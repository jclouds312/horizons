function $L(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in r)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(r,s,i.get?i:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function li(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Xd={exports:{}},Jo={},Qd={exports:{}},We={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R0;function VL(){if(R0)return We;R0=1;var r=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;function m(k){return k===null||typeof k!="object"?null:(k=p&&k[p]||k["@@iterator"],typeof k=="function"?k:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,S={};function T(k,U,re){this.props=k,this.context=U,this.refs=S,this.updater=re||y}T.prototype.isReactComponent={},T.prototype.setState=function(k,U){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,U,"setState")},T.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function A(){}A.prototype=T.prototype;function L(k,U,re){this.props=k,this.context=U,this.refs=S,this.updater=re||y}var w=L.prototype=new A;w.constructor=L,v(w,T.prototype),w.isPureReactComponent=!0;var C=Array.isArray,P=Object.prototype.hasOwnProperty,B={current:null},D={key:!0,ref:!0,__self:!0,__source:!0};function N(k,U,re){var pe,me={},ye=null,ke=null;if(U!=null)for(pe in U.ref!==void 0&&(ke=U.ref),U.key!==void 0&&(ye=""+U.key),U)P.call(U,pe)&&!D.hasOwnProperty(pe)&&(me[pe]=U[pe]);var Ce=arguments.length-2;if(Ce===1)me.children=re;else if(1<Ce){for(var Oe=Array(Ce),He=0;He<Ce;He++)Oe[He]=arguments[He+2];me.children=Oe}if(k&&k.defaultProps)for(pe in Ce=k.defaultProps,Ce)me[pe]===void 0&&(me[pe]=Ce[pe]);return{$$typeof:r,type:k,key:ye,ref:ke,props:me,_owner:B.current}}function F(k,U){return{$$typeof:r,type:k.type,key:U,ref:k.ref,props:k.props,_owner:k._owner}}function O(k){return typeof k=="object"&&k!==null&&k.$$typeof===r}function V(k){var U={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(re){return U[re]})}var H=/\/+/g;function te(k,U){return typeof k=="object"&&k!==null&&k.key!=null?V(""+k.key):U.toString(36)}function X(k,U,re,pe,me){var ye=typeof k;(ye==="undefined"||ye==="boolean")&&(k=null);var ke=!1;if(k===null)ke=!0;else switch(ye){case"string":case"number":ke=!0;break;case"object":switch(k.$$typeof){case r:case e:ke=!0}}if(ke)return ke=k,me=me(ke),k=pe===""?"."+te(ke,0):pe,C(me)?(re="",k!=null&&(re=k.replace(H,"$&/")+"/"),X(me,U,re,"",function(He){return He})):me!=null&&(O(me)&&(me=F(me,re+(!me.key||ke&&ke.key===me.key?"":(""+me.key).replace(H,"$&/")+"/")+k)),U.push(me)),1;if(ke=0,pe=pe===""?".":pe+":",C(k))for(var Ce=0;Ce<k.length;Ce++){ye=k[Ce];var Oe=pe+te(ye,Ce);ke+=X(ye,U,re,Oe,me)}else if(Oe=m(k),typeof Oe=="function")for(k=Oe.call(k),Ce=0;!(ye=k.next()).done;)ye=ye.value,Oe=pe+te(ye,Ce++),ke+=X(ye,U,re,Oe,me);else if(ye==="object")throw U=String(k),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.");return ke}function ae(k,U,re){if(k==null)return k;var pe=[],me=0;return X(k,pe,"","",function(ye){return U.call(re,ye,me++)}),pe}function Q(k){if(k._status===-1){var U=k._result;U=U(),U.then(function(re){(k._status===0||k._status===-1)&&(k._status=1,k._result=re)},function(re){(k._status===0||k._status===-1)&&(k._status=2,k._result=re)}),k._status===-1&&(k._status=0,k._result=U)}if(k._status===1)return k._result.default;throw k._result}var ie={current:null},G={transition:null},ee={ReactCurrentDispatcher:ie,ReactCurrentBatchConfig:G,ReactCurrentOwner:B};function Z(){throw Error("act(...) is not supported in production builds of React.")}return We.Children={map:ae,forEach:function(k,U,re){ae(k,function(){U.apply(this,arguments)},re)},count:function(k){var U=0;return ae(k,function(){U++}),U},toArray:function(k){return ae(k,function(U){return U})||[]},only:function(k){if(!O(k))throw Error("React.Children.only expected to receive a single React element child.");return k}},We.Component=T,We.Fragment=t,We.Profiler=s,We.PureComponent=L,We.StrictMode=n,We.Suspense=d,We.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ee,We.act=Z,We.cloneElement=function(k,U,re){if(k==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+k+".");var pe=v({},k.props),me=k.key,ye=k.ref,ke=k._owner;if(U!=null){if(U.ref!==void 0&&(ye=U.ref,ke=B.current),U.key!==void 0&&(me=""+U.key),k.type&&k.type.defaultProps)var Ce=k.type.defaultProps;for(Oe in U)P.call(U,Oe)&&!D.hasOwnProperty(Oe)&&(pe[Oe]=U[Oe]===void 0&&Ce!==void 0?Ce[Oe]:U[Oe])}var Oe=arguments.length-2;if(Oe===1)pe.children=re;else if(1<Oe){Ce=Array(Oe);for(var He=0;He<Oe;He++)Ce[He]=arguments[He+2];pe.children=Ce}return{$$typeof:r,type:k.type,key:me,ref:ye,props:pe,_owner:ke}},We.createContext=function(k){return k={$$typeof:o,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},k.Provider={$$typeof:i,_context:k},k.Consumer=k},We.createElement=N,We.createFactory=function(k){var U=N.bind(null,k);return U.type=k,U},We.createRef=function(){return{current:null}},We.forwardRef=function(k){return{$$typeof:u,render:k}},We.isValidElement=O,We.lazy=function(k){return{$$typeof:f,_payload:{_status:-1,_result:k},_init:Q}},We.memo=function(k,U){return{$$typeof:c,type:k,compare:U===void 0?null:U}},We.startTransition=function(k){var U=G.transition;G.transition={};try{k()}finally{G.transition=U}},We.unstable_act=Z,We.useCallback=function(k,U){return ie.current.useCallback(k,U)},We.useContext=function(k){return ie.current.useContext(k)},We.useDebugValue=function(){},We.useDeferredValue=function(k){return ie.current.useDeferredValue(k)},We.useEffect=function(k,U){return ie.current.useEffect(k,U)},We.useId=function(){return ie.current.useId()},We.useImperativeHandle=function(k,U,re){return ie.current.useImperativeHandle(k,U,re)},We.useInsertionEffect=function(k,U){return ie.current.useInsertionEffect(k,U)},We.useLayoutEffect=function(k,U){return ie.current.useLayoutEffect(k,U)},We.useMemo=function(k,U){return ie.current.useMemo(k,U)},We.useReducer=function(k,U,re){return ie.current.useReducer(k,U,re)},We.useRef=function(k){return ie.current.useRef(k)},We.useState=function(k){return ie.current.useState(k)},We.useSyncExternalStore=function(k,U,re){return ie.current.useSyncExternalStore(k,U,re)},We.useTransition=function(){return ie.current.useTransition()},We.version="18.3.1",We}var C0;function Da(){return C0||(C0=1,Qd.exports=VL()),Qd.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P0;function GL(){if(P0)return Jo;P0=1;var r=Da(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(u,d,c){var f,p={},m=null,y=null;c!==void 0&&(m=""+c),d.key!==void 0&&(m=""+d.key),d.ref!==void 0&&(y=d.ref);for(f in d)n.call(d,f)&&!i.hasOwnProperty(f)&&(p[f]=d[f]);if(u&&u.defaultProps)for(f in d=u.defaultProps,d)p[f]===void 0&&(p[f]=d[f]);return{$$typeof:e,type:u,key:m,ref:y,props:p,_owner:s.current}}return Jo.Fragment=t,Jo.jsx=o,Jo.jsxs=o,Jo}var _0;function HL(){return _0||(_0=1,Xd.exports=GL()),Xd.exports}var x=HL(),_=Da();const on=li(_),Nx=$L({__proto__:null,default:on},[_]);var zl={},Zd={exports:{}},xn={},Jd={exports:{}},ef={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k0;function KL(){return k0||(k0=1,(function(r){function e(G,ee){var Z=G.length;G.push(ee);e:for(;0<Z;){var k=Z-1>>>1,U=G[k];if(0<s(U,ee))G[k]=ee,G[Z]=U,Z=k;else break e}}function t(G){return G.length===0?null:G[0]}function n(G){if(G.length===0)return null;var ee=G[0],Z=G.pop();if(Z!==ee){G[0]=Z;e:for(var k=0,U=G.length,re=U>>>1;k<re;){var pe=2*(k+1)-1,me=G[pe],ye=pe+1,ke=G[ye];if(0>s(me,Z))ye<U&&0>s(ke,me)?(G[k]=ke,G[ye]=Z,k=ye):(G[k]=me,G[pe]=Z,k=pe);else if(ye<U&&0>s(ke,Z))G[k]=ke,G[ye]=Z,k=ye;else break e}}return ee}function s(G,ee){var Z=G.sortIndex-ee.sortIndex;return Z!==0?Z:G.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var o=Date,u=o.now();r.unstable_now=function(){return o.now()-u}}var d=[],c=[],f=1,p=null,m=3,y=!1,v=!1,S=!1,T=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(G){for(var ee=t(c);ee!==null;){if(ee.callback===null)n(c);else if(ee.startTime<=G)n(c),ee.sortIndex=ee.expirationTime,e(d,ee);else break;ee=t(c)}}function C(G){if(S=!1,w(G),!v)if(t(d)!==null)v=!0,Q(P);else{var ee=t(c);ee!==null&&ie(C,ee.startTime-G)}}function P(G,ee){v=!1,S&&(S=!1,A(N),N=-1),y=!0;var Z=m;try{for(w(ee),p=t(d);p!==null&&(!(p.expirationTime>ee)||G&&!V());){var k=p.callback;if(typeof k=="function"){p.callback=null,m=p.priorityLevel;var U=k(p.expirationTime<=ee);ee=r.unstable_now(),typeof U=="function"?p.callback=U:p===t(d)&&n(d),w(ee)}else n(d);p=t(d)}if(p!==null)var re=!0;else{var pe=t(c);pe!==null&&ie(C,pe.startTime-ee),re=!1}return re}finally{p=null,m=Z,y=!1}}var B=!1,D=null,N=-1,F=5,O=-1;function V(){return!(r.unstable_now()-O<F)}function H(){if(D!==null){var G=r.unstable_now();O=G;var ee=!0;try{ee=D(!0,G)}finally{ee?te():(B=!1,D=null)}}else B=!1}var te;if(typeof L=="function")te=function(){L(H)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,ae=X.port2;X.port1.onmessage=H,te=function(){ae.postMessage(null)}}else te=function(){T(H,0)};function Q(G){D=G,B||(B=!0,te())}function ie(G,ee){N=T(function(){G(r.unstable_now())},ee)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(G){G.callback=null},r.unstable_continueExecution=function(){v||y||(v=!0,Q(P))},r.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<G?Math.floor(1e3/G):5},r.unstable_getCurrentPriorityLevel=function(){return m},r.unstable_getFirstCallbackNode=function(){return t(d)},r.unstable_next=function(G){switch(m){case 1:case 2:case 3:var ee=3;break;default:ee=m}var Z=m;m=ee;try{return G()}finally{m=Z}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(G,ee){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var Z=m;m=G;try{return ee()}finally{m=Z}},r.unstable_scheduleCallback=function(G,ee,Z){var k=r.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?k+Z:k):Z=k,G){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=Z+U,G={id:f++,callback:ee,priorityLevel:G,startTime:Z,expirationTime:U,sortIndex:-1},Z>k?(G.sortIndex=Z,e(c,G),t(d)===null&&G===t(c)&&(S?(A(N),N=-1):S=!0,ie(C,Z-k))):(G.sortIndex=U,e(d,G),v||y||(v=!0,Q(P))),G},r.unstable_shouldYield=V,r.unstable_wrapCallback=function(G){var ee=m;return function(){var Z=m;m=ee;try{return G.apply(this,arguments)}finally{m=Z}}}})(ef)),ef}var D0;function zL(){return D0||(D0=1,Jd.exports=KL()),Jd.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O0;function WL(){if(O0)return xn;O0=1;var r=Da(),e=zL();function t(a){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+a,h=1;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,s={};function i(a,l){o(a,l),o(a+"Capture",l)}function o(a,l){for(s[a]=l,a=0;a<l.length;a++)n.add(l[a])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(a){return d.call(p,a)?!0:d.call(f,a)?!1:c.test(a)?p[a]=!0:(f[a]=!0,!1)}function y(a,l,h,g){if(h!==null&&h.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return g?!1:h!==null?!h.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function v(a,l,h,g){if(l===null||typeof l>"u"||y(a,l,h,g))return!0;if(g)return!1;if(h!==null)switch(h.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function S(a,l,h,g,E,b,R){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=g,this.attributeNamespace=E,this.mustUseProperty=h,this.propertyName=a,this.type=l,this.sanitizeURL=b,this.removeEmptyString=R}var T={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){T[a]=new S(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var l=a[0];T[l]=new S(l,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){T[a]=new S(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){T[a]=new S(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){T[a]=new S(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){T[a]=new S(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){T[a]=new S(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){T[a]=new S(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){T[a]=new S(a,5,!1,a.toLowerCase(),null,!1,!1)});var A=/[\-:]([a-z])/g;function L(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var l=a.replace(A,L);T[l]=new S(l,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var l=a.replace(A,L);T[l]=new S(l,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var l=a.replace(A,L);T[l]=new S(l,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){T[a]=new S(a,1,!1,a.toLowerCase(),null,!1,!1)}),T.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){T[a]=new S(a,1,!1,a.toLowerCase(),null,!0,!0)});function w(a,l,h,g){var E=T.hasOwnProperty(l)?T[l]:null;(E!==null?E.type!==0:g||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(v(l,h,E,g)&&(h=null),g||E===null?m(l)&&(h===null?a.removeAttribute(l):a.setAttribute(l,""+h)):E.mustUseProperty?a[E.propertyName]=h===null?E.type===3?!1:"":h:(l=E.attributeName,g=E.attributeNamespace,h===null?a.removeAttribute(l):(E=E.type,h=E===3||E===4&&h===!0?"":""+h,g?a.setAttributeNS(g,l,h):a.setAttribute(l,h))))}var C=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,P=Symbol.for("react.element"),B=Symbol.for("react.portal"),D=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),O=Symbol.for("react.provider"),V=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),te=Symbol.for("react.suspense"),X=Symbol.for("react.suspense_list"),ae=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),ie=Symbol.for("react.offscreen"),G=Symbol.iterator;function ee(a){return a===null||typeof a!="object"?null:(a=G&&a[G]||a["@@iterator"],typeof a=="function"?a:null)}var Z=Object.assign,k;function U(a){if(k===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);k=l&&l[1]||""}return`
`+k+a}var re=!1;function pe(a,l){if(!a||re)return"";re=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(J){var g=J}Reflect.construct(a,[],l)}else{try{l.call()}catch(J){g=J}a.call(l.prototype)}else{try{throw Error()}catch(J){g=J}a()}}catch(J){if(J&&g&&typeof J.stack=="string"){for(var E=J.stack.split(`
`),b=g.stack.split(`
`),R=E.length-1,M=b.length-1;1<=R&&0<=M&&E[R]!==b[M];)M--;for(;1<=R&&0<=M;R--,M--)if(E[R]!==b[M]){if(R!==1||M!==1)do if(R--,M--,0>M||E[R]!==b[M]){var j=`
`+E[R].replace(" at new "," at ");return a.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",a.displayName)),j}while(1<=R&&0<=M);break}}}finally{re=!1,Error.prepareStackTrace=h}return(a=a?a.displayName||a.name:"")?U(a):""}function me(a){switch(a.tag){case 5:return U(a.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return a=pe(a.type,!1),a;case 11:return a=pe(a.type.render,!1),a;case 1:return a=pe(a.type,!0),a;default:return""}}function ye(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case D:return"Fragment";case B:return"Portal";case F:return"Profiler";case N:return"StrictMode";case te:return"Suspense";case X:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case V:return(a.displayName||"Context")+".Consumer";case O:return(a._context.displayName||"Context")+".Provider";case H:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case ae:return l=a.displayName||null,l!==null?l:ye(a.type)||"Memo";case Q:l=a._payload,a=a._init;try{return ye(a(l))}catch{}}return null}function ke(a){var l=a.type;switch(a.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=l.render,a=a.displayName||a.name||"",l.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ye(l);case 8:return l===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function Ce(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Oe(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function He(a){var l=Oe(a)?"checked":"value",h=Object.getOwnPropertyDescriptor(a.constructor.prototype,l),g=""+a[l];if(!a.hasOwnProperty(l)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var E=h.get,b=h.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return E.call(this)},set:function(R){g=""+R,b.call(this,R)}}),Object.defineProperty(a,l,{enumerable:h.enumerable}),{getValue:function(){return g},setValue:function(R){g=""+R},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function Ke(a){a._valueTracker||(a._valueTracker=He(a))}function Gt(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var h=l.getValue(),g="";return a&&(g=Oe(a)?a.checked?"true":"false":a.value),a=g,a!==h?(l.setValue(a),!0):!1}function xt(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Sr(a,l){var h=l.checked;return Z({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??a._wrapperState.initialChecked})}function fi(a,l){var h=l.defaultValue==null?"":l.defaultValue,g=l.checked!=null?l.checked:l.defaultChecked;h=Ce(l.value!=null?l.value:h),a._wrapperState={initialChecked:g,initialValue:h,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function ze(a,l){l=l.checked,l!=null&&w(a,"checked",l,!1)}function wt(a,l){ze(a,l);var h=Ce(l.value),g=l.type;if(h!=null)g==="number"?(h===0&&a.value===""||a.value!=h)&&(a.value=""+h):a.value!==""+h&&(a.value=""+h);else if(g==="submit"||g==="reset"){a.removeAttribute("value");return}l.hasOwnProperty("value")?Ln(a,l.type,h):l.hasOwnProperty("defaultValue")&&Ln(a,l.type,Ce(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(a.defaultChecked=!!l.defaultChecked)}function Dt(a,l,h){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var g=l.type;if(!(g!=="submit"&&g!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+a._wrapperState.initialValue,h||l===a.value||(a.value=l),a.defaultValue=l}h=a.name,h!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,h!==""&&(a.name=h)}function Ln(a,l,h){(l!=="number"||xt(a.ownerDocument)!==a)&&(h==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+h&&(a.defaultValue=""+h))}var Ot=Array.isArray;function Yt(a,l,h,g){if(a=a.options,l){l={};for(var E=0;E<h.length;E++)l["$"+h[E]]=!0;for(h=0;h<a.length;h++)E=l.hasOwnProperty("$"+a[h].value),a[h].selected!==E&&(a[h].selected=E),E&&g&&(a[h].defaultSelected=!0)}else{for(h=""+Ce(h),l=null,E=0;E<a.length;E++){if(a[E].value===h){a[E].selected=!0,g&&(a[E].defaultSelected=!0);return}l!==null||a[E].disabled||(l=a[E])}l!==null&&(l.selected=!0)}}function Jt(a,l){if(l.dangerouslySetInnerHTML!=null)throw Error(t(91));return Z({},l,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function br(a,l){var h=l.value;if(h==null){if(h=l.children,l=l.defaultValue,h!=null){if(l!=null)throw Error(t(92));if(Ot(h)){if(1<h.length)throw Error(t(93));h=h[0]}l=h}l==null&&(l=""),h=l}a._wrapperState={initialValue:Ce(h)}}function Ar(a,l){var h=Ce(l.value),g=Ce(l.defaultValue);h!=null&&(h=""+h,h!==a.value&&(a.value=h),l.defaultValue==null&&a.defaultValue!==h&&(a.defaultValue=h)),g!=null&&(a.defaultValue=""+g)}function le(a){var l=a.textContent;l===a._wrapperState.initialValue&&l!==""&&l!==null&&(a.value=l)}function Y(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function de(a,l){return a==null||a==="http://www.w3.org/1999/xhtml"?Y(l):a==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var fe,Be=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,h,g,E){MSApp.execUnsafeLocalFunction(function(){return a(l,h,g,E)})}:a})(function(a,l){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=l;else{for(fe=fe||document.createElement("div"),fe.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=fe.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild)}});function Fe(a,l){if(l){var h=a.firstChild;if(h&&h===a.lastChild&&h.nodeType===3){h.nodeValue=l;return}}a.textContent=l}var $e={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ne=["Webkit","ms","Moz","O"];Object.keys($e).forEach(function(a){ne.forEach(function(l){l=l+a.charAt(0).toUpperCase()+a.substring(1),$e[l]=$e[a]})});function oe(a,l,h){return l==null||typeof l=="boolean"||l===""?"":h||typeof l!="number"||l===0||$e.hasOwnProperty(a)&&$e[a]?(""+l).trim():l+"px"}function Le(a,l){a=a.style;for(var h in l)if(l.hasOwnProperty(h)){var g=h.indexOf("--")===0,E=oe(h,l[h],g);h==="float"&&(h="cssFloat"),g?a.setProperty(h,E):a[h]=E}}var be=Z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ee(a,l){if(l){if(be[a]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(t(137,a));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(t(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(t(61))}if(l.style!=null&&typeof l.style!="object")throw Error(t(62))}}function Ve(a,l){if(a.indexOf("-")===-1)return typeof l.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var st=null;function it(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ze=null,mt=null,ot=null;function Bt(a){if(a=Bo(a)){if(typeof Ze!="function")throw Error(t(280));var l=a.stateNode;l&&(l=al(l),Ze(a.stateNode,a.type,l))}}function Lr(a){mt?ot?ot.push(a):ot=[a]:mt=a}function ir(){if(mt){var a=mt,l=ot;if(ot=mt=null,Bt(a),l)for(a=0;a<l.length;a++)Bt(l[a])}}function _s(a,l){return a(l)}function go(){}var hi=!1;function Xp(a,l,h){if(hi)return a(l,h);hi=!0;try{return _s(a,l,h)}finally{hi=!1,(mt!==null||ot!==null)&&(go(),ir())}}function yo(a,l){var h=a.stateNode;if(h===null)return null;var g=al(h);if(g===null)return null;h=g[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(a=a.type,g=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!g;break e;default:a=!1}if(a)return null;if(h&&typeof h!="function")throw Error(t(231,l,typeof h));return h}var pc=!1;if(u)try{var vo={};Object.defineProperty(vo,"passive",{get:function(){pc=!0}}),window.addEventListener("test",vo,vo),window.removeEventListener("test",vo,vo)}catch{pc=!1}function Wb(a,l,h,g,E,b,R,M,j){var J=Array.prototype.slice.call(arguments,3);try{l.apply(h,J)}catch(ce){this.onError(ce)}}var xo=!1,Ua=null,ja=!1,mc=null,Yb={onError:function(a){xo=!0,Ua=a}};function qb(a,l,h,g,E,b,R,M,j){xo=!1,Ua=null,Wb.apply(Yb,arguments)}function Xb(a,l,h,g,E,b,R,M,j){if(qb.apply(this,arguments),xo){if(xo){var J=Ua;xo=!1,Ua=null}else throw Error(t(198));ja||(ja=!0,mc=J)}}function ks(a){var l=a,h=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(h=l.return),a=l.return;while(a)}return l.tag===3?h:null}function Qp(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function Zp(a){if(ks(a)!==a)throw Error(t(188))}function Qb(a){var l=a.alternate;if(!l){if(l=ks(a),l===null)throw Error(t(188));return l!==a?null:a}for(var h=a,g=l;;){var E=h.return;if(E===null)break;var b=E.alternate;if(b===null){if(g=E.return,g!==null){h=g;continue}break}if(E.child===b.child){for(b=E.child;b;){if(b===h)return Zp(E),a;if(b===g)return Zp(E),l;b=b.sibling}throw Error(t(188))}if(h.return!==g.return)h=E,g=b;else{for(var R=!1,M=E.child;M;){if(M===h){R=!0,h=E,g=b;break}if(M===g){R=!0,g=E,h=b;break}M=M.sibling}if(!R){for(M=b.child;M;){if(M===h){R=!0,h=b,g=E;break}if(M===g){R=!0,g=b,h=E;break}M=M.sibling}if(!R)throw Error(t(189))}}if(h.alternate!==g)throw Error(t(190))}if(h.tag!==3)throw Error(t(188));return h.stateNode.current===h?a:l}function Jp(a){return a=Qb(a),a!==null?em(a):null}function em(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var l=em(a);if(l!==null)return l;a=a.sibling}return null}var tm=e.unstable_scheduleCallback,nm=e.unstable_cancelCallback,Zb=e.unstable_shouldYield,Jb=e.unstable_requestPaint,Pt=e.unstable_now,eA=e.unstable_getCurrentPriorityLevel,gc=e.unstable_ImmediatePriority,rm=e.unstable_UserBlockingPriority,$a=e.unstable_NormalPriority,tA=e.unstable_LowPriority,sm=e.unstable_IdlePriority,Va=null,or=null;function nA(a){if(or&&typeof or.onCommitFiberRoot=="function")try{or.onCommitFiberRoot(Va,a,void 0,(a.current.flags&128)===128)}catch{}}var Yn=Math.clz32?Math.clz32:iA,rA=Math.log,sA=Math.LN2;function iA(a){return a>>>=0,a===0?32:31-(rA(a)/sA|0)|0}var Ga=64,Ha=4194304;function Eo(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Ka(a,l){var h=a.pendingLanes;if(h===0)return 0;var g=0,E=a.suspendedLanes,b=a.pingedLanes,R=h&268435455;if(R!==0){var M=R&~E;M!==0?g=Eo(M):(b&=R,b!==0&&(g=Eo(b)))}else R=h&~E,R!==0?g=Eo(R):b!==0&&(g=Eo(b));if(g===0)return 0;if(l!==0&&l!==g&&(l&E)===0&&(E=g&-g,b=l&-l,E>=b||E===16&&(b&4194240)!==0))return l;if((g&4)!==0&&(g|=h&16),l=a.entangledLanes,l!==0)for(a=a.entanglements,l&=g;0<l;)h=31-Yn(l),E=1<<h,g|=a[h],l&=~E;return g}function oA(a,l){switch(a){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function aA(a,l){for(var h=a.suspendedLanes,g=a.pingedLanes,E=a.expirationTimes,b=a.pendingLanes;0<b;){var R=31-Yn(b),M=1<<R,j=E[R];j===-1?((M&h)===0||(M&g)!==0)&&(E[R]=oA(M,l)):j<=l&&(a.expiredLanes|=M),b&=~M}}function yc(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function im(){var a=Ga;return Ga<<=1,(Ga&4194240)===0&&(Ga=64),a}function vc(a){for(var l=[],h=0;31>h;h++)l.push(a);return l}function To(a,l,h){a.pendingLanes|=l,l!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,l=31-Yn(l),a[l]=h}function lA(a,l){var h=a.pendingLanes&~l;a.pendingLanes=l,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=l,a.mutableReadLanes&=l,a.entangledLanes&=l,l=a.entanglements;var g=a.eventTimes;for(a=a.expirationTimes;0<h;){var E=31-Yn(h),b=1<<E;l[E]=0,g[E]=-1,a[E]=-1,h&=~b}}function xc(a,l){var h=a.entangledLanes|=l;for(a=a.entanglements;h;){var g=31-Yn(h),E=1<<g;E&l|a[g]&l&&(a[g]|=l),h&=~E}}var Je=0;function om(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var am,Ec,lm,um,cm,Tc=!1,za=[],Wr=null,Yr=null,qr=null,So=new Map,bo=new Map,Xr=[],uA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function dm(a,l){switch(a){case"focusin":case"focusout":Wr=null;break;case"dragenter":case"dragleave":Yr=null;break;case"mouseover":case"mouseout":qr=null;break;case"pointerover":case"pointerout":So.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":bo.delete(l.pointerId)}}function Ao(a,l,h,g,E,b){return a===null||a.nativeEvent!==b?(a={blockedOn:l,domEventName:h,eventSystemFlags:g,nativeEvent:b,targetContainers:[E]},l!==null&&(l=Bo(l),l!==null&&Ec(l)),a):(a.eventSystemFlags|=g,l=a.targetContainers,E!==null&&l.indexOf(E)===-1&&l.push(E),a)}function cA(a,l,h,g,E){switch(l){case"focusin":return Wr=Ao(Wr,a,l,h,g,E),!0;case"dragenter":return Yr=Ao(Yr,a,l,h,g,E),!0;case"mouseover":return qr=Ao(qr,a,l,h,g,E),!0;case"pointerover":var b=E.pointerId;return So.set(b,Ao(So.get(b)||null,a,l,h,g,E)),!0;case"gotpointercapture":return b=E.pointerId,bo.set(b,Ao(bo.get(b)||null,a,l,h,g,E)),!0}return!1}function fm(a){var l=Ds(a.target);if(l!==null){var h=ks(l);if(h!==null){if(l=h.tag,l===13){if(l=Qp(h),l!==null){a.blockedOn=l,cm(a.priority,function(){lm(h)});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){a.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Wa(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var h=bc(a.domEventName,a.eventSystemFlags,l[0],a.nativeEvent);if(h===null){h=a.nativeEvent;var g=new h.constructor(h.type,h);st=g,h.target.dispatchEvent(g),st=null}else return l=Bo(h),l!==null&&Ec(l),a.blockedOn=h,!1;l.shift()}return!0}function hm(a,l,h){Wa(a)&&h.delete(l)}function dA(){Tc=!1,Wr!==null&&Wa(Wr)&&(Wr=null),Yr!==null&&Wa(Yr)&&(Yr=null),qr!==null&&Wa(qr)&&(qr=null),So.forEach(hm),bo.forEach(hm)}function Lo(a,l){a.blockedOn===l&&(a.blockedOn=null,Tc||(Tc=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,dA)))}function Io(a){function l(E){return Lo(E,a)}if(0<za.length){Lo(za[0],a);for(var h=1;h<za.length;h++){var g=za[h];g.blockedOn===a&&(g.blockedOn=null)}}for(Wr!==null&&Lo(Wr,a),Yr!==null&&Lo(Yr,a),qr!==null&&Lo(qr,a),So.forEach(l),bo.forEach(l),h=0;h<Xr.length;h++)g=Xr[h],g.blockedOn===a&&(g.blockedOn=null);for(;0<Xr.length&&(h=Xr[0],h.blockedOn===null);)fm(h),h.blockedOn===null&&Xr.shift()}var pi=C.ReactCurrentBatchConfig,Ya=!0;function fA(a,l,h,g){var E=Je,b=pi.transition;pi.transition=null;try{Je=1,Sc(a,l,h,g)}finally{Je=E,pi.transition=b}}function hA(a,l,h,g){var E=Je,b=pi.transition;pi.transition=null;try{Je=4,Sc(a,l,h,g)}finally{Je=E,pi.transition=b}}function Sc(a,l,h,g){if(Ya){var E=bc(a,l,h,g);if(E===null)jc(a,l,g,qa,h),dm(a,g);else if(cA(E,a,l,h,g))g.stopPropagation();else if(dm(a,g),l&4&&-1<uA.indexOf(a)){for(;E!==null;){var b=Bo(E);if(b!==null&&am(b),b=bc(a,l,h,g),b===null&&jc(a,l,g,qa,h),b===E)break;E=b}E!==null&&g.stopPropagation()}else jc(a,l,g,null,h)}}var qa=null;function bc(a,l,h,g){if(qa=null,a=it(g),a=Ds(a),a!==null)if(l=ks(a),l===null)a=null;else if(h=l.tag,h===13){if(a=Qp(l),a!==null)return a;a=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null);return qa=a,null}function pm(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(eA()){case gc:return 1;case rm:return 4;case $a:case tA:return 16;case sm:return 536870912;default:return 16}default:return 16}}var Qr=null,Ac=null,Xa=null;function mm(){if(Xa)return Xa;var a,l=Ac,h=l.length,g,E="value"in Qr?Qr.value:Qr.textContent,b=E.length;for(a=0;a<h&&l[a]===E[a];a++);var R=h-a;for(g=1;g<=R&&l[h-g]===E[b-g];g++);return Xa=E.slice(a,1<g?1-g:void 0)}function Qa(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function Za(){return!0}function gm(){return!1}function In(a){function l(h,g,E,b,R){this._reactName=h,this._targetInst=E,this.type=g,this.nativeEvent=b,this.target=R,this.currentTarget=null;for(var M in a)a.hasOwnProperty(M)&&(h=a[M],this[M]=h?h(b):b[M]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Za:gm,this.isPropagationStopped=gm,this}return Z(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Za)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Za)},persist:function(){},isPersistent:Za}),l}var mi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Lc=In(mi),wo=Z({},mi,{view:0,detail:0}),pA=In(wo),Ic,wc,Ro,Ja=Z({},wo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cc,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ro&&(Ro&&a.type==="mousemove"?(Ic=a.screenX-Ro.screenX,wc=a.screenY-Ro.screenY):wc=Ic=0,Ro=a),Ic)},movementY:function(a){return"movementY"in a?a.movementY:wc}}),ym=In(Ja),mA=Z({},Ja,{dataTransfer:0}),gA=In(mA),yA=Z({},wo,{relatedTarget:0}),Rc=In(yA),vA=Z({},mi,{animationName:0,elapsedTime:0,pseudoElement:0}),xA=In(vA),EA=Z({},mi,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),TA=In(EA),SA=Z({},mi,{data:0}),vm=In(SA),bA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},AA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},LA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function IA(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=LA[a])?!!l[a]:!1}function Cc(){return IA}var wA=Z({},wo,{key:function(a){if(a.key){var l=bA[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=Qa(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?AA[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cc,charCode:function(a){return a.type==="keypress"?Qa(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Qa(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),RA=In(wA),CA=Z({},Ja,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xm=In(CA),PA=Z({},wo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cc}),_A=In(PA),kA=Z({},mi,{propertyName:0,elapsedTime:0,pseudoElement:0}),DA=In(kA),OA=Z({},Ja,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),NA=In(OA),MA=[9,13,27,32],Pc=u&&"CompositionEvent"in window,Co=null;u&&"documentMode"in document&&(Co=document.documentMode);var FA=u&&"TextEvent"in window&&!Co,Em=u&&(!Pc||Co&&8<Co&&11>=Co),Tm=" ",Sm=!1;function bm(a,l){switch(a){case"keyup":return MA.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Am(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var gi=!1;function BA(a,l){switch(a){case"compositionend":return Am(l);case"keypress":return l.which!==32?null:(Sm=!0,Tm);case"textInput":return a=l.data,a===Tm&&Sm?null:a;default:return null}}function UA(a,l){if(gi)return a==="compositionend"||!Pc&&bm(a,l)?(a=mm(),Xa=Ac=Qr=null,gi=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return Em&&l.locale!=="ko"?null:l.data;default:return null}}var jA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lm(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!jA[a.type]:l==="textarea"}function Im(a,l,h,g){Lr(g),l=sl(l,"onChange"),0<l.length&&(h=new Lc("onChange","change",null,h,g),a.push({event:h,listeners:l}))}var Po=null,_o=null;function $A(a){Hm(a,0)}function el(a){var l=Ti(a);if(Gt(l))return a}function VA(a,l){if(a==="change")return l}var wm=!1;if(u){var _c;if(u){var kc="oninput"in document;if(!kc){var Rm=document.createElement("div");Rm.setAttribute("oninput","return;"),kc=typeof Rm.oninput=="function"}_c=kc}else _c=!1;wm=_c&&(!document.documentMode||9<document.documentMode)}function Cm(){Po&&(Po.detachEvent("onpropertychange",Pm),_o=Po=null)}function Pm(a){if(a.propertyName==="value"&&el(_o)){var l=[];Im(l,_o,a,it(a)),Xp($A,l)}}function GA(a,l,h){a==="focusin"?(Cm(),Po=l,_o=h,Po.attachEvent("onpropertychange",Pm)):a==="focusout"&&Cm()}function HA(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return el(_o)}function KA(a,l){if(a==="click")return el(l)}function zA(a,l){if(a==="input"||a==="change")return el(l)}function WA(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var qn=typeof Object.is=="function"?Object.is:WA;function ko(a,l){if(qn(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var h=Object.keys(a),g=Object.keys(l);if(h.length!==g.length)return!1;for(g=0;g<h.length;g++){var E=h[g];if(!d.call(l,E)||!qn(a[E],l[E]))return!1}return!0}function _m(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function km(a,l){var h=_m(a);a=0;for(var g;h;){if(h.nodeType===3){if(g=a+h.textContent.length,a<=l&&g>=l)return{node:h,offset:l-a};a=g}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=_m(h)}}function Dm(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?Dm(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function Om(){for(var a=window,l=xt();l instanceof a.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)a=l.contentWindow;else break;l=xt(a.document)}return l}function Dc(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}function YA(a){var l=Om(),h=a.focusedElem,g=a.selectionRange;if(l!==h&&h&&h.ownerDocument&&Dm(h.ownerDocument.documentElement,h)){if(g!==null&&Dc(h)){if(l=g.start,a=g.end,a===void 0&&(a=l),"selectionStart"in h)h.selectionStart=l,h.selectionEnd=Math.min(a,h.value.length);else if(a=(l=h.ownerDocument||document)&&l.defaultView||window,a.getSelection){a=a.getSelection();var E=h.textContent.length,b=Math.min(g.start,E);g=g.end===void 0?b:Math.min(g.end,E),!a.extend&&b>g&&(E=g,g=b,b=E),E=km(h,b);var R=km(h,g);E&&R&&(a.rangeCount!==1||a.anchorNode!==E.node||a.anchorOffset!==E.offset||a.focusNode!==R.node||a.focusOffset!==R.offset)&&(l=l.createRange(),l.setStart(E.node,E.offset),a.removeAllRanges(),b>g?(a.addRange(l),a.extend(R.node,R.offset)):(l.setEnd(R.node,R.offset),a.addRange(l)))}}for(l=[],a=h;a=a.parentNode;)a.nodeType===1&&l.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<l.length;h++)a=l[h],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var qA=u&&"documentMode"in document&&11>=document.documentMode,yi=null,Oc=null,Do=null,Nc=!1;function Nm(a,l,h){var g=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Nc||yi==null||yi!==xt(g)||(g=yi,"selectionStart"in g&&Dc(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Do&&ko(Do,g)||(Do=g,g=sl(Oc,"onSelect"),0<g.length&&(l=new Lc("onSelect","select",null,l,h),a.push({event:l,listeners:g}),l.target=yi)))}function tl(a,l){var h={};return h[a.toLowerCase()]=l.toLowerCase(),h["Webkit"+a]="webkit"+l,h["Moz"+a]="moz"+l,h}var vi={animationend:tl("Animation","AnimationEnd"),animationiteration:tl("Animation","AnimationIteration"),animationstart:tl("Animation","AnimationStart"),transitionend:tl("Transition","TransitionEnd")},Mc={},Mm={};u&&(Mm=document.createElement("div").style,"AnimationEvent"in window||(delete vi.animationend.animation,delete vi.animationiteration.animation,delete vi.animationstart.animation),"TransitionEvent"in window||delete vi.transitionend.transition);function nl(a){if(Mc[a])return Mc[a];if(!vi[a])return a;var l=vi[a],h;for(h in l)if(l.hasOwnProperty(h)&&h in Mm)return Mc[a]=l[h];return a}var Fm=nl("animationend"),Bm=nl("animationiteration"),Um=nl("animationstart"),jm=nl("transitionend"),$m=new Map,Vm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zr(a,l){$m.set(a,l),i(l,[a])}for(var Fc=0;Fc<Vm.length;Fc++){var Bc=Vm[Fc],XA=Bc.toLowerCase(),QA=Bc[0].toUpperCase()+Bc.slice(1);Zr(XA,"on"+QA)}Zr(Fm,"onAnimationEnd"),Zr(Bm,"onAnimationIteration"),Zr(Um,"onAnimationStart"),Zr("dblclick","onDoubleClick"),Zr("focusin","onFocus"),Zr("focusout","onBlur"),Zr(jm,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ZA=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oo));function Gm(a,l,h){var g=a.type||"unknown-event";a.currentTarget=h,Xb(g,l,void 0,a),a.currentTarget=null}function Hm(a,l){l=(l&4)!==0;for(var h=0;h<a.length;h++){var g=a[h],E=g.event;g=g.listeners;e:{var b=void 0;if(l)for(var R=g.length-1;0<=R;R--){var M=g[R],j=M.instance,J=M.currentTarget;if(M=M.listener,j!==b&&E.isPropagationStopped())break e;Gm(E,M,J),b=j}else for(R=0;R<g.length;R++){if(M=g[R],j=M.instance,J=M.currentTarget,M=M.listener,j!==b&&E.isPropagationStopped())break e;Gm(E,M,J),b=j}}}if(ja)throw a=mc,ja=!1,mc=null,a}function ft(a,l){var h=l[zc];h===void 0&&(h=l[zc]=new Set);var g=a+"__bubble";h.has(g)||(Km(l,a,2,!1),h.add(g))}function Uc(a,l,h){var g=0;l&&(g|=4),Km(h,a,g,l)}var rl="_reactListening"+Math.random().toString(36).slice(2);function No(a){if(!a[rl]){a[rl]=!0,n.forEach(function(h){h!=="selectionchange"&&(ZA.has(h)||Uc(h,!1,a),Uc(h,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[rl]||(l[rl]=!0,Uc("selectionchange",!1,l))}}function Km(a,l,h,g){switch(pm(l)){case 1:var E=fA;break;case 4:E=hA;break;default:E=Sc}h=E.bind(null,l,h,a),E=void 0,!pc||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(E=!0),g?E!==void 0?a.addEventListener(l,h,{capture:!0,passive:E}):a.addEventListener(l,h,!0):E!==void 0?a.addEventListener(l,h,{passive:E}):a.addEventListener(l,h,!1)}function jc(a,l,h,g,E){var b=g;if((l&1)===0&&(l&2)===0&&g!==null)e:for(;;){if(g===null)return;var R=g.tag;if(R===3||R===4){var M=g.stateNode.containerInfo;if(M===E||M.nodeType===8&&M.parentNode===E)break;if(R===4)for(R=g.return;R!==null;){var j=R.tag;if((j===3||j===4)&&(j=R.stateNode.containerInfo,j===E||j.nodeType===8&&j.parentNode===E))return;R=R.return}for(;M!==null;){if(R=Ds(M),R===null)return;if(j=R.tag,j===5||j===6){g=b=R;continue e}M=M.parentNode}}g=g.return}Xp(function(){var J=b,ce=it(h),he=[];e:{var ue=$m.get(a);if(ue!==void 0){var xe=Lc,Ae=a;switch(a){case"keypress":if(Qa(h)===0)break e;case"keydown":case"keyup":xe=RA;break;case"focusin":Ae="focus",xe=Rc;break;case"focusout":Ae="blur",xe=Rc;break;case"beforeblur":case"afterblur":xe=Rc;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xe=ym;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xe=gA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xe=_A;break;case Fm:case Bm:case Um:xe=xA;break;case jm:xe=DA;break;case"scroll":xe=pA;break;case"wheel":xe=NA;break;case"copy":case"cut":case"paste":xe=TA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xe=xm}var Ie=(l&4)!==0,_t=!Ie&&a==="scroll",W=Ie?ue!==null?ue+"Capture":null:ue;Ie=[];for(var $=J,q;$!==null;){q=$;var ge=q.stateNode;if(q.tag===5&&ge!==null&&(q=ge,W!==null&&(ge=yo($,W),ge!=null&&Ie.push(Mo($,ge,q)))),_t)break;$=$.return}0<Ie.length&&(ue=new xe(ue,Ae,null,h,ce),he.push({event:ue,listeners:Ie}))}}if((l&7)===0){e:{if(ue=a==="mouseover"||a==="pointerover",xe=a==="mouseout"||a==="pointerout",ue&&h!==st&&(Ae=h.relatedTarget||h.fromElement)&&(Ds(Ae)||Ae[Ir]))break e;if((xe||ue)&&(ue=ce.window===ce?ce:(ue=ce.ownerDocument)?ue.defaultView||ue.parentWindow:window,xe?(Ae=h.relatedTarget||h.toElement,xe=J,Ae=Ae?Ds(Ae):null,Ae!==null&&(_t=ks(Ae),Ae!==_t||Ae.tag!==5&&Ae.tag!==6)&&(Ae=null)):(xe=null,Ae=J),xe!==Ae)){if(Ie=ym,ge="onMouseLeave",W="onMouseEnter",$="mouse",(a==="pointerout"||a==="pointerover")&&(Ie=xm,ge="onPointerLeave",W="onPointerEnter",$="pointer"),_t=xe==null?ue:Ti(xe),q=Ae==null?ue:Ti(Ae),ue=new Ie(ge,$+"leave",xe,h,ce),ue.target=_t,ue.relatedTarget=q,ge=null,Ds(ce)===J&&(Ie=new Ie(W,$+"enter",Ae,h,ce),Ie.target=q,Ie.relatedTarget=_t,ge=Ie),_t=ge,xe&&Ae)t:{for(Ie=xe,W=Ae,$=0,q=Ie;q;q=xi(q))$++;for(q=0,ge=W;ge;ge=xi(ge))q++;for(;0<$-q;)Ie=xi(Ie),$--;for(;0<q-$;)W=xi(W),q--;for(;$--;){if(Ie===W||W!==null&&Ie===W.alternate)break t;Ie=xi(Ie),W=xi(W)}Ie=null}else Ie=null;xe!==null&&zm(he,ue,xe,Ie,!1),Ae!==null&&_t!==null&&zm(he,_t,Ae,Ie,!0)}}e:{if(ue=J?Ti(J):window,xe=ue.nodeName&&ue.nodeName.toLowerCase(),xe==="select"||xe==="input"&&ue.type==="file")var Re=VA;else if(Lm(ue))if(wm)Re=zA;else{Re=HA;var Pe=GA}else(xe=ue.nodeName)&&xe.toLowerCase()==="input"&&(ue.type==="checkbox"||ue.type==="radio")&&(Re=KA);if(Re&&(Re=Re(a,J))){Im(he,Re,h,ce);break e}Pe&&Pe(a,ue,J),a==="focusout"&&(Pe=ue._wrapperState)&&Pe.controlled&&ue.type==="number"&&Ln(ue,"number",ue.value)}switch(Pe=J?Ti(J):window,a){case"focusin":(Lm(Pe)||Pe.contentEditable==="true")&&(yi=Pe,Oc=J,Do=null);break;case"focusout":Do=Oc=yi=null;break;case"mousedown":Nc=!0;break;case"contextmenu":case"mouseup":case"dragend":Nc=!1,Nm(he,h,ce);break;case"selectionchange":if(qA)break;case"keydown":case"keyup":Nm(he,h,ce)}var _e;if(Pc)e:{switch(a){case"compositionstart":var Ne="onCompositionStart";break e;case"compositionend":Ne="onCompositionEnd";break e;case"compositionupdate":Ne="onCompositionUpdate";break e}Ne=void 0}else gi?bm(a,h)&&(Ne="onCompositionEnd"):a==="keydown"&&h.keyCode===229&&(Ne="onCompositionStart");Ne&&(Em&&h.locale!=="ko"&&(gi||Ne!=="onCompositionStart"?Ne==="onCompositionEnd"&&gi&&(_e=mm()):(Qr=ce,Ac="value"in Qr?Qr.value:Qr.textContent,gi=!0)),Pe=sl(J,Ne),0<Pe.length&&(Ne=new vm(Ne,a,null,h,ce),he.push({event:Ne,listeners:Pe}),_e?Ne.data=_e:(_e=Am(h),_e!==null&&(Ne.data=_e)))),(_e=FA?BA(a,h):UA(a,h))&&(J=sl(J,"onBeforeInput"),0<J.length&&(ce=new vm("onBeforeInput","beforeinput",null,h,ce),he.push({event:ce,listeners:J}),ce.data=_e))}Hm(he,l)})}function Mo(a,l,h){return{instance:a,listener:l,currentTarget:h}}function sl(a,l){for(var h=l+"Capture",g=[];a!==null;){var E=a,b=E.stateNode;E.tag===5&&b!==null&&(E=b,b=yo(a,h),b!=null&&g.unshift(Mo(a,b,E)),b=yo(a,l),b!=null&&g.push(Mo(a,b,E))),a=a.return}return g}function xi(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function zm(a,l,h,g,E){for(var b=l._reactName,R=[];h!==null&&h!==g;){var M=h,j=M.alternate,J=M.stateNode;if(j!==null&&j===g)break;M.tag===5&&J!==null&&(M=J,E?(j=yo(h,b),j!=null&&R.unshift(Mo(h,j,M))):E||(j=yo(h,b),j!=null&&R.push(Mo(h,j,M)))),h=h.return}R.length!==0&&a.push({event:l,listeners:R})}var JA=/\r\n?/g,eL=/\u0000|\uFFFD/g;function Wm(a){return(typeof a=="string"?a:""+a).replace(JA,`
`).replace(eL,"")}function il(a,l,h){if(l=Wm(l),Wm(a)!==l&&h)throw Error(t(425))}function ol(){}var $c=null,Vc=null;function Gc(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Hc=typeof setTimeout=="function"?setTimeout:void 0,tL=typeof clearTimeout=="function"?clearTimeout:void 0,Ym=typeof Promise=="function"?Promise:void 0,nL=typeof queueMicrotask=="function"?queueMicrotask:typeof Ym<"u"?function(a){return Ym.resolve(null).then(a).catch(rL)}:Hc;function rL(a){setTimeout(function(){throw a})}function Kc(a,l){var h=l,g=0;do{var E=h.nextSibling;if(a.removeChild(h),E&&E.nodeType===8)if(h=E.data,h==="/$"){if(g===0){a.removeChild(E),Io(l);return}g--}else h!=="$"&&h!=="$?"&&h!=="$!"||g++;h=E}while(h);Io(l)}function Jr(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return a}function qm(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var h=a.data;if(h==="$"||h==="$!"||h==="$?"){if(l===0)return a;l--}else h==="/$"&&l++}a=a.previousSibling}return null}var Ei=Math.random().toString(36).slice(2),ar="__reactFiber$"+Ei,Fo="__reactProps$"+Ei,Ir="__reactContainer$"+Ei,zc="__reactEvents$"+Ei,sL="__reactListeners$"+Ei,iL="__reactHandles$"+Ei;function Ds(a){var l=a[ar];if(l)return l;for(var h=a.parentNode;h;){if(l=h[Ir]||h[ar]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(a=qm(a);a!==null;){if(h=a[ar])return h;a=qm(a)}return l}a=h,h=a.parentNode}return null}function Bo(a){return a=a[ar]||a[Ir],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function Ti(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(t(33))}function al(a){return a[Fo]||null}var Wc=[],Si=-1;function es(a){return{current:a}}function ht(a){0>Si||(a.current=Wc[Si],Wc[Si]=null,Si--)}function ut(a,l){Si++,Wc[Si]=a.current,a.current=l}var ts={},en=es(ts),pn=es(!1),Os=ts;function bi(a,l){var h=a.type.contextTypes;if(!h)return ts;var g=a.stateNode;if(g&&g.__reactInternalMemoizedUnmaskedChildContext===l)return g.__reactInternalMemoizedMaskedChildContext;var E={},b;for(b in h)E[b]=l[b];return g&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=l,a.__reactInternalMemoizedMaskedChildContext=E),E}function mn(a){return a=a.childContextTypes,a!=null}function ll(){ht(pn),ht(en)}function Xm(a,l,h){if(en.current!==ts)throw Error(t(168));ut(en,l),ut(pn,h)}function Qm(a,l,h){var g=a.stateNode;if(l=l.childContextTypes,typeof g.getChildContext!="function")return h;g=g.getChildContext();for(var E in g)if(!(E in l))throw Error(t(108,ke(a)||"Unknown",E));return Z({},h,g)}function ul(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||ts,Os=en.current,ut(en,a),ut(pn,pn.current),!0}function Zm(a,l,h){var g=a.stateNode;if(!g)throw Error(t(169));h?(a=Qm(a,l,Os),g.__reactInternalMemoizedMergedChildContext=a,ht(pn),ht(en),ut(en,a)):ht(pn),ut(pn,h)}var wr=null,cl=!1,Yc=!1;function Jm(a){wr===null?wr=[a]:wr.push(a)}function oL(a){cl=!0,Jm(a)}function ns(){if(!Yc&&wr!==null){Yc=!0;var a=0,l=Je;try{var h=wr;for(Je=1;a<h.length;a++){var g=h[a];do g=g(!0);while(g!==null)}wr=null,cl=!1}catch(E){throw wr!==null&&(wr=wr.slice(a+1)),tm(gc,ns),E}finally{Je=l,Yc=!1}}return null}var Ai=[],Li=0,dl=null,fl=0,Fn=[],Bn=0,Ns=null,Rr=1,Cr="";function Ms(a,l){Ai[Li++]=fl,Ai[Li++]=dl,dl=a,fl=l}function eg(a,l,h){Fn[Bn++]=Rr,Fn[Bn++]=Cr,Fn[Bn++]=Ns,Ns=a;var g=Rr;a=Cr;var E=32-Yn(g)-1;g&=~(1<<E),h+=1;var b=32-Yn(l)+E;if(30<b){var R=E-E%5;b=(g&(1<<R)-1).toString(32),g>>=R,E-=R,Rr=1<<32-Yn(l)+E|h<<E|g,Cr=b+a}else Rr=1<<b|h<<E|g,Cr=a}function qc(a){a.return!==null&&(Ms(a,1),eg(a,1,0))}function Xc(a){for(;a===dl;)dl=Ai[--Li],Ai[Li]=null,fl=Ai[--Li],Ai[Li]=null;for(;a===Ns;)Ns=Fn[--Bn],Fn[Bn]=null,Cr=Fn[--Bn],Fn[Bn]=null,Rr=Fn[--Bn],Fn[Bn]=null}var wn=null,Rn=null,gt=!1,Xn=null;function tg(a,l){var h=Vn(5,null,null,0);h.elementType="DELETED",h.stateNode=l,h.return=a,l=a.deletions,l===null?(a.deletions=[h],a.flags|=16):l.push(h)}function ng(a,l){switch(a.tag){case 5:var h=a.type;return l=l.nodeType!==1||h.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(a.stateNode=l,wn=a,Rn=Jr(l.firstChild),!0):!1;case 6:return l=a.pendingProps===""||l.nodeType!==3?null:l,l!==null?(a.stateNode=l,wn=a,Rn=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(h=Ns!==null?{id:Rr,overflow:Cr}:null,a.memoizedState={dehydrated:l,treeContext:h,retryLane:1073741824},h=Vn(18,null,null,0),h.stateNode=l,h.return=a,a.child=h,wn=a,Rn=null,!0):!1;default:return!1}}function Qc(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Zc(a){if(gt){var l=Rn;if(l){var h=l;if(!ng(a,l)){if(Qc(a))throw Error(t(418));l=Jr(h.nextSibling);var g=wn;l&&ng(a,l)?tg(g,h):(a.flags=a.flags&-4097|2,gt=!1,wn=a)}}else{if(Qc(a))throw Error(t(418));a.flags=a.flags&-4097|2,gt=!1,wn=a}}}function rg(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;wn=a}function hl(a){if(a!==wn)return!1;if(!gt)return rg(a),gt=!0,!1;var l;if((l=a.tag!==3)&&!(l=a.tag!==5)&&(l=a.type,l=l!=="head"&&l!=="body"&&!Gc(a.type,a.memoizedProps)),l&&(l=Rn)){if(Qc(a))throw sg(),Error(t(418));for(;l;)tg(a,l),l=Jr(l.nextSibling)}if(rg(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(t(317));e:{for(a=a.nextSibling,l=0;a;){if(a.nodeType===8){var h=a.data;if(h==="/$"){if(l===0){Rn=Jr(a.nextSibling);break e}l--}else h!=="$"&&h!=="$!"&&h!=="$?"||l++}a=a.nextSibling}Rn=null}}else Rn=wn?Jr(a.stateNode.nextSibling):null;return!0}function sg(){for(var a=Rn;a;)a=Jr(a.nextSibling)}function Ii(){Rn=wn=null,gt=!1}function Jc(a){Xn===null?Xn=[a]:Xn.push(a)}var aL=C.ReactCurrentBatchConfig;function Uo(a,l,h){if(a=h.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(t(309));var g=h.stateNode}if(!g)throw Error(t(147,a));var E=g,b=""+a;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===b?l.ref:(l=function(R){var M=E.refs;R===null?delete M[b]:M[b]=R},l._stringRef=b,l)}if(typeof a!="string")throw Error(t(284));if(!h._owner)throw Error(t(290,a))}return a}function pl(a,l){throw a=Object.prototype.toString.call(l),Error(t(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a))}function ig(a){var l=a._init;return l(a._payload)}function og(a){function l(W,$){if(a){var q=W.deletions;q===null?(W.deletions=[$],W.flags|=16):q.push($)}}function h(W,$){if(!a)return null;for(;$!==null;)l(W,$),$=$.sibling;return null}function g(W,$){for(W=new Map;$!==null;)$.key!==null?W.set($.key,$):W.set($.index,$),$=$.sibling;return W}function E(W,$){return W=cs(W,$),W.index=0,W.sibling=null,W}function b(W,$,q){return W.index=q,a?(q=W.alternate,q!==null?(q=q.index,q<$?(W.flags|=2,$):q):(W.flags|=2,$)):(W.flags|=1048576,$)}function R(W){return a&&W.alternate===null&&(W.flags|=2),W}function M(W,$,q,ge){return $===null||$.tag!==6?($=Hd(q,W.mode,ge),$.return=W,$):($=E($,q),$.return=W,$)}function j(W,$,q,ge){var Re=q.type;return Re===D?ce(W,$,q.props.children,ge,q.key):$!==null&&($.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===Q&&ig(Re)===$.type)?(ge=E($,q.props),ge.ref=Uo(W,$,q),ge.return=W,ge):(ge=Bl(q.type,q.key,q.props,null,W.mode,ge),ge.ref=Uo(W,$,q),ge.return=W,ge)}function J(W,$,q,ge){return $===null||$.tag!==4||$.stateNode.containerInfo!==q.containerInfo||$.stateNode.implementation!==q.implementation?($=Kd(q,W.mode,ge),$.return=W,$):($=E($,q.children||[]),$.return=W,$)}function ce(W,$,q,ge,Re){return $===null||$.tag!==7?($=Hs(q,W.mode,ge,Re),$.return=W,$):($=E($,q),$.return=W,$)}function he(W,$,q){if(typeof $=="string"&&$!==""||typeof $=="number")return $=Hd(""+$,W.mode,q),$.return=W,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case P:return q=Bl($.type,$.key,$.props,null,W.mode,q),q.ref=Uo(W,null,$),q.return=W,q;case B:return $=Kd($,W.mode,q),$.return=W,$;case Q:var ge=$._init;return he(W,ge($._payload),q)}if(Ot($)||ee($))return $=Hs($,W.mode,q,null),$.return=W,$;pl(W,$)}return null}function ue(W,$,q,ge){var Re=$!==null?$.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return Re!==null?null:M(W,$,""+q,ge);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case P:return q.key===Re?j(W,$,q,ge):null;case B:return q.key===Re?J(W,$,q,ge):null;case Q:return Re=q._init,ue(W,$,Re(q._payload),ge)}if(Ot(q)||ee(q))return Re!==null?null:ce(W,$,q,ge,null);pl(W,q)}return null}function xe(W,$,q,ge,Re){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return W=W.get(q)||null,M($,W,""+ge,Re);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case P:return W=W.get(ge.key===null?q:ge.key)||null,j($,W,ge,Re);case B:return W=W.get(ge.key===null?q:ge.key)||null,J($,W,ge,Re);case Q:var Pe=ge._init;return xe(W,$,q,Pe(ge._payload),Re)}if(Ot(ge)||ee(ge))return W=W.get(q)||null,ce($,W,ge,Re,null);pl($,ge)}return null}function Ae(W,$,q,ge){for(var Re=null,Pe=null,_e=$,Ne=$=0,zt=null;_e!==null&&Ne<q.length;Ne++){_e.index>Ne?(zt=_e,_e=null):zt=_e.sibling;var Qe=ue(W,_e,q[Ne],ge);if(Qe===null){_e===null&&(_e=zt);break}a&&_e&&Qe.alternate===null&&l(W,_e),$=b(Qe,$,Ne),Pe===null?Re=Qe:Pe.sibling=Qe,Pe=Qe,_e=zt}if(Ne===q.length)return h(W,_e),gt&&Ms(W,Ne),Re;if(_e===null){for(;Ne<q.length;Ne++)_e=he(W,q[Ne],ge),_e!==null&&($=b(_e,$,Ne),Pe===null?Re=_e:Pe.sibling=_e,Pe=_e);return gt&&Ms(W,Ne),Re}for(_e=g(W,_e);Ne<q.length;Ne++)zt=xe(_e,W,Ne,q[Ne],ge),zt!==null&&(a&&zt.alternate!==null&&_e.delete(zt.key===null?Ne:zt.key),$=b(zt,$,Ne),Pe===null?Re=zt:Pe.sibling=zt,Pe=zt);return a&&_e.forEach(function(ds){return l(W,ds)}),gt&&Ms(W,Ne),Re}function Ie(W,$,q,ge){var Re=ee(q);if(typeof Re!="function")throw Error(t(150));if(q=Re.call(q),q==null)throw Error(t(151));for(var Pe=Re=null,_e=$,Ne=$=0,zt=null,Qe=q.next();_e!==null&&!Qe.done;Ne++,Qe=q.next()){_e.index>Ne?(zt=_e,_e=null):zt=_e.sibling;var ds=ue(W,_e,Qe.value,ge);if(ds===null){_e===null&&(_e=zt);break}a&&_e&&ds.alternate===null&&l(W,_e),$=b(ds,$,Ne),Pe===null?Re=ds:Pe.sibling=ds,Pe=ds,_e=zt}if(Qe.done)return h(W,_e),gt&&Ms(W,Ne),Re;if(_e===null){for(;!Qe.done;Ne++,Qe=q.next())Qe=he(W,Qe.value,ge),Qe!==null&&($=b(Qe,$,Ne),Pe===null?Re=Qe:Pe.sibling=Qe,Pe=Qe);return gt&&Ms(W,Ne),Re}for(_e=g(W,_e);!Qe.done;Ne++,Qe=q.next())Qe=xe(_e,W,Ne,Qe.value,ge),Qe!==null&&(a&&Qe.alternate!==null&&_e.delete(Qe.key===null?Ne:Qe.key),$=b(Qe,$,Ne),Pe===null?Re=Qe:Pe.sibling=Qe,Pe=Qe);return a&&_e.forEach(function(jL){return l(W,jL)}),gt&&Ms(W,Ne),Re}function _t(W,$,q,ge){if(typeof q=="object"&&q!==null&&q.type===D&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case P:e:{for(var Re=q.key,Pe=$;Pe!==null;){if(Pe.key===Re){if(Re=q.type,Re===D){if(Pe.tag===7){h(W,Pe.sibling),$=E(Pe,q.props.children),$.return=W,W=$;break e}}else if(Pe.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===Q&&ig(Re)===Pe.type){h(W,Pe.sibling),$=E(Pe,q.props),$.ref=Uo(W,Pe,q),$.return=W,W=$;break e}h(W,Pe);break}else l(W,Pe);Pe=Pe.sibling}q.type===D?($=Hs(q.props.children,W.mode,ge,q.key),$.return=W,W=$):(ge=Bl(q.type,q.key,q.props,null,W.mode,ge),ge.ref=Uo(W,$,q),ge.return=W,W=ge)}return R(W);case B:e:{for(Pe=q.key;$!==null;){if($.key===Pe)if($.tag===4&&$.stateNode.containerInfo===q.containerInfo&&$.stateNode.implementation===q.implementation){h(W,$.sibling),$=E($,q.children||[]),$.return=W,W=$;break e}else{h(W,$);break}else l(W,$);$=$.sibling}$=Kd(q,W.mode,ge),$.return=W,W=$}return R(W);case Q:return Pe=q._init,_t(W,$,Pe(q._payload),ge)}if(Ot(q))return Ae(W,$,q,ge);if(ee(q))return Ie(W,$,q,ge);pl(W,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,$!==null&&$.tag===6?(h(W,$.sibling),$=E($,q),$.return=W,W=$):(h(W,$),$=Hd(q,W.mode,ge),$.return=W,W=$),R(W)):h(W,$)}return _t}var wi=og(!0),ag=og(!1),ml=es(null),gl=null,Ri=null,ed=null;function td(){ed=Ri=gl=null}function nd(a){var l=ml.current;ht(ml),a._currentValue=l}function rd(a,l,h){for(;a!==null;){var g=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,g!==null&&(g.childLanes|=l)):g!==null&&(g.childLanes&l)!==l&&(g.childLanes|=l),a===h)break;a=a.return}}function Ci(a,l){gl=a,ed=Ri=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&l)!==0&&(gn=!0),a.firstContext=null)}function Un(a){var l=a._currentValue;if(ed!==a)if(a={context:a,memoizedValue:l,next:null},Ri===null){if(gl===null)throw Error(t(308));Ri=a,gl.dependencies={lanes:0,firstContext:a}}else Ri=Ri.next=a;return l}var Fs=null;function sd(a){Fs===null?Fs=[a]:Fs.push(a)}function lg(a,l,h,g){var E=l.interleaved;return E===null?(h.next=h,sd(l)):(h.next=E.next,E.next=h),l.interleaved=h,Pr(a,g)}function Pr(a,l){a.lanes|=l;var h=a.alternate;for(h!==null&&(h.lanes|=l),h=a,a=a.return;a!==null;)a.childLanes|=l,h=a.alternate,h!==null&&(h.childLanes|=l),h=a,a=a.return;return h.tag===3?h.stateNode:null}var rs=!1;function id(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ug(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function _r(a,l){return{eventTime:a,lane:l,tag:0,payload:null,callback:null,next:null}}function ss(a,l,h){var g=a.updateQueue;if(g===null)return null;if(g=g.shared,(Xe&2)!==0){var E=g.pending;return E===null?l.next=l:(l.next=E.next,E.next=l),g.pending=l,Pr(a,h)}return E=g.interleaved,E===null?(l.next=l,sd(g)):(l.next=E.next,E.next=l),g.interleaved=l,Pr(a,h)}function yl(a,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194240)!==0)){var g=l.lanes;g&=a.pendingLanes,h|=g,l.lanes=h,xc(a,h)}}function cg(a,l){var h=a.updateQueue,g=a.alternate;if(g!==null&&(g=g.updateQueue,h===g)){var E=null,b=null;if(h=h.firstBaseUpdate,h!==null){do{var R={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};b===null?E=b=R:b=b.next=R,h=h.next}while(h!==null);b===null?E=b=l:b=b.next=l}else E=b=l;h={baseState:g.baseState,firstBaseUpdate:E,lastBaseUpdate:b,shared:g.shared,effects:g.effects},a.updateQueue=h;return}a=h.lastBaseUpdate,a===null?h.firstBaseUpdate=l:a.next=l,h.lastBaseUpdate=l}function vl(a,l,h,g){var E=a.updateQueue;rs=!1;var b=E.firstBaseUpdate,R=E.lastBaseUpdate,M=E.shared.pending;if(M!==null){E.shared.pending=null;var j=M,J=j.next;j.next=null,R===null?b=J:R.next=J,R=j;var ce=a.alternate;ce!==null&&(ce=ce.updateQueue,M=ce.lastBaseUpdate,M!==R&&(M===null?ce.firstBaseUpdate=J:M.next=J,ce.lastBaseUpdate=j))}if(b!==null){var he=E.baseState;R=0,ce=J=j=null,M=b;do{var ue=M.lane,xe=M.eventTime;if((g&ue)===ue){ce!==null&&(ce=ce.next={eventTime:xe,lane:0,tag:M.tag,payload:M.payload,callback:M.callback,next:null});e:{var Ae=a,Ie=M;switch(ue=l,xe=h,Ie.tag){case 1:if(Ae=Ie.payload,typeof Ae=="function"){he=Ae.call(xe,he,ue);break e}he=Ae;break e;case 3:Ae.flags=Ae.flags&-65537|128;case 0:if(Ae=Ie.payload,ue=typeof Ae=="function"?Ae.call(xe,he,ue):Ae,ue==null)break e;he=Z({},he,ue);break e;case 2:rs=!0}}M.callback!==null&&M.lane!==0&&(a.flags|=64,ue=E.effects,ue===null?E.effects=[M]:ue.push(M))}else xe={eventTime:xe,lane:ue,tag:M.tag,payload:M.payload,callback:M.callback,next:null},ce===null?(J=ce=xe,j=he):ce=ce.next=xe,R|=ue;if(M=M.next,M===null){if(M=E.shared.pending,M===null)break;ue=M,M=ue.next,ue.next=null,E.lastBaseUpdate=ue,E.shared.pending=null}}while(!0);if(ce===null&&(j=he),E.baseState=j,E.firstBaseUpdate=J,E.lastBaseUpdate=ce,l=E.shared.interleaved,l!==null){E=l;do R|=E.lane,E=E.next;while(E!==l)}else b===null&&(E.shared.lanes=0);js|=R,a.lanes=R,a.memoizedState=he}}function dg(a,l,h){if(a=l.effects,l.effects=null,a!==null)for(l=0;l<a.length;l++){var g=a[l],E=g.callback;if(E!==null){if(g.callback=null,g=h,typeof E!="function")throw Error(t(191,E));E.call(g)}}}var jo={},lr=es(jo),$o=es(jo),Vo=es(jo);function Bs(a){if(a===jo)throw Error(t(174));return a}function od(a,l){switch(ut(Vo,l),ut($o,a),ut(lr,jo),a=l.nodeType,a){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:de(null,"");break;default:a=a===8?l.parentNode:l,l=a.namespaceURI||null,a=a.tagName,l=de(l,a)}ht(lr),ut(lr,l)}function Pi(){ht(lr),ht($o),ht(Vo)}function fg(a){Bs(Vo.current);var l=Bs(lr.current),h=de(l,a.type);l!==h&&(ut($o,a),ut(lr,h))}function ad(a){$o.current===a&&(ht(lr),ht($o))}var Et=es(0);function xl(a){for(var l=a;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var ld=[];function ud(){for(var a=0;a<ld.length;a++)ld[a]._workInProgressVersionPrimary=null;ld.length=0}var El=C.ReactCurrentDispatcher,cd=C.ReactCurrentBatchConfig,Us=0,Tt=null,Ut=null,Ht=null,Tl=!1,Go=!1,Ho=0,lL=0;function tn(){throw Error(t(321))}function dd(a,l){if(l===null)return!1;for(var h=0;h<l.length&&h<a.length;h++)if(!qn(a[h],l[h]))return!1;return!0}function fd(a,l,h,g,E,b){if(Us=b,Tt=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,El.current=a===null||a.memoizedState===null?fL:hL,a=h(g,E),Go){b=0;do{if(Go=!1,Ho=0,25<=b)throw Error(t(301));b+=1,Ht=Ut=null,l.updateQueue=null,El.current=pL,a=h(g,E)}while(Go)}if(El.current=Al,l=Ut!==null&&Ut.next!==null,Us=0,Ht=Ut=Tt=null,Tl=!1,l)throw Error(t(300));return a}function hd(){var a=Ho!==0;return Ho=0,a}function ur(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ht===null?Tt.memoizedState=Ht=a:Ht=Ht.next=a,Ht}function jn(){if(Ut===null){var a=Tt.alternate;a=a!==null?a.memoizedState:null}else a=Ut.next;var l=Ht===null?Tt.memoizedState:Ht.next;if(l!==null)Ht=l,Ut=a;else{if(a===null)throw Error(t(310));Ut=a,a={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},Ht===null?Tt.memoizedState=Ht=a:Ht=Ht.next=a}return Ht}function Ko(a,l){return typeof l=="function"?l(a):l}function pd(a){var l=jn(),h=l.queue;if(h===null)throw Error(t(311));h.lastRenderedReducer=a;var g=Ut,E=g.baseQueue,b=h.pending;if(b!==null){if(E!==null){var R=E.next;E.next=b.next,b.next=R}g.baseQueue=E=b,h.pending=null}if(E!==null){b=E.next,g=g.baseState;var M=R=null,j=null,J=b;do{var ce=J.lane;if((Us&ce)===ce)j!==null&&(j=j.next={lane:0,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null}),g=J.hasEagerState?J.eagerState:a(g,J.action);else{var he={lane:ce,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null};j===null?(M=j=he,R=g):j=j.next=he,Tt.lanes|=ce,js|=ce}J=J.next}while(J!==null&&J!==b);j===null?R=g:j.next=M,qn(g,l.memoizedState)||(gn=!0),l.memoizedState=g,l.baseState=R,l.baseQueue=j,h.lastRenderedState=g}if(a=h.interleaved,a!==null){E=a;do b=E.lane,Tt.lanes|=b,js|=b,E=E.next;while(E!==a)}else E===null&&(h.lanes=0);return[l.memoizedState,h.dispatch]}function md(a){var l=jn(),h=l.queue;if(h===null)throw Error(t(311));h.lastRenderedReducer=a;var g=h.dispatch,E=h.pending,b=l.memoizedState;if(E!==null){h.pending=null;var R=E=E.next;do b=a(b,R.action),R=R.next;while(R!==E);qn(b,l.memoizedState)||(gn=!0),l.memoizedState=b,l.baseQueue===null&&(l.baseState=b),h.lastRenderedState=b}return[b,g]}function hg(){}function pg(a,l){var h=Tt,g=jn(),E=l(),b=!qn(g.memoizedState,E);if(b&&(g.memoizedState=E,gn=!0),g=g.queue,gd(yg.bind(null,h,g,a),[a]),g.getSnapshot!==l||b||Ht!==null&&Ht.memoizedState.tag&1){if(h.flags|=2048,zo(9,gg.bind(null,h,g,E,l),void 0,null),Kt===null)throw Error(t(349));(Us&30)!==0||mg(h,l,E)}return E}function mg(a,l,h){a.flags|=16384,a={getSnapshot:l,value:h},l=Tt.updateQueue,l===null?(l={lastEffect:null,stores:null},Tt.updateQueue=l,l.stores=[a]):(h=l.stores,h===null?l.stores=[a]:h.push(a))}function gg(a,l,h,g){l.value=h,l.getSnapshot=g,vg(l)&&xg(a)}function yg(a,l,h){return h(function(){vg(l)&&xg(a)})}function vg(a){var l=a.getSnapshot;a=a.value;try{var h=l();return!qn(a,h)}catch{return!0}}function xg(a){var l=Pr(a,1);l!==null&&er(l,a,1,-1)}function Eg(a){var l=ur();return typeof a=="function"&&(a=a()),l.memoizedState=l.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ko,lastRenderedState:a},l.queue=a,a=a.dispatch=dL.bind(null,Tt,a),[l.memoizedState,a]}function zo(a,l,h,g){return a={tag:a,create:l,destroy:h,deps:g,next:null},l=Tt.updateQueue,l===null?(l={lastEffect:null,stores:null},Tt.updateQueue=l,l.lastEffect=a.next=a):(h=l.lastEffect,h===null?l.lastEffect=a.next=a:(g=h.next,h.next=a,a.next=g,l.lastEffect=a)),a}function Tg(){return jn().memoizedState}function Sl(a,l,h,g){var E=ur();Tt.flags|=a,E.memoizedState=zo(1|l,h,void 0,g===void 0?null:g)}function bl(a,l,h,g){var E=jn();g=g===void 0?null:g;var b=void 0;if(Ut!==null){var R=Ut.memoizedState;if(b=R.destroy,g!==null&&dd(g,R.deps)){E.memoizedState=zo(l,h,b,g);return}}Tt.flags|=a,E.memoizedState=zo(1|l,h,b,g)}function Sg(a,l){return Sl(8390656,8,a,l)}function gd(a,l){return bl(2048,8,a,l)}function bg(a,l){return bl(4,2,a,l)}function Ag(a,l){return bl(4,4,a,l)}function Lg(a,l){if(typeof l=="function")return a=a(),l(a),function(){l(null)};if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function Ig(a,l,h){return h=h!=null?h.concat([a]):null,bl(4,4,Lg.bind(null,l,a),h)}function yd(){}function wg(a,l){var h=jn();l=l===void 0?null:l;var g=h.memoizedState;return g!==null&&l!==null&&dd(l,g[1])?g[0]:(h.memoizedState=[a,l],a)}function Rg(a,l){var h=jn();l=l===void 0?null:l;var g=h.memoizedState;return g!==null&&l!==null&&dd(l,g[1])?g[0]:(a=a(),h.memoizedState=[a,l],a)}function Cg(a,l,h){return(Us&21)===0?(a.baseState&&(a.baseState=!1,gn=!0),a.memoizedState=h):(qn(h,l)||(h=im(),Tt.lanes|=h,js|=h,a.baseState=!0),l)}function uL(a,l){var h=Je;Je=h!==0&&4>h?h:4,a(!0);var g=cd.transition;cd.transition={};try{a(!1),l()}finally{Je=h,cd.transition=g}}function Pg(){return jn().memoizedState}function cL(a,l,h){var g=ls(a);if(h={lane:g,action:h,hasEagerState:!1,eagerState:null,next:null},_g(a))kg(l,h);else if(h=lg(a,l,h,g),h!==null){var E=un();er(h,a,g,E),Dg(h,l,g)}}function dL(a,l,h){var g=ls(a),E={lane:g,action:h,hasEagerState:!1,eagerState:null,next:null};if(_g(a))kg(l,E);else{var b=a.alternate;if(a.lanes===0&&(b===null||b.lanes===0)&&(b=l.lastRenderedReducer,b!==null))try{var R=l.lastRenderedState,M=b(R,h);if(E.hasEagerState=!0,E.eagerState=M,qn(M,R)){var j=l.interleaved;j===null?(E.next=E,sd(l)):(E.next=j.next,j.next=E),l.interleaved=E;return}}catch{}finally{}h=lg(a,l,E,g),h!==null&&(E=un(),er(h,a,g,E),Dg(h,l,g))}}function _g(a){var l=a.alternate;return a===Tt||l!==null&&l===Tt}function kg(a,l){Go=Tl=!0;var h=a.pending;h===null?l.next=l:(l.next=h.next,h.next=l),a.pending=l}function Dg(a,l,h){if((h&4194240)!==0){var g=l.lanes;g&=a.pendingLanes,h|=g,l.lanes=h,xc(a,h)}}var Al={readContext:Un,useCallback:tn,useContext:tn,useEffect:tn,useImperativeHandle:tn,useInsertionEffect:tn,useLayoutEffect:tn,useMemo:tn,useReducer:tn,useRef:tn,useState:tn,useDebugValue:tn,useDeferredValue:tn,useTransition:tn,useMutableSource:tn,useSyncExternalStore:tn,useId:tn,unstable_isNewReconciler:!1},fL={readContext:Un,useCallback:function(a,l){return ur().memoizedState=[a,l===void 0?null:l],a},useContext:Un,useEffect:Sg,useImperativeHandle:function(a,l,h){return h=h!=null?h.concat([a]):null,Sl(4194308,4,Lg.bind(null,l,a),h)},useLayoutEffect:function(a,l){return Sl(4194308,4,a,l)},useInsertionEffect:function(a,l){return Sl(4,2,a,l)},useMemo:function(a,l){var h=ur();return l=l===void 0?null:l,a=a(),h.memoizedState=[a,l],a},useReducer:function(a,l,h){var g=ur();return l=h!==void 0?h(l):l,g.memoizedState=g.baseState=l,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:l},g.queue=a,a=a.dispatch=cL.bind(null,Tt,a),[g.memoizedState,a]},useRef:function(a){var l=ur();return a={current:a},l.memoizedState=a},useState:Eg,useDebugValue:yd,useDeferredValue:function(a){return ur().memoizedState=a},useTransition:function(){var a=Eg(!1),l=a[0];return a=uL.bind(null,a[1]),ur().memoizedState=a,[l,a]},useMutableSource:function(){},useSyncExternalStore:function(a,l,h){var g=Tt,E=ur();if(gt){if(h===void 0)throw Error(t(407));h=h()}else{if(h=l(),Kt===null)throw Error(t(349));(Us&30)!==0||mg(g,l,h)}E.memoizedState=h;var b={value:h,getSnapshot:l};return E.queue=b,Sg(yg.bind(null,g,b,a),[a]),g.flags|=2048,zo(9,gg.bind(null,g,b,h,l),void 0,null),h},useId:function(){var a=ur(),l=Kt.identifierPrefix;if(gt){var h=Cr,g=Rr;h=(g&~(1<<32-Yn(g)-1)).toString(32)+h,l=":"+l+"R"+h,h=Ho++,0<h&&(l+="H"+h.toString(32)),l+=":"}else h=lL++,l=":"+l+"r"+h.toString(32)+":";return a.memoizedState=l},unstable_isNewReconciler:!1},hL={readContext:Un,useCallback:wg,useContext:Un,useEffect:gd,useImperativeHandle:Ig,useInsertionEffect:bg,useLayoutEffect:Ag,useMemo:Rg,useReducer:pd,useRef:Tg,useState:function(){return pd(Ko)},useDebugValue:yd,useDeferredValue:function(a){var l=jn();return Cg(l,Ut.memoizedState,a)},useTransition:function(){var a=pd(Ko)[0],l=jn().memoizedState;return[a,l]},useMutableSource:hg,useSyncExternalStore:pg,useId:Pg,unstable_isNewReconciler:!1},pL={readContext:Un,useCallback:wg,useContext:Un,useEffect:gd,useImperativeHandle:Ig,useInsertionEffect:bg,useLayoutEffect:Ag,useMemo:Rg,useReducer:md,useRef:Tg,useState:function(){return md(Ko)},useDebugValue:yd,useDeferredValue:function(a){var l=jn();return Ut===null?l.memoizedState=a:Cg(l,Ut.memoizedState,a)},useTransition:function(){var a=md(Ko)[0],l=jn().memoizedState;return[a,l]},useMutableSource:hg,useSyncExternalStore:pg,useId:Pg,unstable_isNewReconciler:!1};function Qn(a,l){if(a&&a.defaultProps){l=Z({},l),a=a.defaultProps;for(var h in a)l[h]===void 0&&(l[h]=a[h]);return l}return l}function vd(a,l,h,g){l=a.memoizedState,h=h(g,l),h=h==null?l:Z({},l,h),a.memoizedState=h,a.lanes===0&&(a.updateQueue.baseState=h)}var Ll={isMounted:function(a){return(a=a._reactInternals)?ks(a)===a:!1},enqueueSetState:function(a,l,h){a=a._reactInternals;var g=un(),E=ls(a),b=_r(g,E);b.payload=l,h!=null&&(b.callback=h),l=ss(a,b,E),l!==null&&(er(l,a,E,g),yl(l,a,E))},enqueueReplaceState:function(a,l,h){a=a._reactInternals;var g=un(),E=ls(a),b=_r(g,E);b.tag=1,b.payload=l,h!=null&&(b.callback=h),l=ss(a,b,E),l!==null&&(er(l,a,E,g),yl(l,a,E))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var h=un(),g=ls(a),E=_r(h,g);E.tag=2,l!=null&&(E.callback=l),l=ss(a,E,g),l!==null&&(er(l,a,g,h),yl(l,a,g))}};function Og(a,l,h,g,E,b,R){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(g,b,R):l.prototype&&l.prototype.isPureReactComponent?!ko(h,g)||!ko(E,b):!0}function Ng(a,l,h){var g=!1,E=ts,b=l.contextType;return typeof b=="object"&&b!==null?b=Un(b):(E=mn(l)?Os:en.current,g=l.contextTypes,b=(g=g!=null)?bi(a,E):ts),l=new l(h,b),a.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=Ll,a.stateNode=l,l._reactInternals=a,g&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=E,a.__reactInternalMemoizedMaskedChildContext=b),l}function Mg(a,l,h,g){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,g),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,g),l.state!==a&&Ll.enqueueReplaceState(l,l.state,null)}function xd(a,l,h,g){var E=a.stateNode;E.props=h,E.state=a.memoizedState,E.refs={},id(a);var b=l.contextType;typeof b=="object"&&b!==null?E.context=Un(b):(b=mn(l)?Os:en.current,E.context=bi(a,b)),E.state=a.memoizedState,b=l.getDerivedStateFromProps,typeof b=="function"&&(vd(a,l,b,h),E.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(l=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),l!==E.state&&Ll.enqueueReplaceState(E,E.state,null),vl(a,h,E,g),E.state=a.memoizedState),typeof E.componentDidMount=="function"&&(a.flags|=4194308)}function _i(a,l){try{var h="",g=l;do h+=me(g),g=g.return;while(g);var E=h}catch(b){E=`
Error generating stack: `+b.message+`
`+b.stack}return{value:a,source:l,stack:E,digest:null}}function Ed(a,l,h){return{value:a,source:null,stack:h??null,digest:l??null}}function Td(a,l){try{console.error(l.value)}catch(h){setTimeout(function(){throw h})}}var mL=typeof WeakMap=="function"?WeakMap:Map;function Fg(a,l,h){h=_r(-1,h),h.tag=3,h.payload={element:null};var g=l.value;return h.callback=function(){kl||(kl=!0,Md=g),Td(a,l)},h}function Bg(a,l,h){h=_r(-1,h),h.tag=3;var g=a.type.getDerivedStateFromError;if(typeof g=="function"){var E=l.value;h.payload=function(){return g(E)},h.callback=function(){Td(a,l)}}var b=a.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(h.callback=function(){Td(a,l),typeof g!="function"&&(os===null?os=new Set([this]):os.add(this));var R=l.stack;this.componentDidCatch(l.value,{componentStack:R!==null?R:""})}),h}function Ug(a,l,h){var g=a.pingCache;if(g===null){g=a.pingCache=new mL;var E=new Set;g.set(l,E)}else E=g.get(l),E===void 0&&(E=new Set,g.set(l,E));E.has(h)||(E.add(h),a=CL.bind(null,a,l,h),l.then(a,a))}function jg(a){do{var l;if((l=a.tag===13)&&(l=a.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return a;a=a.return}while(a!==null);return null}function $g(a,l,h,g,E){return(a.mode&1)===0?(a===l?a.flags|=65536:(a.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(l=_r(-1,1),l.tag=2,ss(h,l,1))),h.lanes|=1),a):(a.flags|=65536,a.lanes=E,a)}var gL=C.ReactCurrentOwner,gn=!1;function ln(a,l,h,g){l.child=a===null?ag(l,null,h,g):wi(l,a.child,h,g)}function Vg(a,l,h,g,E){h=h.render;var b=l.ref;return Ci(l,E),g=fd(a,l,h,g,b,E),h=hd(),a!==null&&!gn?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~E,kr(a,l,E)):(gt&&h&&qc(l),l.flags|=1,ln(a,l,g,E),l.child)}function Gg(a,l,h,g,E){if(a===null){var b=h.type;return typeof b=="function"&&!Gd(b)&&b.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(l.tag=15,l.type=b,Hg(a,l,b,g,E)):(a=Bl(h.type,null,g,l,l.mode,E),a.ref=l.ref,a.return=l,l.child=a)}if(b=a.child,(a.lanes&E)===0){var R=b.memoizedProps;if(h=h.compare,h=h!==null?h:ko,h(R,g)&&a.ref===l.ref)return kr(a,l,E)}return l.flags|=1,a=cs(b,g),a.ref=l.ref,a.return=l,l.child=a}function Hg(a,l,h,g,E){if(a!==null){var b=a.memoizedProps;if(ko(b,g)&&a.ref===l.ref)if(gn=!1,l.pendingProps=g=b,(a.lanes&E)!==0)(a.flags&131072)!==0&&(gn=!0);else return l.lanes=a.lanes,kr(a,l,E)}return Sd(a,l,h,g,E)}function Kg(a,l,h){var g=l.pendingProps,E=g.children,b=a!==null?a.memoizedState:null;if(g.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},ut(Di,Cn),Cn|=h;else{if((h&1073741824)===0)return a=b!==null?b.baseLanes|h:h,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:a,cachePool:null,transitions:null},l.updateQueue=null,ut(Di,Cn),Cn|=a,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},g=b!==null?b.baseLanes:h,ut(Di,Cn),Cn|=g}else b!==null?(g=b.baseLanes|h,l.memoizedState=null):g=h,ut(Di,Cn),Cn|=g;return ln(a,l,E,h),l.child}function zg(a,l){var h=l.ref;(a===null&&h!==null||a!==null&&a.ref!==h)&&(l.flags|=512,l.flags|=2097152)}function Sd(a,l,h,g,E){var b=mn(h)?Os:en.current;return b=bi(l,b),Ci(l,E),h=fd(a,l,h,g,b,E),g=hd(),a!==null&&!gn?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~E,kr(a,l,E)):(gt&&g&&qc(l),l.flags|=1,ln(a,l,h,E),l.child)}function Wg(a,l,h,g,E){if(mn(h)){var b=!0;ul(l)}else b=!1;if(Ci(l,E),l.stateNode===null)wl(a,l),Ng(l,h,g),xd(l,h,g,E),g=!0;else if(a===null){var R=l.stateNode,M=l.memoizedProps;R.props=M;var j=R.context,J=h.contextType;typeof J=="object"&&J!==null?J=Un(J):(J=mn(h)?Os:en.current,J=bi(l,J));var ce=h.getDerivedStateFromProps,he=typeof ce=="function"||typeof R.getSnapshotBeforeUpdate=="function";he||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(M!==g||j!==J)&&Mg(l,R,g,J),rs=!1;var ue=l.memoizedState;R.state=ue,vl(l,g,R,E),j=l.memoizedState,M!==g||ue!==j||pn.current||rs?(typeof ce=="function"&&(vd(l,h,ce,g),j=l.memoizedState),(M=rs||Og(l,h,M,g,ue,j,J))?(he||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(l.flags|=4194308)):(typeof R.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=g,l.memoizedState=j),R.props=g,R.state=j,R.context=J,g=M):(typeof R.componentDidMount=="function"&&(l.flags|=4194308),g=!1)}else{R=l.stateNode,ug(a,l),M=l.memoizedProps,J=l.type===l.elementType?M:Qn(l.type,M),R.props=J,he=l.pendingProps,ue=R.context,j=h.contextType,typeof j=="object"&&j!==null?j=Un(j):(j=mn(h)?Os:en.current,j=bi(l,j));var xe=h.getDerivedStateFromProps;(ce=typeof xe=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(M!==he||ue!==j)&&Mg(l,R,g,j),rs=!1,ue=l.memoizedState,R.state=ue,vl(l,g,R,E);var Ae=l.memoizedState;M!==he||ue!==Ae||pn.current||rs?(typeof xe=="function"&&(vd(l,h,xe,g),Ae=l.memoizedState),(J=rs||Og(l,h,J,g,ue,Ae,j)||!1)?(ce||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(g,Ae,j),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(g,Ae,j)),typeof R.componentDidUpdate=="function"&&(l.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof R.componentDidUpdate!="function"||M===a.memoizedProps&&ue===a.memoizedState||(l.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||M===a.memoizedProps&&ue===a.memoizedState||(l.flags|=1024),l.memoizedProps=g,l.memoizedState=Ae),R.props=g,R.state=Ae,R.context=j,g=J):(typeof R.componentDidUpdate!="function"||M===a.memoizedProps&&ue===a.memoizedState||(l.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||M===a.memoizedProps&&ue===a.memoizedState||(l.flags|=1024),g=!1)}return bd(a,l,h,g,b,E)}function bd(a,l,h,g,E,b){zg(a,l);var R=(l.flags&128)!==0;if(!g&&!R)return E&&Zm(l,h,!1),kr(a,l,b);g=l.stateNode,gL.current=l;var M=R&&typeof h.getDerivedStateFromError!="function"?null:g.render();return l.flags|=1,a!==null&&R?(l.child=wi(l,a.child,null,b),l.child=wi(l,null,M,b)):ln(a,l,M,b),l.memoizedState=g.state,E&&Zm(l,h,!0),l.child}function Yg(a){var l=a.stateNode;l.pendingContext?Xm(a,l.pendingContext,l.pendingContext!==l.context):l.context&&Xm(a,l.context,!1),od(a,l.containerInfo)}function qg(a,l,h,g,E){return Ii(),Jc(E),l.flags|=256,ln(a,l,h,g),l.child}var Ad={dehydrated:null,treeContext:null,retryLane:0};function Ld(a){return{baseLanes:a,cachePool:null,transitions:null}}function Xg(a,l,h){var g=l.pendingProps,E=Et.current,b=!1,R=(l.flags&128)!==0,M;if((M=R)||(M=a!==null&&a.memoizedState===null?!1:(E&2)!==0),M?(b=!0,l.flags&=-129):(a===null||a.memoizedState!==null)&&(E|=1),ut(Et,E&1),a===null)return Zc(l),a=l.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((l.mode&1)===0?l.lanes=1:a.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(R=g.children,a=g.fallback,b?(g=l.mode,b=l.child,R={mode:"hidden",children:R},(g&1)===0&&b!==null?(b.childLanes=0,b.pendingProps=R):b=Ul(R,g,0,null),a=Hs(a,g,h,null),b.return=l,a.return=l,b.sibling=a,l.child=b,l.child.memoizedState=Ld(h),l.memoizedState=Ad,a):Id(l,R));if(E=a.memoizedState,E!==null&&(M=E.dehydrated,M!==null))return yL(a,l,R,g,M,E,h);if(b){b=g.fallback,R=l.mode,E=a.child,M=E.sibling;var j={mode:"hidden",children:g.children};return(R&1)===0&&l.child!==E?(g=l.child,g.childLanes=0,g.pendingProps=j,l.deletions=null):(g=cs(E,j),g.subtreeFlags=E.subtreeFlags&14680064),M!==null?b=cs(M,b):(b=Hs(b,R,h,null),b.flags|=2),b.return=l,g.return=l,g.sibling=b,l.child=g,g=b,b=l.child,R=a.child.memoizedState,R=R===null?Ld(h):{baseLanes:R.baseLanes|h,cachePool:null,transitions:R.transitions},b.memoizedState=R,b.childLanes=a.childLanes&~h,l.memoizedState=Ad,g}return b=a.child,a=b.sibling,g=cs(b,{mode:"visible",children:g.children}),(l.mode&1)===0&&(g.lanes=h),g.return=l,g.sibling=null,a!==null&&(h=l.deletions,h===null?(l.deletions=[a],l.flags|=16):h.push(a)),l.child=g,l.memoizedState=null,g}function Id(a,l){return l=Ul({mode:"visible",children:l},a.mode,0,null),l.return=a,a.child=l}function Il(a,l,h,g){return g!==null&&Jc(g),wi(l,a.child,null,h),a=Id(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function yL(a,l,h,g,E,b,R){if(h)return l.flags&256?(l.flags&=-257,g=Ed(Error(t(422))),Il(a,l,R,g)):l.memoizedState!==null?(l.child=a.child,l.flags|=128,null):(b=g.fallback,E=l.mode,g=Ul({mode:"visible",children:g.children},E,0,null),b=Hs(b,E,R,null),b.flags|=2,g.return=l,b.return=l,g.sibling=b,l.child=g,(l.mode&1)!==0&&wi(l,a.child,null,R),l.child.memoizedState=Ld(R),l.memoizedState=Ad,b);if((l.mode&1)===0)return Il(a,l,R,null);if(E.data==="$!"){if(g=E.nextSibling&&E.nextSibling.dataset,g)var M=g.dgst;return g=M,b=Error(t(419)),g=Ed(b,g,void 0),Il(a,l,R,g)}if(M=(R&a.childLanes)!==0,gn||M){if(g=Kt,g!==null){switch(R&-R){case 4:E=2;break;case 16:E=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:E=32;break;case 536870912:E=268435456;break;default:E=0}E=(E&(g.suspendedLanes|R))!==0?0:E,E!==0&&E!==b.retryLane&&(b.retryLane=E,Pr(a,E),er(g,a,E,-1))}return Vd(),g=Ed(Error(t(421))),Il(a,l,R,g)}return E.data==="$?"?(l.flags|=128,l.child=a.child,l=PL.bind(null,a),E._reactRetry=l,null):(a=b.treeContext,Rn=Jr(E.nextSibling),wn=l,gt=!0,Xn=null,a!==null&&(Fn[Bn++]=Rr,Fn[Bn++]=Cr,Fn[Bn++]=Ns,Rr=a.id,Cr=a.overflow,Ns=l),l=Id(l,g.children),l.flags|=4096,l)}function Qg(a,l,h){a.lanes|=l;var g=a.alternate;g!==null&&(g.lanes|=l),rd(a.return,l,h)}function wd(a,l,h,g,E){var b=a.memoizedState;b===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:g,tail:h,tailMode:E}:(b.isBackwards=l,b.rendering=null,b.renderingStartTime=0,b.last=g,b.tail=h,b.tailMode=E)}function Zg(a,l,h){var g=l.pendingProps,E=g.revealOrder,b=g.tail;if(ln(a,l,g.children,h),g=Et.current,(g&2)!==0)g=g&1|2,l.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Qg(a,h,l);else if(a.tag===19)Qg(a,h,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}g&=1}if(ut(Et,g),(l.mode&1)===0)l.memoizedState=null;else switch(E){case"forwards":for(h=l.child,E=null;h!==null;)a=h.alternate,a!==null&&xl(a)===null&&(E=h),h=h.sibling;h=E,h===null?(E=l.child,l.child=null):(E=h.sibling,h.sibling=null),wd(l,!1,E,h,b);break;case"backwards":for(h=null,E=l.child,l.child=null;E!==null;){if(a=E.alternate,a!==null&&xl(a)===null){l.child=E;break}a=E.sibling,E.sibling=h,h=E,E=a}wd(l,!0,h,null,b);break;case"together":wd(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function wl(a,l){(l.mode&1)===0&&a!==null&&(a.alternate=null,l.alternate=null,l.flags|=2)}function kr(a,l,h){if(a!==null&&(l.dependencies=a.dependencies),js|=l.lanes,(h&l.childLanes)===0)return null;if(a!==null&&l.child!==a.child)throw Error(t(153));if(l.child!==null){for(a=l.child,h=cs(a,a.pendingProps),l.child=h,h.return=l;a.sibling!==null;)a=a.sibling,h=h.sibling=cs(a,a.pendingProps),h.return=l;h.sibling=null}return l.child}function vL(a,l,h){switch(l.tag){case 3:Yg(l),Ii();break;case 5:fg(l);break;case 1:mn(l.type)&&ul(l);break;case 4:od(l,l.stateNode.containerInfo);break;case 10:var g=l.type._context,E=l.memoizedProps.value;ut(ml,g._currentValue),g._currentValue=E;break;case 13:if(g=l.memoizedState,g!==null)return g.dehydrated!==null?(ut(Et,Et.current&1),l.flags|=128,null):(h&l.child.childLanes)!==0?Xg(a,l,h):(ut(Et,Et.current&1),a=kr(a,l,h),a!==null?a.sibling:null);ut(Et,Et.current&1);break;case 19:if(g=(h&l.childLanes)!==0,(a.flags&128)!==0){if(g)return Zg(a,l,h);l.flags|=128}if(E=l.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),ut(Et,Et.current),g)break;return null;case 22:case 23:return l.lanes=0,Kg(a,l,h)}return kr(a,l,h)}var Jg,Rd,e0,t0;Jg=function(a,l){for(var h=l.child;h!==null;){if(h.tag===5||h.tag===6)a.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return;h=h.return}h.sibling.return=h.return,h=h.sibling}},Rd=function(){},e0=function(a,l,h,g){var E=a.memoizedProps;if(E!==g){a=l.stateNode,Bs(lr.current);var b=null;switch(h){case"input":E=Sr(a,E),g=Sr(a,g),b=[];break;case"select":E=Z({},E,{value:void 0}),g=Z({},g,{value:void 0}),b=[];break;case"textarea":E=Jt(a,E),g=Jt(a,g),b=[];break;default:typeof E.onClick!="function"&&typeof g.onClick=="function"&&(a.onclick=ol)}Ee(h,g);var R;h=null;for(J in E)if(!g.hasOwnProperty(J)&&E.hasOwnProperty(J)&&E[J]!=null)if(J==="style"){var M=E[J];for(R in M)M.hasOwnProperty(R)&&(h||(h={}),h[R]="")}else J!=="dangerouslySetInnerHTML"&&J!=="children"&&J!=="suppressContentEditableWarning"&&J!=="suppressHydrationWarning"&&J!=="autoFocus"&&(s.hasOwnProperty(J)?b||(b=[]):(b=b||[]).push(J,null));for(J in g){var j=g[J];if(M=E?.[J],g.hasOwnProperty(J)&&j!==M&&(j!=null||M!=null))if(J==="style")if(M){for(R in M)!M.hasOwnProperty(R)||j&&j.hasOwnProperty(R)||(h||(h={}),h[R]="");for(R in j)j.hasOwnProperty(R)&&M[R]!==j[R]&&(h||(h={}),h[R]=j[R])}else h||(b||(b=[]),b.push(J,h)),h=j;else J==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,M=M?M.__html:void 0,j!=null&&M!==j&&(b=b||[]).push(J,j)):J==="children"?typeof j!="string"&&typeof j!="number"||(b=b||[]).push(J,""+j):J!=="suppressContentEditableWarning"&&J!=="suppressHydrationWarning"&&(s.hasOwnProperty(J)?(j!=null&&J==="onScroll"&&ft("scroll",a),b||M===j||(b=[])):(b=b||[]).push(J,j))}h&&(b=b||[]).push("style",h);var J=b;(l.updateQueue=J)&&(l.flags|=4)}},t0=function(a,l,h,g){h!==g&&(l.flags|=4)};function Wo(a,l){if(!gt)switch(a.tailMode){case"hidden":l=a.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?a.tail=null:h.sibling=null;break;case"collapsed":h=a.tail;for(var g=null;h!==null;)h.alternate!==null&&(g=h),h=h.sibling;g===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:g.sibling=null}}function nn(a){var l=a.alternate!==null&&a.alternate.child===a.child,h=0,g=0;if(l)for(var E=a.child;E!==null;)h|=E.lanes|E.childLanes,g|=E.subtreeFlags&14680064,g|=E.flags&14680064,E.return=a,E=E.sibling;else for(E=a.child;E!==null;)h|=E.lanes|E.childLanes,g|=E.subtreeFlags,g|=E.flags,E.return=a,E=E.sibling;return a.subtreeFlags|=g,a.childLanes=h,l}function xL(a,l,h){var g=l.pendingProps;switch(Xc(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nn(l),null;case 1:return mn(l.type)&&ll(),nn(l),null;case 3:return g=l.stateNode,Pi(),ht(pn),ht(en),ud(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(a===null||a.child===null)&&(hl(l)?l.flags|=4:a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,Xn!==null&&(Ud(Xn),Xn=null))),Rd(a,l),nn(l),null;case 5:ad(l);var E=Bs(Vo.current);if(h=l.type,a!==null&&l.stateNode!=null)e0(a,l,h,g,E),a.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!g){if(l.stateNode===null)throw Error(t(166));return nn(l),null}if(a=Bs(lr.current),hl(l)){g=l.stateNode,h=l.type;var b=l.memoizedProps;switch(g[ar]=l,g[Fo]=b,a=(l.mode&1)!==0,h){case"dialog":ft("cancel",g),ft("close",g);break;case"iframe":case"object":case"embed":ft("load",g);break;case"video":case"audio":for(E=0;E<Oo.length;E++)ft(Oo[E],g);break;case"source":ft("error",g);break;case"img":case"image":case"link":ft("error",g),ft("load",g);break;case"details":ft("toggle",g);break;case"input":fi(g,b),ft("invalid",g);break;case"select":g._wrapperState={wasMultiple:!!b.multiple},ft("invalid",g);break;case"textarea":br(g,b),ft("invalid",g)}Ee(h,b),E=null;for(var R in b)if(b.hasOwnProperty(R)){var M=b[R];R==="children"?typeof M=="string"?g.textContent!==M&&(b.suppressHydrationWarning!==!0&&il(g.textContent,M,a),E=["children",M]):typeof M=="number"&&g.textContent!==""+M&&(b.suppressHydrationWarning!==!0&&il(g.textContent,M,a),E=["children",""+M]):s.hasOwnProperty(R)&&M!=null&&R==="onScroll"&&ft("scroll",g)}switch(h){case"input":Ke(g),Dt(g,b,!0);break;case"textarea":Ke(g),le(g);break;case"select":case"option":break;default:typeof b.onClick=="function"&&(g.onclick=ol)}g=E,l.updateQueue=g,g!==null&&(l.flags|=4)}else{R=E.nodeType===9?E:E.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=Y(h)),a==="http://www.w3.org/1999/xhtml"?h==="script"?(a=R.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof g.is=="string"?a=R.createElement(h,{is:g.is}):(a=R.createElement(h),h==="select"&&(R=a,g.multiple?R.multiple=!0:g.size&&(R.size=g.size))):a=R.createElementNS(a,h),a[ar]=l,a[Fo]=g,Jg(a,l,!1,!1),l.stateNode=a;e:{switch(R=Ve(h,g),h){case"dialog":ft("cancel",a),ft("close",a),E=g;break;case"iframe":case"object":case"embed":ft("load",a),E=g;break;case"video":case"audio":for(E=0;E<Oo.length;E++)ft(Oo[E],a);E=g;break;case"source":ft("error",a),E=g;break;case"img":case"image":case"link":ft("error",a),ft("load",a),E=g;break;case"details":ft("toggle",a),E=g;break;case"input":fi(a,g),E=Sr(a,g),ft("invalid",a);break;case"option":E=g;break;case"select":a._wrapperState={wasMultiple:!!g.multiple},E=Z({},g,{value:void 0}),ft("invalid",a);break;case"textarea":br(a,g),E=Jt(a,g),ft("invalid",a);break;default:E=g}Ee(h,E),M=E;for(b in M)if(M.hasOwnProperty(b)){var j=M[b];b==="style"?Le(a,j):b==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,j!=null&&Be(a,j)):b==="children"?typeof j=="string"?(h!=="textarea"||j!=="")&&Fe(a,j):typeof j=="number"&&Fe(a,""+j):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(s.hasOwnProperty(b)?j!=null&&b==="onScroll"&&ft("scroll",a):j!=null&&w(a,b,j,R))}switch(h){case"input":Ke(a),Dt(a,g,!1);break;case"textarea":Ke(a),le(a);break;case"option":g.value!=null&&a.setAttribute("value",""+Ce(g.value));break;case"select":a.multiple=!!g.multiple,b=g.value,b!=null?Yt(a,!!g.multiple,b,!1):g.defaultValue!=null&&Yt(a,!!g.multiple,g.defaultValue,!0);break;default:typeof E.onClick=="function"&&(a.onclick=ol)}switch(h){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}}g&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return nn(l),null;case 6:if(a&&l.stateNode!=null)t0(a,l,a.memoizedProps,g);else{if(typeof g!="string"&&l.stateNode===null)throw Error(t(166));if(h=Bs(Vo.current),Bs(lr.current),hl(l)){if(g=l.stateNode,h=l.memoizedProps,g[ar]=l,(b=g.nodeValue!==h)&&(a=wn,a!==null))switch(a.tag){case 3:il(g.nodeValue,h,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&il(g.nodeValue,h,(a.mode&1)!==0)}b&&(l.flags|=4)}else g=(h.nodeType===9?h:h.ownerDocument).createTextNode(g),g[ar]=l,l.stateNode=g}return nn(l),null;case 13:if(ht(Et),g=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(gt&&Rn!==null&&(l.mode&1)!==0&&(l.flags&128)===0)sg(),Ii(),l.flags|=98560,b=!1;else if(b=hl(l),g!==null&&g.dehydrated!==null){if(a===null){if(!b)throw Error(t(318));if(b=l.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(t(317));b[ar]=l}else Ii(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;nn(l),b=!1}else Xn!==null&&(Ud(Xn),Xn=null),b=!0;if(!b)return l.flags&65536?l:null}return(l.flags&128)!==0?(l.lanes=h,l):(g=g!==null,g!==(a!==null&&a.memoizedState!==null)&&g&&(l.child.flags|=8192,(l.mode&1)!==0&&(a===null||(Et.current&1)!==0?jt===0&&(jt=3):Vd())),l.updateQueue!==null&&(l.flags|=4),nn(l),null);case 4:return Pi(),Rd(a,l),a===null&&No(l.stateNode.containerInfo),nn(l),null;case 10:return nd(l.type._context),nn(l),null;case 17:return mn(l.type)&&ll(),nn(l),null;case 19:if(ht(Et),b=l.memoizedState,b===null)return nn(l),null;if(g=(l.flags&128)!==0,R=b.rendering,R===null)if(g)Wo(b,!1);else{if(jt!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(R=xl(a),R!==null){for(l.flags|=128,Wo(b,!1),g=R.updateQueue,g!==null&&(l.updateQueue=g,l.flags|=4),l.subtreeFlags=0,g=h,h=l.child;h!==null;)b=h,a=g,b.flags&=14680066,R=b.alternate,R===null?(b.childLanes=0,b.lanes=a,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=R.childLanes,b.lanes=R.lanes,b.child=R.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=R.memoizedProps,b.memoizedState=R.memoizedState,b.updateQueue=R.updateQueue,b.type=R.type,a=R.dependencies,b.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),h=h.sibling;return ut(Et,Et.current&1|2),l.child}a=a.sibling}b.tail!==null&&Pt()>Oi&&(l.flags|=128,g=!0,Wo(b,!1),l.lanes=4194304)}else{if(!g)if(a=xl(R),a!==null){if(l.flags|=128,g=!0,h=a.updateQueue,h!==null&&(l.updateQueue=h,l.flags|=4),Wo(b,!0),b.tail===null&&b.tailMode==="hidden"&&!R.alternate&&!gt)return nn(l),null}else 2*Pt()-b.renderingStartTime>Oi&&h!==1073741824&&(l.flags|=128,g=!0,Wo(b,!1),l.lanes=4194304);b.isBackwards?(R.sibling=l.child,l.child=R):(h=b.last,h!==null?h.sibling=R:l.child=R,b.last=R)}return b.tail!==null?(l=b.tail,b.rendering=l,b.tail=l.sibling,b.renderingStartTime=Pt(),l.sibling=null,h=Et.current,ut(Et,g?h&1|2:h&1),l):(nn(l),null);case 22:case 23:return $d(),g=l.memoizedState!==null,a!==null&&a.memoizedState!==null!==g&&(l.flags|=8192),g&&(l.mode&1)!==0?(Cn&1073741824)!==0&&(nn(l),l.subtreeFlags&6&&(l.flags|=8192)):nn(l),null;case 24:return null;case 25:return null}throw Error(t(156,l.tag))}function EL(a,l){switch(Xc(l),l.tag){case 1:return mn(l.type)&&ll(),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return Pi(),ht(pn),ht(en),ud(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 5:return ad(l),null;case 13:if(ht(Et),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(t(340));Ii()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return ht(Et),null;case 4:return Pi(),null;case 10:return nd(l.type._context),null;case 22:case 23:return $d(),null;case 24:return null;default:return null}}var Rl=!1,rn=!1,TL=typeof WeakSet=="function"?WeakSet:Set,Se=null;function ki(a,l){var h=a.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(g){Rt(a,l,g)}else h.current=null}function Cd(a,l,h){try{h()}catch(g){Rt(a,l,g)}}var n0=!1;function SL(a,l){if($c=Ya,a=Om(),Dc(a)){if("selectionStart"in a)var h={start:a.selectionStart,end:a.selectionEnd};else e:{h=(h=a.ownerDocument)&&h.defaultView||window;var g=h.getSelection&&h.getSelection();if(g&&g.rangeCount!==0){h=g.anchorNode;var E=g.anchorOffset,b=g.focusNode;g=g.focusOffset;try{h.nodeType,b.nodeType}catch{h=null;break e}var R=0,M=-1,j=-1,J=0,ce=0,he=a,ue=null;t:for(;;){for(var xe;he!==h||E!==0&&he.nodeType!==3||(M=R+E),he!==b||g!==0&&he.nodeType!==3||(j=R+g),he.nodeType===3&&(R+=he.nodeValue.length),(xe=he.firstChild)!==null;)ue=he,he=xe;for(;;){if(he===a)break t;if(ue===h&&++J===E&&(M=R),ue===b&&++ce===g&&(j=R),(xe=he.nextSibling)!==null)break;he=ue,ue=he.parentNode}he=xe}h=M===-1||j===-1?null:{start:M,end:j}}else h=null}h=h||{start:0,end:0}}else h=null;for(Vc={focusedElem:a,selectionRange:h},Ya=!1,Se=l;Se!==null;)if(l=Se,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,Se=a;else for(;Se!==null;){l=Se;try{var Ae=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if(Ae!==null){var Ie=Ae.memoizedProps,_t=Ae.memoizedState,W=l.stateNode,$=W.getSnapshotBeforeUpdate(l.elementType===l.type?Ie:Qn(l.type,Ie),_t);W.__reactInternalSnapshotBeforeUpdate=$}break;case 3:var q=l.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(ge){Rt(l,l.return,ge)}if(a=l.sibling,a!==null){a.return=l.return,Se=a;break}Se=l.return}return Ae=n0,n0=!1,Ae}function Yo(a,l,h){var g=l.updateQueue;if(g=g!==null?g.lastEffect:null,g!==null){var E=g=g.next;do{if((E.tag&a)===a){var b=E.destroy;E.destroy=void 0,b!==void 0&&Cd(l,h,b)}E=E.next}while(E!==g)}}function Cl(a,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var h=l=l.next;do{if((h.tag&a)===a){var g=h.create;h.destroy=g()}h=h.next}while(h!==l)}}function Pd(a){var l=a.ref;if(l!==null){var h=a.stateNode;switch(a.tag){case 5:a=h;break;default:a=h}typeof l=="function"?l(a):l.current=a}}function r0(a){var l=a.alternate;l!==null&&(a.alternate=null,r0(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&(delete l[ar],delete l[Fo],delete l[zc],delete l[sL],delete l[iL])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function s0(a){return a.tag===5||a.tag===3||a.tag===4}function i0(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||s0(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function _d(a,l,h){var g=a.tag;if(g===5||g===6)a=a.stateNode,l?h.nodeType===8?h.parentNode.insertBefore(a,l):h.insertBefore(a,l):(h.nodeType===8?(l=h.parentNode,l.insertBefore(a,h)):(l=h,l.appendChild(a)),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=ol));else if(g!==4&&(a=a.child,a!==null))for(_d(a,l,h),a=a.sibling;a!==null;)_d(a,l,h),a=a.sibling}function kd(a,l,h){var g=a.tag;if(g===5||g===6)a=a.stateNode,l?h.insertBefore(a,l):h.appendChild(a);else if(g!==4&&(a=a.child,a!==null))for(kd(a,l,h),a=a.sibling;a!==null;)kd(a,l,h),a=a.sibling}var qt=null,Zn=!1;function is(a,l,h){for(h=h.child;h!==null;)o0(a,l,h),h=h.sibling}function o0(a,l,h){if(or&&typeof or.onCommitFiberUnmount=="function")try{or.onCommitFiberUnmount(Va,h)}catch{}switch(h.tag){case 5:rn||ki(h,l);case 6:var g=qt,E=Zn;qt=null,is(a,l,h),qt=g,Zn=E,qt!==null&&(Zn?(a=qt,h=h.stateNode,a.nodeType===8?a.parentNode.removeChild(h):a.removeChild(h)):qt.removeChild(h.stateNode));break;case 18:qt!==null&&(Zn?(a=qt,h=h.stateNode,a.nodeType===8?Kc(a.parentNode,h):a.nodeType===1&&Kc(a,h),Io(a)):Kc(qt,h.stateNode));break;case 4:g=qt,E=Zn,qt=h.stateNode.containerInfo,Zn=!0,is(a,l,h),qt=g,Zn=E;break;case 0:case 11:case 14:case 15:if(!rn&&(g=h.updateQueue,g!==null&&(g=g.lastEffect,g!==null))){E=g=g.next;do{var b=E,R=b.destroy;b=b.tag,R!==void 0&&((b&2)!==0||(b&4)!==0)&&Cd(h,l,R),E=E.next}while(E!==g)}is(a,l,h);break;case 1:if(!rn&&(ki(h,l),g=h.stateNode,typeof g.componentWillUnmount=="function"))try{g.props=h.memoizedProps,g.state=h.memoizedState,g.componentWillUnmount()}catch(M){Rt(h,l,M)}is(a,l,h);break;case 21:is(a,l,h);break;case 22:h.mode&1?(rn=(g=rn)||h.memoizedState!==null,is(a,l,h),rn=g):is(a,l,h);break;default:is(a,l,h)}}function a0(a){var l=a.updateQueue;if(l!==null){a.updateQueue=null;var h=a.stateNode;h===null&&(h=a.stateNode=new TL),l.forEach(function(g){var E=_L.bind(null,a,g);h.has(g)||(h.add(g),g.then(E,E))})}}function Jn(a,l){var h=l.deletions;if(h!==null)for(var g=0;g<h.length;g++){var E=h[g];try{var b=a,R=l,M=R;e:for(;M!==null;){switch(M.tag){case 5:qt=M.stateNode,Zn=!1;break e;case 3:qt=M.stateNode.containerInfo,Zn=!0;break e;case 4:qt=M.stateNode.containerInfo,Zn=!0;break e}M=M.return}if(qt===null)throw Error(t(160));o0(b,R,E),qt=null,Zn=!1;var j=E.alternate;j!==null&&(j.return=null),E.return=null}catch(J){Rt(E,l,J)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)l0(l,a),l=l.sibling}function l0(a,l){var h=a.alternate,g=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Jn(l,a),cr(a),g&4){try{Yo(3,a,a.return),Cl(3,a)}catch(Ie){Rt(a,a.return,Ie)}try{Yo(5,a,a.return)}catch(Ie){Rt(a,a.return,Ie)}}break;case 1:Jn(l,a),cr(a),g&512&&h!==null&&ki(h,h.return);break;case 5:if(Jn(l,a),cr(a),g&512&&h!==null&&ki(h,h.return),a.flags&32){var E=a.stateNode;try{Fe(E,"")}catch(Ie){Rt(a,a.return,Ie)}}if(g&4&&(E=a.stateNode,E!=null)){var b=a.memoizedProps,R=h!==null?h.memoizedProps:b,M=a.type,j=a.updateQueue;if(a.updateQueue=null,j!==null)try{M==="input"&&b.type==="radio"&&b.name!=null&&ze(E,b),Ve(M,R);var J=Ve(M,b);for(R=0;R<j.length;R+=2){var ce=j[R],he=j[R+1];ce==="style"?Le(E,he):ce==="dangerouslySetInnerHTML"?Be(E,he):ce==="children"?Fe(E,he):w(E,ce,he,J)}switch(M){case"input":wt(E,b);break;case"textarea":Ar(E,b);break;case"select":var ue=E._wrapperState.wasMultiple;E._wrapperState.wasMultiple=!!b.multiple;var xe=b.value;xe!=null?Yt(E,!!b.multiple,xe,!1):ue!==!!b.multiple&&(b.defaultValue!=null?Yt(E,!!b.multiple,b.defaultValue,!0):Yt(E,!!b.multiple,b.multiple?[]:"",!1))}E[Fo]=b}catch(Ie){Rt(a,a.return,Ie)}}break;case 6:if(Jn(l,a),cr(a),g&4){if(a.stateNode===null)throw Error(t(162));E=a.stateNode,b=a.memoizedProps;try{E.nodeValue=b}catch(Ie){Rt(a,a.return,Ie)}}break;case 3:if(Jn(l,a),cr(a),g&4&&h!==null&&h.memoizedState.isDehydrated)try{Io(l.containerInfo)}catch(Ie){Rt(a,a.return,Ie)}break;case 4:Jn(l,a),cr(a);break;case 13:Jn(l,a),cr(a),E=a.child,E.flags&8192&&(b=E.memoizedState!==null,E.stateNode.isHidden=b,!b||E.alternate!==null&&E.alternate.memoizedState!==null||(Nd=Pt())),g&4&&a0(a);break;case 22:if(ce=h!==null&&h.memoizedState!==null,a.mode&1?(rn=(J=rn)||ce,Jn(l,a),rn=J):Jn(l,a),cr(a),g&8192){if(J=a.memoizedState!==null,(a.stateNode.isHidden=J)&&!ce&&(a.mode&1)!==0)for(Se=a,ce=a.child;ce!==null;){for(he=Se=ce;Se!==null;){switch(ue=Se,xe=ue.child,ue.tag){case 0:case 11:case 14:case 15:Yo(4,ue,ue.return);break;case 1:ki(ue,ue.return);var Ae=ue.stateNode;if(typeof Ae.componentWillUnmount=="function"){g=ue,h=ue.return;try{l=g,Ae.props=l.memoizedProps,Ae.state=l.memoizedState,Ae.componentWillUnmount()}catch(Ie){Rt(g,h,Ie)}}break;case 5:ki(ue,ue.return);break;case 22:if(ue.memoizedState!==null){d0(he);continue}}xe!==null?(xe.return=ue,Se=xe):d0(he)}ce=ce.sibling}e:for(ce=null,he=a;;){if(he.tag===5){if(ce===null){ce=he;try{E=he.stateNode,J?(b=E.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none"):(M=he.stateNode,j=he.memoizedProps.style,R=j!=null&&j.hasOwnProperty("display")?j.display:null,M.style.display=oe("display",R))}catch(Ie){Rt(a,a.return,Ie)}}}else if(he.tag===6){if(ce===null)try{he.stateNode.nodeValue=J?"":he.memoizedProps}catch(Ie){Rt(a,a.return,Ie)}}else if((he.tag!==22&&he.tag!==23||he.memoizedState===null||he===a)&&he.child!==null){he.child.return=he,he=he.child;continue}if(he===a)break e;for(;he.sibling===null;){if(he.return===null||he.return===a)break e;ce===he&&(ce=null),he=he.return}ce===he&&(ce=null),he.sibling.return=he.return,he=he.sibling}}break;case 19:Jn(l,a),cr(a),g&4&&a0(a);break;case 21:break;default:Jn(l,a),cr(a)}}function cr(a){var l=a.flags;if(l&2){try{e:{for(var h=a.return;h!==null;){if(s0(h)){var g=h;break e}h=h.return}throw Error(t(160))}switch(g.tag){case 5:var E=g.stateNode;g.flags&32&&(Fe(E,""),g.flags&=-33);var b=i0(a);kd(a,b,E);break;case 3:case 4:var R=g.stateNode.containerInfo,M=i0(a);_d(a,M,R);break;default:throw Error(t(161))}}catch(j){Rt(a,a.return,j)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function bL(a,l,h){Se=a,u0(a)}function u0(a,l,h){for(var g=(a.mode&1)!==0;Se!==null;){var E=Se,b=E.child;if(E.tag===22&&g){var R=E.memoizedState!==null||Rl;if(!R){var M=E.alternate,j=M!==null&&M.memoizedState!==null||rn;M=Rl;var J=rn;if(Rl=R,(rn=j)&&!J)for(Se=E;Se!==null;)R=Se,j=R.child,R.tag===22&&R.memoizedState!==null?f0(E):j!==null?(j.return=R,Se=j):f0(E);for(;b!==null;)Se=b,u0(b),b=b.sibling;Se=E,Rl=M,rn=J}c0(a)}else(E.subtreeFlags&8772)!==0&&b!==null?(b.return=E,Se=b):c0(a)}}function c0(a){for(;Se!==null;){var l=Se;if((l.flags&8772)!==0){var h=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:rn||Cl(5,l);break;case 1:var g=l.stateNode;if(l.flags&4&&!rn)if(h===null)g.componentDidMount();else{var E=l.elementType===l.type?h.memoizedProps:Qn(l.type,h.memoizedProps);g.componentDidUpdate(E,h.memoizedState,g.__reactInternalSnapshotBeforeUpdate)}var b=l.updateQueue;b!==null&&dg(l,b,g);break;case 3:var R=l.updateQueue;if(R!==null){if(h=null,l.child!==null)switch(l.child.tag){case 5:h=l.child.stateNode;break;case 1:h=l.child.stateNode}dg(l,R,h)}break;case 5:var M=l.stateNode;if(h===null&&l.flags&4){h=M;var j=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":j.autoFocus&&h.focus();break;case"img":j.src&&(h.src=j.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var J=l.alternate;if(J!==null){var ce=J.memoizedState;if(ce!==null){var he=ce.dehydrated;he!==null&&Io(he)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}rn||l.flags&512&&Pd(l)}catch(ue){Rt(l,l.return,ue)}}if(l===a){Se=null;break}if(h=l.sibling,h!==null){h.return=l.return,Se=h;break}Se=l.return}}function d0(a){for(;Se!==null;){var l=Se;if(l===a){Se=null;break}var h=l.sibling;if(h!==null){h.return=l.return,Se=h;break}Se=l.return}}function f0(a){for(;Se!==null;){var l=Se;try{switch(l.tag){case 0:case 11:case 15:var h=l.return;try{Cl(4,l)}catch(j){Rt(l,h,j)}break;case 1:var g=l.stateNode;if(typeof g.componentDidMount=="function"){var E=l.return;try{g.componentDidMount()}catch(j){Rt(l,E,j)}}var b=l.return;try{Pd(l)}catch(j){Rt(l,b,j)}break;case 5:var R=l.return;try{Pd(l)}catch(j){Rt(l,R,j)}}}catch(j){Rt(l,l.return,j)}if(l===a){Se=null;break}var M=l.sibling;if(M!==null){M.return=l.return,Se=M;break}Se=l.return}}var AL=Math.ceil,Pl=C.ReactCurrentDispatcher,Dd=C.ReactCurrentOwner,$n=C.ReactCurrentBatchConfig,Xe=0,Kt=null,Nt=null,Xt=0,Cn=0,Di=es(0),jt=0,qo=null,js=0,_l=0,Od=0,Xo=null,yn=null,Nd=0,Oi=1/0,Dr=null,kl=!1,Md=null,os=null,Dl=!1,as=null,Ol=0,Qo=0,Fd=null,Nl=-1,Ml=0;function un(){return(Xe&6)!==0?Pt():Nl!==-1?Nl:Nl=Pt()}function ls(a){return(a.mode&1)===0?1:(Xe&2)!==0&&Xt!==0?Xt&-Xt:aL.transition!==null?(Ml===0&&(Ml=im()),Ml):(a=Je,a!==0||(a=window.event,a=a===void 0?16:pm(a.type)),a)}function er(a,l,h,g){if(50<Qo)throw Qo=0,Fd=null,Error(t(185));To(a,h,g),((Xe&2)===0||a!==Kt)&&(a===Kt&&((Xe&2)===0&&(_l|=h),jt===4&&us(a,Xt)),vn(a,g),h===1&&Xe===0&&(l.mode&1)===0&&(Oi=Pt()+500,cl&&ns()))}function vn(a,l){var h=a.callbackNode;aA(a,l);var g=Ka(a,a===Kt?Xt:0);if(g===0)h!==null&&nm(h),a.callbackNode=null,a.callbackPriority=0;else if(l=g&-g,a.callbackPriority!==l){if(h!=null&&nm(h),l===1)a.tag===0?oL(p0.bind(null,a)):Jm(p0.bind(null,a)),nL(function(){(Xe&6)===0&&ns()}),h=null;else{switch(om(g)){case 1:h=gc;break;case 4:h=rm;break;case 16:h=$a;break;case 536870912:h=sm;break;default:h=$a}h=S0(h,h0.bind(null,a))}a.callbackPriority=l,a.callbackNode=h}}function h0(a,l){if(Nl=-1,Ml=0,(Xe&6)!==0)throw Error(t(327));var h=a.callbackNode;if(Ni()&&a.callbackNode!==h)return null;var g=Ka(a,a===Kt?Xt:0);if(g===0)return null;if((g&30)!==0||(g&a.expiredLanes)!==0||l)l=Fl(a,g);else{l=g;var E=Xe;Xe|=2;var b=g0();(Kt!==a||Xt!==l)&&(Dr=null,Oi=Pt()+500,Vs(a,l));do try{wL();break}catch(M){m0(a,M)}while(!0);td(),Pl.current=b,Xe=E,Nt!==null?l=0:(Kt=null,Xt=0,l=jt)}if(l!==0){if(l===2&&(E=yc(a),E!==0&&(g=E,l=Bd(a,E))),l===1)throw h=qo,Vs(a,0),us(a,g),vn(a,Pt()),h;if(l===6)us(a,g);else{if(E=a.current.alternate,(g&30)===0&&!LL(E)&&(l=Fl(a,g),l===2&&(b=yc(a),b!==0&&(g=b,l=Bd(a,b))),l===1))throw h=qo,Vs(a,0),us(a,g),vn(a,Pt()),h;switch(a.finishedWork=E,a.finishedLanes=g,l){case 0:case 1:throw Error(t(345));case 2:Gs(a,yn,Dr);break;case 3:if(us(a,g),(g&130023424)===g&&(l=Nd+500-Pt(),10<l)){if(Ka(a,0)!==0)break;if(E=a.suspendedLanes,(E&g)!==g){un(),a.pingedLanes|=a.suspendedLanes&E;break}a.timeoutHandle=Hc(Gs.bind(null,a,yn,Dr),l);break}Gs(a,yn,Dr);break;case 4:if(us(a,g),(g&4194240)===g)break;for(l=a.eventTimes,E=-1;0<g;){var R=31-Yn(g);b=1<<R,R=l[R],R>E&&(E=R),g&=~b}if(g=E,g=Pt()-g,g=(120>g?120:480>g?480:1080>g?1080:1920>g?1920:3e3>g?3e3:4320>g?4320:1960*AL(g/1960))-g,10<g){a.timeoutHandle=Hc(Gs.bind(null,a,yn,Dr),g);break}Gs(a,yn,Dr);break;case 5:Gs(a,yn,Dr);break;default:throw Error(t(329))}}}return vn(a,Pt()),a.callbackNode===h?h0.bind(null,a):null}function Bd(a,l){var h=Xo;return a.current.memoizedState.isDehydrated&&(Vs(a,l).flags|=256),a=Fl(a,l),a!==2&&(l=yn,yn=h,l!==null&&Ud(l)),a}function Ud(a){yn===null?yn=a:yn.push.apply(yn,a)}function LL(a){for(var l=a;;){if(l.flags&16384){var h=l.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var g=0;g<h.length;g++){var E=h[g],b=E.getSnapshot;E=E.value;try{if(!qn(b(),E))return!1}catch{return!1}}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function us(a,l){for(l&=~Od,l&=~_l,a.suspendedLanes|=l,a.pingedLanes&=~l,a=a.expirationTimes;0<l;){var h=31-Yn(l),g=1<<h;a[h]=-1,l&=~g}}function p0(a){if((Xe&6)!==0)throw Error(t(327));Ni();var l=Ka(a,0);if((l&1)===0)return vn(a,Pt()),null;var h=Fl(a,l);if(a.tag!==0&&h===2){var g=yc(a);g!==0&&(l=g,h=Bd(a,g))}if(h===1)throw h=qo,Vs(a,0),us(a,l),vn(a,Pt()),h;if(h===6)throw Error(t(345));return a.finishedWork=a.current.alternate,a.finishedLanes=l,Gs(a,yn,Dr),vn(a,Pt()),null}function jd(a,l){var h=Xe;Xe|=1;try{return a(l)}finally{Xe=h,Xe===0&&(Oi=Pt()+500,cl&&ns())}}function $s(a){as!==null&&as.tag===0&&(Xe&6)===0&&Ni();var l=Xe;Xe|=1;var h=$n.transition,g=Je;try{if($n.transition=null,Je=1,a)return a()}finally{Je=g,$n.transition=h,Xe=l,(Xe&6)===0&&ns()}}function $d(){Cn=Di.current,ht(Di)}function Vs(a,l){a.finishedWork=null,a.finishedLanes=0;var h=a.timeoutHandle;if(h!==-1&&(a.timeoutHandle=-1,tL(h)),Nt!==null)for(h=Nt.return;h!==null;){var g=h;switch(Xc(g),g.tag){case 1:g=g.type.childContextTypes,g!=null&&ll();break;case 3:Pi(),ht(pn),ht(en),ud();break;case 5:ad(g);break;case 4:Pi();break;case 13:ht(Et);break;case 19:ht(Et);break;case 10:nd(g.type._context);break;case 22:case 23:$d()}h=h.return}if(Kt=a,Nt=a=cs(a.current,null),Xt=Cn=l,jt=0,qo=null,Od=_l=js=0,yn=Xo=null,Fs!==null){for(l=0;l<Fs.length;l++)if(h=Fs[l],g=h.interleaved,g!==null){h.interleaved=null;var E=g.next,b=h.pending;if(b!==null){var R=b.next;b.next=E,g.next=R}h.pending=g}Fs=null}return a}function m0(a,l){do{var h=Nt;try{if(td(),El.current=Al,Tl){for(var g=Tt.memoizedState;g!==null;){var E=g.queue;E!==null&&(E.pending=null),g=g.next}Tl=!1}if(Us=0,Ht=Ut=Tt=null,Go=!1,Ho=0,Dd.current=null,h===null||h.return===null){jt=1,qo=l,Nt=null;break}e:{var b=a,R=h.return,M=h,j=l;if(l=Xt,M.flags|=32768,j!==null&&typeof j=="object"&&typeof j.then=="function"){var J=j,ce=M,he=ce.tag;if((ce.mode&1)===0&&(he===0||he===11||he===15)){var ue=ce.alternate;ue?(ce.updateQueue=ue.updateQueue,ce.memoizedState=ue.memoizedState,ce.lanes=ue.lanes):(ce.updateQueue=null,ce.memoizedState=null)}var xe=jg(R);if(xe!==null){xe.flags&=-257,$g(xe,R,M,b,l),xe.mode&1&&Ug(b,J,l),l=xe,j=J;var Ae=l.updateQueue;if(Ae===null){var Ie=new Set;Ie.add(j),l.updateQueue=Ie}else Ae.add(j);break e}else{if((l&1)===0){Ug(b,J,l),Vd();break e}j=Error(t(426))}}else if(gt&&M.mode&1){var _t=jg(R);if(_t!==null){(_t.flags&65536)===0&&(_t.flags|=256),$g(_t,R,M,b,l),Jc(_i(j,M));break e}}b=j=_i(j,M),jt!==4&&(jt=2),Xo===null?Xo=[b]:Xo.push(b),b=R;do{switch(b.tag){case 3:b.flags|=65536,l&=-l,b.lanes|=l;var W=Fg(b,j,l);cg(b,W);break e;case 1:M=j;var $=b.type,q=b.stateNode;if((b.flags&128)===0&&(typeof $.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(os===null||!os.has(q)))){b.flags|=65536,l&=-l,b.lanes|=l;var ge=Bg(b,M,l);cg(b,ge);break e}}b=b.return}while(b!==null)}v0(h)}catch(Re){l=Re,Nt===h&&h!==null&&(Nt=h=h.return);continue}break}while(!0)}function g0(){var a=Pl.current;return Pl.current=Al,a===null?Al:a}function Vd(){(jt===0||jt===3||jt===2)&&(jt=4),Kt===null||(js&268435455)===0&&(_l&268435455)===0||us(Kt,Xt)}function Fl(a,l){var h=Xe;Xe|=2;var g=g0();(Kt!==a||Xt!==l)&&(Dr=null,Vs(a,l));do try{IL();break}catch(E){m0(a,E)}while(!0);if(td(),Xe=h,Pl.current=g,Nt!==null)throw Error(t(261));return Kt=null,Xt=0,jt}function IL(){for(;Nt!==null;)y0(Nt)}function wL(){for(;Nt!==null&&!Zb();)y0(Nt)}function y0(a){var l=T0(a.alternate,a,Cn);a.memoizedProps=a.pendingProps,l===null?v0(a):Nt=l,Dd.current=null}function v0(a){var l=a;do{var h=l.alternate;if(a=l.return,(l.flags&32768)===0){if(h=xL(h,l,Cn),h!==null){Nt=h;return}}else{if(h=EL(h,l),h!==null){h.flags&=32767,Nt=h;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{jt=6,Nt=null;return}}if(l=l.sibling,l!==null){Nt=l;return}Nt=l=a}while(l!==null);jt===0&&(jt=5)}function Gs(a,l,h){var g=Je,E=$n.transition;try{$n.transition=null,Je=1,RL(a,l,h,g)}finally{$n.transition=E,Je=g}return null}function RL(a,l,h,g){do Ni();while(as!==null);if((Xe&6)!==0)throw Error(t(327));h=a.finishedWork;var E=a.finishedLanes;if(h===null)return null;if(a.finishedWork=null,a.finishedLanes=0,h===a.current)throw Error(t(177));a.callbackNode=null,a.callbackPriority=0;var b=h.lanes|h.childLanes;if(lA(a,b),a===Kt&&(Nt=Kt=null,Xt=0),(h.subtreeFlags&2064)===0&&(h.flags&2064)===0||Dl||(Dl=!0,S0($a,function(){return Ni(),null})),b=(h.flags&15990)!==0,(h.subtreeFlags&15990)!==0||b){b=$n.transition,$n.transition=null;var R=Je;Je=1;var M=Xe;Xe|=4,Dd.current=null,SL(a,h),l0(h,a),YA(Vc),Ya=!!$c,Vc=$c=null,a.current=h,bL(h),Jb(),Xe=M,Je=R,$n.transition=b}else a.current=h;if(Dl&&(Dl=!1,as=a,Ol=E),b=a.pendingLanes,b===0&&(os=null),nA(h.stateNode),vn(a,Pt()),l!==null)for(g=a.onRecoverableError,h=0;h<l.length;h++)E=l[h],g(E.value,{componentStack:E.stack,digest:E.digest});if(kl)throw kl=!1,a=Md,Md=null,a;return(Ol&1)!==0&&a.tag!==0&&Ni(),b=a.pendingLanes,(b&1)!==0?a===Fd?Qo++:(Qo=0,Fd=a):Qo=0,ns(),null}function Ni(){if(as!==null){var a=om(Ol),l=$n.transition,h=Je;try{if($n.transition=null,Je=16>a?16:a,as===null)var g=!1;else{if(a=as,as=null,Ol=0,(Xe&6)!==0)throw Error(t(331));var E=Xe;for(Xe|=4,Se=a.current;Se!==null;){var b=Se,R=b.child;if((Se.flags&16)!==0){var M=b.deletions;if(M!==null){for(var j=0;j<M.length;j++){var J=M[j];for(Se=J;Se!==null;){var ce=Se;switch(ce.tag){case 0:case 11:case 15:Yo(8,ce,b)}var he=ce.child;if(he!==null)he.return=ce,Se=he;else for(;Se!==null;){ce=Se;var ue=ce.sibling,xe=ce.return;if(r0(ce),ce===J){Se=null;break}if(ue!==null){ue.return=xe,Se=ue;break}Se=xe}}}var Ae=b.alternate;if(Ae!==null){var Ie=Ae.child;if(Ie!==null){Ae.child=null;do{var _t=Ie.sibling;Ie.sibling=null,Ie=_t}while(Ie!==null)}}Se=b}}if((b.subtreeFlags&2064)!==0&&R!==null)R.return=b,Se=R;else e:for(;Se!==null;){if(b=Se,(b.flags&2048)!==0)switch(b.tag){case 0:case 11:case 15:Yo(9,b,b.return)}var W=b.sibling;if(W!==null){W.return=b.return,Se=W;break e}Se=b.return}}var $=a.current;for(Se=$;Se!==null;){R=Se;var q=R.child;if((R.subtreeFlags&2064)!==0&&q!==null)q.return=R,Se=q;else e:for(R=$;Se!==null;){if(M=Se,(M.flags&2048)!==0)try{switch(M.tag){case 0:case 11:case 15:Cl(9,M)}}catch(Re){Rt(M,M.return,Re)}if(M===R){Se=null;break e}var ge=M.sibling;if(ge!==null){ge.return=M.return,Se=ge;break e}Se=M.return}}if(Xe=E,ns(),or&&typeof or.onPostCommitFiberRoot=="function")try{or.onPostCommitFiberRoot(Va,a)}catch{}g=!0}return g}finally{Je=h,$n.transition=l}}return!1}function x0(a,l,h){l=_i(h,l),l=Fg(a,l,1),a=ss(a,l,1),l=un(),a!==null&&(To(a,1,l),vn(a,l))}function Rt(a,l,h){if(a.tag===3)x0(a,a,h);else for(;l!==null;){if(l.tag===3){x0(l,a,h);break}else if(l.tag===1){var g=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(os===null||!os.has(g))){a=_i(h,a),a=Bg(l,a,1),l=ss(l,a,1),a=un(),l!==null&&(To(l,1,a),vn(l,a));break}}l=l.return}}function CL(a,l,h){var g=a.pingCache;g!==null&&g.delete(l),l=un(),a.pingedLanes|=a.suspendedLanes&h,Kt===a&&(Xt&h)===h&&(jt===4||jt===3&&(Xt&130023424)===Xt&&500>Pt()-Nd?Vs(a,0):Od|=h),vn(a,l)}function E0(a,l){l===0&&((a.mode&1)===0?l=1:(l=Ha,Ha<<=1,(Ha&130023424)===0&&(Ha=4194304)));var h=un();a=Pr(a,l),a!==null&&(To(a,l,h),vn(a,h))}function PL(a){var l=a.memoizedState,h=0;l!==null&&(h=l.retryLane),E0(a,h)}function _L(a,l){var h=0;switch(a.tag){case 13:var g=a.stateNode,E=a.memoizedState;E!==null&&(h=E.retryLane);break;case 19:g=a.stateNode;break;default:throw Error(t(314))}g!==null&&g.delete(l),E0(a,h)}var T0;T0=function(a,l,h){if(a!==null)if(a.memoizedProps!==l.pendingProps||pn.current)gn=!0;else{if((a.lanes&h)===0&&(l.flags&128)===0)return gn=!1,vL(a,l,h);gn=(a.flags&131072)!==0}else gn=!1,gt&&(l.flags&1048576)!==0&&eg(l,fl,l.index);switch(l.lanes=0,l.tag){case 2:var g=l.type;wl(a,l),a=l.pendingProps;var E=bi(l,en.current);Ci(l,h),E=fd(null,l,g,a,E,h);var b=hd();return l.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,mn(g)?(b=!0,ul(l)):b=!1,l.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,id(l),E.updater=Ll,l.stateNode=E,E._reactInternals=l,xd(l,g,a,h),l=bd(null,l,g,!0,b,h)):(l.tag=0,gt&&b&&qc(l),ln(null,l,E,h),l=l.child),l;case 16:g=l.elementType;e:{switch(wl(a,l),a=l.pendingProps,E=g._init,g=E(g._payload),l.type=g,E=l.tag=DL(g),a=Qn(g,a),E){case 0:l=Sd(null,l,g,a,h);break e;case 1:l=Wg(null,l,g,a,h);break e;case 11:l=Vg(null,l,g,a,h);break e;case 14:l=Gg(null,l,g,Qn(g.type,a),h);break e}throw Error(t(306,g,""))}return l;case 0:return g=l.type,E=l.pendingProps,E=l.elementType===g?E:Qn(g,E),Sd(a,l,g,E,h);case 1:return g=l.type,E=l.pendingProps,E=l.elementType===g?E:Qn(g,E),Wg(a,l,g,E,h);case 3:e:{if(Yg(l),a===null)throw Error(t(387));g=l.pendingProps,b=l.memoizedState,E=b.element,ug(a,l),vl(l,g,null,h);var R=l.memoizedState;if(g=R.element,b.isDehydrated)if(b={element:g,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},l.updateQueue.baseState=b,l.memoizedState=b,l.flags&256){E=_i(Error(t(423)),l),l=qg(a,l,g,h,E);break e}else if(g!==E){E=_i(Error(t(424)),l),l=qg(a,l,g,h,E);break e}else for(Rn=Jr(l.stateNode.containerInfo.firstChild),wn=l,gt=!0,Xn=null,h=ag(l,null,g,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Ii(),g===E){l=kr(a,l,h);break e}ln(a,l,g,h)}l=l.child}return l;case 5:return fg(l),a===null&&Zc(l),g=l.type,E=l.pendingProps,b=a!==null?a.memoizedProps:null,R=E.children,Gc(g,E)?R=null:b!==null&&Gc(g,b)&&(l.flags|=32),zg(a,l),ln(a,l,R,h),l.child;case 6:return a===null&&Zc(l),null;case 13:return Xg(a,l,h);case 4:return od(l,l.stateNode.containerInfo),g=l.pendingProps,a===null?l.child=wi(l,null,g,h):ln(a,l,g,h),l.child;case 11:return g=l.type,E=l.pendingProps,E=l.elementType===g?E:Qn(g,E),Vg(a,l,g,E,h);case 7:return ln(a,l,l.pendingProps,h),l.child;case 8:return ln(a,l,l.pendingProps.children,h),l.child;case 12:return ln(a,l,l.pendingProps.children,h),l.child;case 10:e:{if(g=l.type._context,E=l.pendingProps,b=l.memoizedProps,R=E.value,ut(ml,g._currentValue),g._currentValue=R,b!==null)if(qn(b.value,R)){if(b.children===E.children&&!pn.current){l=kr(a,l,h);break e}}else for(b=l.child,b!==null&&(b.return=l);b!==null;){var M=b.dependencies;if(M!==null){R=b.child;for(var j=M.firstContext;j!==null;){if(j.context===g){if(b.tag===1){j=_r(-1,h&-h),j.tag=2;var J=b.updateQueue;if(J!==null){J=J.shared;var ce=J.pending;ce===null?j.next=j:(j.next=ce.next,ce.next=j),J.pending=j}}b.lanes|=h,j=b.alternate,j!==null&&(j.lanes|=h),rd(b.return,h,l),M.lanes|=h;break}j=j.next}}else if(b.tag===10)R=b.type===l.type?null:b.child;else if(b.tag===18){if(R=b.return,R===null)throw Error(t(341));R.lanes|=h,M=R.alternate,M!==null&&(M.lanes|=h),rd(R,h,l),R=b.sibling}else R=b.child;if(R!==null)R.return=b;else for(R=b;R!==null;){if(R===l){R=null;break}if(b=R.sibling,b!==null){b.return=R.return,R=b;break}R=R.return}b=R}ln(a,l,E.children,h),l=l.child}return l;case 9:return E=l.type,g=l.pendingProps.children,Ci(l,h),E=Un(E),g=g(E),l.flags|=1,ln(a,l,g,h),l.child;case 14:return g=l.type,E=Qn(g,l.pendingProps),E=Qn(g.type,E),Gg(a,l,g,E,h);case 15:return Hg(a,l,l.type,l.pendingProps,h);case 17:return g=l.type,E=l.pendingProps,E=l.elementType===g?E:Qn(g,E),wl(a,l),l.tag=1,mn(g)?(a=!0,ul(l)):a=!1,Ci(l,h),Ng(l,g,E),xd(l,g,E,h),bd(null,l,g,!0,a,h);case 19:return Zg(a,l,h);case 22:return Kg(a,l,h)}throw Error(t(156,l.tag))};function S0(a,l){return tm(a,l)}function kL(a,l,h,g){this.tag=a,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vn(a,l,h,g){return new kL(a,l,h,g)}function Gd(a){return a=a.prototype,!(!a||!a.isReactComponent)}function DL(a){if(typeof a=="function")return Gd(a)?1:0;if(a!=null){if(a=a.$$typeof,a===H)return 11;if(a===ae)return 14}return 2}function cs(a,l){var h=a.alternate;return h===null?(h=Vn(a.tag,l,a.key,a.mode),h.elementType=a.elementType,h.type=a.type,h.stateNode=a.stateNode,h.alternate=a,a.alternate=h):(h.pendingProps=l,h.type=a.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=a.flags&14680064,h.childLanes=a.childLanes,h.lanes=a.lanes,h.child=a.child,h.memoizedProps=a.memoizedProps,h.memoizedState=a.memoizedState,h.updateQueue=a.updateQueue,l=a.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=a.sibling,h.index=a.index,h.ref=a.ref,h}function Bl(a,l,h,g,E,b){var R=2;if(g=a,typeof a=="function")Gd(a)&&(R=1);else if(typeof a=="string")R=5;else e:switch(a){case D:return Hs(h.children,E,b,l);case N:R=8,E|=8;break;case F:return a=Vn(12,h,l,E|2),a.elementType=F,a.lanes=b,a;case te:return a=Vn(13,h,l,E),a.elementType=te,a.lanes=b,a;case X:return a=Vn(19,h,l,E),a.elementType=X,a.lanes=b,a;case ie:return Ul(h,E,b,l);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case O:R=10;break e;case V:R=9;break e;case H:R=11;break e;case ae:R=14;break e;case Q:R=16,g=null;break e}throw Error(t(130,a==null?a:typeof a,""))}return l=Vn(R,h,l,E),l.elementType=a,l.type=g,l.lanes=b,l}function Hs(a,l,h,g){return a=Vn(7,a,g,l),a.lanes=h,a}function Ul(a,l,h,g){return a=Vn(22,a,g,l),a.elementType=ie,a.lanes=h,a.stateNode={isHidden:!1},a}function Hd(a,l,h){return a=Vn(6,a,null,l),a.lanes=h,a}function Kd(a,l,h){return l=Vn(4,a.children!==null?a.children:[],a.key,l),l.lanes=h,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}function OL(a,l,h,g,E){this.tag=l,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vc(0),this.expirationTimes=vc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vc(0),this.identifierPrefix=g,this.onRecoverableError=E,this.mutableSourceEagerHydrationData=null}function zd(a,l,h,g,E,b,R,M,j){return a=new OL(a,l,h,M,j),l===1?(l=1,b===!0&&(l|=8)):l=0,b=Vn(3,null,null,l),a.current=b,b.stateNode=a,b.memoizedState={element:g,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},id(b),a}function NL(a,l,h){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:B,key:g==null?null:""+g,children:a,containerInfo:l,implementation:h}}function b0(a){if(!a)return ts;a=a._reactInternals;e:{if(ks(a)!==a||a.tag!==1)throw Error(t(170));var l=a;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(mn(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(t(171))}if(a.tag===1){var h=a.type;if(mn(h))return Qm(a,h,l)}return l}function A0(a,l,h,g,E,b,R,M,j){return a=zd(h,g,!0,a,E,b,R,M,j),a.context=b0(null),h=a.current,g=un(),E=ls(h),b=_r(g,E),b.callback=l??null,ss(h,b,E),a.current.lanes=E,To(a,E,g),vn(a,g),a}function jl(a,l,h,g){var E=l.current,b=un(),R=ls(E);return h=b0(h),l.context===null?l.context=h:l.pendingContext=h,l=_r(b,R),l.payload={element:a},g=g===void 0?null:g,g!==null&&(l.callback=g),a=ss(E,l,R),a!==null&&(er(a,E,R,b),yl(a,E,R)),R}function $l(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function L0(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var h=a.retryLane;a.retryLane=h!==0&&h<l?h:l}}function Wd(a,l){L0(a,l),(a=a.alternate)&&L0(a,l)}function ML(){return null}var I0=typeof reportError=="function"?reportError:function(a){console.error(a)};function Yd(a){this._internalRoot=a}Vl.prototype.render=Yd.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(t(409));jl(a,l,null,null)},Vl.prototype.unmount=Yd.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;$s(function(){jl(null,a,null,null)}),l[Ir]=null}};function Vl(a){this._internalRoot=a}Vl.prototype.unstable_scheduleHydration=function(a){if(a){var l=um();a={blockedOn:null,target:a,priority:l};for(var h=0;h<Xr.length&&l!==0&&l<Xr[h].priority;h++);Xr.splice(h,0,a),h===0&&fm(a)}};function qd(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function Gl(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function w0(){}function FL(a,l,h,g,E){if(E){if(typeof g=="function"){var b=g;g=function(){var J=$l(R);b.call(J)}}var R=A0(l,g,a,0,null,!1,!1,"",w0);return a._reactRootContainer=R,a[Ir]=R.current,No(a.nodeType===8?a.parentNode:a),$s(),R}for(;E=a.lastChild;)a.removeChild(E);if(typeof g=="function"){var M=g;g=function(){var J=$l(j);M.call(J)}}var j=zd(a,0,!1,null,null,!1,!1,"",w0);return a._reactRootContainer=j,a[Ir]=j.current,No(a.nodeType===8?a.parentNode:a),$s(function(){jl(l,j,h,g)}),j}function Hl(a,l,h,g,E){var b=h._reactRootContainer;if(b){var R=b;if(typeof E=="function"){var M=E;E=function(){var j=$l(R);M.call(j)}}jl(l,R,a,E)}else R=FL(h,l,a,E,g);return $l(R)}am=function(a){switch(a.tag){case 3:var l=a.stateNode;if(l.current.memoizedState.isDehydrated){var h=Eo(l.pendingLanes);h!==0&&(xc(l,h|1),vn(l,Pt()),(Xe&6)===0&&(Oi=Pt()+500,ns()))}break;case 13:$s(function(){var g=Pr(a,1);if(g!==null){var E=un();er(g,a,1,E)}}),Wd(a,1)}},Ec=function(a){if(a.tag===13){var l=Pr(a,134217728);if(l!==null){var h=un();er(l,a,134217728,h)}Wd(a,134217728)}},lm=function(a){if(a.tag===13){var l=ls(a),h=Pr(a,l);if(h!==null){var g=un();er(h,a,l,g)}Wd(a,l)}},um=function(){return Je},cm=function(a,l){var h=Je;try{return Je=a,l()}finally{Je=h}},Ze=function(a,l,h){switch(l){case"input":if(wt(a,h),l=h.name,h.type==="radio"&&l!=null){for(h=a;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<h.length;l++){var g=h[l];if(g!==a&&g.form===a.form){var E=al(g);if(!E)throw Error(t(90));Gt(g),wt(g,E)}}}break;case"textarea":Ar(a,h);break;case"select":l=h.value,l!=null&&Yt(a,!!h.multiple,l,!1)}},_s=jd,go=$s;var BL={usingClientEntryPoint:!1,Events:[Bo,Ti,al,Lr,ir,jd]},Zo={findFiberByHostInstance:Ds,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},UL={bundleType:Zo.bundleType,version:Zo.version,rendererPackageName:Zo.rendererPackageName,rendererConfig:Zo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Jp(a),a===null?null:a.stateNode},findFiberByHostInstance:Zo.findFiberByHostInstance||ML,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Kl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Kl.isDisabled&&Kl.supportsFiber)try{Va=Kl.inject(UL),or=Kl}catch{}}return xn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BL,xn.createPortal=function(a,l){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qd(l))throw Error(t(200));return NL(a,l,null,h)},xn.createRoot=function(a,l){if(!qd(a))throw Error(t(299));var h=!1,g="",E=I0;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(g=l.identifierPrefix),l.onRecoverableError!==void 0&&(E=l.onRecoverableError)),l=zd(a,1,!1,null,null,h,!1,g,E),a[Ir]=l.current,No(a.nodeType===8?a.parentNode:a),new Yd(l)},xn.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(t(188)):(a=Object.keys(a).join(","),Error(t(268,a)));return a=Jp(l),a=a===null?null:a.stateNode,a},xn.flushSync=function(a){return $s(a)},xn.hydrate=function(a,l,h){if(!Gl(l))throw Error(t(200));return Hl(null,a,l,!0,h)},xn.hydrateRoot=function(a,l,h){if(!qd(a))throw Error(t(405));var g=h!=null&&h.hydratedSources||null,E=!1,b="",R=I0;if(h!=null&&(h.unstable_strictMode===!0&&(E=!0),h.identifierPrefix!==void 0&&(b=h.identifierPrefix),h.onRecoverableError!==void 0&&(R=h.onRecoverableError)),l=A0(l,null,a,1,h??null,E,!1,b,R),a[Ir]=l.current,No(a),g)for(a=0;a<g.length;a++)h=g[a],E=h._getVersion,E=E(h._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[h,E]:l.mutableSourceEagerHydrationData.push(h,E);return new Vl(l)},xn.render=function(a,l,h){if(!Gl(l))throw Error(t(200));return Hl(null,a,l,!1,h)},xn.unmountComponentAtNode=function(a){if(!Gl(a))throw Error(t(40));return a._reactRootContainer?($s(function(){Hl(null,null,a,!1,function(){a._reactRootContainer=null,a[Ir]=null})}),!0):!1},xn.unstable_batchedUpdates=jd,xn.unstable_renderSubtreeIntoContainer=function(a,l,h,g){if(!Gl(h))throw Error(t(200));if(a==null||a._reactInternals===void 0)throw Error(t(38));return Hl(a,l,h,!1,g)},xn.version="18.3.1-next-f1338f8080-20240426",xn}var N0;function Mx(){if(N0)return Zd.exports;N0=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Zd.exports=WL(),Zd.exports}var M0;function YL(){if(M0)return zl;M0=1;var r=Mx();return zl.createRoot=r.createRoot,zl.hydrateRoot=r.hydrateRoot,zl}var qL=YL();const XL=li(qL);var zh=Mx();const QL=li(zh);/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function va(){return va=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},va.apply(this,arguments)}var Ts;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(Ts||(Ts={}));const F0="popstate";function ZL(r){r===void 0&&(r={});function e(n,s){let{pathname:i,search:o,hash:u}=n.location;return Xf("",{pathname:i,search:o,hash:u},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(n,s){return typeof s=="string"?s:Cu(s)}return eI(e,t,null,r)}function Lt(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Fx(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function JL(){return Math.random().toString(36).substr(2,8)}function B0(r,e){return{usr:r.state,key:r.key,idx:e}}function Xf(r,e,t,n){return t===void 0&&(t=null),va({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof e=="string"?fo(e):e,{state:t,key:e&&e.key||n||JL()})}function Cu(r){let{pathname:e="/",search:t="",hash:n=""}=r;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function fo(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substr(t),r=r.substr(0,t));let n=r.indexOf("?");n>=0&&(e.search=r.substr(n),r=r.substr(0,n)),r&&(e.pathname=r)}return e}function eI(r,e,t,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:i=!1}=n,o=s.history,u=Ts.Pop,d=null,c=f();c==null&&(c=0,o.replaceState(va({},o.state,{idx:c}),""));function f(){return(o.state||{idx:null}).idx}function p(){u=Ts.Pop;let T=f(),A=T==null?null:T-c;c=T,d&&d({action:u,location:S.location,delta:A})}function m(T,A){u=Ts.Push;let L=Xf(S.location,T,A);c=f()+1;let w=B0(L,c),C=S.createHref(L);try{o.pushState(w,"",C)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;s.location.assign(C)}i&&d&&d({action:u,location:S.location,delta:1})}function y(T,A){u=Ts.Replace;let L=Xf(S.location,T,A);c=f();let w=B0(L,c),C=S.createHref(L);o.replaceState(w,"",C),i&&d&&d({action:u,location:S.location,delta:0})}function v(T){let A=s.location.origin!=="null"?s.location.origin:s.location.href,L=typeof T=="string"?T:Cu(T);return L=L.replace(/ $/,"%20"),Lt(A,"No window.location.(origin|href) available to create URL for href: "+L),new URL(L,A)}let S={get action(){return u},get location(){return r(s,o)},listen(T){if(d)throw new Error("A history only accepts one active listener");return s.addEventListener(F0,p),d=T,()=>{s.removeEventListener(F0,p),d=null}},createHref(T){return e(s,T)},createURL:v,encodeLocation(T){let A=v(T);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:m,replace:y,go(T){return o.go(T)}};return S}var U0;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(U0||(U0={}));function tI(r,e,t){return t===void 0&&(t="/"),nI(r,e,t)}function nI(r,e,t,n){let s=typeof e=="string"?fo(e):e,i=oo(s.pathname||"/",t);if(i==null)return null;let o=Bx(r);rI(o);let u=null;for(let d=0;u==null&&d<o.length;++d){let c=pI(i);u=fI(o[d],c)}return u}function Bx(r,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n="");let s=(i,o,u)=>{let d={relativePath:u===void 0?i.path||"":u,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};d.relativePath.startsWith("/")&&(Lt(d.relativePath.startsWith(n),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(n.length));let c=Ss([n,d.relativePath]),f=t.concat(d);i.children&&i.children.length>0&&(Lt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),Bx(i.children,e,f,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:cI(c,i.index),routesMeta:f})};return r.forEach((i,o)=>{var u;if(i.path===""||!((u=i.path)!=null&&u.includes("?")))s(i,o);else for(let d of Ux(i.path))s(i,o,d)}),e}function Ux(r){let e=r.split("/");if(e.length===0)return[];let[t,...n]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(n.length===0)return s?[i,""]:[i];let o=Ux(n.join("/")),u=[];return u.push(...o.map(d=>d===""?i:[i,d].join("/"))),s&&u.push(...o),u.map(d=>r.startsWith("/")&&d===""?"/":d)}function rI(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:dI(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const sI=/^:[\w-]+$/,iI=3,oI=2,aI=1,lI=10,uI=-2,j0=r=>r==="*";function cI(r,e){let t=r.split("/"),n=t.length;return t.some(j0)&&(n+=uI),e&&(n+=oI),t.filter(s=>!j0(s)).reduce((s,i)=>s+(sI.test(i)?iI:i===""?aI:lI),n)}function dI(r,e){return r.length===e.length&&r.slice(0,-1).every((n,s)=>n===e[s])?r[r.length-1]-e[e.length-1]:0}function fI(r,e,t){let{routesMeta:n}=r,s={},i="/",o=[];for(let u=0;u<n.length;++u){let d=n[u],c=u===n.length-1,f=i==="/"?e:e.slice(i.length)||"/",p=Qf({path:d.relativePath,caseSensitive:d.caseSensitive,end:c},f),m=d.route;if(!p)return null;Object.assign(s,p.params),o.push({params:s,pathname:Ss([i,p.pathname]),pathnameBase:vI(Ss([i,p.pathnameBase])),route:m}),p.pathnameBase!=="/"&&(i=Ss([i,p.pathnameBase]))}return o}function Qf(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,n]=hI(r.path,r.caseSensitive,r.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),u=s.slice(1);return{params:n.reduce((c,f,p)=>{let{paramName:m,isOptional:y}=f;if(m==="*"){let S=u[p]||"";o=i.slice(0,i.length-S.length).replace(/(.)\/+$/,"$1")}const v=u[p];return y&&!v?c[m]=void 0:c[m]=(v||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:r}}function hI(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),Fx(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let n=[],s="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,u,d)=>(n.push({paramName:u,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(n.push({paramName:"*"}),s+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":r!==""&&r!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),n]}function pI(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Fx(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),r}}function oo(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=r.charAt(t);return n&&n!=="/"?null:r.slice(t)||"/"}function mI(r,e){e===void 0&&(e="/");let{pathname:t,search:n="",hash:s=""}=typeof r=="string"?fo(r):r;return{pathname:t?t.startsWith("/")?t:gI(t,e):e,search:xI(n),hash:EI(s)}}function gI(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function tf(r,e,t,n){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function yI(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Wh(r,e){let t=yI(r);return e?t.map((n,s)=>s===t.length-1?n.pathname:n.pathnameBase):t.map(n=>n.pathnameBase)}function Yh(r,e,t,n){n===void 0&&(n=!1);let s;typeof r=="string"?s=fo(r):(s=va({},r),Lt(!s.pathname||!s.pathname.includes("?"),tf("?","pathname","search",s)),Lt(!s.pathname||!s.pathname.includes("#"),tf("#","pathname","hash",s)),Lt(!s.search||!s.search.includes("#"),tf("#","search","hash",s)));let i=r===""||s.pathname==="",o=i?"/":s.pathname,u;if(o==null)u=t;else{let p=e.length-1;if(!n&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),p-=1;s.pathname=m.join("/")}u=p>=0?e[p]:"/"}let d=mI(s,u),c=o&&o!=="/"&&o.endsWith("/"),f=(i||o===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(c||f)&&(d.pathname+="/"),d}const Ss=r=>r.join("/").replace(/\/\/+/g,"/"),vI=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),xI=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,EI=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function TI(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const jx=["post","put","patch","delete"];new Set(jx);const SI=["get",...jx];new Set(SI);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xa(){return xa=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},xa.apply(this,arguments)}const Zu=_.createContext(null),$x=_.createContext(null),Kr=_.createContext(null),Ju=_.createContext(null),zr=_.createContext({outlet:null,matches:[],isDataRoute:!1}),Vx=_.createContext(null);function bI(r,e){let{relative:t}=e===void 0?{}:e;ho()||Lt(!1);let{basename:n,navigator:s}=_.useContext(Kr),{hash:i,pathname:o,search:u}=ec(r,{relative:t}),d=o;return n!=="/"&&(d=o==="/"?n:Ss([n,o])),s.createHref({pathname:d,search:u,hash:i})}function ho(){return _.useContext(Ju)!=null}function Cs(){return ho()||Lt(!1),_.useContext(Ju).location}function Gx(r){_.useContext(Kr).static||_.useLayoutEffect(r)}function zn(){let{isDataRoute:r}=_.useContext(zr);return r?MI():AI()}function AI(){ho()||Lt(!1);let r=_.useContext(Zu),{basename:e,future:t,navigator:n}=_.useContext(Kr),{matches:s}=_.useContext(zr),{pathname:i}=Cs(),o=JSON.stringify(Wh(s,t.v7_relativeSplatPath)),u=_.useRef(!1);return Gx(()=>{u.current=!0}),_.useCallback(function(c,f){if(f===void 0&&(f={}),!u.current)return;if(typeof c=="number"){n.go(c);return}let p=Yh(c,JSON.parse(o),i,f.relative==="path");r==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:Ss([e,p.pathname])),(f.replace?n.replace:n.push)(p,f.state,f)},[e,n,o,i,r])}function qh(){let{matches:r}=_.useContext(zr),e=r[r.length-1];return e?e.params:{}}function ec(r,e){let{relative:t}=e===void 0?{}:e,{future:n}=_.useContext(Kr),{matches:s}=_.useContext(zr),{pathname:i}=Cs(),o=JSON.stringify(Wh(s,n.v7_relativeSplatPath));return _.useMemo(()=>Yh(r,JSON.parse(o),i,t==="path"),[r,o,i,t])}function LI(r,e){return II(r,e)}function II(r,e,t,n){ho()||Lt(!1);let{navigator:s}=_.useContext(Kr),{matches:i}=_.useContext(zr),o=i[i.length-1],u=o?o.params:{};o&&o.pathname;let d=o?o.pathnameBase:"/";o&&o.route;let c=Cs(),f;if(e){var p;let T=typeof e=="string"?fo(e):e;d==="/"||(p=T.pathname)!=null&&p.startsWith(d)||Lt(!1),f=T}else f=c;let m=f.pathname||"/",y=m;if(d!=="/"){let T=d.replace(/^\//,"").split("/");y="/"+m.replace(/^\//,"").split("/").slice(T.length).join("/")}let v=tI(r,{pathname:y}),S=_I(v&&v.map(T=>Object.assign({},T,{params:Object.assign({},u,T.params),pathname:Ss([d,s.encodeLocation?s.encodeLocation(T.pathname).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?d:Ss([d,s.encodeLocation?s.encodeLocation(T.pathnameBase).pathname:T.pathnameBase])})),i,t,n);return e&&S?_.createElement(Ju.Provider,{value:{location:xa({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:Ts.Pop}},S):S}function wI(){let r=NI(),e=TI(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return _.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},e),t?_.createElement("pre",{style:s},t):null,null)}const RI=_.createElement(wI,null);class CI extends _.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?_.createElement(zr.Provider,{value:this.props.routeContext},_.createElement(Vx.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function PI(r){let{routeContext:e,match:t,children:n}=r,s=_.useContext(Zu);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),_.createElement(zr.Provider,{value:e},n)}function _I(r,e,t,n){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),n===void 0&&(n=null),r==null){var i;if(!t)return null;if(t.errors)r=t.matches;else if((i=n)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let o=r,u=(s=t)==null?void 0:s.errors;if(u!=null){let f=o.findIndex(p=>p.route.id&&u?.[p.route.id]!==void 0);f>=0||Lt(!1),o=o.slice(0,Math.min(o.length,f+1))}let d=!1,c=-1;if(t&&n&&n.v7_partialHydration)for(let f=0;f<o.length;f++){let p=o[f];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(c=f),p.route.id){let{loaderData:m,errors:y}=t,v=p.route.loader&&m[p.route.id]===void 0&&(!y||y[p.route.id]===void 0);if(p.route.lazy||v){d=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((f,p,m)=>{let y,v=!1,S=null,T=null;t&&(y=u&&p.route.id?u[p.route.id]:void 0,S=p.route.errorElement||RI,d&&(c<0&&m===0?(FI("route-fallback"),v=!0,T=null):c===m&&(v=!0,T=p.route.hydrateFallbackElement||null)));let A=e.concat(o.slice(0,m+1)),L=()=>{let w;return y?w=S:v?w=T:p.route.Component?w=_.createElement(p.route.Component,null):p.route.element?w=p.route.element:w=f,_.createElement(PI,{match:p,routeContext:{outlet:f,matches:A,isDataRoute:t!=null},children:w})};return t&&(p.route.ErrorBoundary||p.route.errorElement||m===0)?_.createElement(CI,{location:t.location,revalidation:t.revalidation,component:S,error:y,children:L(),routeContext:{outlet:null,matches:A,isDataRoute:!0}}):L()},null)}var Hx=(function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r})(Hx||{}),Kx=(function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r})(Kx||{});function kI(r){let e=_.useContext(Zu);return e||Lt(!1),e}function DI(r){let e=_.useContext($x);return e||Lt(!1),e}function OI(r){let e=_.useContext(zr);return e||Lt(!1),e}function zx(r){let e=OI(),t=e.matches[e.matches.length-1];return t.route.id||Lt(!1),t.route.id}function NI(){var r;let e=_.useContext(Vx),t=DI(),n=zx();return e!==void 0?e:(r=t.errors)==null?void 0:r[n]}function MI(){let{router:r}=kI(Hx.UseNavigateStable),e=zx(Kx.UseNavigateStable),t=_.useRef(!1);return Gx(()=>{t.current=!0}),_.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?r.navigate(s):r.navigate(s,xa({fromRouteId:e},i)))},[r,e])}const $0={};function FI(r,e,t){$0[r]||($0[r]=!0)}function BI(r,e){r?.v7_startTransition,r?.v7_relativeSplatPath}function UI(r){let{to:e,replace:t,state:n,relative:s}=r;ho()||Lt(!1);let{future:i,static:o}=_.useContext(Kr),{matches:u}=_.useContext(zr),{pathname:d}=Cs(),c=zn(),f=Yh(e,Wh(u,i.v7_relativeSplatPath),d,s==="path"),p=JSON.stringify(f);return _.useEffect(()=>c(JSON.parse(p),{replace:t,state:n,relative:s}),[c,p,s,t,n]),null}function Tn(r){Lt(!1)}function jI(r){let{basename:e="/",children:t=null,location:n,navigationType:s=Ts.Pop,navigator:i,static:o=!1,future:u}=r;ho()&&Lt(!1);let d=e.replace(/^\/*/,"/"),c=_.useMemo(()=>({basename:d,navigator:i,static:o,future:xa({v7_relativeSplatPath:!1},u)}),[d,u,i,o]);typeof n=="string"&&(n=fo(n));let{pathname:f="/",search:p="",hash:m="",state:y=null,key:v="default"}=n,S=_.useMemo(()=>{let T=oo(f,d);return T==null?null:{location:{pathname:T,search:p,hash:m,state:y,key:v},navigationType:s}},[d,f,p,m,y,v,s]);return S==null?null:_.createElement(Kr.Provider,{value:c},_.createElement(Ju.Provider,{children:t,value:S}))}function $I(r){let{children:e,location:t}=r;return LI(Zf(e),t)}new Promise(()=>{});function Zf(r,e){e===void 0&&(e=[]);let t=[];return _.Children.forEach(r,(n,s)=>{if(!_.isValidElement(n))return;let i=[...e,s];if(n.type===_.Fragment){t.push.apply(t,Zf(n.props.children,i));return}n.type!==Tn&&Lt(!1),!n.props.index||!n.props.children||Lt(!1);let o={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=Zf(n.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Pu(){return Pu=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Pu.apply(this,arguments)}function Wx(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,i;for(i=0;i<n.length;i++)s=n[i],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function VI(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function GI(r,e){return r.button===0&&(!e||e==="_self")&&!VI(r)}function Jf(r){return r===void 0&&(r=""),new URLSearchParams(typeof r=="string"||Array.isArray(r)||r instanceof URLSearchParams?r:Object.keys(r).reduce((e,t)=>{let n=r[t];return e.concat(Array.isArray(n)?n.map(s=>[t,s]):[[t,n]])},[]))}function HI(r,e){let t=Jf(r);return e&&e.forEach((n,s)=>{t.has(s)||e.getAll(s).forEach(i=>{t.append(s,i)})}),t}const KI=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],zI=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],WI="6";try{window.__reactRouterVersion=WI}catch{}const YI=_.createContext({isTransitioning:!1}),qI="startTransition",V0=Nx[qI];function XI(r){let{basename:e,children:t,future:n,window:s}=r,i=_.useRef();i.current==null&&(i.current=ZL({window:s,v5Compat:!0}));let o=i.current,[u,d]=_.useState({action:o.action,location:o.location}),{v7_startTransition:c}=n||{},f=_.useCallback(p=>{c&&V0?V0(()=>d(p)):d(p)},[d,c]);return _.useLayoutEffect(()=>o.listen(f),[o,f]),_.useEffect(()=>BI(n),[n]),_.createElement(jI,{basename:e,children:t,location:u.location,navigationType:u.action,navigator:o,future:n})}const QI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ZI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ct=_.forwardRef(function(e,t){let{onClick:n,relative:s,reloadDocument:i,replace:o,state:u,target:d,to:c,preventScrollReset:f,viewTransition:p}=e,m=Wx(e,KI),{basename:y}=_.useContext(Kr),v,S=!1;if(typeof c=="string"&&ZI.test(c)&&(v=c,QI))try{let w=new URL(window.location.href),C=c.startsWith("//")?new URL(w.protocol+c):new URL(c),P=oo(C.pathname,y);C.origin===w.origin&&P!=null?c=P+C.search+C.hash:S=!0}catch{}let T=bI(c,{relative:s}),A=ew(c,{replace:o,state:u,target:d,preventScrollReset:f,relative:s,viewTransition:p});function L(w){n&&n(w),w.defaultPrevented||A(w)}return _.createElement("a",Pu({},m,{href:v||T,onClick:S||i?n:L,ref:t,target:d}))}),fs=_.forwardRef(function(e,t){let{"aria-current":n="page",caseSensitive:s=!1,className:i="",end:o=!1,style:u,to:d,viewTransition:c,children:f}=e,p=Wx(e,zI),m=ec(d,{relative:p.relative}),y=Cs(),v=_.useContext($x),{navigator:S,basename:T}=_.useContext(Kr),A=v!=null&&tw(m)&&c===!0,L=S.encodeLocation?S.encodeLocation(m).pathname:m.pathname,w=y.pathname,C=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;s||(w=w.toLowerCase(),C=C?C.toLowerCase():null,L=L.toLowerCase()),C&&T&&(C=oo(C,T)||C);const P=L!=="/"&&L.endsWith("/")?L.length-1:L.length;let B=w===L||!o&&w.startsWith(L)&&w.charAt(P)==="/",D=C!=null&&(C===L||!o&&C.startsWith(L)&&C.charAt(L.length)==="/"),N={isActive:B,isPending:D,isTransitioning:A},F=B?n:void 0,O;typeof i=="function"?O=i(N):O=[i,B?"active":null,D?"pending":null,A?"transitioning":null].filter(Boolean).join(" ");let V=typeof u=="function"?u(N):u;return _.createElement(ct,Pu({},p,{"aria-current":F,className:O,ref:t,style:V,to:d,viewTransition:c}),typeof f=="function"?f(N):f)});var eh;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(eh||(eh={}));var G0;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(G0||(G0={}));function JI(r){let e=_.useContext(Zu);return e||Lt(!1),e}function ew(r,e){let{target:t,replace:n,state:s,preventScrollReset:i,relative:o,viewTransition:u}=e===void 0?{}:e,d=zn(),c=Cs(),f=ec(r,{relative:o});return _.useCallback(p=>{if(GI(p,t)){p.preventDefault();let m=n!==void 0?n:Cu(c)===Cu(f);d(r,{replace:m,state:s,preventScrollReset:i,relative:o,viewTransition:u})}},[c,d,f,n,s,t,r,i,o,u])}function Yx(r){let e=_.useRef(Jf(r)),t=_.useRef(!1),n=Cs(),s=_.useMemo(()=>HI(n.search,t.current?null:e.current),[n.search]),i=zn(),o=_.useCallback((u,d)=>{const c=Jf(typeof u=="function"?u(s):u);t.current=!0,i("?"+c,d)},[i,s]);return[s,o]}function tw(r,e){e===void 0&&(e={});let t=_.useContext(YI);t==null&&Lt(!1);let{basename:n}=JI(eh.useViewTransitionState),s=ec(r,{relative:e.relative});if(!t.isTransitioning)return!1;let i=oo(t.currentLocation.pathname,n)||t.currentLocation.pathname,o=oo(t.nextLocation.pathname,n)||t.nextLocation.pathname;return Qf(s.pathname,o)!=null||Qf(s.pathname,i)!=null}const qx=_.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"}),tc=_.createContext({}),nc=_.createContext(null),rc=typeof document<"u",Xh=rc?_.useLayoutEffect:_.useEffect,Xx=_.createContext({strict:!1}),Qh=r=>r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),nw="framerAppearId",Qx="data-"+Qh(nw);function rw(r,e,t,n){const{visualElement:s}=_.useContext(tc),i=_.useContext(Xx),o=_.useContext(nc),u=_.useContext(qx).reducedMotion,d=_.useRef();n=n||i.renderer,!d.current&&n&&(d.current=n(r,{visualState:e,parent:s,props:t,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:u}));const c=d.current;_.useInsertionEffect(()=>{c&&c.update(t,o)});const f=_.useRef(!!(t[Qx]&&!window.HandoffComplete));return Xh(()=>{c&&(c.render(),f.current&&c.animationState&&c.animationState.animateChanges())}),_.useEffect(()=>{c&&(c.updateFeatures(),!f.current&&c.animationState&&c.animationState.animateChanges(),f.current&&(f.current=!1,window.HandoffComplete=!0))}),c}function Gi(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function sw(r,e,t){return _.useCallback(n=>{n&&r.mount&&r.mount(n),e&&(n?e.mount(n):e.unmount()),t&&(typeof t=="function"?t(n):Gi(t)&&(t.current=n))},[e])}function Ea(r){return typeof r=="string"||Array.isArray(r)}function sc(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}const Zh=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Jh=["initial",...Zh];function ic(r){return sc(r.animate)||Jh.some(e=>Ea(r[e]))}function Zx(r){return!!(ic(r)||r.variants)}function iw(r,e){if(ic(r)){const{initial:t,animate:n}=r;return{initial:t===!1||Ea(t)?t:void 0,animate:Ea(n)?n:void 0}}return r.inherit!==!1?e:{}}function ow(r){const{initial:e,animate:t}=iw(r,_.useContext(tc));return _.useMemo(()=>({initial:e,animate:t}),[H0(e),H0(t)])}function H0(r){return Array.isArray(r)?r.join(" "):r}const K0={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Ta={};for(const r in K0)Ta[r]={isEnabled:e=>K0[r].some(t=>!!e[t])};function aw(r){for(const e in r)Ta[e]={...Ta[e],...r[e]}}const ep=_.createContext({}),Jx=_.createContext({}),lw=Symbol.for("motionComponentSymbol");function uw({preloadedFeatures:r,createVisualElement:e,useRender:t,useVisualState:n,Component:s}){r&&aw(r);function i(u,d){let c;const f={..._.useContext(qx),...u,layoutId:cw(u)},{isStatic:p}=f,m=ow(u),y=n(u,p);if(!p&&rc){m.visualElement=rw(s,y,f,e);const v=_.useContext(Jx),S=_.useContext(Xx).strict;m.visualElement&&(c=m.visualElement.loadFeatures(f,S,r,v))}return _.createElement(tc.Provider,{value:m},c&&m.visualElement?_.createElement(c,{visualElement:m.visualElement,...f}):null,t(s,u,sw(y,m.visualElement,d),y,p,m.visualElement))}const o=_.forwardRef(i);return o[lw]=s,o}function cw({layoutId:r}){const e=_.useContext(ep).id;return e&&r!==void 0?e+"-"+r:r}function dw(r){function e(n,s={}){return uw(r(n,s))}if(typeof Proxy>"u")return e;const t=new Map;return new Proxy(e,{get:(n,s)=>(t.has(s)||t.set(s,e(s)),t.get(s))})}const fw=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function tp(r){return typeof r!="string"||r.includes("-")?!1:!!(fw.indexOf(r)>-1||/[A-Z]/.test(r))}const _u={};function hw(r){Object.assign(_u,r)}const Oa=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ui=new Set(Oa);function eE(r,{layout:e,layoutId:t}){return ui.has(r)||r.startsWith("origin")||(e||t!==void 0)&&(!!_u[r]||r==="opacity")}const An=r=>!!(r&&r.getVelocity),pw={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},mw=Oa.length;function gw(r,{enableHardwareAcceleration:e=!0,allowTransformNone:t=!0},n,s){let i="";for(let o=0;o<mw;o++){const u=Oa[o];if(r[u]!==void 0){const d=pw[u]||u;i+=`${d}(${r[u]}) `}}return e&&!r.z&&(i+="translateZ(0)"),i=i.trim(),s?i=s(r,n?"":i):t&&n&&(i="none"),i}const tE=r=>e=>typeof e=="string"&&e.startsWith(r),nE=tE("--"),th=tE("var(--"),yw=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,vw=(r,e)=>e&&typeof r=="number"?e.transform(r):r,Ls=(r,e,t)=>Math.min(Math.max(t,r),e),ci={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},ua={...ci,transform:r=>Ls(0,1,r)},Wl={...ci,default:1},ca=r=>Math.round(r*1e5)/1e5,oc=/(-)?([\d]*\.?[\d])+/g,rE=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,xw=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function Na(r){return typeof r=="string"}const Ma=r=>({test:e=>Na(e)&&e.endsWith(r)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${r}`}),gs=Ma("deg"),vr=Ma("%"),De=Ma("px"),Ew=Ma("vh"),Tw=Ma("vw"),z0={...vr,parse:r=>vr.parse(r)/100,transform:r=>vr.transform(r*100)},W0={...ci,transform:Math.round},sE={borderWidth:De,borderTopWidth:De,borderRightWidth:De,borderBottomWidth:De,borderLeftWidth:De,borderRadius:De,radius:De,borderTopLeftRadius:De,borderTopRightRadius:De,borderBottomRightRadius:De,borderBottomLeftRadius:De,width:De,maxWidth:De,height:De,maxHeight:De,size:De,top:De,right:De,bottom:De,left:De,padding:De,paddingTop:De,paddingRight:De,paddingBottom:De,paddingLeft:De,margin:De,marginTop:De,marginRight:De,marginBottom:De,marginLeft:De,rotate:gs,rotateX:gs,rotateY:gs,rotateZ:gs,scale:Wl,scaleX:Wl,scaleY:Wl,scaleZ:Wl,skew:gs,skewX:gs,skewY:gs,distance:De,translateX:De,translateY:De,translateZ:De,x:De,y:De,z:De,perspective:De,transformPerspective:De,opacity:ua,originX:z0,originY:z0,originZ:De,zIndex:W0,fillOpacity:ua,strokeOpacity:ua,numOctaves:W0};function np(r,e,t,n){const{style:s,vars:i,transform:o,transformOrigin:u}=r;let d=!1,c=!1,f=!0;for(const p in e){const m=e[p];if(nE(p)){i[p]=m;continue}const y=sE[p],v=vw(m,y);if(ui.has(p)){if(d=!0,o[p]=v,!f)continue;m!==(y.default||0)&&(f=!1)}else p.startsWith("origin")?(c=!0,u[p]=v):s[p]=v}if(e.transform||(d||n?s.transform=gw(r.transform,t,f,n):s.transform&&(s.transform="none")),c){const{originX:p="50%",originY:m="50%",originZ:y=0}=u;s.transformOrigin=`${p} ${m} ${y}`}}const rp=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function iE(r,e,t){for(const n in e)!An(e[n])&&!eE(n,t)&&(r[n]=e[n])}function Sw({transformTemplate:r},e,t){return _.useMemo(()=>{const n=rp();return np(n,e,{enableHardwareAcceleration:!t},r),Object.assign({},n.vars,n.style)},[e])}function bw(r,e,t){const n=r.style||{},s={};return iE(s,n,r),Object.assign(s,Sw(r,e,t)),r.transformValues?r.transformValues(s):s}function Aw(r,e,t){const n={},s=bw(r,e,t);return r.drag&&r.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(n.tabIndex=0),n.style=s,n}const Lw=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ku(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||Lw.has(r)}let oE=r=>!ku(r);function Iw(r){r&&(oE=e=>e.startsWith("on")?!ku(e):r(e))}try{Iw(require("@emotion/is-prop-valid").default)}catch{}function ww(r,e,t){const n={};for(const s in r)s==="values"&&typeof r.values=="object"||(oE(s)||t===!0&&ku(s)||!e&&!ku(s)||r.draggable&&s.startsWith("onDrag"))&&(n[s]=r[s]);return n}function Y0(r,e,t){return typeof r=="string"?r:De.transform(e+t*r)}function Rw(r,e,t){const n=Y0(e,r.x,r.width),s=Y0(t,r.y,r.height);return`${n} ${s}`}const Cw={offset:"stroke-dashoffset",array:"stroke-dasharray"},Pw={offset:"strokeDashoffset",array:"strokeDasharray"};function _w(r,e,t=1,n=0,s=!0){r.pathLength=1;const i=s?Cw:Pw;r[i.offset]=De.transform(-n);const o=De.transform(e),u=De.transform(t);r[i.array]=`${o} ${u}`}function sp(r,{attrX:e,attrY:t,attrScale:n,originX:s,originY:i,pathLength:o,pathSpacing:u=1,pathOffset:d=0,...c},f,p,m){if(np(r,c,f,m),p){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:y,style:v,dimensions:S}=r;y.transform&&(S&&(v.transform=y.transform),delete y.transform),S&&(s!==void 0||i!==void 0||v.transform)&&(v.transformOrigin=Rw(S,s!==void 0?s:.5,i!==void 0?i:.5)),e!==void 0&&(y.x=e),t!==void 0&&(y.y=t),n!==void 0&&(y.scale=n),o!==void 0&&_w(y,o,u,d,!1)}const aE=()=>({...rp(),attrs:{}}),ip=r=>typeof r=="string"&&r.toLowerCase()==="svg";function kw(r,e,t,n){const s=_.useMemo(()=>{const i=aE();return sp(i,e,{enableHardwareAcceleration:!1},ip(n),r.transformTemplate),{...i.attrs,style:{...i.style}}},[e]);if(r.style){const i={};iE(i,r.style,r),s.style={...i,...s.style}}return s}function Dw(r=!1){return(t,n,s,{latestValues:i},o)=>{const d=(tp(t)?kw:Aw)(n,i,o,t),f={...ww(n,typeof t=="string",r),...d,ref:s},{children:p}=n,m=_.useMemo(()=>An(p)?p.get():p,[p]);return _.createElement(t,{...f,children:m})}}function lE(r,{style:e,vars:t},n,s){Object.assign(r.style,e,s&&s.getProjectionStyles(n));for(const i in t)r.style.setProperty(i,t[i])}const uE=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function cE(r,e,t,n){lE(r,e,void 0,n);for(const s in e.attrs)r.setAttribute(uE.has(s)?s:Qh(s),e.attrs[s])}function op(r,e){const{style:t}=r,n={};for(const s in t)(An(t[s])||e.style&&An(e.style[s])||eE(s,r))&&(n[s]=t[s]);return n}function dE(r,e){const t=op(r,e);for(const n in r)if(An(r[n])||An(e[n])){const s=Oa.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;t[s]=r[n]}return t}function ap(r,e,t,n={},s={}){return typeof e=="function"&&(e=e(t!==void 0?t:r.custom,n,s)),typeof e=="string"&&(e=r.variants&&r.variants[e]),typeof e=="function"&&(e=e(t!==void 0?t:r.custom,n,s)),e}function fE(r){const e=_.useRef(null);return e.current===null&&(e.current=r()),e.current}const Du=r=>Array.isArray(r),Ow=r=>!!(r&&typeof r=="object"&&r.mix&&r.toValue),Nw=r=>Du(r)?r[r.length-1]||0:r;function yu(r){const e=An(r)?r.get():r;return Ow(e)?e.toValue():e}function Mw({scrapeMotionValuesFromProps:r,createRenderState:e,onMount:t},n,s,i){const o={latestValues:Fw(n,s,i,r),renderState:e()};return t&&(o.mount=u=>t(n,u,o)),o}const hE=r=>(e,t)=>{const n=_.useContext(tc),s=_.useContext(nc),i=()=>Mw(r,e,n,s);return t?i():fE(i)};function Fw(r,e,t,n){const s={},i=n(r,{});for(const m in i)s[m]=yu(i[m]);let{initial:o,animate:u}=r;const d=ic(r),c=Zx(r);e&&c&&!d&&r.inherit!==!1&&(o===void 0&&(o=e.initial),u===void 0&&(u=e.animate));let f=t?t.initial===!1:!1;f=f||o===!1;const p=f?u:o;return p&&typeof p!="boolean"&&!sc(p)&&(Array.isArray(p)?p:[p]).forEach(y=>{const v=ap(r,y);if(!v)return;const{transitionEnd:S,transition:T,...A}=v;for(const L in A){let w=A[L];if(Array.isArray(w)){const C=f?w.length-1:0;w=w[C]}w!==null&&(s[L]=w)}for(const L in S)s[L]=S[L]}),s}const kt=r=>r;class q0{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);t!==-1&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function Bw(r){let e=new q0,t=new q0,n=0,s=!1,i=!1;const o=new WeakSet,u={schedule:(d,c=!1,f=!1)=>{const p=f&&s,m=p?e:t;return c&&o.add(d),m.add(d)&&p&&s&&(n=e.order.length),d},cancel:d=>{t.remove(d),o.delete(d)},process:d=>{if(s){i=!0;return}if(s=!0,[e,t]=[t,e],t.clear(),n=e.order.length,n)for(let c=0;c<n;c++){const f=e.order[c];f(d),o.has(f)&&(u.schedule(f),r())}s=!1,i&&(i=!1,u.process(d))}};return u}const Yl=["prepare","read","update","preRender","render","postRender"],Uw=40;function jw(r,e){let t=!1,n=!0;const s={delta:0,timestamp:0,isProcessing:!1},i=Yl.reduce((p,m)=>(p[m]=Bw(()=>t=!0),p),{}),o=p=>i[p].process(s),u=()=>{const p=performance.now();t=!1,s.delta=n?1e3/60:Math.max(Math.min(p-s.timestamp,Uw),1),s.timestamp=p,s.isProcessing=!0,Yl.forEach(o),s.isProcessing=!1,t&&e&&(n=!1,r(u))},d=()=>{t=!0,n=!0,s.isProcessing||r(u)};return{schedule:Yl.reduce((p,m)=>{const y=i[m];return p[m]=(v,S=!1,T=!1)=>(t||d(),y.schedule(v,S,T)),p},{}),cancel:p=>Yl.forEach(m=>i[m].cancel(p)),state:s,steps:i}}const{schedule:dt,cancel:Hr,state:sn,steps:nf}=jw(typeof requestAnimationFrame<"u"?requestAnimationFrame:kt,!0),$w={useVisualState:hE({scrapeMotionValuesFromProps:dE,createRenderState:aE,onMount:(r,e,{renderState:t,latestValues:n})=>{dt.read(()=>{try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}),dt.render(()=>{sp(t,n,{enableHardwareAcceleration:!1},ip(e.tagName),r.transformTemplate),cE(e,t)})}})},Vw={useVisualState:hE({scrapeMotionValuesFromProps:op,createRenderState:rp})};function Gw(r,{forwardMotionProps:e=!1},t,n){return{...tp(r)?$w:Vw,preloadedFeatures:t,useRender:Dw(e),createVisualElement:n,Component:r}}function jr(r,e,t,n={passive:!0}){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t)}const pE=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1;function ac(r,e="page"){return{point:{x:r[e+"X"],y:r[e+"Y"]}}}const Hw=r=>e=>pE(e)&&r(e,ac(e));function Vr(r,e,t,n){return jr(r,e,Hw(t),n)}const Kw=(r,e)=>t=>e(r(t)),bs=(...r)=>r.reduce(Kw);function mE(r){let e=null;return()=>{const t=()=>{e=null};return e===null?(e=r,t):!1}}const X0=mE("dragHorizontal"),Q0=mE("dragVertical");function gE(r){let e=!1;if(r==="y")e=Q0();else if(r==="x")e=X0();else{const t=X0(),n=Q0();t&&n?e=()=>{t(),n()}:(t&&t(),n&&n())}return e}function yE(){const r=gE(!0);return r?(r(),!1):!0}class Ps{constructor(e){this.isMounted=!1,this.node=e}update(){}}function Z0(r,e){const t="pointer"+(e?"enter":"leave"),n="onHover"+(e?"Start":"End"),s=(i,o)=>{if(i.pointerType==="touch"||yE())return;const u=r.getProps();r.animationState&&u.whileHover&&r.animationState.setActive("whileHover",e),u[n]&&dt.update(()=>u[n](i,o))};return Vr(r.current,t,s,{passive:!r.getProps()[n]})}class zw extends Ps{mount(){this.unmount=bs(Z0(this.node,!0),Z0(this.node,!1))}unmount(){}}class Ww extends Ps{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=bs(jr(this.node.current,"focus",()=>this.onFocus()),jr(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const vE=(r,e)=>e?r===e?!0:vE(r,e.parentElement):!1;function rf(r,e){if(!e)return;const t=new PointerEvent("pointer"+r);e(t,ac(t))}class Yw extends Ps{constructor(){super(...arguments),this.removeStartListeners=kt,this.removeEndListeners=kt,this.removeAccessibleListeners=kt,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),i=Vr(window,"pointerup",(u,d)=>{if(!this.checkPressEnd())return;const{onTap:c,onTapCancel:f,globalTapTarget:p}=this.node.getProps();dt.update(()=>{!p&&!vE(this.node.current,u.target)?f&&f(u,d):c&&c(u,d)})},{passive:!(n.onTap||n.onPointerUp)}),o=Vr(window,"pointercancel",(u,d)=>this.cancelPress(u,d),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=bs(i,o),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=i=>{if(i.key!=="Enter"||this.isPressing)return;const o=u=>{u.key!=="Enter"||!this.checkPressEnd()||rf("up",(d,c)=>{const{onTap:f}=this.node.getProps();f&&dt.update(()=>f(d,c))})};this.removeEndListeners(),this.removeEndListeners=jr(this.node.current,"keyup",o),rf("down",(u,d)=>{this.startPress(u,d)})},t=jr(this.node.current,"keydown",e),n=()=>{this.isPressing&&rf("cancel",(i,o)=>this.cancelPress(i,o))},s=jr(this.node.current,"blur",n);this.removeAccessibleListeners=bs(t,s)}}startPress(e,t){this.isPressing=!0;const{onTapStart:n,whileTap:s}=this.node.getProps();s&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&dt.update(()=>n(e,t))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!yE()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&dt.update(()=>n(e,t))}mount(){const e=this.node.getProps(),t=Vr(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),n=jr(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=bs(t,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const nh=new WeakMap,sf=new WeakMap,qw=r=>{const e=nh.get(r.target);e&&e(r)},Xw=r=>{r.forEach(qw)};function Qw({root:r,...e}){const t=r||document;sf.has(t)||sf.set(t,{});const n=sf.get(t),s=JSON.stringify(e);return n[s]||(n[s]=new IntersectionObserver(Xw,{root:r,...e})),n[s]}function Zw(r,e,t){const n=Qw(e);return nh.set(r,t),n.observe(r),()=>{nh.delete(r),n.unobserve(r)}}const Jw={some:0,all:1};class eR extends Ps{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:s="some",once:i}=e,o={root:t?t.current:void 0,rootMargin:n,threshold:typeof s=="number"?s:Jw[s]},u=d=>{const{isIntersecting:c}=d;if(this.isInView===c||(this.isInView=c,i&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:f,onViewportLeave:p}=this.node.getProps(),m=c?f:p;m&&m(d)};return Zw(this.node.current,o,u)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(tR(e,t))&&this.startObserver()}unmount(){}}function tR({viewport:r={}},{viewport:e={}}={}){return t=>r[t]!==e[t]}const nR={inView:{Feature:eR},tap:{Feature:Yw},focus:{Feature:Ww},hover:{Feature:zw}};function xE(r,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==r.length)return!1;for(let n=0;n<t;n++)if(e[n]!==r[n])return!1;return!0}function rR(r){const e={};return r.values.forEach((t,n)=>e[n]=t.get()),e}function sR(r){const e={};return r.values.forEach((t,n)=>e[n]=t.getVelocity()),e}function lc(r,e,t){const n=r.getProps();return ap(n,e,t!==void 0?t:n.custom,rR(r),sR(r))}let lp=kt;const ti=r=>r*1e3,Gr=r=>r/1e3,iR={current:!1},EE=r=>Array.isArray(r)&&typeof r[0]=="number";function TE(r){return!!(!r||typeof r=="string"&&SE[r]||EE(r)||Array.isArray(r)&&r.every(TE))}const aa=([r,e,t,n])=>`cubic-bezier(${r}, ${e}, ${t}, ${n})`,SE={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:aa([0,.65,.55,1]),circOut:aa([.55,0,1,.45]),backIn:aa([.31,.01,.66,-.59]),backOut:aa([.33,1.53,.69,.99])};function bE(r){if(r)return EE(r)?aa(r):Array.isArray(r)?r.map(bE):SE[r]}function oR(r,e,t,{delay:n=0,duration:s,repeat:i=0,repeatType:o="loop",ease:u,times:d}={}){const c={[e]:t};d&&(c.offset=d);const f=bE(u);return Array.isArray(f)&&(c.easing=f),r.animate(c,{delay:n,duration:s,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"})}function aR(r,{repeat:e,repeatType:t="loop"}){const n=e&&t!=="loop"&&e%2===1?0:r.length-1;return r[n]}const AE=(r,e,t)=>(((1-3*t+3*e)*r+(3*t-6*e))*r+3*e)*r,lR=1e-7,uR=12;function cR(r,e,t,n,s){let i,o,u=0;do o=e+(t-e)/2,i=AE(o,n,s)-r,i>0?t=o:e=o;while(Math.abs(i)>lR&&++u<uR);return o}function Fa(r,e,t,n){if(r===e&&t===n)return kt;const s=i=>cR(i,0,1,r,t);return i=>i===0||i===1?i:AE(s(i),e,n)}const dR=Fa(.42,0,1,1),fR=Fa(0,0,.58,1),LE=Fa(.42,0,.58,1),hR=r=>Array.isArray(r)&&typeof r[0]!="number",IE=r=>e=>e<=.5?r(2*e)/2:(2-r(2*(1-e)))/2,wE=r=>e=>1-r(1-e),up=r=>1-Math.sin(Math.acos(r)),RE=wE(up),pR=IE(up),CE=Fa(.33,1.53,.69,.99),cp=wE(CE),mR=IE(cp),gR=r=>(r*=2)<1?.5*cp(r):.5*(2-Math.pow(2,-10*(r-1))),yR={linear:kt,easeIn:dR,easeInOut:LE,easeOut:fR,circIn:up,circInOut:pR,circOut:RE,backIn:cp,backInOut:mR,backOut:CE,anticipate:gR},J0=r=>{if(Array.isArray(r)){lp(r.length===4);const[e,t,n,s]=r;return Fa(e,t,n,s)}else if(typeof r=="string")return yR[r];return r},dp=(r,e)=>t=>!!(Na(t)&&xw.test(t)&&t.startsWith(r)||e&&Object.prototype.hasOwnProperty.call(t,e)),PE=(r,e,t)=>n=>{if(!Na(n))return n;const[s,i,o,u]=n.match(oc);return{[r]:parseFloat(s),[e]:parseFloat(i),[t]:parseFloat(o),alpha:u!==void 0?parseFloat(u):1}},vR=r=>Ls(0,255,r),of={...ci,transform:r=>Math.round(vR(r))},Js={test:dp("rgb","red"),parse:PE("red","green","blue"),transform:({red:r,green:e,blue:t,alpha:n=1})=>"rgba("+of.transform(r)+", "+of.transform(e)+", "+of.transform(t)+", "+ca(ua.transform(n))+")"};function xR(r){let e="",t="",n="",s="";return r.length>5?(e=r.substring(1,3),t=r.substring(3,5),n=r.substring(5,7),s=r.substring(7,9)):(e=r.substring(1,2),t=r.substring(2,3),n=r.substring(3,4),s=r.substring(4,5),e+=e,t+=t,n+=n,s+=s),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:s?parseInt(s,16)/255:1}}const rh={test:dp("#"),parse:xR,transform:Js.transform},Hi={test:dp("hsl","hue"),parse:PE("hue","saturation","lightness"),transform:({hue:r,saturation:e,lightness:t,alpha:n=1})=>"hsla("+Math.round(r)+", "+vr.transform(ca(e))+", "+vr.transform(ca(t))+", "+ca(ua.transform(n))+")"},cn={test:r=>Js.test(r)||rh.test(r)||Hi.test(r),parse:r=>Js.test(r)?Js.parse(r):Hi.test(r)?Hi.parse(r):rh.parse(r),transform:r=>Na(r)?r:r.hasOwnProperty("red")?Js.transform(r):Hi.transform(r)},At=(r,e,t)=>-t*r+t*e+r;function af(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*(2/3-t)*6:r}function ER({hue:r,saturation:e,lightness:t,alpha:n}){r/=360,e/=100,t/=100;let s=0,i=0,o=0;if(!e)s=i=o=t;else{const u=t<.5?t*(1+e):t+e-t*e,d=2*t-u;s=af(d,u,r+1/3),i=af(d,u,r),o=af(d,u,r-1/3)}return{red:Math.round(s*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:n}}const lf=(r,e,t)=>{const n=r*r;return Math.sqrt(Math.max(0,t*(e*e-n)+n))},TR=[rh,Js,Hi],SR=r=>TR.find(e=>e.test(r));function ey(r){const e=SR(r);let t=e.parse(r);return e===Hi&&(t=ER(t)),t}const _E=(r,e)=>{const t=ey(r),n=ey(e),s={...t};return i=>(s.red=lf(t.red,n.red,i),s.green=lf(t.green,n.green,i),s.blue=lf(t.blue,n.blue,i),s.alpha=At(t.alpha,n.alpha,i),Js.transform(s))};function bR(r){var e,t;return isNaN(r)&&Na(r)&&(((e=r.match(oc))===null||e===void 0?void 0:e.length)||0)+(((t=r.match(rE))===null||t===void 0?void 0:t.length)||0)>0}const kE={regex:yw,countKey:"Vars",token:"${v}",parse:kt},DE={regex:rE,countKey:"Colors",token:"${c}",parse:cn.parse},OE={regex:oc,countKey:"Numbers",token:"${n}",parse:ci.parse};function uf(r,{regex:e,countKey:t,token:n,parse:s}){const i=r.tokenised.match(e);i&&(r["num"+t]=i.length,r.tokenised=r.tokenised.replace(e,n),r.values.push(...i.map(s)))}function Ou(r){const e=r.toString(),t={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return t.value.includes("var(--")&&uf(t,kE),uf(t,DE),uf(t,OE),t}function NE(r){return Ou(r).values}function ME(r){const{values:e,numColors:t,numVars:n,tokenised:s}=Ou(r),i=e.length;return o=>{let u=s;for(let d=0;d<i;d++)d<n?u=u.replace(kE.token,o[d]):d<n+t?u=u.replace(DE.token,cn.transform(o[d])):u=u.replace(OE.token,ca(o[d]));return u}}const AR=r=>typeof r=="number"?0:r;function LR(r){const e=NE(r);return ME(r)(e.map(AR))}const Is={test:bR,parse:NE,createTransformer:ME,getAnimatableNone:LR},FE=(r,e)=>t=>`${t>0?e:r}`;function BE(r,e){return typeof r=="number"?t=>At(r,e,t):cn.test(r)?_E(r,e):r.startsWith("var(")?FE(r,e):jE(r,e)}const UE=(r,e)=>{const t=[...r],n=t.length,s=r.map((i,o)=>BE(i,e[o]));return i=>{for(let o=0;o<n;o++)t[o]=s[o](i);return t}},IR=(r,e)=>{const t={...r,...e},n={};for(const s in t)r[s]!==void 0&&e[s]!==void 0&&(n[s]=BE(r[s],e[s]));return s=>{for(const i in n)t[i]=n[i](s);return t}},jE=(r,e)=>{const t=Is.createTransformer(e),n=Ou(r),s=Ou(e);return n.numVars===s.numVars&&n.numColors===s.numColors&&n.numNumbers>=s.numNumbers?bs(UE(n.values,s.values),t):FE(r,e)},Sa=(r,e,t)=>{const n=e-r;return n===0?1:(t-r)/n},ty=(r,e)=>t=>At(r,e,t);function wR(r){return typeof r=="number"?ty:typeof r=="string"?cn.test(r)?_E:jE:Array.isArray(r)?UE:typeof r=="object"?IR:ty}function RR(r,e,t){const n=[],s=t||wR(r[0]),i=r.length-1;for(let o=0;o<i;o++){let u=s(r[o],r[o+1]);if(e){const d=Array.isArray(e)?e[o]||kt:e;u=bs(d,u)}n.push(u)}return n}function $E(r,e,{clamp:t=!0,ease:n,mixer:s}={}){const i=r.length;if(lp(i===e.length),i===1)return()=>e[0];r[0]>r[i-1]&&(r=[...r].reverse(),e=[...e].reverse());const o=RR(e,n,s),u=o.length,d=c=>{let f=0;if(u>1)for(;f<r.length-2&&!(c<r[f+1]);f++);const p=Sa(r[f],r[f+1],c);return o[f](p)};return t?c=>d(Ls(r[0],r[i-1],c)):d}function CR(r,e){const t=r[r.length-1];for(let n=1;n<=e;n++){const s=Sa(0,e,n);r.push(At(t,1,s))}}function PR(r){const e=[0];return CR(e,r.length-1),e}function _R(r,e){return r.map(t=>t*e)}function kR(r,e){return r.map(()=>e||LE).splice(0,r.length-1)}function Nu({duration:r=300,keyframes:e,times:t,ease:n="easeInOut"}){const s=hR(n)?n.map(J0):J0(n),i={done:!1,value:e[0]},o=_R(t&&t.length===e.length?t:PR(e),r),u=$E(o,e,{ease:Array.isArray(s)?s:kR(e,s)});return{calculatedDuration:r,next:d=>(i.value=u(d),i.done=d>=r,i)}}function VE(r,e){return e?r*(1e3/e):0}const DR=5;function GE(r,e,t){const n=Math.max(e-DR,0);return VE(t-r(n),e-n)}const cf=.001,OR=.01,NR=10,MR=.05,FR=1;function BR({duration:r=800,bounce:e=.25,velocity:t=0,mass:n=1}){let s,i,o=1-e;o=Ls(MR,FR,o),r=Ls(OR,NR,Gr(r)),o<1?(s=c=>{const f=c*o,p=f*r,m=f-t,y=sh(c,o),v=Math.exp(-p);return cf-m/y*v},i=c=>{const p=c*o*r,m=p*t+t,y=Math.pow(o,2)*Math.pow(c,2)*r,v=Math.exp(-p),S=sh(Math.pow(c,2),o);return(-s(c)+cf>0?-1:1)*((m-y)*v)/S}):(s=c=>{const f=Math.exp(-c*r),p=(c-t)*r+1;return-cf+f*p},i=c=>{const f=Math.exp(-c*r),p=(t-c)*(r*r);return f*p});const u=5/r,d=jR(s,i,u);if(r=ti(r),isNaN(d))return{stiffness:100,damping:10,duration:r};{const c=Math.pow(d,2)*n;return{stiffness:c,damping:o*2*Math.sqrt(n*c),duration:r}}}const UR=12;function jR(r,e,t){let n=t;for(let s=1;s<UR;s++)n=n-r(n)/e(n);return n}function sh(r,e){return r*Math.sqrt(1-e*e)}const $R=["duration","bounce"],VR=["stiffness","damping","mass"];function ny(r,e){return e.some(t=>r[t]!==void 0)}function GR(r){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...r};if(!ny(r,VR)&&ny(r,$R)){const t=BR(r);e={...e,...t,mass:1},e.isResolvedFromDuration=!0}return e}function HE({keyframes:r,restDelta:e,restSpeed:t,...n}){const s=r[0],i=r[r.length-1],o={done:!1,value:s},{stiffness:u,damping:d,mass:c,duration:f,velocity:p,isResolvedFromDuration:m}=GR({...n,velocity:-Gr(n.velocity||0)}),y=p||0,v=d/(2*Math.sqrt(u*c)),S=i-s,T=Gr(Math.sqrt(u/c)),A=Math.abs(S)<5;t||(t=A?.01:2),e||(e=A?.005:.5);let L;if(v<1){const w=sh(T,v);L=C=>{const P=Math.exp(-v*T*C);return i-P*((y+v*T*S)/w*Math.sin(w*C)+S*Math.cos(w*C))}}else if(v===1)L=w=>i-Math.exp(-T*w)*(S+(y+T*S)*w);else{const w=T*Math.sqrt(v*v-1);L=C=>{const P=Math.exp(-v*T*C),B=Math.min(w*C,300);return i-P*((y+v*T*S)*Math.sinh(B)+w*S*Math.cosh(B))/w}}return{calculatedDuration:m&&f||null,next:w=>{const C=L(w);if(m)o.done=w>=f;else{let P=y;w!==0&&(v<1?P=GE(L,w,C):P=0);const B=Math.abs(P)<=t,D=Math.abs(i-C)<=e;o.done=B&&D}return o.value=o.done?i:C,o}}}function ry({keyframes:r,velocity:e=0,power:t=.8,timeConstant:n=325,bounceDamping:s=10,bounceStiffness:i=500,modifyTarget:o,min:u,max:d,restDelta:c=.5,restSpeed:f}){const p=r[0],m={done:!1,value:p},y=N=>u!==void 0&&N<u||d!==void 0&&N>d,v=N=>u===void 0?d:d===void 0||Math.abs(u-N)<Math.abs(d-N)?u:d;let S=t*e;const T=p+S,A=o===void 0?T:o(T);A!==T&&(S=A-p);const L=N=>-S*Math.exp(-N/n),w=N=>A+L(N),C=N=>{const F=L(N),O=w(N);m.done=Math.abs(F)<=c,m.value=m.done?A:O};let P,B;const D=N=>{y(m.value)&&(P=N,B=HE({keyframes:[m.value,v(m.value)],velocity:GE(w,N,m.value),damping:s,stiffness:i,restDelta:c,restSpeed:f}))};return D(0),{calculatedDuration:null,next:N=>{let F=!1;return!B&&P===void 0&&(F=!0,C(N),D(N)),P!==void 0&&N>P?B.next(N-P):(!F&&C(N),m)}}}const HR=r=>{const e=({timestamp:t})=>r(t);return{start:()=>dt.update(e,!0),stop:()=>Hr(e),now:()=>sn.isProcessing?sn.timestamp:performance.now()}},sy=2e4;function iy(r){let e=0;const t=50;let n=r.next(e);for(;!n.done&&e<sy;)e+=t,n=r.next(e);return e>=sy?1/0:e}const KR={decay:ry,inertia:ry,tween:Nu,keyframes:Nu,spring:HE};function Mu({autoplay:r=!0,delay:e=0,driver:t=HR,keyframes:n,type:s="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:u="loop",onPlay:d,onStop:c,onComplete:f,onUpdate:p,...m}){let y=1,v=!1,S,T;const A=()=>{T=new Promise(k=>{S=k})};A();let L;const w=KR[s]||Nu;let C;w!==Nu&&typeof n[0]!="number"&&(C=$E([0,100],n,{clamp:!1}),n=[0,100]);const P=w({...m,keyframes:n});let B;u==="mirror"&&(B=w({...m,keyframes:[...n].reverse(),velocity:-(m.velocity||0)}));let D="idle",N=null,F=null,O=null;P.calculatedDuration===null&&i&&(P.calculatedDuration=iy(P));const{calculatedDuration:V}=P;let H=1/0,te=1/0;V!==null&&(H=V+o,te=H*(i+1)-o);let X=0;const ae=k=>{if(F===null)return;y>0&&(F=Math.min(F,k)),y<0&&(F=Math.min(k-te/y,F)),N!==null?X=N:X=Math.round(k-F)*y;const U=X-e*(y>=0?1:-1),re=y>=0?U<0:U>te;X=Math.max(U,0),D==="finished"&&N===null&&(X=te);let pe=X,me=P;if(i){const Oe=Math.min(X,te)/H;let He=Math.floor(Oe),Ke=Oe%1;!Ke&&Oe>=1&&(Ke=1),Ke===1&&He--,He=Math.min(He,i+1),!!(He%2)&&(u==="reverse"?(Ke=1-Ke,o&&(Ke-=o/H)):u==="mirror"&&(me=B)),pe=Ls(0,1,Ke)*H}const ye=re?{done:!1,value:n[0]}:me.next(pe);C&&(ye.value=C(ye.value));let{done:ke}=ye;!re&&V!==null&&(ke=y>=0?X>=te:X<=0);const Ce=N===null&&(D==="finished"||D==="running"&&ke);return p&&p(ye.value),Ce&&G(),ye},Q=()=>{L&&L.stop(),L=void 0},ie=()=>{D="idle",Q(),S(),A(),F=O=null},G=()=>{D="finished",f&&f(),Q(),S()},ee=()=>{if(v)return;L||(L=t(ae));const k=L.now();d&&d(),N!==null?F=k-N:(!F||D==="finished")&&(F=k),D==="finished"&&A(),O=F,N=null,D="running",L.start()};r&&ee();const Z={then(k,U){return T.then(k,U)},get time(){return Gr(X)},set time(k){k=ti(k),X=k,N!==null||!L||y===0?N=k:F=L.now()-k/y},get duration(){const k=P.calculatedDuration===null?iy(P):P.calculatedDuration;return Gr(k)},get speed(){return y},set speed(k){k===y||!L||(y=k,Z.time=Gr(X))},get state(){return D},play:ee,pause:()=>{D="paused",N=X},stop:()=>{v=!0,D!=="idle"&&(D="idle",c&&c(),ie())},cancel:()=>{O!==null&&ae(O),ie()},complete:()=>{D="finished"},sample:k=>(F=0,ae(k))};return Z}function zR(r){let e;return()=>(e===void 0&&(e=r()),e)}const WR=zR(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),YR=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),ql=10,qR=2e4,XR=(r,e)=>e.type==="spring"||r==="backgroundColor"||!TE(e.ease);function QR(r,e,{onUpdate:t,onComplete:n,...s}){if(!(WR()&&YR.has(e)&&!s.repeatDelay&&s.repeatType!=="mirror"&&s.damping!==0&&s.type!=="inertia"))return!1;let o=!1,u,d,c=!1;const f=()=>{d=new Promise(w=>{u=w})};f();let{keyframes:p,duration:m=300,ease:y,times:v}=s;if(XR(e,s)){const w=Mu({...s,repeat:0,delay:0});let C={done:!1,value:p[0]};const P=[];let B=0;for(;!C.done&&B<qR;)C=w.sample(B),P.push(C.value),B+=ql;v=void 0,p=P,m=B-ql,y="linear"}const S=oR(r.owner.current,e,p,{...s,duration:m,ease:y,times:v}),T=()=>{c=!1,S.cancel()},A=()=>{c=!0,dt.update(T),u(),f()};return S.onfinish=()=>{c||(r.set(aR(p,s)),n&&n(),A())},{then(w,C){return d.then(w,C)},attachTimeline(w){return S.timeline=w,S.onfinish=null,kt},get time(){return Gr(S.currentTime||0)},set time(w){S.currentTime=ti(w)},get speed(){return S.playbackRate},set speed(w){S.playbackRate=w},get duration(){return Gr(m)},play:()=>{o||(S.play(),Hr(T))},pause:()=>S.pause(),stop:()=>{if(o=!0,S.playState==="idle")return;const{currentTime:w}=S;if(w){const C=Mu({...s,autoplay:!1});r.setWithVelocity(C.sample(w-ql).value,C.sample(w).value,ql)}A()},complete:()=>{c||S.finish()},cancel:A}}function ZR({keyframes:r,delay:e,onUpdate:t,onComplete:n}){const s=()=>(t&&t(r[r.length-1]),n&&n(),{time:0,speed:1,duration:0,play:kt,pause:kt,stop:kt,then:i=>(i(),Promise.resolve()),cancel:kt,complete:kt});return e?Mu({keyframes:[0,1],duration:0,delay:e,onComplete:s}):s()}const JR={type:"spring",stiffness:500,damping:25,restSpeed:10},e1=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),t1={type:"keyframes",duration:.8},n1={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},r1=(r,{keyframes:e})=>e.length>2?t1:ui.has(r)?r.startsWith("scale")?e1(e[1]):JR:n1,ih=(r,e)=>r==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Is.test(e)||e==="0")&&!e.startsWith("url(")),s1=new Set(["brightness","contrast","saturate","opacity"]);function i1(r){const[e,t]=r.slice(0,-1).split("(");if(e==="drop-shadow")return r;const[n]=t.match(oc)||[];if(!n)return r;const s=t.replace(n,"");let i=s1.has(e)?1:0;return n!==t&&(i*=100),e+"("+i+s+")"}const o1=/([a-z-]*)\(.*?\)/g,oh={...Is,getAnimatableNone:r=>{const e=r.match(o1);return e?e.map(i1).join(" "):r}},a1={...sE,color:cn,backgroundColor:cn,outlineColor:cn,fill:cn,stroke:cn,borderColor:cn,borderTopColor:cn,borderRightColor:cn,borderBottomColor:cn,borderLeftColor:cn,filter:oh,WebkitFilter:oh},fp=r=>a1[r];function KE(r,e){let t=fp(r);return t!==oh&&(t=Is),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const zE=r=>/^0[^.\s]+$/.test(r);function l1(r){if(typeof r=="number")return r===0;if(r!==null)return r==="none"||r==="0"||zE(r)}function u1(r,e,t,n){const s=ih(e,t);let i;Array.isArray(t)?i=[...t]:i=[null,t];const o=n.from!==void 0?n.from:r.get();let u;const d=[];for(let c=0;c<i.length;c++)i[c]===null&&(i[c]=c===0?o:i[c-1]),l1(i[c])&&d.push(c),typeof i[c]=="string"&&i[c]!=="none"&&i[c]!=="0"&&(u=i[c]);if(s&&d.length&&u)for(let c=0;c<d.length;c++){const f=d[c];i[f]=KE(e,u)}return i}function c1({when:r,delay:e,delayChildren:t,staggerChildren:n,staggerDirection:s,repeat:i,repeatType:o,repeatDelay:u,from:d,elapsed:c,...f}){return!!Object.keys(f).length}function hp(r,e){return r[e]||r.default||r}const d1={skipAnimations:!1},pp=(r,e,t,n={})=>s=>{const i=hp(n,r)||{},o=i.delay||n.delay||0;let{elapsed:u=0}=n;u=u-ti(o);const d=u1(e,r,t,i),c=d[0],f=d[d.length-1],p=ih(r,c),m=ih(r,f);let y={keyframes:d,velocity:e.getVelocity(),ease:"easeOut",...i,delay:-u,onUpdate:v=>{e.set(v),i.onUpdate&&i.onUpdate(v)},onComplete:()=>{s(),i.onComplete&&i.onComplete()}};if(c1(i)||(y={...y,...r1(r,y)}),y.duration&&(y.duration=ti(y.duration)),y.repeatDelay&&(y.repeatDelay=ti(y.repeatDelay)),!p||!m||iR.current||i.type===!1||d1.skipAnimations)return ZR(y);if(!n.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const v=QR(e,r,y);if(v)return v}return Mu(y)};function Fu(r){return!!(An(r)&&r.add)}const WE=r=>/^\-?\d*\.?\d+$/.test(r);function mp(r,e){r.indexOf(e)===-1&&r.push(e)}function gp(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}class yp{constructor(){this.subscriptions=[]}add(e){return mp(this.subscriptions,e),()=>gp(this.subscriptions,e)}notify(e,t,n){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,t,n);else for(let i=0;i<s;i++){const o=this.subscriptions[i];o&&o(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const f1=r=>!isNaN(parseFloat(r));class h1{constructor(e,t={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(n,s=!0)=>{this.prev=this.current,this.current=n;const{delta:i,timestamp:o}=sn;this.lastUpdated!==o&&(this.timeDelta=i,this.lastUpdated=o,dt.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),s&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>dt.postRender(this.velocityCheck),this.velocityCheck=({timestamp:n})=>{n!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=f1(this.current),this.owner=t.owner}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new yp);const n=this.events[e].add(t);return e==="change"?()=>{n(),dt.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,n){this.set(t),this.prev=e,this.timeDelta=n}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?VE(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ao(r,e){return new h1(r,e)}const YE=r=>e=>e.test(r),p1={test:r=>r==="auto",parse:r=>r},qE=[ci,De,vr,gs,Tw,Ew,p1],ea=r=>qE.find(YE(r)),m1=[...qE,cn,Is],g1=r=>m1.find(YE(r));function y1(r,e,t){r.hasValue(e)?r.getValue(e).set(t):r.addValue(e,ao(t))}function v1(r,e){const t=lc(r,e);let{transitionEnd:n={},transition:s={},...i}=t?r.makeTargetAnimatable(t,!1):{};i={...i,...n};for(const o in i){const u=Nw(i[o]);y1(r,o,u)}}function x1(r,e,t){var n,s;const i=Object.keys(e).filter(u=>!r.hasValue(u)),o=i.length;if(o)for(let u=0;u<o;u++){const d=i[u],c=e[d];let f=null;Array.isArray(c)&&(f=c[0]),f===null&&(f=(s=(n=t[d])!==null&&n!==void 0?n:r.readValue(d))!==null&&s!==void 0?s:e[d]),f!=null&&(typeof f=="string"&&(WE(f)||zE(f))?f=parseFloat(f):!g1(f)&&Is.test(c)&&(f=KE(d,c)),r.addValue(d,ao(f,{owner:r})),t[d]===void 0&&(t[d]=f),f!==null&&r.setBaseTarget(d,f))}}function E1(r,e){return e?(e[r]||e.default||e).from:void 0}function T1(r,e,t){const n={};for(const s in r){const i=E1(s,e);if(i!==void 0)n[s]=i;else{const o=t.getValue(s);o&&(n[s]=o.get())}}return n}function S1({protectedKeys:r,needsAnimating:e},t){const n=r.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,n}function b1(r,e){const t=r.get();if(Array.isArray(e)){for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}else return t!==e}function XE(r,e,{delay:t=0,transitionOverride:n,type:s}={}){let{transition:i=r.getDefaultTransition(),transitionEnd:o,...u}=r.makeTargetAnimatable(e);const d=r.getValue("willChange");n&&(i=n);const c=[],f=s&&r.animationState&&r.animationState.getState()[s];for(const p in u){const m=r.getValue(p),y=u[p];if(!m||y===void 0||f&&S1(f,p))continue;const v={delay:t,elapsed:0,...hp(i||{},p)};if(window.HandoffAppearAnimations){const A=r.getProps()[Qx];if(A){const L=window.HandoffAppearAnimations(A,p,m,dt);L!==null&&(v.elapsed=L,v.isHandoff=!0)}}let S=!v.isHandoff&&!b1(m,y);if(v.type==="spring"&&(m.getVelocity()||v.velocity)&&(S=!1),m.animation&&(S=!1),S)continue;m.start(pp(p,m,y,r.shouldReduceMotion&&ui.has(p)?{type:!1}:v));const T=m.animation;Fu(d)&&(d.add(p),T.then(()=>d.remove(p))),c.push(T)}return o&&Promise.all(c).then(()=>{o&&v1(r,o)}),c}function ah(r,e,t={}){const n=lc(r,e,t.custom);let{transition:s=r.getDefaultTransition()||{}}=n||{};t.transitionOverride&&(s=t.transitionOverride);const i=n?()=>Promise.all(XE(r,n,t)):()=>Promise.resolve(),o=r.variantChildren&&r.variantChildren.size?(d=0)=>{const{delayChildren:c=0,staggerChildren:f,staggerDirection:p}=s;return A1(r,e,c+d,f,p,t)}:()=>Promise.resolve(),{when:u}=s;if(u){const[d,c]=u==="beforeChildren"?[i,o]:[o,i];return d().then(()=>c())}else return Promise.all([i(),o(t.delay)])}function A1(r,e,t=0,n=0,s=1,i){const o=[],u=(r.variantChildren.size-1)*n,d=s===1?(c=0)=>c*n:(c=0)=>u-c*n;return Array.from(r.variantChildren).sort(L1).forEach((c,f)=>{c.notify("AnimationStart",e),o.push(ah(c,e,{...i,delay:t+d(f)}).then(()=>c.notify("AnimationComplete",e)))}),Promise.all(o)}function L1(r,e){return r.sortNodePosition(e)}function I1(r,e,t={}){r.notify("AnimationStart",e);let n;if(Array.isArray(e)){const s=e.map(i=>ah(r,i,t));n=Promise.all(s)}else if(typeof e=="string")n=ah(r,e,t);else{const s=typeof e=="function"?lc(r,e,t.custom):e;n=Promise.all(XE(r,s,t))}return n.then(()=>r.notify("AnimationComplete",e))}const w1=[...Zh].reverse(),R1=Zh.length;function C1(r){return e=>Promise.all(e.map(({animation:t,options:n})=>I1(r,t,n)))}function P1(r){let e=C1(r);const t=k1();let n=!0;const s=(d,c)=>{const f=lc(r,c);if(f){const{transition:p,transitionEnd:m,...y}=f;d={...d,...y,...m}}return d};function i(d){e=d(r)}function o(d,c){const f=r.getProps(),p=r.getVariantContext(!0)||{},m=[],y=new Set;let v={},S=1/0;for(let A=0;A<R1;A++){const L=w1[A],w=t[L],C=f[L]!==void 0?f[L]:p[L],P=Ea(C),B=L===c?w.isActive:null;B===!1&&(S=A);let D=C===p[L]&&C!==f[L]&&P;if(D&&n&&r.manuallyAnimateOnMount&&(D=!1),w.protectedKeys={...v},!w.isActive&&B===null||!C&&!w.prevProp||sc(C)||typeof C=="boolean")continue;let F=_1(w.prevProp,C)||L===c&&w.isActive&&!D&&P||A>S&&P,O=!1;const V=Array.isArray(C)?C:[C];let H=V.reduce(s,{});B===!1&&(H={});const{prevResolvedValues:te={}}=w,X={...te,...H},ae=Q=>{F=!0,y.has(Q)&&(O=!0,y.delete(Q)),w.needsAnimating[Q]=!0};for(const Q in X){const ie=H[Q],G=te[Q];if(v.hasOwnProperty(Q))continue;let ee=!1;Du(ie)&&Du(G)?ee=!xE(ie,G):ee=ie!==G,ee?ie!==void 0?ae(Q):y.add(Q):ie!==void 0&&y.has(Q)?ae(Q):w.protectedKeys[Q]=!0}w.prevProp=C,w.prevResolvedValues=H,w.isActive&&(v={...v,...H}),n&&r.blockInitialAnimation&&(F=!1),F&&(!D||O)&&m.push(...V.map(Q=>({animation:Q,options:{type:L,...d}})))}if(y.size){const A={};y.forEach(L=>{const w=r.getBaseTarget(L);w!==void 0&&(A[L]=w)}),m.push({animation:A})}let T=!!m.length;return n&&(f.initial===!1||f.initial===f.animate)&&!r.manuallyAnimateOnMount&&(T=!1),n=!1,T?e(m):Promise.resolve()}function u(d,c,f){var p;if(t[d].isActive===c)return Promise.resolve();(p=r.variantChildren)===null||p===void 0||p.forEach(y=>{var v;return(v=y.animationState)===null||v===void 0?void 0:v.setActive(d,c)}),t[d].isActive=c;const m=o(f,d);for(const y in t)t[y].protectedKeys={};return m}return{animateChanges:o,setActive:u,setAnimateFunction:i,getState:()=>t}}function _1(r,e){return typeof e=="string"?e!==r:Array.isArray(e)?!xE(e,r):!1}function Ks(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function k1(){return{animate:Ks(!0),whileInView:Ks(),whileHover:Ks(),whileTap:Ks(),whileDrag:Ks(),whileFocus:Ks(),exit:Ks()}}class D1 extends Ps{constructor(e){super(e),e.animationState||(e.animationState=P1(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),sc(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){}}let O1=0;class N1 extends Ps{constructor(){super(...arguments),this.id=O1++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t,custom:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e,{custom:n??this.node.getProps().custom});t&&!e&&i.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const M1={animation:{Feature:D1},exit:{Feature:N1}},oy=(r,e)=>Math.abs(r-e);function F1(r,e){const t=oy(r.x,e.x),n=oy(r.y,e.y);return Math.sqrt(t**2+n**2)}class QE{constructor(e,t,{transformPagePoint:n,contextWindow:s,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=ff(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,y=F1(p.offset,{x:0,y:0})>=3;if(!m&&!y)return;const{point:v}=p,{timestamp:S}=sn;this.history.push({...v,timestamp:S});const{onStart:T,onMove:A}=this.handlers;m||(T&&T(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),A&&A(this.lastMoveEvent,p)},this.handlePointerMove=(p,m)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=df(m,this.transformPagePoint),dt.update(this.updatePoint,!0)},this.handlePointerUp=(p,m)=>{this.end();const{onEnd:y,onSessionEnd:v,resumeAnimation:S}=this.handlers;if(this.dragSnapToOrigin&&S&&S(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const T=ff(p.type==="pointercancel"?this.lastMoveEventInfo:df(m,this.transformPagePoint),this.history);this.startEvent&&y&&y(p,T),v&&v(p,T)},!pE(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=n,this.contextWindow=s||window;const o=ac(e),u=df(o,this.transformPagePoint),{point:d}=u,{timestamp:c}=sn;this.history=[{...d,timestamp:c}];const{onSessionStart:f}=t;f&&f(e,ff(u,this.history)),this.removeListeners=bs(Vr(this.contextWindow,"pointermove",this.handlePointerMove),Vr(this.contextWindow,"pointerup",this.handlePointerUp),Vr(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Hr(this.updatePoint)}}function df(r,e){return e?{point:e(r.point)}:r}function ay(r,e){return{x:r.x-e.x,y:r.y-e.y}}function ff({point:r},e){return{point:r,delta:ay(r,ZE(e)),offset:ay(r,B1(e)),velocity:U1(e,.1)}}function B1(r){return r[0]}function ZE(r){return r[r.length-1]}function U1(r,e){if(r.length<2)return{x:0,y:0};let t=r.length-1,n=null;const s=ZE(r);for(;t>=0&&(n=r[t],!(s.timestamp-n.timestamp>ti(e)));)t--;if(!n)return{x:0,y:0};const i=Gr(s.timestamp-n.timestamp);if(i===0)return{x:0,y:0};const o={x:(s.x-n.x)/i,y:(s.y-n.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function Mn(r){return r.max-r.min}function lh(r,e=0,t=.01){return Math.abs(r-e)<=t}function ly(r,e,t,n=.5){r.origin=n,r.originPoint=At(e.min,e.max,r.origin),r.scale=Mn(t)/Mn(e),(lh(r.scale,1,1e-4)||isNaN(r.scale))&&(r.scale=1),r.translate=At(t.min,t.max,r.origin)-r.originPoint,(lh(r.translate)||isNaN(r.translate))&&(r.translate=0)}function da(r,e,t,n){ly(r.x,e.x,t.x,n?n.originX:void 0),ly(r.y,e.y,t.y,n?n.originY:void 0)}function uy(r,e,t){r.min=t.min+e.min,r.max=r.min+Mn(e)}function j1(r,e,t){uy(r.x,e.x,t.x),uy(r.y,e.y,t.y)}function cy(r,e,t){r.min=e.min-t.min,r.max=r.min+Mn(e)}function fa(r,e,t){cy(r.x,e.x,t.x),cy(r.y,e.y,t.y)}function $1(r,{min:e,max:t},n){return e!==void 0&&r<e?r=n?At(e,r,n.min):Math.max(r,e):t!==void 0&&r>t&&(r=n?At(t,r,n.max):Math.min(r,t)),r}function dy(r,e,t){return{min:e!==void 0?r.min+e:void 0,max:t!==void 0?r.max+t-(r.max-r.min):void 0}}function V1(r,{top:e,left:t,bottom:n,right:s}){return{x:dy(r.x,t,s),y:dy(r.y,e,n)}}function fy(r,e){let t=e.min-r.min,n=e.max-r.max;return e.max-e.min<r.max-r.min&&([t,n]=[n,t]),{min:t,max:n}}function G1(r,e){return{x:fy(r.x,e.x),y:fy(r.y,e.y)}}function H1(r,e){let t=.5;const n=Mn(r),s=Mn(e);return s>n?t=Sa(e.min,e.max-n,r.min):n>s&&(t=Sa(r.min,r.max-s,e.min)),Ls(0,1,t)}function K1(r,e){const t={};return e.min!==void 0&&(t.min=e.min-r.min),e.max!==void 0&&(t.max=e.max-r.min),t}const uh=.35;function z1(r=uh){return r===!1?r=0:r===!0&&(r=uh),{x:hy(r,"left","right"),y:hy(r,"top","bottom")}}function hy(r,e,t){return{min:py(r,e),max:py(r,t)}}function py(r,e){return typeof r=="number"?r:r[e]||0}const my=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ki=()=>({x:my(),y:my()}),gy=()=>({min:0,max:0}),Mt=()=>({x:gy(),y:gy()});function Hn(r){return[r("x"),r("y")]}function JE({top:r,left:e,right:t,bottom:n}){return{x:{min:e,max:t},y:{min:r,max:n}}}function W1({x:r,y:e}){return{top:e.min,right:r.max,bottom:e.max,left:r.min}}function Y1(r,e){if(!e)return r;const t=e({x:r.left,y:r.top}),n=e({x:r.right,y:r.bottom});return{top:t.y,left:t.x,bottom:n.y,right:n.x}}function hf(r){return r===void 0||r===1}function ch({scale:r,scaleX:e,scaleY:t}){return!hf(r)||!hf(e)||!hf(t)}function Ys(r){return ch(r)||eT(r)||r.z||r.rotate||r.rotateX||r.rotateY}function eT(r){return yy(r.x)||yy(r.y)}function yy(r){return r&&r!=="0%"}function Bu(r,e,t){const n=r-t,s=e*n;return t+s}function vy(r,e,t,n,s){return s!==void 0&&(r=Bu(r,s,n)),Bu(r,t,n)+e}function dh(r,e=0,t=1,n,s){r.min=vy(r.min,e,t,n,s),r.max=vy(r.max,e,t,n,s)}function tT(r,{x:e,y:t}){dh(r.x,e.translate,e.scale,e.originPoint),dh(r.y,t.translate,t.scale,t.originPoint)}function q1(r,e,t,n=!1){const s=t.length;if(!s)return;e.x=e.y=1;let i,o;for(let u=0;u<s;u++){i=t[u],o=i.projectionDelta;const d=i.instance;d&&d.style&&d.style.display==="contents"||(n&&i.options.layoutScroll&&i.scroll&&i!==i.root&&zi(r,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,tT(r,o)),n&&Ys(i.latestValues)&&zi(r,i.latestValues))}e.x=xy(e.x),e.y=xy(e.y)}function xy(r){return Number.isInteger(r)||r>1.0000000000001||r<.999999999999?r:1}function ys(r,e){r.min=r.min+e,r.max=r.max+e}function Ey(r,e,[t,n,s]){const i=e[s]!==void 0?e[s]:.5,o=At(r.min,r.max,i);dh(r,e[t],e[n],o,e.scale)}const X1=["x","scaleX","originX"],Q1=["y","scaleY","originY"];function zi(r,e){Ey(r.x,e,X1),Ey(r.y,e,Q1)}function nT(r,e){return JE(Y1(r.getBoundingClientRect(),e))}function Z1(r,e,t){const n=nT(r,t),{scroll:s}=e;return s&&(ys(n.x,s.offset.x),ys(n.y,s.offset.y)),n}const rT=({current:r})=>r?r.ownerDocument.defaultView:null,J1=new WeakMap;class eC{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Mt(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const s=f=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(ac(f,"page").point)},i=(f,p)=>{const{drag:m,dragPropagation:y,onDragStart:v}=this.getProps();if(m&&!y&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=gE(m),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Hn(T=>{let A=this.getAxisMotionValue(T).get()||0;if(vr.test(A)){const{projection:L}=this.visualElement;if(L&&L.layout){const w=L.layout.layoutBox[T];w&&(A=Mn(w)*(parseFloat(A)/100))}}this.originPoint[T]=A}),v&&dt.update(()=>v(f,p),!1,!0);const{animationState:S}=this.visualElement;S&&S.setActive("whileDrag",!0)},o=(f,p)=>{const{dragPropagation:m,dragDirectionLock:y,onDirectionLock:v,onDrag:S}=this.getProps();if(!m&&!this.openGlobalLock)return;const{offset:T}=p;if(y&&this.currentDirection===null){this.currentDirection=tC(T),this.currentDirection!==null&&v&&v(this.currentDirection);return}this.updateAxis("x",p.point,T),this.updateAxis("y",p.point,T),this.visualElement.render(),S&&S(f,p)},u=(f,p)=>this.stop(f,p),d=()=>Hn(f=>{var p;return this.getAnimationState(f)==="paused"&&((p=this.getAxisMotionValue(f).animation)===null||p===void 0?void 0:p.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new QE(e,{onSessionStart:s,onStart:i,onMove:o,onSessionEnd:u,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:rT(this.visualElement)})}stop(e,t){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:s}=t;this.startAnimation(s);const{onDragEnd:i}=this.getProps();i&&dt.update(()=>i(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:s}=this.getProps();if(!n||!Xl(e,s,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(o=$1(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,i=this.constraints;t&&Gi(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&s?this.constraints=V1(s.layoutBox,t):this.constraints=!1,this.elastic=z1(n),i!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Hn(o=>{this.getAxisMotionValue(o)&&(this.constraints[o]=K1(s.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Gi(e))return!1;const n=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const i=Z1(n,s.root,this.visualElement.getTransformPagePoint());let o=G1(s.layout.layoutBox,i);if(t){const u=t(W1(o));this.hasMutatedConstraints=!!u,u&&(o=JE(u))}return o}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:s,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:u}=this.getProps(),d=this.constraints||{},c=Hn(f=>{if(!Xl(f,t,this.currentDirection))return;let p=d&&d[f]||{};o&&(p={min:0,max:0});const m=s?200:1e6,y=s?40:1e7,v={type:"inertia",velocity:n?e[f]:0,bounceStiffness:m,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10,...i,...p};return this.startAxisValueAnimation(f,v)});return Promise.all(c).then(u)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return n.start(pp(e,n,0,t))}stopAnimation(){Hn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Hn(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t="_drag"+e.toUpperCase(),n=this.visualElement.getProps(),s=n[t];return s||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){Hn(t=>{const{drag:n}=this.getProps();if(!Xl(t,n,this.currentDirection))return;const{projection:s}=this.visualElement,i=this.getAxisMotionValue(t);if(s&&s.layout){const{min:o,max:u}=s.layout.layoutBox[t];i.set(e[t]-At(o,u,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!Gi(t)||!n||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};Hn(o=>{const u=this.getAxisMotionValue(o);if(u){const d=u.get();s[o]=H1({min:d,max:d},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Hn(o=>{if(!Xl(o,e,null))return;const u=this.getAxisMotionValue(o),{min:d,max:c}=this.constraints[o];u.set(At(d,c,s[o]))})}addListeners(){if(!this.visualElement.current)return;J1.set(this.visualElement,this);const e=this.visualElement.current,t=Vr(e,"pointerdown",d=>{const{drag:c,dragListener:f=!0}=this.getProps();c&&f&&this.start(d)}),n=()=>{const{dragConstraints:d}=this.getProps();Gi(d)&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",n);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),n();const o=jr(window,"resize",()=>this.scalePositionWithinConstraints()),u=s.addEventListener("didUpdate",(({delta:d,hasLayoutChanged:c})=>{this.isDragging&&c&&(Hn(f=>{const p=this.getAxisMotionValue(f);p&&(this.originPoint[f]+=d[f].translate,p.set(p.get()+d[f].translate))}),this.visualElement.render())}));return()=>{o(),t(),i(),u&&u()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:s=!1,dragConstraints:i=!1,dragElastic:o=uh,dragMomentum:u=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:s,dragConstraints:i,dragElastic:o,dragMomentum:u}}}function Xl(r,e,t){return(e===!0||e===r)&&(t===null||t===r)}function tC(r,e=10){let t=null;return Math.abs(r.y)>e?t="y":Math.abs(r.x)>e&&(t="x"),t}class nC extends Ps{constructor(e){super(e),this.removeGroupControls=kt,this.removeListeners=kt,this.controls=new eC(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||kt}unmount(){this.removeGroupControls(),this.removeListeners()}}const Ty=r=>(e,t)=>{r&&dt.update(()=>r(e,t))};class rC extends Ps{constructor(){super(...arguments),this.removePointerDownListener=kt}onPointerDown(e){this.session=new QE(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:rT(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:s}=this.node.getProps();return{onSessionStart:Ty(e),onStart:Ty(t),onMove:n,onEnd:(i,o)=>{delete this.session,s&&dt.update(()=>s(i,o))}}}mount(){this.removePointerDownListener=Vr(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function sC(){const r=_.useContext(nc);if(r===null)return[!0,null];const{isPresent:e,onExitComplete:t,register:n}=r,s=_.useId();return _.useEffect(()=>n(s),[]),!e&&t?[!1,()=>t&&t(s)]:[!0]}const vu={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Sy(r,e){return e.max===e.min?0:r/(e.max-e.min)*100}const ta={correct:(r,e)=>{if(!e.target)return r;if(typeof r=="string")if(De.test(r))r=parseFloat(r);else return r;const t=Sy(r,e.target.x),n=Sy(r,e.target.y);return`${t}% ${n}%`}},iC={correct:(r,{treeScale:e,projectionDelta:t})=>{const n=r,s=Is.parse(r);if(s.length>5)return n;const i=Is.createTransformer(r),o=typeof s[0]!="number"?1:0,u=t.x.scale*e.x,d=t.y.scale*e.y;s[0+o]/=u,s[1+o]/=d;const c=At(u,d,.5);return typeof s[2+o]=="number"&&(s[2+o]/=c),typeof s[3+o]=="number"&&(s[3+o]/=c),i(s)}};class oC extends on.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:s}=this.props,{projection:i}=e;hw(aC),i&&(t.group&&t.group.add(i),n&&n.register&&s&&n.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),vu.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:s,isPresent:i}=this.props,o=n.projection;return o&&(o.isPresent=i,s||e.layoutDependency!==t||t===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||dt.postRender(()=>{const u=o.getStack();(!u||!u.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:s}=e;s&&(s.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(s),n&&n.deregister&&n.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function sT(r){const[e,t]=sC(),n=_.useContext(ep);return on.createElement(oC,{...r,layoutGroup:n,switchLayoutGroup:_.useContext(Jx),isPresent:e,safeToRemove:t})}const aC={borderRadius:{...ta,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ta,borderTopRightRadius:ta,borderBottomLeftRadius:ta,borderBottomRightRadius:ta,boxShadow:iC},iT=["TopLeft","TopRight","BottomLeft","BottomRight"],lC=iT.length,by=r=>typeof r=="string"?parseFloat(r):r,Ay=r=>typeof r=="number"||De.test(r);function uC(r,e,t,n,s,i){s?(r.opacity=At(0,t.opacity!==void 0?t.opacity:1,cC(n)),r.opacityExit=At(e.opacity!==void 0?e.opacity:1,0,dC(n))):i&&(r.opacity=At(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,n));for(let o=0;o<lC;o++){const u=`border${iT[o]}Radius`;let d=Ly(e,u),c=Ly(t,u);if(d===void 0&&c===void 0)continue;d||(d=0),c||(c=0),d===0||c===0||Ay(d)===Ay(c)?(r[u]=Math.max(At(by(d),by(c),n),0),(vr.test(c)||vr.test(d))&&(r[u]+="%")):r[u]=c}(e.rotate||t.rotate)&&(r.rotate=At(e.rotate||0,t.rotate||0,n))}function Ly(r,e){return r[e]!==void 0?r[e]:r.borderRadius}const cC=oT(0,.5,RE),dC=oT(.5,.95,kt);function oT(r,e,t){return n=>n<r?0:n>e?1:t(Sa(r,e,n))}function Iy(r,e){r.min=e.min,r.max=e.max}function Gn(r,e){Iy(r.x,e.x),Iy(r.y,e.y)}function wy(r,e,t,n,s){return r-=e,r=Bu(r,1/t,n),s!==void 0&&(r=Bu(r,1/s,n)),r}function fC(r,e=0,t=1,n=.5,s,i=r,o=r){if(vr.test(e)&&(e=parseFloat(e),e=At(o.min,o.max,e/100)-o.min),typeof e!="number")return;let u=At(i.min,i.max,n);r===i&&(u-=e),r.min=wy(r.min,e,t,u,s),r.max=wy(r.max,e,t,u,s)}function Ry(r,e,[t,n,s],i,o){fC(r,e[t],e[n],e[s],e.scale,i,o)}const hC=["x","scaleX","originX"],pC=["y","scaleY","originY"];function Cy(r,e,t,n){Ry(r.x,e,hC,t?t.x:void 0,n?n.x:void 0),Ry(r.y,e,pC,t?t.y:void 0,n?n.y:void 0)}function Py(r){return r.translate===0&&r.scale===1}function aT(r){return Py(r.x)&&Py(r.y)}function mC(r,e){return r.x.min===e.x.min&&r.x.max===e.x.max&&r.y.min===e.y.min&&r.y.max===e.y.max}function lT(r,e){return Math.round(r.x.min)===Math.round(e.x.min)&&Math.round(r.x.max)===Math.round(e.x.max)&&Math.round(r.y.min)===Math.round(e.y.min)&&Math.round(r.y.max)===Math.round(e.y.max)}function _y(r){return Mn(r.x)/Mn(r.y)}class gC{constructor(){this.members=[]}add(e){mp(this.members,e),e.scheduleRender()}remove(e){if(gp(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(s=>e===s);if(t===0)return!1;let n;for(let s=t;s>=0;s--){const i=this.members[s];if(i.isPresent!==!1){n=i;break}}return n?(this.promote(n),!0):!1}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function ky(r,e,t){let n="";const s=r.x.translate/e.x,i=r.y.translate/e.y;if((s||i)&&(n=`translate3d(${s}px, ${i}px, 0) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),t){const{rotate:d,rotateX:c,rotateY:f}=t;d&&(n+=`rotate(${d}deg) `),c&&(n+=`rotateX(${c}deg) `),f&&(n+=`rotateY(${f}deg) `)}const o=r.x.scale*e.x,u=r.y.scale*e.y;return(o!==1||u!==1)&&(n+=`scale(${o}, ${u})`),n||"none"}const yC=(r,e)=>r.depth-e.depth;class vC{constructor(){this.children=[],this.isDirty=!1}add(e){mp(this.children,e),this.isDirty=!0}remove(e){gp(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(yC),this.isDirty=!1,this.children.forEach(e)}}function xC(r,e){const t=performance.now(),n=({timestamp:s})=>{const i=s-t;i>=e&&(Hr(n),r(i-e))};return dt.read(n,!0),()=>Hr(n)}function EC(r){window.MotionDebug&&window.MotionDebug.record(r)}function TC(r){return r instanceof SVGElement&&r.tagName!=="svg"}function SC(r,e,t){const n=An(r)?r:ao(r);return n.start(pp("",n,e,t)),n.animation}const Dy=["","X","Y","Z"],bC={visibility:"hidden"},Oy=1e3;let AC=0;const qs={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function uT({attachResizeListener:r,defaultParent:e,measureScroll:t,checkIsScrollRoot:n,resetTransform:s}){return class{constructor(o={},u=e?.()){this.id=AC++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,qs.totalNodes=qs.resolvedTargetDeltas=qs.recalculatedProjection=0,this.nodes.forEach(wC),this.nodes.forEach(kC),this.nodes.forEach(DC),this.nodes.forEach(RC),EC(qs)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=u?u.root||u:this,this.path=u?[...u.path,u]:[],this.parent=u,this.depth=u?u.depth+1:0;for(let d=0;d<this.path.length;d++)this.path[d].shouldResetTransform=!0;this.root===this&&(this.nodes=new vC)}addEventListener(o,u){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new yp),this.eventHandlers.get(o).add(u)}notifyListeners(o,...u){const d=this.eventHandlers.get(o);d&&d.notify(...u)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,u=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=TC(o),this.instance=o;const{layoutId:d,layout:c,visualElement:f}=this.options;if(f&&!f.current&&f.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),u&&(c||d)&&(this.isLayoutDirty=!0),r){let p;const m=()=>this.root.updateBlockedByResize=!1;r(o,()=>{this.root.updateBlockedByResize=!0,p&&p(),p=xC(m,250),vu.hasAnimatedSinceResize&&(vu.hasAnimatedSinceResize=!1,this.nodes.forEach(My))})}d&&this.root.registerSharedNode(d,this),this.options.animate!==!1&&f&&(d||c)&&this.addEventListener("didUpdate",({delta:p,hasLayoutChanged:m,hasRelativeTargetChanged:y,layout:v})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const S=this.options.transition||f.getDefaultTransition()||BC,{onLayoutAnimationStart:T,onLayoutAnimationComplete:A}=f.getProps(),L=!this.targetLayout||!lT(this.targetLayout,v)||y,w=!m&&y;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||w||m&&(L||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(p,w);const C={...hp(S,"layout"),onPlay:T,onComplete:A};(f.shouldReduceMotion||this.options.layoutRoot)&&(C.delay=0,C.type=!1),this.startAnimation(C)}else m||My(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=v})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Hr(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(OC),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let f=0;f<this.path.length;f++){const p=this.path[f];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:u,layout:d}=this.options;if(u===void 0&&!d)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Ny);return}this.isUpdating||this.nodes.forEach(PC),this.isUpdating=!1,this.nodes.forEach(_C),this.nodes.forEach(LC),this.nodes.forEach(IC),this.clearAllSnapshots();const u=performance.now();sn.delta=Ls(0,1e3/60,u-sn.timestamp),sn.timestamp=u,sn.isProcessing=!0,nf.update.process(sn),nf.preRender.process(sn),nf.render.process(sn),sn.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(CC),this.sharedNodes.forEach(NC)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,dt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){dt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let d=0;d<this.path.length;d++)this.path[d].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Mt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:u}=this.options;u&&u.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let u=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(u=!1),u&&(this.scroll={animationId:this.root.animationId,phase:o,isRoot:n(this.instance),offset:t(this.instance)})}resetTransform(){if(!s)return;const o=this.isLayoutDirty||this.shouldResetTransform,u=this.projectionDelta&&!aT(this.projectionDelta),d=this.getTransformTemplate(),c=d?d(this.latestValues,""):void 0,f=c!==this.prevTransformTemplateValue;o&&(u||Ys(this.latestValues)||f)&&(s(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const u=this.measurePageBox();let d=this.removeElementScroll(u);return o&&(d=this.removeTransform(d)),UC(d),{animationId:this.root.animationId,measuredBox:u,layoutBox:d,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return Mt();const u=o.measureViewportBox(),{scroll:d}=this.root;return d&&(ys(u.x,d.offset.x),ys(u.y,d.offset.y)),u}removeElementScroll(o){const u=Mt();Gn(u,o);for(let d=0;d<this.path.length;d++){const c=this.path[d],{scroll:f,options:p}=c;if(c!==this.root&&f&&p.layoutScroll){if(f.isRoot){Gn(u,o);const{scroll:m}=this.root;m&&(ys(u.x,-m.offset.x),ys(u.y,-m.offset.y))}ys(u.x,f.offset.x),ys(u.y,f.offset.y)}}return u}applyTransform(o,u=!1){const d=Mt();Gn(d,o);for(let c=0;c<this.path.length;c++){const f=this.path[c];!u&&f.options.layoutScroll&&f.scroll&&f!==f.root&&zi(d,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),Ys(f.latestValues)&&zi(d,f.latestValues)}return Ys(this.latestValues)&&zi(d,this.latestValues),d}removeTransform(o){const u=Mt();Gn(u,o);for(let d=0;d<this.path.length;d++){const c=this.path[d];if(!c.instance||!Ys(c.latestValues))continue;ch(c.latestValues)&&c.updateSnapshot();const f=Mt(),p=c.measurePageBox();Gn(f,p),Cy(u,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,f)}return Ys(this.latestValues)&&Cy(u,this.latestValues),u}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==sn.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var u;const d=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=d.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=d.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=d.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==d;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((u=this.parent)===null||u===void 0)&&u.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:p,layoutId:m}=this.options;if(!(!this.layout||!(p||m))){if(this.resolvedRelativeTargetAt=sn.timestamp,!this.targetDelta&&!this.relativeTarget){const y=this.getClosestProjectingParent();y&&y.layout&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Mt(),this.relativeTargetOrigin=Mt(),fa(this.relativeTargetOrigin,this.layout.layoutBox,y.layout.layoutBox),Gn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Mt(),this.targetWithTransforms=Mt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),j1(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Gn(this.target,this.layout.layoutBox),tT(this.target,this.targetDelta)):Gn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const y=this.getClosestProjectingParent();y&&!!y.resumingFrom==!!this.resumingFrom&&!y.options.layoutScroll&&y.target&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Mt(),this.relativeTargetOrigin=Mt(),fa(this.relativeTargetOrigin,this.target,y.target),Gn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}qs.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||ch(this.parent.latestValues)||eT(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const u=this.getLead(),d=!!this.resumingFrom||this!==u;let c=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(c=!1),d&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===sn.timestamp&&(c=!1),c)return;const{layout:f,layoutId:p}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(f||p))return;Gn(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,y=this.treeScale.y;q1(this.layoutCorrected,this.treeScale,this.path,d),u.layout&&!u.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(u.target=u.layout.layoutBox);const{target:v}=u;if(!v){this.projectionTransform&&(this.projectionDelta=Ki(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Ki(),this.projectionDeltaWithTransform=Ki());const S=this.projectionTransform;da(this.projectionDelta,this.layoutCorrected,v,this.latestValues),this.projectionTransform=ky(this.projectionDelta,this.treeScale),(this.projectionTransform!==S||this.treeScale.x!==m||this.treeScale.y!==y)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",v)),qs.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),o){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(o,u=!1){const d=this.snapshot,c=d?d.latestValues:{},f={...this.latestValues},p=Ki();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!u;const m=Mt(),y=d?d.source:void 0,v=this.layout?this.layout.source:void 0,S=y!==v,T=this.getStack(),A=!T||T.members.length<=1,L=!!(S&&!A&&this.options.crossfade===!0&&!this.path.some(FC));this.animationProgress=0;let w;this.mixTargetDelta=C=>{const P=C/1e3;Fy(p.x,o.x,P),Fy(p.y,o.y,P),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(fa(m,this.layout.layoutBox,this.relativeParent.layout.layoutBox),MC(this.relativeTarget,this.relativeTargetOrigin,m,P),w&&mC(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Mt()),Gn(w,this.relativeTarget)),S&&(this.animationValues=f,uC(f,c,this.latestValues,P,L,A)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=P},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Hr(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=dt.update(()=>{vu.hasAnimatedSinceResize=!0,this.currentAnimation=SC(0,Oy,{...o,onUpdate:u=>{this.mixTargetDelta(u),o.onUpdate&&o.onUpdate(u)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Oy),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:u,target:d,layout:c,latestValues:f}=o;if(!(!u||!d||!c)){if(this!==o&&this.layout&&c&&cT(this.options.animationType,this.layout.layoutBox,c.layoutBox)){d=this.target||Mt();const p=Mn(this.layout.layoutBox.x);d.x.min=o.target.x.min,d.x.max=d.x.min+p;const m=Mn(this.layout.layoutBox.y);d.y.min=o.target.y.min,d.y.max=d.y.min+m}Gn(u,d),zi(u,f),da(this.projectionDeltaWithTransform,this.layoutCorrected,u,f)}}registerSharedNode(o,u){this.sharedNodes.has(o)||this.sharedNodes.set(o,new gC),this.sharedNodes.get(o).add(u);const c=u.options.initialPromotionConfig;u.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(u):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:u}=this.options;return u?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:u}=this.options;return u?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:u,preserveFollowOpacity:d}={}){const c=this.getStack();c&&c.promote(this,d),o&&(this.projectionDelta=void 0,this.needsReset=!0),u&&this.setOptions({transition:u})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetRotation(){const{visualElement:o}=this.options;if(!o)return;let u=!1;const{latestValues:d}=o;if((d.rotate||d.rotateX||d.rotateY||d.rotateZ)&&(u=!0),!u)return;const c={};for(let f=0;f<Dy.length;f++){const p="rotate"+Dy[f];d[p]&&(c[p]=d[p],o.setStaticValue(p,0))}o.render();for(const f in c)o.setStaticValue(f,c[f]);o.scheduleRender()}getProjectionStyles(o){var u,d;if(!this.instance||this.isSVG)return;if(!this.isVisible)return bC;const c={visibility:""},f=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=yu(o?.pointerEvents)||"",c.transform=f?f(this.latestValues,""):"none",c;const p=this.getLead();if(!this.projectionDelta||!this.layout||!p.target){const S={};return this.options.layoutId&&(S.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,S.pointerEvents=yu(o?.pointerEvents)||""),this.hasProjected&&!Ys(this.latestValues)&&(S.transform=f?f({},""):"none",this.hasProjected=!1),S}const m=p.animationValues||p.latestValues;this.applyTransformsToTarget(),c.transform=ky(this.projectionDeltaWithTransform,this.treeScale,m),f&&(c.transform=f(m,c.transform));const{x:y,y:v}=this.projectionDelta;c.transformOrigin=`${y.origin*100}% ${v.origin*100}% 0`,p.animationValues?c.opacity=p===this?(d=(u=m.opacity)!==null&&u!==void 0?u:this.latestValues.opacity)!==null&&d!==void 0?d:1:this.preserveOpacity?this.latestValues.opacity:m.opacityExit:c.opacity=p===this?m.opacity!==void 0?m.opacity:"":m.opacityExit!==void 0?m.opacityExit:0;for(const S in _u){if(m[S]===void 0)continue;const{correct:T,applyTo:A}=_u[S],L=c.transform==="none"?m[S]:T(m[S],p);if(A){const w=A.length;for(let C=0;C<w;C++)c[A[C]]=L}else c[S]=L}return this.options.layoutId&&(c.pointerEvents=p===this?yu(o?.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var u;return(u=o.currentAnimation)===null||u===void 0?void 0:u.stop()}),this.root.nodes.forEach(Ny),this.root.sharedNodes.clear()}}}function LC(r){r.updateLayout()}function IC(r){var e;const t=((e=r.resumeFrom)===null||e===void 0?void 0:e.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&t&&r.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:s}=r.layout,{animationType:i}=r.options,o=t.source!==r.layout.source;i==="size"?Hn(p=>{const m=o?t.measuredBox[p]:t.layoutBox[p],y=Mn(m);m.min=n[p].min,m.max=m.min+y}):cT(i,t.layoutBox,n)&&Hn(p=>{const m=o?t.measuredBox[p]:t.layoutBox[p],y=Mn(n[p]);m.max=m.min+y,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[p].max=r.relativeTarget[p].min+y)});const u=Ki();da(u,n,t.layoutBox);const d=Ki();o?da(d,r.applyTransform(s,!0),t.measuredBox):da(d,n,t.layoutBox);const c=!aT(u);let f=!1;if(!r.resumeFrom){const p=r.getClosestProjectingParent();if(p&&!p.resumeFrom){const{snapshot:m,layout:y}=p;if(m&&y){const v=Mt();fa(v,t.layoutBox,m.layoutBox);const S=Mt();fa(S,n,y.layoutBox),lT(v,S)||(f=!0),p.options.layoutRoot&&(r.relativeTarget=S,r.relativeTargetOrigin=v,r.relativeParent=p)}}}r.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:d,layoutDelta:u,hasLayoutChanged:c,hasRelativeTargetChanged:f})}else if(r.isLead()){const{onExitComplete:n}=r.options;n&&n()}r.options.transition=void 0}function wC(r){qs.totalNodes++,r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function RC(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function CC(r){r.clearSnapshot()}function Ny(r){r.clearMeasurements()}function PC(r){r.isLayoutDirty=!1}function _C(r){const{visualElement:e}=r.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),r.resetTransform()}function My(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function kC(r){r.resolveTargetDelta()}function DC(r){r.calcProjection()}function OC(r){r.resetRotation()}function NC(r){r.removeLeadSnapshot()}function Fy(r,e,t){r.translate=At(e.translate,0,t),r.scale=At(e.scale,1,t),r.origin=e.origin,r.originPoint=e.originPoint}function By(r,e,t,n){r.min=At(e.min,t.min,n),r.max=At(e.max,t.max,n)}function MC(r,e,t,n){By(r.x,e.x,t.x,n),By(r.y,e.y,t.y,n)}function FC(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const BC={duration:.45,ease:[.4,0,.1,1]},Uy=r=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(r),jy=Uy("applewebkit/")&&!Uy("chrome/")?Math.round:kt;function $y(r){r.min=jy(r.min),r.max=jy(r.max)}function UC(r){$y(r.x),$y(r.y)}function cT(r,e,t){return r==="position"||r==="preserve-aspect"&&!lh(_y(e),_y(t),.2)}const jC=uT({attachResizeListener:(r,e)=>jr(r,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),pf={current:void 0},dT=uT({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!pf.current){const r=new jC({});r.mount(window),r.setOptions({layoutScroll:!0}),pf.current=r}return pf.current},resetTransform:(r,e)=>{r.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),$C={pan:{Feature:rC},drag:{Feature:nC,ProjectionNode:dT,MeasureLayout:sT}},VC=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function GC(r){const e=VC.exec(r);if(!e)return[,];const[,t,n]=e;return[t,n]}function fh(r,e,t=1){const[n,s]=GC(r);if(!n)return;const i=window.getComputedStyle(e).getPropertyValue(n);if(i){const o=i.trim();return WE(o)?parseFloat(o):o}else return th(s)?fh(s,e,t+1):s}function HC(r,{...e},t){const n=r.current;if(!(n instanceof Element))return{target:e,transitionEnd:t};t&&(t={...t}),r.values.forEach(s=>{const i=s.get();if(!th(i))return;const o=fh(i,n);o&&s.set(o)});for(const s in e){const i=e[s];if(!th(i))continue;const o=fh(i,n);o&&(e[s]=o,t||(t={}),t[s]===void 0&&(t[s]=i))}return{target:e,transitionEnd:t}}const KC=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),fT=r=>KC.has(r),zC=r=>Object.keys(r).some(fT),Vy=r=>r===ci||r===De,Gy=(r,e)=>parseFloat(r.split(", ")[e]),Hy=(r,e)=>(t,{transform:n})=>{if(n==="none"||!n)return 0;const s=n.match(/^matrix3d\((.+)\)$/);if(s)return Gy(s[1],e);{const i=n.match(/^matrix\((.+)\)$/);return i?Gy(i[1],r):0}},WC=new Set(["x","y","z"]),YC=Oa.filter(r=>!WC.has(r));function qC(r){const e=[];return YC.forEach(t=>{const n=r.getValue(t);n!==void 0&&(e.push([t,n.get()]),n.set(t.startsWith("scale")?1:0))}),e.length&&r.render(),e}const lo={width:({x:r},{paddingLeft:e="0",paddingRight:t="0"})=>r.max-r.min-parseFloat(e)-parseFloat(t),height:({y:r},{paddingTop:e="0",paddingBottom:t="0"})=>r.max-r.min-parseFloat(e)-parseFloat(t),top:(r,{top:e})=>parseFloat(e),left:(r,{left:e})=>parseFloat(e),bottom:({y:r},{top:e})=>parseFloat(e)+(r.max-r.min),right:({x:r},{left:e})=>parseFloat(e)+(r.max-r.min),x:Hy(4,13),y:Hy(5,14)};lo.translateX=lo.x;lo.translateY=lo.y;const XC=(r,e,t)=>{const n=e.measureViewportBox(),s=e.current,i=getComputedStyle(s),{display:o}=i,u={};o==="none"&&e.setStaticValue("display",r.display||"block"),t.forEach(c=>{u[c]=lo[c](n,i)}),e.render();const d=e.measureViewportBox();return t.forEach(c=>{const f=e.getValue(c);f&&f.jump(u[c]),r[c]=lo[c](d,i)}),r},QC=(r,e,t={},n={})=>{e={...e},n={...n};const s=Object.keys(e).filter(fT);let i=[],o=!1;const u=[];if(s.forEach(d=>{const c=r.getValue(d);if(!r.hasValue(d))return;let f=t[d],p=ea(f);const m=e[d];let y;if(Du(m)){const v=m.length,S=m[0]===null?1:0;f=m[S],p=ea(f);for(let T=S;T<v&&m[T]!==null;T++)y?lp(ea(m[T])===y):y=ea(m[T])}else y=ea(m);if(p!==y)if(Vy(p)&&Vy(y)){const v=c.get();typeof v=="string"&&c.set(parseFloat(v)),typeof m=="string"?e[d]=parseFloat(m):Array.isArray(m)&&y===De&&(e[d]=m.map(parseFloat))}else p?.transform&&y?.transform&&(f===0||m===0)?f===0?c.set(y.transform(f)):e[d]=p.transform(m):(o||(i=qC(r),o=!0),u.push(d),n[d]=n[d]!==void 0?n[d]:e[d],c.jump(m))}),u.length){const d=u.indexOf("height")>=0?window.pageYOffset:null,c=XC(e,r,u);return i.length&&i.forEach(([f,p])=>{r.getValue(f).set(p)}),r.render(),rc&&d!==null&&window.scrollTo({top:d}),{target:c,transitionEnd:n}}else return{target:e,transitionEnd:n}};function ZC(r,e,t,n){return zC(e)?QC(r,e,t,n):{target:e,transitionEnd:n}}const JC=(r,e,t,n)=>{const s=HC(r,e,n);return e=s.target,n=s.transitionEnd,ZC(r,e,t,n)},hh={current:null},hT={current:!1};function eP(){if(hT.current=!0,!!rc)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),e=()=>hh.current=r.matches;r.addListener(e),e()}else hh.current=!1}function tP(r,e,t){const{willChange:n}=e;for(const s in e){const i=e[s],o=t[s];if(An(i))r.addValue(s,i),Fu(n)&&n.add(s);else if(An(o))r.addValue(s,ao(i,{owner:r})),Fu(n)&&n.remove(s);else if(o!==i)if(r.hasValue(s)){const u=r.getValue(s);!u.hasAnimated&&u.set(i)}else{const u=r.getStaticValue(s);r.addValue(s,ao(u!==void 0?u:i,{owner:r}))}}for(const s in t)e[s]===void 0&&r.removeValue(s);return e}const Ky=new WeakMap,pT=Object.keys(Ta),nP=pT.length,zy=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],rP=Jh.length;class sP{constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:s,visualState:i},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>dt.render(this.render,!1,!0);const{latestValues:u,renderState:d}=i;this.latestValues=u,this.baseTarget={...u},this.initialValues=t.initial?{...u}:{},this.renderState=d,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=o,this.isControllingVariants=ic(t),this.isVariantNode=Zx(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:c,...f}=this.scrapeMotionValuesFromProps(t,{});for(const p in f){const m=f[p];u[p]!==void 0&&An(m)&&(m.set(u[p],!1),Fu(c)&&c.add(p))}}scrapeMotionValuesFromProps(e,t){return{}}mount(e){this.current=e,Ky.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,n)=>this.bindToMotionValue(n,t)),hT.current||eP(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:hh.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Ky.delete(this.current),this.projection&&this.projection.unmount(),Hr(this.notifyUpdate),Hr(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,t){const n=ui.has(e),s=t.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&dt.update(this.notifyUpdate,!1,!0),n&&this.projection&&(this.projection.isTransformDirty=!0)}),i=t.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{s(),i()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...t},n,s,i){let o,u;for(let d=0;d<nP;d++){const c=pT[d],{isEnabled:f,Feature:p,ProjectionNode:m,MeasureLayout:y}=Ta[c];m&&(o=m),f(t)&&(!this.features[c]&&p&&(this.features[c]=new p(this)),y&&(u=y))}if((this.type==="html"||this.type==="svg")&&!this.projection&&o){this.projection=new o(this.latestValues,this.parent&&this.parent.projection);const{layoutId:d,layout:c,drag:f,dragConstraints:p,layoutScroll:m,layoutRoot:y}=t;this.projection.setOptions({layoutId:d,layout:c,alwaysMeasureLayout:!!f||p&&Gi(p),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof c=="string"?c:"both",initialPromotionConfig:i,layoutScroll:m,layoutRoot:y})}return u}updateFeatures(){for(const e in this.features){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Mt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}makeTargetAnimatable(e,t=!0){return this.makeTargetAnimatableFromInstance(e,this.props,t)}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<zy.length;n++){const s=zy[n];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const i=e["on"+s];i&&(this.propEventSubscriptions[s]=this.on(s,i))}this.prevMotionValues=tP(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const n=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(n.initial=this.props.initial),n}const t={};for(let n=0;n<rP;n++){const s=Jh[n],i=this.props[s];(Ea(i)||i===!1)&&(t[s]=i)}return t}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){t!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,t)),this.values.set(e,t),this.latestValues[e]=t.get()}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&t!==void 0&&(n=ao(t,{owner:this}),this.addValue(e,n)),n}readValue(e){var t;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(t=this.getBaseTargetFromProps(this.props,e))!==null&&t!==void 0?t:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:n}=this.props,s=typeof n=="string"||typeof n=="object"?(t=ap(this.props,n))===null||t===void 0?void 0:t[e]:void 0;if(n&&s!==void 0)return s;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!An(i)?i:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new yp),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class mT extends sP{sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:t,...n},{transformValues:s},i){let o=T1(n,e||{},this);if(s&&(t&&(t=s(t)),n&&(n=s(n)),o&&(o=s(o))),i){x1(this,n,o);const u=JC(this,n,o,t);t=u.transitionEnd,n=u.target}return{transition:e,transitionEnd:t,...n}}}function iP(r){return window.getComputedStyle(r)}class oP extends mT{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,t){if(ui.has(t)){const n=fp(t);return n&&n.default||0}else{const n=iP(e),s=(nE(t)?n.getPropertyValue(t):n[t])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(e,{transformPagePoint:t}){return nT(e,t)}build(e,t,n,s){np(e,t,n,s.transformTemplate)}scrapeMotionValuesFromProps(e,t){return op(e,t)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;An(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}renderInstance(e,t,n,s){lE(e,t,n,s)}}class aP extends mT{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(ui.has(t)){const n=fp(t);return n&&n.default||0}return t=uE.has(t)?t:Qh(t),e.getAttribute(t)}measureInstanceViewportBox(){return Mt()}scrapeMotionValuesFromProps(e,t){return dE(e,t)}build(e,t,n,s){sp(e,t,n,this.isSVGTag,s.transformTemplate)}renderInstance(e,t,n,s){cE(e,t,n,s)}mount(e){this.isSVGTag=ip(e.tagName),super.mount(e)}}const lP=(r,e)=>tp(r)?new aP(e,{enableHardwareAcceleration:!1}):new oP(e,{enableHardwareAcceleration:!0}),uP={layout:{ProjectionNode:dT,MeasureLayout:sT}},cP={...M1,...nR,...$C,...uP},$r=dw((r,e)=>Gw(r,e,cP,lP));function gT(){const r=_.useRef(!1);return Xh(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function dP(){const r=gT(),[e,t]=_.useState(0),n=_.useCallback(()=>{r.current&&t(e+1)},[e]);return[_.useCallback(()=>dt.postRender(n),[n]),e]}class fP extends _.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function hP({children:r,isPresent:e}){const t=_.useId(),n=_.useRef(null),s=_.useRef({width:0,height:0,top:0,left:0});return _.useInsertionEffect(()=>{const{width:i,height:o,top:u,left:d}=s.current;if(e||!n.current||!i||!o)return;n.current.dataset.motionPopId=t;const c=document.createElement("style");return document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${o}px !important;
            top: ${u}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[e]),_.createElement(fP,{isPresent:e,childRef:n,sizeRef:s},_.cloneElement(r,{ref:n}))}const mf=({children:r,initial:e,isPresent:t,onExitComplete:n,custom:s,presenceAffectsLayout:i,mode:o})=>{const u=fE(pP),d=_.useId(),c=_.useMemo(()=>({id:d,initial:e,isPresent:t,custom:s,onExitComplete:f=>{u.set(f,!0);for(const p of u.values())if(!p)return;n&&n()},register:f=>(u.set(f,!1),()=>u.delete(f))}),i?void 0:[t]);return _.useMemo(()=>{u.forEach((f,p)=>u.set(p,!1))},[t]),_.useEffect(()=>{!t&&!u.size&&n&&n()},[t]),o==="popLayout"&&(r=_.createElement(hP,{isPresent:t},r)),_.createElement(nc.Provider,{value:c},r)};function pP(){return new Map}function mP(r){return _.useEffect(()=>()=>r(),[])}const Xs=r=>r.key||"";function gP(r,e){r.forEach(t=>{const n=Xs(t);e.set(n,t)})}function yP(r){const e=[];return _.Children.forEach(r,t=>{_.isValidElement(t)&&e.push(t)}),e}const ba=({children:r,custom:e,initial:t=!0,onExitComplete:n,exitBeforeEnter:s,presenceAffectsLayout:i=!0,mode:o="sync"})=>{const u=_.useContext(ep).forceRender||dP()[0],d=gT(),c=yP(r);let f=c;const p=_.useRef(new Map).current,m=_.useRef(f),y=_.useRef(new Map).current,v=_.useRef(!0);if(Xh(()=>{v.current=!1,gP(c,y),m.current=f}),mP(()=>{v.current=!0,y.clear(),p.clear()}),v.current)return _.createElement(_.Fragment,null,f.map(L=>_.createElement(mf,{key:Xs(L),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:i,mode:o},L)));f=[...f];const S=m.current.map(Xs),T=c.map(Xs),A=S.length;for(let L=0;L<A;L++){const w=S[L];T.indexOf(w)===-1&&!p.has(w)&&p.set(w,void 0)}return o==="wait"&&p.size&&(f=[]),p.forEach((L,w)=>{if(T.indexOf(w)!==-1)return;const C=y.get(w);if(!C)return;const P=S.indexOf(w);let B=L;if(!B){const D=()=>{p.delete(w);const N=Array.from(y.keys()).filter(F=>!T.includes(F));if(N.forEach(F=>y.delete(F)),m.current=c.filter(F=>{const O=Xs(F);return O===w||N.includes(O)}),!p.size){if(d.current===!1)return;u(),n&&n()}};B=_.createElement(mf,{key:Xs(C),isPresent:!1,onExitComplete:D,custom:e,presenceAffectsLayout:i,mode:o},C),p.set(w,B)}f.splice(P,0,B)}),f=f.map(L=>{const w=L.key;return p.has(w)?L:_.createElement(mf,{key:Xs(L),isPresent:!0,presenceAffectsLayout:i,mode:o},L)}),_.createElement(_.Fragment,null,p.size?f:f.map(L=>_.cloneElement(L)))};var vP={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const xP=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),It=(r,e)=>{const t=_.forwardRef(({color:n="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:u,...d},c)=>_.createElement("svg",{ref:c,...vP,width:s,height:s,stroke:n,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${xP(r)}`,...d},[...e.map(([f,p])=>_.createElement(f,p)),...(Array.isArray(u)?u:[u])||[]]));return t.displayName=`${r}`,t},po=It("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),EP=It("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),yT=It("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),vT=It("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),xT=It("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),TP=It("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]),SP=It("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]),bP=It("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]),AP=It("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),LP=It("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Wy=It("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),IP=It("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Yy=It("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Uu=It("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),wP=It("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),qy=It("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),RP=It("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),CP=It("Twitch",[["path",{d:"M21 2H3v16h5v4l4-4h5l4-4V2zm-10 9V7m5 4V7",key:"c0yzno"}]]),PP=It("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]),Xy=It("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),_P=It("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),vp=It("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),kP=It("Youtube",[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]]),nt=({children:r,...e})=>x.jsx("button",{...e,children:r}),ET=()=>{const[r,e]=_.useState(localStorage.getItem("theme")||"light");return _.useEffect(()=>{const n=window.document.documentElement;n.classList.remove("light","dark"),n.classList.add(r),localStorage.setItem("theme",r)},[r]),{theme:r,toggleTheme:()=>{e(r==="light"?"dark":"light")}}},DP=({cartCount:r,user:e,onLogout:t})=>{const[n,s]=_.useState(!1),{theme:i,toggleTheme:o}=ET(),u=({isActive:c})=>`relative text-sm font-medium transition-colors px-3 py-2 rounded-md ${c?"text-primary":"text-foreground/70 hover:text-foreground"}`,d=({isActive:c})=>`block px-3 py-2 rounded-md text-base font-medium transition-colors ${c?"bg-muted text-primary":"hover:bg-muted hover:text-foreground"}`;return x.jsxs("header",{className:"fixed top-0 left-0 right-0 z-50 bg-background/80 backdrop-blur-lg border-b",children:[x.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:x.jsxs("div",{className:"flex justify-between h-20 items-center",children:[x.jsx("div",{className:"flex-shrink-0 flex items-center",children:x.jsxs(ct,{to:"/",className:"flex items-center text-xl font-bold text-primary",children:[x.jsx("img",{src:"https://horizons-cdn.hostinger.com/fcc80be5-d307-4647-b2f4-869061a50bf6/1000144452-oAdSC.png",alt:"SimpleMarket360 Logo",className:"h-10 w-auto mr-2"}),x.jsx("span",{className:"sr-only",children:"SimpleMarket360"})]})}),x.jsx("div",{className:"hidden lg:flex flex-grow justify-center mx-4",children:x.jsxs("div",{className:"relative w-full max-w-lg",children:[x.jsx(Yy,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),x.jsx("input",{type:"text",placeholder:"Buscar productos, vendedores...",className:"w-full pl-12 pr-4 py-2.5 rounded-full border bg-muted/50 text-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:bg-background transition-all"})]})}),x.jsxs("nav",{className:"hidden lg:flex space-x-2 items-center",children:[x.jsx(fs,{to:"/",className:u,children:"Inicio"}),x.jsx(fs,{to:"/categories",className:u,children:"Categorías"}),x.jsx(fs,{to:"/sellers",className:u,children:"Vendedores"}),x.jsx(fs,{to:"/offers",className:u,children:"Ofertas"}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("button",{onClick:o,className:"p-2 rounded-full hover:bg-muted transition-colors",children:x.jsx(ba,{mode:"wait",children:x.jsx($r.div,{initial:{opacity:0,rotate:-30},animate:{opacity:1,rotate:0},exit:{opacity:0,rotate:30},transition:{duration:.2},children:i==="light"?x.jsx(Wy,{size:20}):x.jsx(qy,{size:20})},i)})}),x.jsxs(ct,{to:"/cart","aria-label":"Carrito",className:"relative p-2 rounded-full hover:bg-muted transition-colors",children:[x.jsx(Uu,{className:"h-5 w-5"}),r>0&&x.jsx("span",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground text-xs font-bold rounded-full h-4 w-4 flex items-center justify-center",children:r})]}),e?x.jsxs("div",{className:"relative group",children:[x.jsx(ct,{to:"/user",children:x.jsxs(nt,{variant:"ghost",size:"sm",className:"flex items-center gap-2",children:[x.jsx("img",{src:e.avatar,alt:"Avatar",className:"w-6 h-6 rounded-full"}),e.name]})}),x.jsxs("div",{className:"absolute top-full right-0 mt-2 w-48 bg-card rounded-md shadow-lg py-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[x.jsx(ct,{to:"/user",className:"block px-4 py-2 text-sm text-foreground/80 hover:bg-muted",children:"Mi Panel"}),x.jsx("button",{onClick:t,className:"w-full text-left block px-4 py-2 text-sm text-red-500 hover:bg-muted",children:"Cerrar Sesión"})]})]}):x.jsx(ct,{to:"/user",children:x.jsxs(nt,{size:"sm",className:"flex items-center gap-2",children:[x.jsx(Xy,{size:16}),"Login"]})})]})]}),x.jsxs("div",{className:"lg:hidden flex items-center",children:[x.jsx("button",{onClick:o,className:"p-2 rounded-full hover:bg-muted",children:i==="light"?x.jsx(Wy,{size:20}):x.jsx(qy,{size:20})}),x.jsxs(ct,{to:"/cart","aria-label":"Carrito",className:"relative p-2 rounded-full hover:bg-muted",children:[x.jsx(Uu,{className:"h-5 w-5"}),r>0&&x.jsx("span",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground text-xs font-bold rounded-full h-4 w-4 flex items-center justify-center",children:r})]}),x.jsx("button",{onClick:()=>s(!n),className:"p-2 rounded-md","aria-controls":"mobile-menu","aria-expanded":n,children:n?x.jsx(vp,{size:24}):x.jsx(AP,{size:24})})]})]})}),x.jsx(ba,{children:n&&x.jsxs($r.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"lg:hidden overflow-hidden bg-background",children:[x.jsxs("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3",children:[x.jsx(fs,{to:"/",className:d,onClick:()=>s(!1),children:"Inicio"}),x.jsx(fs,{to:"/categories",className:d,onClick:()=>s(!1),children:"Categorías"}),x.jsx(fs,{to:"/sellers",className:d,onClick:()=>s(!1),children:"Vendedores"}),x.jsx(fs,{to:"/offers",className:d,onClick:()=>s(!1),children:"Ofertas"}),x.jsx("div",{className:"border-t mt-4 pt-4",children:e?x.jsxs("div",{children:[x.jsxs(ct,{to:"/user",className:"w-full flex items-center gap-3 px-3 py-2",onClick:()=>s(!1),children:[x.jsx("img",{src:e.avatar,alt:"Avatar",className:"w-8 h-8 rounded-full"}),x.jsx("span",{className:"font-medium",children:e.name})]}),x.jsx("button",{onClick:()=>{t(),s(!1)},className:"w-full text-left block px-3 py-2 rounded-md text-base font-medium text-red-500 hover:bg-muted",children:"Cerrar Sesión"})]}):x.jsx(ct,{to:"/user",className:"w-full block",onClick:()=>s(!1),children:x.jsxs(nt,{className:"w-full mt-2 flex items-center gap-2",children:[x.jsx(Xy,{size:16}),"Login / Registro"]})})})]}),x.jsx("div",{className:"p-4 border-t",children:x.jsxs("div",{className:"relative w-full",children:[x.jsx(Yy,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:18}),x.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full pl-10 pr-4 py-2 rounded-md border bg-muted"})]})})]})})]})},OP=()=>{const r=[{name:"Términos y Condiciones",path:"/legal?section=terms"},{name:"Política de Privacidad",path:"/legal?section=privacy"},{name:"Política de Devoluciones",path:"/legal?section=returns"}],e=[{name:"Sobre Nosotros",path:"/about"},{name:"Contacto",path:"/contact"},{name:"Blog",path:"/blog"},{name:"Vende en SimpleMarket360",path:"/user"}],t=[{name:"Electrónica",path:"/categories#electronics"},{name:"Moda",path:"/categories#fashion"},{name:"Hogar",path:"/categories#home"},{name:"Deportes",path:"/categories#sports"}],n=[{name:"Facebook",url:"#",icon:x.jsx(TP,{size:20})},{name:"Instagram",url:"#",icon:x.jsx(SP,{size:20})},{name:"Twitter",url:"#",icon:x.jsx(PP,{size:20})},{name:"Youtube",url:"#",icon:x.jsx(kP,{size:20})},{name:"Twitch",url:"#",icon:x.jsx(CP,{size:20})}];return x.jsx("footer",{className:"bg-background/80 border-t backdrop-blur-sm mt-24",children:x.jsxs("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[x.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8",children:[x.jsxs("div",{className:"col-span-2 lg:col-span-1 space-y-8",children:[x.jsx("img",{src:"https://horizons-cdn.hostinger.com/fcc80be5-d307-4647-b2f4-869061a50bf6/1000144452-oAdSC.png",alt:"SimpleMarket360 Logo",className:"h-10"}),x.jsx("p",{className:"text-muted-foreground text-base",children:"Tu marketplace para comprar y vender de todo, de forma fácil y segura."}),x.jsx("div",{className:"flex space-x-4",children:n.map(s=>x.jsxs("a",{href:s.url,className:"text-muted-foreground transition-colors hover:text-primary",children:[x.jsx("span",{className:"sr-only",children:s.name}),s.icon]},s.name))})]}),x.jsxs("div",{children:[x.jsx("h3",{className:"text-sm font-semibold text-foreground tracking-wider uppercase",children:"Categorías"}),x.jsx("ul",{className:"mt-4 space-y-3",children:t.map(s=>x.jsx("li",{children:x.jsx(ct,{to:s.path,className:"text-base text-muted-foreground transition-colors hover:text-primary",children:s.name})},s.name))})]}),x.jsxs("div",{children:[x.jsx("h3",{className:"text-sm font-semibold text-foreground tracking-wider uppercase",children:"Nosotros"}),x.jsx("ul",{className:"mt-4 space-y-3",children:e.map(s=>x.jsx("li",{children:x.jsx(ct,{to:s.path,className:"text-base text-muted-foreground transition-colors hover:text-primary",children:s.name})},s.name))})]}),x.jsxs("div",{children:[x.jsx("h3",{className:"text-sm font-semibold text-foreground tracking-wider uppercase",children:"Legal"}),x.jsx("ul",{className:"mt-4 space-y-3",children:r.map(s=>x.jsx("li",{children:x.jsx(ct,{to:s.path,className:"text-base text-muted-foreground transition-colors hover:text-primary",children:s.name})},s.name))})]}),x.jsxs("div",{className:"col-span-2 md:col-span-4 lg:col-span-1",children:[x.jsx("h3",{className:"text-sm font-semibold text-foreground tracking-wider uppercase",children:"Newsletter"}),x.jsx("p",{className:"text-muted-foreground mt-4 text-base",children:"Recibe las mejores ofertas y novedades directamente en tu email."}),x.jsxs("form",{className:"mt-4 sm:flex sm:max-w-md",children:[x.jsx("label",{htmlFor:"email-address",className:"sr-only",children:"Email"}),x.jsx("input",{type:"email",name:"email-address",id:"email-address",autoComplete:"email",required:!0,className:"appearance-none min-w-0 w-full bg-background border border-border rounded-md py-2 px-4 text-base text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background focus:ring-primary",placeholder:"Tu email"}),x.jsx("div",{className:"mt-3 rounded-md sm:mt-0 sm:ml-3 sm:flex-shrink-0",children:x.jsx(nt,{type:"submit",className:"w-full transition-transform transform hover:scale-105",children:"Suscribirme"})})]})]})]}),x.jsx("div",{className:"mt-12 border-t pt-8",children:x.jsxs("p",{className:"text-base text-muted-foreground xl:text-center",children:["© ",new Date().getFullYear()," SimpleMarket360. Todos los derechos reservados."]})})]})})};function On(r,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(r?.(s),t===!1||!s.defaultPrevented)return e?.(s)}}function Qy(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function TT(...r){return e=>{let t=!1;const n=r.map(s=>{const i=Qy(s,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let s=0;s<n.length;s++){const i=n[s];typeof i=="function"?i():Qy(r[s],null)}}}}function ii(...r){return _.useCallback(TT(...r),r)}function ST(r,e=[]){let t=[];function n(i,o){const u=_.createContext(o),d=t.length;t=[...t,o];const c=p=>{const{scope:m,children:y,...v}=p,S=m?.[r]?.[d]||u,T=_.useMemo(()=>v,Object.values(v));return x.jsx(S.Provider,{value:T,children:y})};c.displayName=i+"Provider";function f(p,m){const y=m?.[r]?.[d]||u,v=_.useContext(y);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${p}\` must be used within \`${i}\``)}return[c,f]}const s=()=>{const i=t.map(o=>_.createContext(o));return function(u){const d=u?.[r]||i;return _.useMemo(()=>({[`__scope${r}`]:{...u,[r]:d}}),[u,d])}};return s.scopeName=r,[n,NP(s,...e)]}function NP(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const n=r.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(i){const o=n.reduce((u,{useScope:d,scopeName:c})=>{const p=d(i)[`__scope${c}`];return{...u,...p}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function ph(r){const e=MP(r),t=_.forwardRef((n,s)=>{const{children:i,...o}=n,u=_.Children.toArray(i),d=u.find(BP);if(d){const c=d.props.children,f=u.map(p=>p===d?_.Children.count(c)>1?_.Children.only(null):_.isValidElement(c)?c.props.children:null:p);return x.jsx(e,{...o,ref:s,children:_.isValidElement(c)?_.cloneElement(c,void 0,f):null})}return x.jsx(e,{...o,ref:s,children:i})});return t.displayName=`${r}.Slot`,t}function MP(r){const e=_.forwardRef((t,n)=>{const{children:s,...i}=t;if(_.isValidElement(s)){const o=jP(s),u=UP(i,s.props);return s.type!==_.Fragment&&(u.ref=n?TT(n,o):o),_.cloneElement(s,u)}return _.Children.count(s)>1?_.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var FP=Symbol("radix.slottable");function BP(r){return _.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===FP}function UP(r,e){const t={...e};for(const n in e){const s=r[n],i=e[n];/^on[A-Z]/.test(n)?s&&i?t[n]=(...u)=>{const d=i(...u);return s(...u),d}:s&&(t[n]=s):n==="style"?t[n]={...s,...i}:n==="className"&&(t[n]=[s,i].filter(Boolean).join(" "))}return{...r,...t}}function jP(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}function $P(r){const e=r+"CollectionProvider",[t,n]=ST(e),[s,i]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=S=>{const{scope:T,children:A}=S,L=on.useRef(null),w=on.useRef(new Map).current;return x.jsx(s,{scope:T,itemMap:w,collectionRef:L,children:A})};o.displayName=e;const u=r+"CollectionSlot",d=ph(u),c=on.forwardRef((S,T)=>{const{scope:A,children:L}=S,w=i(u,A),C=ii(T,w.collectionRef);return x.jsx(d,{ref:C,children:L})});c.displayName=u;const f=r+"CollectionItemSlot",p="data-radix-collection-item",m=ph(f),y=on.forwardRef((S,T)=>{const{scope:A,children:L,...w}=S,C=on.useRef(null),P=ii(T,C),B=i(f,A);return on.useEffect(()=>(B.itemMap.set(C,{ref:C,...w}),()=>void B.itemMap.delete(C))),x.jsx(m,{[p]:"",ref:P,children:L})});y.displayName=f;function v(S){const T=i(r+"CollectionConsumer",S);return on.useCallback(()=>{const L=T.collectionRef.current;if(!L)return[];const w=Array.from(L.querySelectorAll(`[${p}]`));return Array.from(T.itemMap.values()).sort((B,D)=>w.indexOf(B.ref.current)-w.indexOf(D.ref.current))},[T.collectionRef,T.itemMap])}return[{Provider:o,Slot:c,ItemSlot:y},v,n]}var VP=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Tr=VP.reduce((r,e)=>{const t=ph(`Primitive.${e}`),n=_.forwardRef((s,i)=>{const{asChild:o,...u}=s,d=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),x.jsx(d,{...u,ref:i})});return n.displayName=`Primitive.${e}`,{...r,[e]:n}},{});function bT(r,e){r&&zh.flushSync(()=>r.dispatchEvent(e))}function oi(r){const e=_.useRef(r);return _.useEffect(()=>{e.current=r}),_.useMemo(()=>(...t)=>e.current?.(...t),[])}function GP(r,e=globalThis?.document){const t=oi(r);_.useEffect(()=>{const n=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[t,e])}var HP="DismissableLayer",mh="dismissableLayer.update",KP="dismissableLayer.pointerDownOutside",zP="dismissableLayer.focusOutside",Zy,AT=_.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),LT=_.forwardRef((r,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:o,onDismiss:u,...d}=r,c=_.useContext(AT),[f,p]=_.useState(null),m=f?.ownerDocument??globalThis?.document,[,y]=_.useState({}),v=ii(e,D=>p(D)),S=Array.from(c.layers),[T]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),A=S.indexOf(T),L=f?S.indexOf(f):-1,w=c.layersWithOutsidePointerEventsDisabled.size>0,C=L>=A,P=YP(D=>{const N=D.target,F=[...c.branches].some(O=>O.contains(N));!C||F||(s?.(D),o?.(D),D.defaultPrevented||u?.())},m),B=qP(D=>{const N=D.target;[...c.branches].some(O=>O.contains(N))||(i?.(D),o?.(D),D.defaultPrevented||u?.())},m);return GP(D=>{L===c.layers.size-1&&(n?.(D),!D.defaultPrevented&&u&&(D.preventDefault(),u()))},m),_.useEffect(()=>{if(f)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Zy=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(f)),c.layers.add(f),Jy(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=Zy)}},[f,m,t,c]),_.useEffect(()=>()=>{f&&(c.layers.delete(f),c.layersWithOutsidePointerEventsDisabled.delete(f),Jy())},[f,c]),_.useEffect(()=>{const D=()=>y({});return document.addEventListener(mh,D),()=>document.removeEventListener(mh,D)},[]),x.jsx(Tr.div,{...d,ref:v,style:{pointerEvents:w?C?"auto":"none":void 0,...r.style},onFocusCapture:On(r.onFocusCapture,B.onFocusCapture),onBlurCapture:On(r.onBlurCapture,B.onBlurCapture),onPointerDownCapture:On(r.onPointerDownCapture,P.onPointerDownCapture)})});LT.displayName=HP;var WP="DismissableLayerBranch",IT=_.forwardRef((r,e)=>{const t=_.useContext(AT),n=_.useRef(null),s=ii(e,n);return _.useEffect(()=>{const i=n.current;if(i)return t.branches.add(i),()=>{t.branches.delete(i)}},[t.branches]),x.jsx(Tr.div,{...r,ref:s})});IT.displayName=WP;function YP(r,e=globalThis?.document){const t=oi(r),n=_.useRef(!1),s=_.useRef(()=>{});return _.useEffect(()=>{const i=u=>{if(u.target&&!n.current){let d=function(){wT(KP,t,c,{discrete:!0})};const c={originalEvent:u};u.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=d,e.addEventListener("click",s.current,{once:!0})):d()}else e.removeEventListener("click",s.current);n.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",i),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function qP(r,e=globalThis?.document){const t=oi(r),n=_.useRef(!1);return _.useEffect(()=>{const s=i=>{i.target&&!n.current&&wT(zP,t,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function Jy(){const r=new CustomEvent(mh);document.dispatchEvent(r)}function wT(r,e,t,{discrete:n}){const s=t.originalEvent.target,i=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),n?bT(s,i):s.dispatchEvent(i)}var XP=LT,QP=IT,Aa=globalThis?.document?_.useLayoutEffect:()=>{},ZP="Portal",RT=_.forwardRef((r,e)=>{const{container:t,...n}=r,[s,i]=_.useState(!1);Aa(()=>i(!0),[]);const o=t||s&&globalThis?.document?.body;return o?QL.createPortal(x.jsx(Tr.div,{...n,ref:e}),o):null});RT.displayName=ZP;function JP(r,e){return _.useReducer((t,n)=>e[t][n]??t,r)}var CT=r=>{const{present:e,children:t}=r,n=e_(e),s=typeof t=="function"?t({present:n.isPresent}):_.Children.only(t),i=ii(n.ref,t_(s));return typeof t=="function"||n.isPresent?_.cloneElement(s,{ref:i}):null};CT.displayName="Presence";function e_(r){const[e,t]=_.useState(),n=_.useRef(null),s=_.useRef(r),i=_.useRef("none"),o=r?"mounted":"unmounted",[u,d]=JP(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect(()=>{const c=Ql(n.current);i.current=u==="mounted"?c:"none"},[u]),Aa(()=>{const c=n.current,f=s.current;if(f!==r){const m=i.current,y=Ql(c);r?d("MOUNT"):y==="none"||c?.display==="none"?d("UNMOUNT"):d(f&&m!==y?"ANIMATION_OUT":"UNMOUNT"),s.current=r}},[r,d]),Aa(()=>{if(e){let c;const f=e.ownerDocument.defaultView??window,p=y=>{const S=Ql(n.current).includes(CSS.escape(y.animationName));if(y.target===e&&S&&(d("ANIMATION_END"),!s.current)){const T=e.style.animationFillMode;e.style.animationFillMode="forwards",c=f.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=T)})}},m=y=>{y.target===e&&(i.current=Ql(n.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",p),e.addEventListener("animationend",p),()=>{f.clearTimeout(c),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",p),e.removeEventListener("animationend",p)}}else d("ANIMATION_END")},[e,d]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:_.useCallback(c=>{n.current=c?getComputedStyle(c):null,t(c)},[])}}function Ql(r){return r?.animationName||"none"}function t_(r){let e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var n_=Nx[" useInsertionEffect ".trim().toString()]||Aa;function r_({prop:r,defaultProp:e,onChange:t=()=>{},caller:n}){const[s,i,o]=s_({defaultProp:e,onChange:t}),u=r!==void 0,d=u?r:s;{const f=_.useRef(r!==void 0);_.useEffect(()=>{const p=f.current;p!==u&&console.warn(`${n} is changing from ${p?"controlled":"uncontrolled"} to ${u?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),f.current=u},[u,n])}const c=_.useCallback(f=>{if(u){const p=i_(f)?f(r):f;p!==r&&o.current?.(p)}else i(f)},[u,r,i,o]);return[d,c]}function s_({defaultProp:r,onChange:e}){const[t,n]=_.useState(r),s=_.useRef(t),i=_.useRef(e);return n_(()=>{i.current=e},[e]),_.useEffect(()=>{s.current!==t&&(i.current?.(t),s.current=t)},[t,s]),[t,n,i]}function i_(r){return typeof r=="function"}var o_=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),a_="VisuallyHidden",xp=_.forwardRef((r,e)=>x.jsx(Tr.span,{...r,ref:e,style:{...o_,...r.style}}));xp.displayName=a_;var Ep="ToastProvider",[Tp,l_,u_]=$P("Toast"),[PT]=ST("Toast",[u_]),[c_,uc]=PT(Ep),_T=r=>{const{__scopeToast:e,label:t="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:i=50,children:o}=r,[u,d]=_.useState(null),[c,f]=_.useState(0),p=_.useRef(!1),m=_.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${Ep}\`. Expected non-empty \`string\`.`),x.jsx(Tp.Provider,{scope:e,children:x.jsx(c_,{scope:e,label:t,duration:n,swipeDirection:s,swipeThreshold:i,toastCount:c,viewport:u,onViewportChange:d,onToastAdd:_.useCallback(()=>f(y=>y+1),[]),onToastRemove:_.useCallback(()=>f(y=>y-1),[]),isFocusedToastEscapeKeyDownRef:p,isClosePausedRef:m,children:o})})};_T.displayName=Ep;var kT="ToastViewport",d_=["F8"],gh="toast.viewportPause",yh="toast.viewportResume",DT=_.forwardRef((r,e)=>{const{__scopeToast:t,hotkey:n=d_,label:s="Notifications ({hotkey})",...i}=r,o=uc(kT,t),u=l_(t),d=_.useRef(null),c=_.useRef(null),f=_.useRef(null),p=_.useRef(null),m=ii(e,p,o.onViewportChange),y=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),v=o.toastCount>0;_.useEffect(()=>{const T=A=>{n.length!==0&&n.every(w=>A[w]||A.code===w)&&p.current?.focus()};return document.addEventListener("keydown",T),()=>document.removeEventListener("keydown",T)},[n]),_.useEffect(()=>{const T=d.current,A=p.current;if(v&&T&&A){const L=()=>{if(!o.isClosePausedRef.current){const B=new CustomEvent(gh);A.dispatchEvent(B),o.isClosePausedRef.current=!0}},w=()=>{if(o.isClosePausedRef.current){const B=new CustomEvent(yh);A.dispatchEvent(B),o.isClosePausedRef.current=!1}},C=B=>{!T.contains(B.relatedTarget)&&w()},P=()=>{T.contains(document.activeElement)||w()};return T.addEventListener("focusin",L),T.addEventListener("focusout",C),T.addEventListener("pointermove",L),T.addEventListener("pointerleave",P),window.addEventListener("blur",L),window.addEventListener("focus",w),()=>{T.removeEventListener("focusin",L),T.removeEventListener("focusout",C),T.removeEventListener("pointermove",L),T.removeEventListener("pointerleave",P),window.removeEventListener("blur",L),window.removeEventListener("focus",w)}}},[v,o.isClosePausedRef]);const S=_.useCallback(({tabbingDirection:T})=>{const L=u().map(w=>{const C=w.ref.current,P=[C,...A_(C)];return T==="forwards"?P:P.reverse()});return(T==="forwards"?L.reverse():L).flat()},[u]);return _.useEffect(()=>{const T=p.current;if(T){const A=L=>{const w=L.altKey||L.ctrlKey||L.metaKey;if(L.key==="Tab"&&!w){const P=document.activeElement,B=L.shiftKey;if(L.target===T&&B){c.current?.focus();return}const F=S({tabbingDirection:B?"backwards":"forwards"}),O=F.findIndex(V=>V===P);gf(F.slice(O+1))?L.preventDefault():B?c.current?.focus():f.current?.focus()}};return T.addEventListener("keydown",A),()=>T.removeEventListener("keydown",A)}},[u,S]),x.jsxs(QP,{ref:d,role:"region","aria-label":s.replace("{hotkey}",y),tabIndex:-1,style:{pointerEvents:v?void 0:"none"},children:[v&&x.jsx(vh,{ref:c,onFocusFromOutsideViewport:()=>{const T=S({tabbingDirection:"forwards"});gf(T)}}),x.jsx(Tp.Slot,{scope:t,children:x.jsx(Tr.ol,{tabIndex:-1,...i,ref:m})}),v&&x.jsx(vh,{ref:f,onFocusFromOutsideViewport:()=>{const T=S({tabbingDirection:"backwards"});gf(T)}})]})});DT.displayName=kT;var OT="ToastFocusProxy",vh=_.forwardRef((r,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:n,...s}=r,i=uc(OT,t);return x.jsx(xp,{tabIndex:0,...s,ref:e,style:{position:"fixed"},onFocus:o=>{const u=o.relatedTarget;!i.viewport?.contains(u)&&n()}})});vh.displayName=OT;var Ba="Toast",f_="toast.swipeStart",h_="toast.swipeMove",p_="toast.swipeCancel",m_="toast.swipeEnd",NT=_.forwardRef((r,e)=>{const{forceMount:t,open:n,defaultOpen:s,onOpenChange:i,...o}=r,[u,d]=r_({prop:n,defaultProp:s??!0,onChange:i,caller:Ba});return x.jsx(CT,{present:t||u,children:x.jsx(v_,{open:u,...o,ref:e,onClose:()=>d(!1),onPause:oi(r.onPause),onResume:oi(r.onResume),onSwipeStart:On(r.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:On(r.onSwipeMove,c=>{const{x:f,y:p}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${f}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${p}px`)}),onSwipeCancel:On(r.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:On(r.onSwipeEnd,c=>{const{x:f,y:p}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${f}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${p}px`),d(!1)})})})});NT.displayName=Ba;var[g_,y_]=PT(Ba,{onClose(){}}),v_=_.forwardRef((r,e)=>{const{__scopeToast:t,type:n="foreground",duration:s,open:i,onClose:o,onEscapeKeyDown:u,onPause:d,onResume:c,onSwipeStart:f,onSwipeMove:p,onSwipeCancel:m,onSwipeEnd:y,...v}=r,S=uc(Ba,t),[T,A]=_.useState(null),L=ii(e,X=>A(X)),w=_.useRef(null),C=_.useRef(null),P=s||S.duration,B=_.useRef(0),D=_.useRef(P),N=_.useRef(0),{onToastAdd:F,onToastRemove:O}=S,V=oi(()=>{T?.contains(document.activeElement)&&S.viewport?.focus(),o()}),H=_.useCallback(X=>{!X||X===1/0||(window.clearTimeout(N.current),B.current=new Date().getTime(),N.current=window.setTimeout(V,X))},[V]);_.useEffect(()=>{const X=S.viewport;if(X){const ae=()=>{H(D.current),c?.()},Q=()=>{const ie=new Date().getTime()-B.current;D.current=D.current-ie,window.clearTimeout(N.current),d?.()};return X.addEventListener(gh,Q),X.addEventListener(yh,ae),()=>{X.removeEventListener(gh,Q),X.removeEventListener(yh,ae)}}},[S.viewport,P,d,c,H]),_.useEffect(()=>{i&&!S.isClosePausedRef.current&&H(P)},[i,P,S.isClosePausedRef,H]),_.useEffect(()=>(F(),()=>O()),[F,O]);const te=_.useMemo(()=>T?VT(T):null,[T]);return S.viewport?x.jsxs(x.Fragment,{children:[te&&x.jsx(x_,{__scopeToast:t,role:"status","aria-live":n==="foreground"?"assertive":"polite",children:te}),x.jsx(g_,{scope:t,onClose:V,children:zh.createPortal(x.jsx(Tp.ItemSlot,{scope:t,children:x.jsx(XP,{asChild:!0,onEscapeKeyDown:On(u,()=>{S.isFocusedToastEscapeKeyDownRef.current||V(),S.isFocusedToastEscapeKeyDownRef.current=!1}),children:x.jsx(Tr.li,{tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":S.swipeDirection,...v,ref:L,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:On(r.onKeyDown,X=>{X.key==="Escape"&&(u?.(X.nativeEvent),X.nativeEvent.defaultPrevented||(S.isFocusedToastEscapeKeyDownRef.current=!0,V()))}),onPointerDown:On(r.onPointerDown,X=>{X.button===0&&(w.current={x:X.clientX,y:X.clientY})}),onPointerMove:On(r.onPointerMove,X=>{if(!w.current)return;const ae=X.clientX-w.current.x,Q=X.clientY-w.current.y,ie=!!C.current,G=["left","right"].includes(S.swipeDirection),ee=["left","up"].includes(S.swipeDirection)?Math.min:Math.max,Z=G?ee(0,ae):0,k=G?0:ee(0,Q),U=X.pointerType==="touch"?10:2,re={x:Z,y:k},pe={originalEvent:X,delta:re};ie?(C.current=re,Zl(h_,p,pe,{discrete:!1})):ev(re,S.swipeDirection,U)?(C.current=re,Zl(f_,f,pe,{discrete:!1}),X.target.setPointerCapture(X.pointerId)):(Math.abs(ae)>U||Math.abs(Q)>U)&&(w.current=null)}),onPointerUp:On(r.onPointerUp,X=>{const ae=C.current,Q=X.target;if(Q.hasPointerCapture(X.pointerId)&&Q.releasePointerCapture(X.pointerId),C.current=null,w.current=null,ae){const ie=X.currentTarget,G={originalEvent:X,delta:ae};ev(ae,S.swipeDirection,S.swipeThreshold)?Zl(m_,y,G,{discrete:!0}):Zl(p_,m,G,{discrete:!0}),ie.addEventListener("click",ee=>ee.preventDefault(),{once:!0})}})})})}),S.viewport)})]}):null}),x_=r=>{const{__scopeToast:e,children:t,...n}=r,s=uc(Ba,e),[i,o]=_.useState(!1),[u,d]=_.useState(!1);return S_(()=>o(!0)),_.useEffect(()=>{const c=window.setTimeout(()=>d(!0),1e3);return()=>window.clearTimeout(c)},[]),u?null:x.jsx(RT,{asChild:!0,children:x.jsx(xp,{...n,children:i&&x.jsxs(x.Fragment,{children:[s.label," ",t]})})})},E_="ToastTitle",MT=_.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r;return x.jsx(Tr.div,{...n,ref:e})});MT.displayName=E_;var T_="ToastDescription",FT=_.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r;return x.jsx(Tr.div,{...n,ref:e})});FT.displayName=T_;var BT="ToastAction",UT=_.forwardRef((r,e)=>{const{altText:t,...n}=r;return t.trim()?x.jsx($T,{altText:t,asChild:!0,children:x.jsx(Sp,{...n,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${BT}\`. Expected non-empty \`string\`.`),null)});UT.displayName=BT;var jT="ToastClose",Sp=_.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r,s=y_(jT,t);return x.jsx($T,{asChild:!0,children:x.jsx(Tr.button,{type:"button",...n,ref:e,onClick:On(r.onClick,s.onClose)})})});Sp.displayName=jT;var $T=_.forwardRef((r,e)=>{const{__scopeToast:t,altText:n,...s}=r;return x.jsx(Tr.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:e})});function VT(r){const e=[];return Array.from(r.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&e.push(n.textContent),b_(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",i=n.dataset.radixToastAnnounceExclude==="";if(!s)if(i){const o=n.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...VT(n))}}),e}function Zl(r,e,t,{discrete:n}){const s=t.originalEvent.currentTarget,i=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),n?bT(s,i):s.dispatchEvent(i)}var ev=(r,e,t=0)=>{const n=Math.abs(r.x),s=Math.abs(r.y),i=n>s;return e==="left"||e==="right"?i&&n>t:!i&&s>t};function S_(r=()=>{}){const e=oi(r);Aa(()=>{let t=0,n=0;return t=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(n)}},[e])}function b_(r){return r.nodeType===r.ELEMENT_NODE}function A_(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function gf(r){const e=document.activeElement;return r.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var L_=_T,GT=DT,HT=NT,KT=MT,zT=FT,WT=UT,YT=Sp;function qT(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=qT(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function XT(){for(var r,e,t=0,n="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=qT(r))&&(n&&(n+=" "),n+=e);return n}const tv=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,nv=XT,I_=(r,e)=>t=>{var n;if(e?.variants==null)return nv(r,t?.class,t?.className);const{variants:s,defaultVariants:i}=e,o=Object.keys(s).map(c=>{const f=t?.[c],p=i?.[c];if(f===null)return null;const m=tv(f)||tv(p);return s[c][m]}),u=t&&Object.entries(t).reduce((c,f)=>{let[p,m]=f;return m===void 0||(c[p]=m),c},{}),d=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((c,f)=>{let{class:p,className:m,...y}=f;return Object.entries(y).every(v=>{let[S,T]=v;return Array.isArray(T)?T.includes({...i,...u}[S]):{...i,...u}[S]===T})?[...c,p,m]:c},[]);return nv(r,o,d,t?.class,t?.className)};function w_(){for(var r=0,e,t,n="";r<arguments.length;)(e=arguments[r++])&&(t=QT(e))&&(n&&(n+=" "),n+=t);return n}function QT(r){if(typeof r=="string")return r;for(var e,t="",n=0;n<r.length;n++)r[n]&&(e=QT(r[n]))&&(t&&(t+=" "),t+=e);return t}var bp="-";function R_(r){var e=P_(r),t=r.conflictingClassGroups,n=r.conflictingClassGroupModifiers,s=n===void 0?{}:n;function i(u){var d=u.split(bp);return d[0]===""&&d.length!==1&&d.shift(),ZT(d,e)||C_(u)}function o(u,d){var c=t[u]||[];return d&&s[u]?[].concat(c,s[u]):c}return{getClassGroupId:i,getConflictingClassGroupIds:o}}function ZT(r,e){if(r.length===0)return e.classGroupId;var t=r[0],n=e.nextPart.get(t),s=n?ZT(r.slice(1),n):void 0;if(s)return s;if(e.validators.length!==0){var i=r.join(bp);return e.validators.find(function(o){var u=o.validator;return u(i)})?.classGroupId}}var rv=/^\[(.+)\]$/;function C_(r){if(rv.test(r)){var e=rv.exec(r)[1],t=e?.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}}function P_(r){var e=r.theme,t=r.prefix,n={nextPart:new Map,validators:[]},s=k_(Object.entries(r.classGroups),t);return s.forEach(function(i){var o=i[0],u=i[1];xh(u,n,o,e)}),n}function xh(r,e,t,n){r.forEach(function(s){if(typeof s=="string"){var i=s===""?e:sv(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(__(s)){xh(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(function(o){var u=o[0],d=o[1];xh(d,sv(e,u),t,n)})})}function sv(r,e){var t=r;return e.split(bp).forEach(function(n){t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t}function __(r){return r.isThemeGetter}function k_(r,e){return e?r.map(function(t){var n=t[0],s=t[1],i=s.map(function(o){return typeof o=="string"?e+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(function(u){var d=u[0],c=u[1];return[e+d,c]})):o});return[n,i]}):r}function D_(r){if(r<1)return{get:function(){},set:function(){}};var e=0,t=new Map,n=new Map;function s(i,o){t.set(i,o),e++,e>r&&(e=0,n=t,t=new Map)}return{get:function(o){var u=t.get(o);if(u!==void 0)return u;if((u=n.get(o))!==void 0)return s(o,u),u},set:function(o,u){t.has(o)?t.set(o,u):s(o,u)}}}var JT="!";function O_(r){var e=r.separator||":",t=e.length===1,n=e[0],s=e.length;return function(o){for(var u=[],d=0,c=0,f,p=0;p<o.length;p++){var m=o[p];if(d===0){if(m===n&&(t||o.slice(p,p+s)===e)){u.push(o.slice(c,p)),c=p+s;continue}if(m==="/"){f=p;continue}}m==="["?d++:m==="]"&&d--}var y=u.length===0?o:o.substring(c),v=y.startsWith(JT),S=v?y.substring(1):y,T=f&&f>c?f-c:void 0;return{modifiers:u,hasImportantModifier:v,baseClassName:S,maybePostfixModifierPosition:T}}}function N_(r){if(r.length<=1)return r;var e=[],t=[];return r.forEach(function(n){var s=n[0]==="[";s?(e.push.apply(e,t.sort().concat([n])),t=[]):t.push(n)}),e.push.apply(e,t.sort()),e}function M_(r){return{cache:D_(r.cacheSize),splitModifiers:O_(r),...R_(r)}}var F_=/\s+/;function B_(r,e){var t=e.splitModifiers,n=e.getClassGroupId,s=e.getConflictingClassGroupIds,i=new Set;return r.trim().split(F_).map(function(o){var u=t(o),d=u.modifiers,c=u.hasImportantModifier,f=u.baseClassName,p=u.maybePostfixModifierPosition,m=n(p?f.substring(0,p):f),y=!!p;if(!m){if(!p)return{isTailwindClass:!1,originalClassName:o};if(m=n(f),!m)return{isTailwindClass:!1,originalClassName:o};y=!1}var v=N_(d).join(":"),S=c?v+JT:v;return{isTailwindClass:!0,modifierId:S,classGroupId:m,originalClassName:o,hasPostfixModifier:y}}).reverse().filter(function(o){if(!o.isTailwindClass)return!0;var u=o.modifierId,d=o.classGroupId,c=o.hasPostfixModifier,f=u+d;return i.has(f)?!1:(i.add(f),s(d,c).forEach(function(p){return i.add(u+p)}),!0)}).reverse().map(function(o){return o.originalClassName}).join(" ")}function U_(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];var n,s,i,o=u;function u(c){var f=e[0],p=e.slice(1),m=p.reduce(function(y,v){return v(y)},f());return n=M_(m),s=n.cache.get,i=n.cache.set,o=d,d(c)}function d(c){var f=s(c);if(f)return f;var p=B_(c,n);return i(c,p),p}return function(){return o(w_.apply(null,arguments))}}function pt(r){var e=function(n){return n[r]||[]};return e.isThemeGetter=!0,e}var eS=/^\[(?:([a-z-]+):)?(.+)\]$/i,j_=/^\d+\/\d+$/,$_=new Set(["px","full","screen"]),V_=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,G_=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,H_=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/;function tr(r){return ei(r)||$_.has(r)||j_.test(r)||Eh(r)}function Eh(r){return di(r,"length",X_)}function K_(r){return di(r,"size",tS)}function z_(r){return di(r,"position",tS)}function W_(r){return di(r,"url",Q_)}function Jl(r){return di(r,"number",ei)}function ei(r){return!Number.isNaN(Number(r))}function Y_(r){return r.endsWith("%")&&ei(r.slice(0,-1))}function na(r){return iv(r)||di(r,"number",iv)}function qe(r){return eS.test(r)}function ra(){return!0}function hs(r){return V_.test(r)}function q_(r){return di(r,"",Z_)}function di(r,e,t){var n=eS.exec(r);return n?n[1]?n[1]===e:t(n[2]):!1}function X_(r){return G_.test(r)}function tS(){return!1}function Q_(r){return r.startsWith("url(")}function iv(r){return Number.isInteger(Number(r))}function Z_(r){return H_.test(r)}function J_(){var r=pt("colors"),e=pt("spacing"),t=pt("blur"),n=pt("brightness"),s=pt("borderColor"),i=pt("borderRadius"),o=pt("borderSpacing"),u=pt("borderWidth"),d=pt("contrast"),c=pt("grayscale"),f=pt("hueRotate"),p=pt("invert"),m=pt("gap"),y=pt("gradientColorStops"),v=pt("gradientColorStopPositions"),S=pt("inset"),T=pt("margin"),A=pt("opacity"),L=pt("padding"),w=pt("saturate"),C=pt("scale"),P=pt("sepia"),B=pt("skew"),D=pt("space"),N=pt("translate"),F=function(){return["auto","contain","none"]},O=function(){return["auto","hidden","clip","visible","scroll"]},V=function(){return["auto",qe,e]},H=function(){return[qe,e]},te=function(){return["",tr]},X=function(){return["auto",ei,qe]},ae=function(){return["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"]},Q=function(){return["solid","dashed","dotted","double","none"]},ie=function(){return["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"]},G=function(){return["start","end","center","between","around","evenly","stretch"]},ee=function(){return["","0",qe]},Z=function(){return["auto","avoid","all","avoid-page","page","left","right","column"]},k=function(){return[ei,Jl]},U=function(){return[ei,qe]};return{cacheSize:500,theme:{colors:[ra],spacing:[tr],blur:["none","",hs,qe],brightness:k(),borderColor:[r],borderRadius:["none","","full",hs,qe],borderSpacing:H(),borderWidth:te(),contrast:k(),grayscale:ee(),hueRotate:U(),invert:ee(),gap:H(),gradientColorStops:[r],gradientColorStopPositions:[Y_,Eh],inset:V(),margin:V(),opacity:k(),padding:H(),saturate:k(),scale:k(),sepia:ee(),skew:U(),space:H(),translate:H()},classGroups:{aspect:[{aspect:["auto","square","video",qe]}],container:["container"],columns:[{columns:[hs]}],"break-after":[{"break-after":Z()}],"break-before":[{"break-before":Z()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none"]}],clear:[{clear:["left","right","both","none"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[].concat(ae(),[qe])}],overflow:[{overflow:O()}],"overflow-x":[{"overflow-x":O()}],"overflow-y":[{"overflow-y":O()}],overscroll:[{overscroll:F()}],"overscroll-x":[{"overscroll-x":F()}],"overscroll-y":[{"overscroll-y":F()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[S]}],"inset-x":[{"inset-x":[S]}],"inset-y":[{"inset-y":[S]}],start:[{start:[S]}],end:[{end:[S]}],top:[{top:[S]}],right:[{right:[S]}],bottom:[{bottom:[S]}],left:[{left:[S]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",na]}],basis:[{basis:V()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",qe]}],grow:[{grow:ee()}],shrink:[{shrink:ee()}],order:[{order:["first","last","none",na]}],"grid-cols":[{"grid-cols":[ra]}],"col-start-end":[{col:["auto",{span:["full",na]},qe]}],"col-start":[{"col-start":X()}],"col-end":[{"col-end":X()}],"grid-rows":[{"grid-rows":[ra]}],"row-start-end":[{row:["auto",{span:[na]},qe]}],"row-start":[{"row-start":X()}],"row-end":[{"row-end":X()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",qe]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",qe]}],gap:[{gap:[m]}],"gap-x":[{"gap-x":[m]}],"gap-y":[{"gap-y":[m]}],"justify-content":[{justify:["normal"].concat(G())}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal"].concat(G(),["baseline"])}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[].concat(G(),["baseline"])}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[L]}],px:[{px:[L]}],py:[{py:[L]}],ps:[{ps:[L]}],pe:[{pe:[L]}],pt:[{pt:[L]}],pr:[{pr:[L]}],pb:[{pb:[L]}],pl:[{pl:[L]}],m:[{m:[T]}],mx:[{mx:[T]}],my:[{my:[T]}],ms:[{ms:[T]}],me:[{me:[T]}],mt:[{mt:[T]}],mr:[{mr:[T]}],mb:[{mb:[T]}],ml:[{ml:[T]}],"space-x":[{"space-x":[D]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[D]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit",qe,e]}],"min-w":[{"min-w":["min","max","fit",qe,tr]}],"max-w":[{"max-w":["0","none","full","min","max","fit","prose",{screen:[hs]},hs,qe]}],h:[{h:[qe,e,"auto","min","max","fit"]}],"min-h":[{"min-h":["min","max","fit",qe,tr]}],"max-h":[{"max-h":[qe,e,"min","max","fit"]}],"font-size":[{text:["base",hs,Eh]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Jl]}],"font-family":[{font:[ra]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",qe]}],"line-clamp":[{"line-clamp":["none",ei,Jl]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",qe,tr]}],"list-image":[{"list-image":["none",qe]}],"list-style-type":[{list:["none","disc","decimal",qe]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[A]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[A]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[].concat(Q(),["wavy"])}],"text-decoration-thickness":[{decoration:["auto","from-font",tr]}],"underline-offset":[{"underline-offset":["auto",qe,tr]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],indent:[{indent:H()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",qe]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",qe]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[A]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[].concat(ae(),[z_])}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",K_]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},W_]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[v]}],"gradient-via-pos":[{via:[v]}],"gradient-to-pos":[{to:[v]}],"gradient-from":[{from:[y]}],"gradient-via":[{via:[y]}],"gradient-to":[{to:[y]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[u]}],"border-w-x":[{"border-x":[u]}],"border-w-y":[{"border-y":[u]}],"border-w-s":[{"border-s":[u]}],"border-w-e":[{"border-e":[u]}],"border-w-t":[{"border-t":[u]}],"border-w-r":[{"border-r":[u]}],"border-w-b":[{"border-b":[u]}],"border-w-l":[{"border-l":[u]}],"border-opacity":[{"border-opacity":[A]}],"border-style":[{border:[].concat(Q(),["hidden"])}],"divide-x":[{"divide-x":[u]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[u]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[A]}],"divide-style":[{divide:Q()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:[""].concat(Q())}],"outline-offset":[{"outline-offset":[qe,tr]}],"outline-w":[{outline:[tr]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:te()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[A]}],"ring-offset-w":[{"ring-offset":[tr]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",hs,q_]}],"shadow-color":[{shadow:[ra]}],opacity:[{opacity:[A]}],"mix-blend":[{"mix-blend":ie()}],"bg-blend":[{"bg-blend":ie()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[n]}],contrast:[{contrast:[d]}],"drop-shadow":[{"drop-shadow":["","none",hs,qe]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[f]}],invert:[{invert:[p]}],saturate:[{saturate:[w]}],sepia:[{sepia:[P]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[d]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[f]}],"backdrop-invert":[{"backdrop-invert":[p]}],"backdrop-opacity":[{"backdrop-opacity":[A]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[P]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",qe]}],duration:[{duration:U()}],ease:[{ease:["linear","in","out","in-out",qe]}],delay:[{delay:U()}],animate:[{animate:["none","spin","ping","pulse","bounce",qe]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[C]}],"scale-x":[{"scale-x":[C]}],"scale-y":[{"scale-y":[C]}],rotate:[{rotate:[na,qe]}],"translate-x":[{"translate-x":[N]}],"translate-y":[{"translate-y":[N]}],"skew-x":[{"skew-x":[B]}],"skew-y":[{"skew-y":[B]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",qe]}],accent:[{accent:["auto",r]}],appearance:["appearance-none"],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",qe]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":H()}],"scroll-mx":[{"scroll-mx":H()}],"scroll-my":[{"scroll-my":H()}],"scroll-ms":[{"scroll-ms":H()}],"scroll-me":[{"scroll-me":H()}],"scroll-mt":[{"scroll-mt":H()}],"scroll-mr":[{"scroll-mr":H()}],"scroll-mb":[{"scroll-mb":H()}],"scroll-ml":[{"scroll-ml":H()}],"scroll-p":[{"scroll-p":H()}],"scroll-px":[{"scroll-px":H()}],"scroll-py":[{"scroll-py":H()}],"scroll-ps":[{"scroll-ps":H()}],"scroll-pe":[{"scroll-pe":H()}],"scroll-pt":[{"scroll-pt":H()}],"scroll-pr":[{"scroll-pr":H()}],"scroll-pb":[{"scroll-pb":H()}],"scroll-pl":[{"scroll-pl":H()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","pinch-zoom","manipulation",{pan:["x","left","right","y","up","down"]}]}],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",qe]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[tr,Jl]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}var ek=U_(J_);function mo(...r){return ek(XT(r))}const tk=L_,nS=_.forwardRef(({className:r,...e},t)=>x.jsx(GT,{ref:t,className:mo("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...e}));nS.displayName=GT.displayName;const nk=I_("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),rS=_.forwardRef(({className:r,variant:e,...t},n)=>x.jsx(HT,{ref:n,className:mo(nk({variant:e}),r),...t}));rS.displayName=HT.displayName;const rk=_.forwardRef(({className:r,...e},t)=>x.jsx(WT,{ref:t,className:mo("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",r),...e}));rk.displayName=WT.displayName;const sS=_.forwardRef(({className:r,...e},t)=>x.jsx(YT,{ref:t,className:mo("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...e,children:x.jsx(vp,{className:"h-4 w-4"})}));sS.displayName=YT.displayName;const iS=_.forwardRef(({className:r,...e},t)=>x.jsx(KT,{ref:t,className:mo("text-sm font-semibold",r),...e}));iS.displayName=KT.displayName;const oS=_.forwardRef(({className:r,...e},t)=>x.jsx(zT,{ref:t,className:mo("text-sm opacity-90",r),...e}));oS.displayName=zT.displayName;const sk=1,ik=(r,e)=>{switch(e.type){case"ADD_TOAST":return{...r,toasts:[e.toast,...r.toasts].slice(0,sk)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=e;return{...r,toasts:r.toasts.map(n=>n.id===t||t===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":{const{toastId:t}=e;return t===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(n=>n.id!==t)}}}},xu=[];let Eu={toasts:[]};function ha(r){Eu=ik(Eu,r),xu.forEach(e=>{e(Eu)})}let yf=0;function ok(){return yf=(yf+1)%Number.MAX_SAFE_INTEGER,yf.toString()}const As=r=>{const e=ok(),t=s=>ha({type:"UPDATE_TOAST",toast:{...s,id:e}}),n=()=>ha({type:"DISMISS_TOAST",toastId:e});return ha({type:"ADD_TOAST",toast:{...r,id:e,open:!0,onOpenChange:s=>{s||n()}}}),{id:e,dismiss:n,update:t}};function ak(){const[r,e]=_.useState(Eu);return _.useEffect(()=>(xu.push(e),()=>{const t=xu.indexOf(e);t>-1&&xu.splice(t,1)}),[r]),_.useEffect(()=>{const t=new Map;return r.toasts.forEach(n=>{if(n.open&&!t.has(n.id)){const s=setTimeout(()=>{ha({type:"DISMISS_TOAST",toastId:n.id})},n.duration||5e3);t.set(n.id,s)}}),()=>{t.forEach(n=>clearTimeout(n))}},[r.toasts]),{...r,toast:As,dismiss:t=>ha({type:"DISMISS_TOAST",toastId:t})}}function lk(){const{toasts:r}=ak();return x.jsxs(tk,{children:[r.map(function({id:e,title:t,description:n,action:s,...i}){return x.jsxs(rS,{...i,children:[x.jsxs("div",{className:"grid gap-1",children:[t&&x.jsx(iS,{children:t}),n&&x.jsx(oS,{children:n})]}),s,x.jsx(sS,{})]},e)}),x.jsx(nS,{})]})}var vf={exports:{}},xf,ov;function uk(){if(ov)return xf;ov=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return xf=r,xf}var Ef,av;function ck(){if(av)return Ef;av=1;var r=uk();function e(){}function t(){}return t.resetWarningCache=e,Ef=function(){function n(o,u,d,c,f,p){if(p!==r){var m=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw m.name="Invariant Violation",m}}n.isRequired=n;function s(){return n}var i={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:s,element:n,elementType:n,instanceOf:s,node:n,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:t,resetWarningCache:e};return i.PropTypes=i,i},Ef}var lv;function dk(){return lv||(lv=1,vf.exports=ck()()),vf.exports}var fk=dk();const yt=li(fk);var Tf,uv;function hk(){if(uv)return Tf;uv=1;function r(u){return u&&typeof u=="object"&&"default"in u?u.default:u}var e=Da(),t=r(e);function n(u,d,c){return d in u?Object.defineProperty(u,d,{value:c,enumerable:!0,configurable:!0,writable:!0}):u[d]=c,u}function s(u,d){u.prototype=Object.create(d.prototype),u.prototype.constructor=u,u.__proto__=d}var i=!!(typeof window<"u"&&window.document&&window.document.createElement);function o(u,d,c){if(typeof u!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof d!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof c<"u"&&typeof c!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function f(p){return p.displayName||p.name||"Component"}return function(m){if(typeof m!="function")throw new Error("Expected WrappedComponent to be a React component.");var y=[],v;function S(){v=u(y.map(function(A){return A.props})),T.canUseDOM?d(v):c&&(v=c(v))}var T=(function(A){s(L,A);function L(){return A.apply(this,arguments)||this}L.peek=function(){return v},L.rewind=function(){if(L.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var P=v;return v=void 0,y=[],P};var w=L.prototype;return w.UNSAFE_componentWillMount=function(){y.push(this),S()},w.componentDidUpdate=function(){S()},w.componentWillUnmount=function(){var P=y.indexOf(this);y.splice(P,1),S()},w.render=function(){return t.createElement(m,this.props)},L})(e.PureComponent);return n(T,"displayName","SideEffect("+f(m)+")"),n(T,"canUseDOM",i),T}}return Tf=o,Tf}var pk=hk();const mk=li(pk);var Sf,cv;function gk(){if(cv)return Sf;cv=1;var r=typeof Element<"u",e=typeof Map=="function",t=typeof Set=="function",n=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function s(i,o){if(i===o)return!0;if(i&&o&&typeof i=="object"&&typeof o=="object"){if(i.constructor!==o.constructor)return!1;var u,d,c;if(Array.isArray(i)){if(u=i.length,u!=o.length)return!1;for(d=u;d--!==0;)if(!s(i[d],o[d]))return!1;return!0}var f;if(e&&i instanceof Map&&o instanceof Map){if(i.size!==o.size)return!1;for(f=i.entries();!(d=f.next()).done;)if(!o.has(d.value[0]))return!1;for(f=i.entries();!(d=f.next()).done;)if(!s(d.value[1],o.get(d.value[0])))return!1;return!0}if(t&&i instanceof Set&&o instanceof Set){if(i.size!==o.size)return!1;for(f=i.entries();!(d=f.next()).done;)if(!o.has(d.value[0]))return!1;return!0}if(n&&ArrayBuffer.isView(i)&&ArrayBuffer.isView(o)){if(u=i.length,u!=o.length)return!1;for(d=u;d--!==0;)if(i[d]!==o[d])return!1;return!0}if(i.constructor===RegExp)return i.source===o.source&&i.flags===o.flags;if(i.valueOf!==Object.prototype.valueOf&&typeof i.valueOf=="function"&&typeof o.valueOf=="function")return i.valueOf()===o.valueOf();if(i.toString!==Object.prototype.toString&&typeof i.toString=="function"&&typeof o.toString=="function")return i.toString()===o.toString();if(c=Object.keys(i),u=c.length,u!==Object.keys(o).length)return!1;for(d=u;d--!==0;)if(!Object.prototype.hasOwnProperty.call(o,c[d]))return!1;if(r&&i instanceof Element)return!1;for(d=u;d--!==0;)if(!((c[d]==="_owner"||c[d]==="__v"||c[d]==="__o")&&i.$$typeof)&&!s(i[c[d]],o[c[d]]))return!1;return!0}return i!==i&&o!==o}return Sf=function(o,u){try{return s(o,u)}catch(d){if((d.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw d}},Sf}var yk=gk();const vk=li(yk);/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var bf,dv;function xk(){if(dv)return bf;dv=1;var r=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function n(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function s(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var o={},u=0;u<10;u++)o["_"+String.fromCharCode(u)]=u;var d=Object.getOwnPropertyNames(o).map(function(f){return o[f]});if(d.join("")!=="0123456789")return!1;var c={};return"abcdefghijklmnopqrst".split("").forEach(function(f){c[f]=f}),Object.keys(Object.assign({},c)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return bf=s()?Object.assign:function(i,o){for(var u,d=n(i),c,f=1;f<arguments.length;f++){u=Object(arguments[f]);for(var p in u)e.call(u,p)&&(d[p]=u[p]);if(r){c=r(u);for(var m=0;m<c.length;m++)t.call(u,c[m])&&(d[c[m]]=u[c[m]])}}return d},bf}var Ek=xk();const Tk=li(Ek);var ni={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},je={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(je).map(function(r){return je[r]});var vt={CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"},ju={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},La={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},Sk=Object.keys(ju).reduce(function(r,e){return r[ju[e]]=e,r},{}),bk=[je.NOSCRIPT,je.SCRIPT,je.STYLE],sr="data-react-helmet",Ak=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Lk=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},Ik=(function(){function r(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}})(),Sn=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},wk=function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(r,e):r.__proto__=e)},fv=function(r,e){var t={};for(var n in r)e.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);return t},Rk=function(r,e){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:r},Th=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t===!1?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},Ck=function(e){var t=to(e,je.TITLE),n=to(e,La.TITLE_TEMPLATE);if(n&&t)return n.replace(/%s/g,function(){return Array.isArray(t)?t.join(""):t});var s=to(e,La.DEFAULT_TITLE);return t||s||void 0},Pk=function(e){return to(e,La.ON_CHANGE_CLIENT_STATE)||function(){}},Af=function(e,t){return t.filter(function(n){return typeof n[e]<"u"}).map(function(n){return n[e]}).reduce(function(n,s){return Sn({},n,s)},{})},_k=function(e,t){return t.filter(function(n){return typeof n[je.BASE]<"u"}).map(function(n){return n[je.BASE]}).reverse().reduce(function(n,s){if(!n.length)for(var i=Object.keys(s),o=0;o<i.length;o++){var u=i[o],d=u.toLowerCase();if(e.indexOf(d)!==-1&&s[d])return n.concat(s)}return n},[])},sa=function(e,t,n){var s={};return n.filter(function(i){return Array.isArray(i[e])?!0:(typeof i[e]<"u"&&Nk("Helmet: "+e+' should be of type "Array". Instead found type "'+Ak(i[e])+'"'),!1)}).map(function(i){return i[e]}).reverse().reduce(function(i,o){var u={};o.filter(function(m){for(var y=void 0,v=Object.keys(m),S=0;S<v.length;S++){var T=v[S],A=T.toLowerCase();t.indexOf(A)!==-1&&!(y===vt.REL&&m[y].toLowerCase()==="canonical")&&!(A===vt.REL&&m[A].toLowerCase()==="stylesheet")&&(y=A),t.indexOf(T)!==-1&&(T===vt.INNER_HTML||T===vt.CSS_TEXT||T===vt.ITEM_PROP)&&(y=T)}if(!y||!m[y])return!1;var L=m[y].toLowerCase();return s[y]||(s[y]={}),u[y]||(u[y]={}),s[y][L]?!1:(u[y][L]=!0,!0)}).reverse().forEach(function(m){return i.push(m)});for(var d=Object.keys(u),c=0;c<d.length;c++){var f=d[c],p=Tk({},s[f],u[f]);s[f]=p}return i},[]).reverse()},to=function(e,t){for(var n=e.length-1;n>=0;n--){var s=e[n];if(s.hasOwnProperty(t))return s[t]}return null},kk=function(e){return{baseTag:_k([vt.HREF,vt.TARGET],e),bodyAttributes:Af(ni.BODY,e),defer:to(e,La.DEFER),encode:to(e,La.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:Af(ni.HTML,e),linkTags:sa(je.LINK,[vt.REL,vt.HREF],e),metaTags:sa(je.META,[vt.NAME,vt.CHARSET,vt.HTTPEQUIV,vt.PROPERTY,vt.ITEM_PROP],e),noscriptTags:sa(je.NOSCRIPT,[vt.INNER_HTML],e),onChangeClientState:Pk(e),scriptTags:sa(je.SCRIPT,[vt.SRC,vt.INNER_HTML],e),styleTags:sa(je.STYLE,[vt.CSS_TEXT],e),title:Ck(e),titleAttributes:Af(ni.TITLE,e)}},Sh=(function(){var r=Date.now();return function(e){var t=Date.now();t-r>16?(r=t,e(t)):setTimeout(function(){Sh(e)},0)}})(),hv=function(e){return clearTimeout(e)},Dk=typeof window<"u"?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||Sh:global.requestAnimationFrame||Sh,Ok=typeof window<"u"?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||hv:global.cancelAnimationFrame||hv,Nk=function(e){return console&&typeof console.warn=="function"&&console.warn(e)},ia=null,Mk=function(e){ia&&Ok(ia),e.defer?ia=Dk(function(){pv(e,function(){ia=null})}):(pv(e),ia=null)},pv=function(e,t){var n=e.baseTag,s=e.bodyAttributes,i=e.htmlAttributes,o=e.linkTags,u=e.metaTags,d=e.noscriptTags,c=e.onChangeClientState,f=e.scriptTags,p=e.styleTags,m=e.title,y=e.titleAttributes;bh(je.BODY,s),bh(je.HTML,i),Fk(m,y);var v={baseTag:Mi(je.BASE,n),linkTags:Mi(je.LINK,o),metaTags:Mi(je.META,u),noscriptTags:Mi(je.NOSCRIPT,d),scriptTags:Mi(je.SCRIPT,f),styleTags:Mi(je.STYLE,p)},S={},T={};Object.keys(v).forEach(function(A){var L=v[A],w=L.newTags,C=L.oldTags;w.length&&(S[A]=w),C.length&&(T[A]=v[A].oldTags)}),t&&t(),c(e,S,T)},aS=function(e){return Array.isArray(e)?e.join(""):e},Fk=function(e,t){typeof e<"u"&&document.title!==e&&(document.title=aS(e)),bh(je.TITLE,t)},bh=function(e,t){var n=document.getElementsByTagName(e)[0];if(n){for(var s=n.getAttribute(sr),i=s?s.split(","):[],o=[].concat(i),u=Object.keys(t),d=0;d<u.length;d++){var c=u[d],f=t[c]||"";n.getAttribute(c)!==f&&n.setAttribute(c,f),i.indexOf(c)===-1&&i.push(c);var p=o.indexOf(c);p!==-1&&o.splice(p,1)}for(var m=o.length-1;m>=0;m--)n.removeAttribute(o[m]);i.length===o.length?n.removeAttribute(sr):n.getAttribute(sr)!==u.join(",")&&n.setAttribute(sr,u.join(","))}},Mi=function(e,t){var n=document.head||document.querySelector(je.HEAD),s=n.querySelectorAll(e+"["+sr+"]"),i=Array.prototype.slice.call(s),o=[],u=void 0;return t&&t.length&&t.forEach(function(d){var c=document.createElement(e);for(var f in d)if(d.hasOwnProperty(f))if(f===vt.INNER_HTML)c.innerHTML=d.innerHTML;else if(f===vt.CSS_TEXT)c.styleSheet?c.styleSheet.cssText=d.cssText:c.appendChild(document.createTextNode(d.cssText));else{var p=typeof d[f]>"u"?"":d[f];c.setAttribute(f,p)}c.setAttribute(sr,"true"),i.some(function(m,y){return u=y,c.isEqualNode(m)})?i.splice(u,1):o.push(c)}),i.forEach(function(d){return d.parentNode.removeChild(d)}),o.forEach(function(d){return n.appendChild(d)}),{oldTags:i,newTags:o}},lS=function(e){return Object.keys(e).reduce(function(t,n){var s=typeof e[n]<"u"?n+'="'+e[n]+'"':""+n;return t?t+" "+s:s},"")},Bk=function(e,t,n,s){var i=lS(n),o=aS(t);return i?"<"+e+" "+sr+'="true" '+i+">"+Th(o,s)+"</"+e+">":"<"+e+" "+sr+'="true">'+Th(o,s)+"</"+e+">"},Uk=function(e,t,n){return t.reduce(function(s,i){var o=Object.keys(i).filter(function(c){return!(c===vt.INNER_HTML||c===vt.CSS_TEXT)}).reduce(function(c,f){var p=typeof i[f]>"u"?f:f+'="'+Th(i[f],n)+'"';return c?c+" "+p:p},""),u=i.innerHTML||i.cssText||"",d=bk.indexOf(e)===-1;return s+"<"+e+" "+sr+'="true" '+o+(d?"/>":">"+u+"</"+e+">")},"")},uS=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(e).reduce(function(n,s){return n[ju[s]||s]=e[s],n},t)},jk=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(e).reduce(function(n,s){return n[Sk[s]||s]=e[s],n},t)},$k=function(e,t,n){var s,i=(s={key:t},s[sr]=!0,s),o=uS(n,i);return[on.createElement(je.TITLE,o,t)]},Vk=function(e,t){return t.map(function(n,s){var i,o=(i={key:s},i[sr]=!0,i);return Object.keys(n).forEach(function(u){var d=ju[u]||u;if(d===vt.INNER_HTML||d===vt.CSS_TEXT){var c=n.innerHTML||n.cssText;o.dangerouslySetInnerHTML={__html:c}}else o[d]=n[u]}),on.createElement(e,o)})},Or=function(e,t,n){switch(e){case je.TITLE:return{toComponent:function(){return $k(e,t.title,t.titleAttributes)},toString:function(){return Bk(e,t.title,t.titleAttributes,n)}};case ni.BODY:case ni.HTML:return{toComponent:function(){return uS(t)},toString:function(){return lS(t)}};default:return{toComponent:function(){return Vk(e,t)},toString:function(){return Uk(e,t,n)}}}},cS=function(e){var t=e.baseTag,n=e.bodyAttributes,s=e.encode,i=e.htmlAttributes,o=e.linkTags,u=e.metaTags,d=e.noscriptTags,c=e.scriptTags,f=e.styleTags,p=e.title,m=p===void 0?"":p,y=e.titleAttributes;return{base:Or(je.BASE,t,s),bodyAttributes:Or(ni.BODY,n,s),htmlAttributes:Or(ni.HTML,i,s),link:Or(je.LINK,o,s),meta:Or(je.META,u,s),noscript:Or(je.NOSCRIPT,d,s),script:Or(je.SCRIPT,c,s),style:Or(je.STYLE,f,s),title:Or(je.TITLE,{title:m,titleAttributes:y},s)}},Gk=function(e){var t,n;return n=t=(function(s){wk(i,s);function i(){return Lk(this,i),Rk(this,s.apply(this,arguments))}return i.prototype.shouldComponentUpdate=function(u){return!vk(this.props,u)},i.prototype.mapNestedChildrenToProps=function(u,d){if(!d)return null;switch(u.type){case je.SCRIPT:case je.NOSCRIPT:return{innerHTML:d};case je.STYLE:return{cssText:d}}throw new Error("<"+u.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},i.prototype.flattenArrayTypeChildren=function(u){var d,c=u.child,f=u.arrayTypeChildren,p=u.newChildProps,m=u.nestedChildren;return Sn({},f,(d={},d[c.type]=[].concat(f[c.type]||[],[Sn({},p,this.mapNestedChildrenToProps(c,m))]),d))},i.prototype.mapObjectTypeChildren=function(u){var d,c,f=u.child,p=u.newProps,m=u.newChildProps,y=u.nestedChildren;switch(f.type){case je.TITLE:return Sn({},p,(d={},d[f.type]=y,d.titleAttributes=Sn({},m),d));case je.BODY:return Sn({},p,{bodyAttributes:Sn({},m)});case je.HTML:return Sn({},p,{htmlAttributes:Sn({},m)})}return Sn({},p,(c={},c[f.type]=Sn({},m),c))},i.prototype.mapArrayTypeChildrenToProps=function(u,d){var c=Sn({},d);return Object.keys(u).forEach(function(f){var p;c=Sn({},c,(p={},p[f]=u[f],p))}),c},i.prototype.warnOnInvalidChildren=function(u,d){return!0},i.prototype.mapChildrenToProps=function(u,d){var c=this,f={};return on.Children.forEach(u,function(p){if(!(!p||!p.props)){var m=p.props,y=m.children,v=fv(m,["children"]),S=jk(v);switch(c.warnOnInvalidChildren(p,y),p.type){case je.LINK:case je.META:case je.NOSCRIPT:case je.SCRIPT:case je.STYLE:f=c.flattenArrayTypeChildren({child:p,arrayTypeChildren:f,newChildProps:S,nestedChildren:y});break;default:d=c.mapObjectTypeChildren({child:p,newProps:d,newChildProps:S,nestedChildren:y});break}}}),d=this.mapArrayTypeChildrenToProps(f,d),d},i.prototype.render=function(){var u=this.props,d=u.children,c=fv(u,["children"]),f=Sn({},c);return d&&(f=this.mapChildrenToProps(d,f)),on.createElement(e,f)},Ik(i,null,[{key:"canUseDOM",set:function(u){e.canUseDOM=u}}]),i})(on.Component),t.propTypes={base:yt.object,bodyAttributes:yt.object,children:yt.oneOfType([yt.arrayOf(yt.node),yt.node]),defaultTitle:yt.string,defer:yt.bool,encodeSpecialCharacters:yt.bool,htmlAttributes:yt.object,link:yt.arrayOf(yt.object),meta:yt.arrayOf(yt.object),noscript:yt.arrayOf(yt.object),onChangeClientState:yt.func,script:yt.arrayOf(yt.object),style:yt.arrayOf(yt.object),title:yt.string,titleAttributes:yt.object,titleTemplate:yt.string},t.defaultProps={defer:!0,encodeSpecialCharacters:!0},t.peek=e.peek,t.rewind=function(){var s=e.rewind();return s||(s=cS({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),s},n},Hk=function(){return null},Kk=mk(kk,Mk,cS)(Hk),hn=Gk(Kk);hn.renderStatic=hn.rewind;const Nr=[{title:"Bienvenido a SimpleMarket360",subtitle:"Tu marketplace para comprar y vender de todo, de forma fácil y segura.",image:"https://images.unsplash.com/photo-1556740738-b6a63e27c4df?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80"},{title:"Vende tus productos en minutos",subtitle:"Publica tus artículos con la ayuda de nuestra IA y llega a miles de compradores.",image:"https://images.unsplash.com/photo-1579548122204-782e1b0a1a8b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80"},{title:"Descubre ofertas increíbles",subtitle:"Encuentra productos únicos y a los mejores precios, todos los días.",image:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80"},{title:"Compra con confianza",subtitle:"Verificación biométrica y pasarela de pagos segura para tu tranquilidad.",image:"https://images.unsplash.com/photo-1563013544-824ae1b704d3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80"},{title:"Únete a la comunidad LiveHopp",subtitle:"Interactúa con vendedores y compradores en tiempo real.",image:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80"}],zk=()=>{const[r,e]=_.useState(0);_.useEffect(()=>{const i=setInterval(()=>{e(o=>(o+1)%Nr.length)},7e3);return()=>clearInterval(i)},[]);const t=i=>{e(i)},n=()=>{e(i=>(i+1)%Nr.length)},s=()=>{e(i=>(i-1+Nr.length)%Nr.length)};return x.jsx("section",{className:"relative bg-muted overflow-hidden","aria-label":"Hero slider",children:x.jsx("div",{className:"max-w-7xl mx-auto",children:x.jsxs("div",{className:"relative h-[450px] md:h-[550px]",children:[x.jsx(ba,{mode:"wait",children:x.jsx($r.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.5,ease:"easeInOut"},className:"absolute inset-0",children:x.jsxs("div",{className:"relative h-full flex items-center justify-center",children:[x.jsx("img",{className:"absolute inset-0 w-full h-full object-cover",alt:Nr[r].title,src:Nr[r].image}),x.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"}),x.jsxs("div",{className:"relative z-10 text-center px-4 max-w-4xl",children:[x.jsx($r.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},className:"text-4xl md:text-6xl font-extrabold text-white mb-4 drop-shadow-lg",children:Nr[r].title}),x.jsx($r.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-lg md:text-xl text-gray-200 mb-8 drop-shadow-md",children:Nr[r].subtitle}),x.jsxs($r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.5},className:"flex flex-col sm:flex-row gap-4 justify-center",children:[x.jsx(ct,{to:"/categories",children:x.jsx(nt,{size:"lg",variant:"secondary",children:"Explora el Marketplace"})}),x.jsx(ct,{to:"/user?action=publish",children:x.jsx(nt,{size:"lg",variant:"outline",className:"border-white text-white hover:bg-white/10",children:"Publica tu producto"})})]})]})]})},r)}),x.jsx("button",{onClick:s,className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 bg-background/50 hover:bg-background/80 p-2 rounded-full shadow-lg transition-colors","aria-label":"Slide anterior",children:x.jsx(yT,{className:"w-6 h-6"})}),x.jsx("button",{onClick:n,className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 bg-background/50 hover:bg-background/80 p-2 rounded-full shadow-lg transition-colors","aria-label":"Siguiente slide",children:x.jsx(vT,{className:"w-6 h-6"})}),x.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-20 flex gap-2",children:Nr.map((i,o)=>x.jsx("button",{onClick:()=>t(o),className:`w-2.5 h-2.5 rounded-full transition-all duration-300 ${o===r?"bg-white scale-125":"bg-white/50"}`,"aria-label":`Ir al slide ${o+1}`},o))})]})})})};var Lf={exports:{}},mv;function Wk(){return mv||(mv=1,(()=>{var r={296:(s,i,o)=>{var u=/^\s+|\s+$/g,d=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,f=/^0o[0-7]+$/i,p=parseInt,m=typeof o.g=="object"&&o.g&&o.g.Object===Object&&o.g,y=typeof self=="object"&&self&&self.Object===Object&&self,v=m||y||Function("return this")(),S=Object.prototype.toString,T=Math.max,A=Math.min,L=function(){return v.Date.now()};function w(P){var B=typeof P;return!!P&&(B=="object"||B=="function")}function C(P){if(typeof P=="number")return P;if((function(N){return typeof N=="symbol"||(function(F){return!!F&&typeof F=="object"})(N)&&S.call(N)=="[object Symbol]"})(P))return NaN;if(w(P)){var B=typeof P.valueOf=="function"?P.valueOf():P;P=w(B)?B+"":B}if(typeof P!="string")return P===0?P:+P;P=P.replace(u,"");var D=c.test(P);return D||f.test(P)?p(P.slice(2),D?2:8):d.test(P)?NaN:+P}s.exports=function(P,B,D){var N,F,O,V,H,te,X=0,ae=!1,Q=!1,ie=!0;if(typeof P!="function")throw new TypeError("Expected a function");function G(re){var pe=N,me=F;return N=F=void 0,X=re,V=P.apply(me,pe)}function ee(re){var pe=re-te;return te===void 0||pe>=B||pe<0||Q&&re-X>=O}function Z(){var re=L();if(ee(re))return k(re);H=setTimeout(Z,(function(pe){var me=B-(pe-te);return Q?A(me,O-(pe-X)):me})(re))}function k(re){return H=void 0,ie&&N?G(re):(N=F=void 0,V)}function U(){var re=L(),pe=ee(re);if(N=arguments,F=this,te=re,pe){if(H===void 0)return(function(me){return X=me,H=setTimeout(Z,B),ae?G(me):V})(te);if(Q)return H=setTimeout(Z,B),G(te)}return H===void 0&&(H=setTimeout(Z,B)),V}return B=C(B)||0,w(D)&&(ae=!!D.leading,O=(Q="maxWait"in D)?T(C(D.maxWait)||0,B):O,ie="trailing"in D?!!D.trailing:ie),U.cancel=function(){H!==void 0&&clearTimeout(H),X=0,N=te=F=H=void 0},U.flush=function(){return H===void 0?V:k(L())},U}},96:(s,i,o)=>{var u="Expected a function",d=NaN,c="[object Symbol]",f=/^\s+|\s+$/g,p=/^[-+]0x[0-9a-f]+$/i,m=/^0b[01]+$/i,y=/^0o[0-7]+$/i,v=parseInt,S=typeof o.g=="object"&&o.g&&o.g.Object===Object&&o.g,T=typeof self=="object"&&self&&self.Object===Object&&self,A=S||T||Function("return this")(),L=Object.prototype.toString,w=Math.max,C=Math.min,P=function(){return A.Date.now()};function B(N){var F=typeof N;return!!N&&(F=="object"||F=="function")}function D(N){if(typeof N=="number")return N;if((function(V){return typeof V=="symbol"||(function(H){return!!H&&typeof H=="object"})(V)&&L.call(V)==c})(N))return d;if(B(N)){var F=typeof N.valueOf=="function"?N.valueOf():N;N=B(F)?F+"":F}if(typeof N!="string")return N===0?N:+N;N=N.replace(f,"");var O=m.test(N);return O||y.test(N)?v(N.slice(2),O?2:8):p.test(N)?d:+N}s.exports=function(N,F,O){var V=!0,H=!0;if(typeof N!="function")throw new TypeError(u);return B(O)&&(V="leading"in O?!!O.leading:V,H="trailing"in O?!!O.trailing:H),(function(te,X,ae){var Q,ie,G,ee,Z,k,U=0,re=!1,pe=!1,me=!0;if(typeof te!="function")throw new TypeError(u);function ye(Ke){var Gt=Q,xt=ie;return Q=ie=void 0,U=Ke,ee=te.apply(xt,Gt)}function ke(Ke){var Gt=Ke-k;return k===void 0||Gt>=X||Gt<0||pe&&Ke-U>=G}function Ce(){var Ke=P();if(ke(Ke))return Oe(Ke);Z=setTimeout(Ce,(function(Gt){var xt=X-(Gt-k);return pe?C(xt,G-(Gt-U)):xt})(Ke))}function Oe(Ke){return Z=void 0,me&&Q?ye(Ke):(Q=ie=void 0,ee)}function He(){var Ke=P(),Gt=ke(Ke);if(Q=arguments,ie=this,k=Ke,Gt){if(Z===void 0)return(function(xt){return U=xt,Z=setTimeout(Ce,X),re?ye(xt):ee})(k);if(pe)return Z=setTimeout(Ce,X),ye(k)}return Z===void 0&&(Z=setTimeout(Ce,X)),ee}return X=D(X)||0,B(ae)&&(re=!!ae.leading,G=(pe="maxWait"in ae)?w(D(ae.maxWait)||0,X):G,me="trailing"in ae?!!ae.trailing:me),He.cancel=function(){Z!==void 0&&clearTimeout(Z),U=0,Q=k=ie=Z=void 0},He.flush=function(){return Z===void 0?ee:Oe(P())},He})(N,F,{leading:V,maxWait:F,trailing:H})}},703:(s,i,o)=>{var u=o(414);function d(){}function c(){}c.resetWarningCache=d,s.exports=function(){function f(y,v,S,T,A,L){if(L!==u){var w=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw w.name="Invariant Violation",w}}function p(){return f}f.isRequired=f;var m={array:f,bigint:f,bool:f,func:f,number:f,object:f,string:f,symbol:f,any:f,arrayOf:p,element:f,elementType:f,instanceOf:p,node:f,objectOf:p,oneOf:p,oneOfType:p,shape:p,exact:p,checkPropTypes:c,resetWarningCache:d};return m.PropTypes=m,m}},697:(s,i,o)=>{s.exports=o(703)()},414:s=>{s.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},e={};function t(s){var i=e[s];if(i!==void 0)return i.exports;var o=e[s]={exports:{}};return r[s](o,o.exports,t),o.exports}t.n=s=>{var i=s&&s.__esModule?()=>s.default:()=>s;return t.d(i,{a:i}),i},t.d=(s,i)=>{for(var o in i)t.o(i,o)&&!t.o(s,o)&&Object.defineProperty(s,o,{enumerable:!0,get:i[o]})},t.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),t.o=(s,i)=>Object.prototype.hasOwnProperty.call(s,i),t.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var n={};(()=>{t.r(n),t.d(n,{LazyLoadComponent:()=>Gt,LazyLoadImage:()=>Ar,trackWindowScroll:()=>ee});const s=Da();var i=t.n(s),o=t(697);function u(){return typeof window<"u"&&"IntersectionObserver"in window&&"isIntersecting"in window.IntersectionObserverEntry.prototype}function d(le){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Y){return typeof Y}:function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y},d(le)}function c(le,Y){var de=Object.keys(le);if(Object.getOwnPropertySymbols){var fe=Object.getOwnPropertySymbols(le);Y&&(fe=fe.filter((function(Be){return Object.getOwnPropertyDescriptor(le,Be).enumerable}))),de.push.apply(de,fe)}return de}function f(le,Y,de){return(Y=m(Y))in le?Object.defineProperty(le,Y,{value:de,enumerable:!0,configurable:!0,writable:!0}):le[Y]=de,le}function p(le,Y){for(var de=0;de<Y.length;de++){var fe=Y[de];fe.enumerable=fe.enumerable||!1,fe.configurable=!0,"value"in fe&&(fe.writable=!0),Object.defineProperty(le,m(fe.key),fe)}}function m(le){var Y=(function(de,fe){if(d(de)!=="object"||de===null)return de;var Be=de[Symbol.toPrimitive];if(Be!==void 0){var Fe=Be.call(de,"string");if(d(Fe)!=="object")return Fe;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(de)})(le);return d(Y)==="symbol"?Y:String(Y)}function y(le,Y){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(de,fe){return de.__proto__=fe,de},y(le,Y)}function v(le){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Y){return Y.__proto__||Object.getPrototypeOf(Y)},v(le)}var S=function(le){le.forEach((function(Y){Y.isIntersecting&&Y.target.onVisible()}))},T={},A=(function(le){(function(ne,oe){if(typeof oe!="function"&&oe!==null)throw new TypeError("Super expression must either be null or a function");ne.prototype=Object.create(oe&&oe.prototype,{constructor:{value:ne,writable:!0,configurable:!0}}),Object.defineProperty(ne,"prototype",{writable:!1}),oe&&y(ne,oe)})($e,le);var Y,de,fe,Be,Fe=(fe=$e,Be=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var ne,oe=v(fe);if(Be){var Le=v(this).constructor;ne=Reflect.construct(oe,arguments,Le)}else ne=oe.apply(this,arguments);return(function(be,Ee){if(Ee&&(d(Ee)==="object"||typeof Ee=="function"))return Ee;if(Ee!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(Ve){if(Ve===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Ve})(be)})(this,ne)});function $e(ne){var oe;if((function(be,Ee){if(!(be instanceof Ee))throw new TypeError("Cannot call a class as a function")})(this,$e),(oe=Fe.call(this,ne)).supportsObserver=!ne.scrollPosition&&ne.useIntersectionObserver&&u(),oe.supportsObserver){var Le=ne.threshold;oe.observer=(function(be){return T[be]=T[be]||new IntersectionObserver(S,{rootMargin:be+"px"}),T[be]})(Le)}return oe}return Y=$e,de=[{key:"componentDidMount",value:function(){this.placeholder&&this.observer&&(this.placeholder.onVisible=this.props.onVisible,this.observer.observe(this.placeholder)),this.supportsObserver||this.updateVisibility()}},{key:"componentWillUnmount",value:function(){this.observer&&this.placeholder&&this.observer.unobserve(this.placeholder)}},{key:"componentDidUpdate",value:function(){this.supportsObserver||this.updateVisibility()}},{key:"getPlaceholderBoundingBox",value:function(){var ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props.scrollPosition,oe=this.placeholder.getBoundingClientRect(),Le=this.placeholder.style,be=parseInt(Le.getPropertyValue("margin-left"),10)||0,Ee=parseInt(Le.getPropertyValue("margin-top"),10)||0;return{bottom:ne.y+oe.bottom+Ee,left:ne.x+oe.left+be,right:ne.x+oe.right+be,top:ne.y+oe.top+Ee}}},{key:"isPlaceholderInViewport",value:function(){if(typeof window>"u"||!this.placeholder)return!1;var ne=this.props,oe=ne.scrollPosition,Le=ne.threshold,be=this.getPlaceholderBoundingBox(oe),Ee=oe.y+window.innerHeight,Ve=oe.x,st=oe.x+window.innerWidth,it=oe.y;return it-Le<=be.bottom&&Ee+Le>=be.top&&Ve-Le<=be.right&&st+Le>=be.left}},{key:"updateVisibility",value:function(){this.isPlaceholderInViewport()&&this.props.onVisible()}},{key:"render",value:function(){var ne=this,oe=this.props,Le=oe.className,be=oe.height,Ee=oe.placeholder,Ve=oe.style,st=oe.width;if(Ee&&typeof Ee.type!="function")return i().cloneElement(Ee,{ref:function(Ze){return ne.placeholder=Ze}});var it=(function(Ze){for(var mt=1;mt<arguments.length;mt++){var ot=arguments[mt]!=null?arguments[mt]:{};mt%2?c(Object(ot),!0).forEach((function(Bt){f(Ze,Bt,ot[Bt])})):Object.getOwnPropertyDescriptors?Object.defineProperties(Ze,Object.getOwnPropertyDescriptors(ot)):c(Object(ot)).forEach((function(Bt){Object.defineProperty(Ze,Bt,Object.getOwnPropertyDescriptor(ot,Bt))}))}return Ze})({display:"inline-block"},Ve);return st!==void 0&&(it.width=st),be!==void 0&&(it.height=be),i().createElement("span",{className:Le,ref:function(Ze){return ne.placeholder=Ze},style:it},Ee)}}],de&&p(Y.prototype,de),Object.defineProperty(Y,"prototype",{writable:!1}),$e})(i().Component);A.propTypes={onVisible:o.PropTypes.func.isRequired,className:o.PropTypes.string,height:o.PropTypes.oneOfType([o.PropTypes.number,o.PropTypes.string]),placeholder:o.PropTypes.element,threshold:o.PropTypes.number,useIntersectionObserver:o.PropTypes.bool,scrollPosition:o.PropTypes.shape({x:o.PropTypes.number.isRequired,y:o.PropTypes.number.isRequired}),width:o.PropTypes.oneOfType([o.PropTypes.number,o.PropTypes.string])},A.defaultProps={className:"",placeholder:null,threshold:100,useIntersectionObserver:!0};const L=A;var w=t(296),C=t.n(w),P=t(96),B=t.n(P),D=function(le){var Y=getComputedStyle(le,null);return Y.getPropertyValue("overflow")+Y.getPropertyValue("overflow-y")+Y.getPropertyValue("overflow-x")};const N=function(le){if(!(le instanceof HTMLElement))return window;for(var Y=le;Y&&Y instanceof HTMLElement;){if(/(scroll|auto)/.test(D(Y)))return Y;Y=Y.parentNode}return window};function F(le){return F=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Y){return typeof Y}:function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y},F(le)}var O=["delayMethod","delayTime"];function V(){return V=Object.assign?Object.assign.bind():function(le){for(var Y=1;Y<arguments.length;Y++){var de=arguments[Y];for(var fe in de)Object.prototype.hasOwnProperty.call(de,fe)&&(le[fe]=de[fe])}return le},V.apply(this,arguments)}function H(le,Y){for(var de=0;de<Y.length;de++){var fe=Y[de];fe.enumerable=fe.enumerable||!1,fe.configurable=!0,"value"in fe&&(fe.writable=!0),Object.defineProperty(le,(Be=(function(Fe,$e){if(F(Fe)!=="object"||Fe===null)return Fe;var ne=Fe[Symbol.toPrimitive];if(ne!==void 0){var oe=ne.call(Fe,"string");if(F(oe)!=="object")return oe;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Fe)})(fe.key),F(Be)==="symbol"?Be:String(Be)),fe)}var Be}function te(le,Y){return te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(de,fe){return de.__proto__=fe,de},te(le,Y)}function X(le,Y){if(Y&&(F(Y)==="object"||typeof Y=="function"))return Y;if(Y!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ae(le)}function ae(le){if(le===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return le}function Q(le){return Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Y){return Y.__proto__||Object.getPrototypeOf(Y)},Q(le)}var ie=function(){return typeof window>"u"?0:window.scrollX||window.pageXOffset},G=function(){return typeof window>"u"?0:window.scrollY||window.pageYOffset};const ee=function(le){var Y=(function(de){(function(Le,be){if(typeof be!="function"&&be!==null)throw new TypeError("Super expression must either be null or a function");Le.prototype=Object.create(be&&be.prototype,{constructor:{value:Le,writable:!0,configurable:!0}}),Object.defineProperty(Le,"prototype",{writable:!1}),be&&te(Le,be)})(oe,de);var fe,Be,Fe,$e,ne=(Fe=oe,$e=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var Le,be=Q(Fe);if($e){var Ee=Q(this).constructor;Le=Reflect.construct(be,arguments,Ee)}else Le=be.apply(this,arguments);return X(this,Le)});function oe(Le){var be;if((function(Ve,st){if(!(Ve instanceof st))throw new TypeError("Cannot call a class as a function")})(this,oe),(be=ne.call(this,Le)).useIntersectionObserver=Le.useIntersectionObserver&&u(),be.useIntersectionObserver)return X(be);var Ee=be.onChangeScroll.bind(ae(be));return Le.delayMethod==="debounce"?be.delayedScroll=C()(Ee,Le.delayTime):Le.delayMethod==="throttle"&&(be.delayedScroll=B()(Ee,Le.delayTime)),be.state={scrollPosition:{x:ie(),y:G()}},be.baseComponentRef=i().createRef(),be}return fe=oe,(Be=[{key:"componentDidMount",value:function(){this.addListeners()}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"componentDidUpdate",value:function(){typeof window>"u"||this.useIntersectionObserver||N(this.baseComponentRef.current)!==this.scrollElement&&(this.removeListeners(),this.addListeners())}},{key:"addListeners",value:function(){typeof window>"u"||this.useIntersectionObserver||(this.scrollElement=N(this.baseComponentRef.current),this.scrollElement.addEventListener("scroll",this.delayedScroll,{passive:!0}),window.addEventListener("resize",this.delayedScroll,{passive:!0}),this.scrollElement!==window&&window.addEventListener("scroll",this.delayedScroll,{passive:!0}))}},{key:"removeListeners",value:function(){typeof window>"u"||this.useIntersectionObserver||(this.scrollElement.removeEventListener("scroll",this.delayedScroll),window.removeEventListener("resize",this.delayedScroll),this.scrollElement!==window&&window.removeEventListener("scroll",this.delayedScroll))}},{key:"onChangeScroll",value:function(){this.useIntersectionObserver||this.setState({scrollPosition:{x:ie(),y:G()}})}},{key:"render",value:function(){var Le=this.props,be=(Le.delayMethod,Le.delayTime,(function(Ve,st){if(Ve==null)return{};var it,Ze,mt=(function(Bt,Lr){if(Bt==null)return{};var ir,_s,go={},hi=Object.keys(Bt);for(_s=0;_s<hi.length;_s++)ir=hi[_s],Lr.indexOf(ir)>=0||(go[ir]=Bt[ir]);return go})(Ve,st);if(Object.getOwnPropertySymbols){var ot=Object.getOwnPropertySymbols(Ve);for(Ze=0;Ze<ot.length;Ze++)it=ot[Ze],st.indexOf(it)>=0||Object.prototype.propertyIsEnumerable.call(Ve,it)&&(mt[it]=Ve[it])}return mt})(Le,O)),Ee=this.useIntersectionObserver?null:this.state.scrollPosition;return i().createElement(le,V({forwardRef:this.baseComponentRef,scrollPosition:Ee},be))}}])&&H(fe.prototype,Be),Object.defineProperty(fe,"prototype",{writable:!1}),oe})(i().Component);return Y.propTypes={delayMethod:o.PropTypes.oneOf(["debounce","throttle"]),delayTime:o.PropTypes.number,useIntersectionObserver:o.PropTypes.bool},Y.defaultProps={delayMethod:"throttle",delayTime:300,useIntersectionObserver:!0},Y};function Z(le){return Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Y){return typeof Y}:function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y},Z(le)}function k(le,Y){for(var de=0;de<Y.length;de++){var fe=Y[de];fe.enumerable=fe.enumerable||!1,fe.configurable=!0,"value"in fe&&(fe.writable=!0),Object.defineProperty(le,(Be=(function(Fe,$e){if(Z(Fe)!=="object"||Fe===null)return Fe;var ne=Fe[Symbol.toPrimitive];if(ne!==void 0){var oe=ne.call(Fe,"string");if(Z(oe)!=="object")return oe;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Fe)})(fe.key),Z(Be)==="symbol"?Be:String(Be)),fe)}var Be}function U(le,Y){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(de,fe){return de.__proto__=fe,de},U(le,Y)}function re(le){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Y){return Y.__proto__||Object.getPrototypeOf(Y)},re(le)}var pe=(function(le){(function(ne,oe){if(typeof oe!="function"&&oe!==null)throw new TypeError("Super expression must either be null or a function");ne.prototype=Object.create(oe&&oe.prototype,{constructor:{value:ne,writable:!0,configurable:!0}}),Object.defineProperty(ne,"prototype",{writable:!1}),oe&&U(ne,oe)})($e,le);var Y,de,fe,Be,Fe=(fe=$e,Be=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var ne,oe=re(fe);if(Be){var Le=re(this).constructor;ne=Reflect.construct(oe,arguments,Le)}else ne=oe.apply(this,arguments);return(function(be,Ee){if(Ee&&(Z(Ee)==="object"||typeof Ee=="function"))return Ee;if(Ee!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(Ve){if(Ve===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Ve})(be)})(this,ne)});function $e(ne){return(function(oe,Le){if(!(oe instanceof Le))throw new TypeError("Cannot call a class as a function")})(this,$e),Fe.call(this,ne)}return Y=$e,(de=[{key:"render",value:function(){return i().createElement(L,this.props)}}])&&k(Y.prototype,de),Object.defineProperty(Y,"prototype",{writable:!1}),$e})(i().Component);const me=ee(pe);function ye(le){return ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Y){return typeof Y}:function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y},ye(le)}function ke(le,Y){for(var de=0;de<Y.length;de++){var fe=Y[de];fe.enumerable=fe.enumerable||!1,fe.configurable=!0,"value"in fe&&(fe.writable=!0),Object.defineProperty(le,(Be=(function(Fe,$e){if(ye(Fe)!=="object"||Fe===null)return Fe;var ne=Fe[Symbol.toPrimitive];if(ne!==void 0){var oe=ne.call(Fe,"string");if(ye(oe)!=="object")return oe;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Fe)})(fe.key),ye(Be)==="symbol"?Be:String(Be)),fe)}var Be}function Ce(le,Y){return Ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(de,fe){return de.__proto__=fe,de},Ce(le,Y)}function Oe(le){if(le===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return le}function He(le){return He=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Y){return Y.__proto__||Object.getPrototypeOf(Y)},He(le)}var Ke=(function(le){(function(ne,oe){if(typeof oe!="function"&&oe!==null)throw new TypeError("Super expression must either be null or a function");ne.prototype=Object.create(oe&&oe.prototype,{constructor:{value:ne,writable:!0,configurable:!0}}),Object.defineProperty(ne,"prototype",{writable:!1}),oe&&Ce(ne,oe)})($e,le);var Y,de,fe,Be,Fe=(fe=$e,Be=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var ne,oe=He(fe);if(Be){var Le=He(this).constructor;ne=Reflect.construct(oe,arguments,Le)}else ne=oe.apply(this,arguments);return(function(be,Ee){if(Ee&&(ye(Ee)==="object"||typeof Ee=="function"))return Ee;if(Ee!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Oe(be)})(this,ne)});function $e(ne){var oe;(function(st,it){if(!(st instanceof it))throw new TypeError("Cannot call a class as a function")})(this,$e),oe=Fe.call(this,ne);var Le=ne.afterLoad,be=ne.beforeLoad,Ee=ne.scrollPosition,Ve=ne.visibleByDefault;return oe.state={visible:Ve},Ve&&(be(),Le()),oe.onVisible=oe.onVisible.bind(Oe(oe)),oe.isScrollTracked=!!(Ee&&Number.isFinite(Ee.x)&&Ee.x>=0&&Number.isFinite(Ee.y)&&Ee.y>=0),oe}return Y=$e,(de=[{key:"componentDidUpdate",value:function(ne,oe){oe.visible!==this.state.visible&&this.props.afterLoad()}},{key:"onVisible",value:function(){this.props.beforeLoad(),this.setState({visible:!0})}},{key:"render",value:function(){if(this.state.visible)return this.props.children;var ne=this.props,oe=ne.className,Le=ne.delayMethod,be=ne.delayTime,Ee=ne.height,Ve=ne.placeholder,st=ne.scrollPosition,it=ne.style,Ze=ne.threshold,mt=ne.useIntersectionObserver,ot=ne.width;return this.isScrollTracked||mt&&u()?i().createElement(L,{className:oe,height:Ee,onVisible:this.onVisible,placeholder:Ve,scrollPosition:st,style:it,threshold:Ze,useIntersectionObserver:mt,width:ot}):i().createElement(me,{className:oe,delayMethod:Le,delayTime:be,height:Ee,onVisible:this.onVisible,placeholder:Ve,style:it,threshold:Ze,width:ot})}}])&&ke(Y.prototype,de),Object.defineProperty(Y,"prototype",{writable:!1}),$e})(i().Component);Ke.propTypes={afterLoad:o.PropTypes.func,beforeLoad:o.PropTypes.func,useIntersectionObserver:o.PropTypes.bool,visibleByDefault:o.PropTypes.bool},Ke.defaultProps={afterLoad:function(){return{}},beforeLoad:function(){return{}},useIntersectionObserver:!0,visibleByDefault:!1};const Gt=Ke;function xt(le){return xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Y){return typeof Y}:function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y},xt(le)}var Sr=["afterLoad","beforeLoad","delayMethod","delayTime","effect","placeholder","placeholderSrc","scrollPosition","threshold","useIntersectionObserver","visibleByDefault","wrapperClassName","wrapperProps"];function fi(le,Y){var de=Object.keys(le);if(Object.getOwnPropertySymbols){var fe=Object.getOwnPropertySymbols(le);Y&&(fe=fe.filter((function(Be){return Object.getOwnPropertyDescriptor(le,Be).enumerable}))),de.push.apply(de,fe)}return de}function ze(le){for(var Y=1;Y<arguments.length;Y++){var de=arguments[Y]!=null?arguments[Y]:{};Y%2?fi(Object(de),!0).forEach((function(fe){wt(le,fe,de[fe])})):Object.getOwnPropertyDescriptors?Object.defineProperties(le,Object.getOwnPropertyDescriptors(de)):fi(Object(de)).forEach((function(fe){Object.defineProperty(le,fe,Object.getOwnPropertyDescriptor(de,fe))}))}return le}function wt(le,Y,de){return(Y=Ot(Y))in le?Object.defineProperty(le,Y,{value:de,enumerable:!0,configurable:!0,writable:!0}):le[Y]=de,le}function Dt(){return Dt=Object.assign?Object.assign.bind():function(le){for(var Y=1;Y<arguments.length;Y++){var de=arguments[Y];for(var fe in de)Object.prototype.hasOwnProperty.call(de,fe)&&(le[fe]=de[fe])}return le},Dt.apply(this,arguments)}function Ln(le,Y){for(var de=0;de<Y.length;de++){var fe=Y[de];fe.enumerable=fe.enumerable||!1,fe.configurable=!0,"value"in fe&&(fe.writable=!0),Object.defineProperty(le,Ot(fe.key),fe)}}function Ot(le){var Y=(function(de,fe){if(xt(de)!=="object"||de===null)return de;var Be=de[Symbol.toPrimitive];if(Be!==void 0){var Fe=Be.call(de,"string");if(xt(Fe)!=="object")return Fe;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(de)})(le);return xt(Y)==="symbol"?Y:String(Y)}function Yt(le,Y){return Yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(de,fe){return de.__proto__=fe,de},Yt(le,Y)}function Jt(le){return Jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Y){return Y.__proto__||Object.getPrototypeOf(Y)},Jt(le)}var br=(function(le){(function(ne,oe){if(typeof oe!="function"&&oe!==null)throw new TypeError("Super expression must either be null or a function");ne.prototype=Object.create(oe&&oe.prototype,{constructor:{value:ne,writable:!0,configurable:!0}}),Object.defineProperty(ne,"prototype",{writable:!1}),oe&&Yt(ne,oe)})($e,le);var Y,de,fe,Be,Fe=(fe=$e,Be=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var ne,oe=Jt(fe);if(Be){var Le=Jt(this).constructor;ne=Reflect.construct(oe,arguments,Le)}else ne=oe.apply(this,arguments);return(function(be,Ee){if(Ee&&(xt(Ee)==="object"||typeof Ee=="function"))return Ee;if(Ee!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(Ve){if(Ve===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Ve})(be)})(this,ne)});function $e(ne){var oe;return(function(Le,be){if(!(Le instanceof be))throw new TypeError("Cannot call a class as a function")})(this,$e),(oe=Fe.call(this,ne)).state={loaded:!1},oe}return Y=$e,(de=[{key:"onImageLoad",value:function(){var ne=this;return this.state.loaded?null:function(oe){ne.props.onLoad(oe),ne.props.afterLoad(),ne.setState({loaded:!0})}}},{key:"getImg",value:function(){var ne=this.props,oe=(ne.afterLoad,ne.beforeLoad,ne.delayMethod,ne.delayTime,ne.effect,ne.placeholder,ne.placeholderSrc,ne.scrollPosition,ne.threshold,ne.useIntersectionObserver,ne.visibleByDefault,ne.wrapperClassName,ne.wrapperProps,(function(Le,be){if(Le==null)return{};var Ee,Ve,st=(function(Ze,mt){if(Ze==null)return{};var ot,Bt,Lr={},ir=Object.keys(Ze);for(Bt=0;Bt<ir.length;Bt++)ot=ir[Bt],mt.indexOf(ot)>=0||(Lr[ot]=Ze[ot]);return Lr})(Le,be);if(Object.getOwnPropertySymbols){var it=Object.getOwnPropertySymbols(Le);for(Ve=0;Ve<it.length;Ve++)Ee=it[Ve],be.indexOf(Ee)>=0||Object.prototype.propertyIsEnumerable.call(Le,Ee)&&(st[Ee]=Le[Ee])}return st})(ne,Sr));return i().createElement("img",Dt({},oe,{onLoad:this.onImageLoad()}))}},{key:"getLazyLoadImage",value:function(){var ne=this.props,oe=ne.beforeLoad,Le=ne.className,be=ne.delayMethod,Ee=ne.delayTime,Ve=ne.height,st=ne.placeholder,it=ne.scrollPosition,Ze=ne.style,mt=ne.threshold,ot=ne.useIntersectionObserver,Bt=ne.visibleByDefault,Lr=ne.width;return i().createElement(Gt,{beforeLoad:oe,className:Le,delayMethod:be,delayTime:Ee,height:Ve,placeholder:st,scrollPosition:it,style:Ze,threshold:mt,useIntersectionObserver:ot,visibleByDefault:Bt,width:Lr},this.getImg())}},{key:"getWrappedLazyLoadImage",value:function(ne){var oe=this.props,Le=oe.effect,be=oe.height,Ee=oe.placeholderSrc,Ve=oe.width,st=oe.wrapperClassName,it=oe.wrapperProps,Ze=this.state.loaded,mt=Ze?" lazy-load-image-loaded":"",ot=Ze||!Ee?{}:{backgroundImage:"url(".concat(Ee,")"),backgroundSize:"100% 100%"};return i().createElement("span",Dt({className:st+" lazy-load-image-background "+Le+mt,style:ze(ze({},ot),{},{color:"transparent",display:"inline-block",height:be,width:Ve})},it),ne)}},{key:"render",value:function(){var ne=this.props,oe=ne.effect,Le=ne.placeholderSrc,be=ne.visibleByDefault,Ee=ne.wrapperClassName,Ve=ne.wrapperProps,st=this.getLazyLoadImage();return(oe||Le)&&!be||Ee||Ve?this.getWrappedLazyLoadImage(st):st}}])&&Ln(Y.prototype,de),Object.defineProperty(Y,"prototype",{writable:!1}),$e})(i().Component);br.propTypes={onLoad:o.PropTypes.func,afterLoad:o.PropTypes.func,beforeLoad:o.PropTypes.func,delayMethod:o.PropTypes.string,delayTime:o.PropTypes.number,effect:o.PropTypes.string,placeholderSrc:o.PropTypes.string,threshold:o.PropTypes.number,useIntersectionObserver:o.PropTypes.bool,visibleByDefault:o.PropTypes.bool,wrapperClassName:o.PropTypes.string,wrapperProps:o.PropTypes.object},br.defaultProps={onLoad:function(){},afterLoad:function(){return{}},beforeLoad:function(){return{}},delayMethod:"throttle",delayTime:300,effect:"",placeholderSrc:null,threshold:100,useIntersectionObserver:!0,visibleByDefault:!1,wrapperClassName:""};const Ar=br})(),Lf.exports=n})()),Lf.exports}var Ah=Wk();function gv(r,{slotKey:e,creativeId:t}){window.gtag&&window.gtag("event",r,{event_category:"ads",event_label:`${e}:${t}`,slot:e,creative_id:t}),console.debug("[ad-event]",r,e,t)}const Ap=({slotKey:r,slotData:e,className:t=""})=>{const n=_.useRef(null),[s,i]=_.useState(null),o=_.useRef(!1);_.useEffect(()=>{if(e){const d=e.rotation||e.items;d&&d.length>0&&i(d[0])}},[e]),_.useEffect(()=>{if(!s||!n.current||o.current)return;const d=new IntersectionObserver(c=>{c.forEach(f=>{f.isIntersecting&&(gv("ad_impression",{slotKey:r,creativeId:s.id}),o.current=!0,d.unobserve(f.target))})},{threshold:.5});return d.observe(n.current),()=>{n.current&&d.unobserve(n.current)}},[s,r]);const u=()=>{gv("ad_click",{slotKey:r,creativeId:s.id})};return s?x.jsx("div",{ref:n,role:"region","aria-label":"Publicidad",className:`w-full bg-gray-100 overflow-hidden ${t}`,style:{aspectRatio:s.ratio.replace("/"," / ")},children:x.jsx("a",{href:s.href,onClick:u,target:"_blank",rel:"noopener noreferrer",className:"block w-full h-full focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2 rounded-lg",children:x.jsx(Ah.LazyLoadImage,{src:s.src,alt:s.alt,effect:"blur",decoding:"async",className:"w-full h-full object-cover",wrapperClassName:"w-full h-full"})})}):(e?.rotation?.[0]?.ratio||e?.items?.[0]?.ratio,null)};let eu=null;const yv={"sandbox:/mnt/data/ads_with_logo/ad_hero_publicite.png":"/assets/ad_hero_publicite.png","sandbox:/mnt/data/ads_with_logo/ad_rail_300x600_publicite.png":"/assets/ad_rail_300x600.png","sandbox:/mnt/data/ads_with_logo/ad_rail_300x250_publicite.png":"/assets/ad_rail_300x250.png","sandbox:/mnt/data/ads_with_logo/ad_infeed_live_publicite.png":"/assets/ad_infeed_live_publicite.png","sandbox:/mnt/data/ads_with_logo/ad_infeed_catalog_publicite.png":"/assets/ad_infeed_catalog_publicite.png","sandbox:/mnt/data/ads_with_logo/ad_prefooter_publicite.png":"/assets/ad_prefooter_publicite.png","sandbox:/mnt/data/ads_with_logo/ad_sticky_footer_publicite.png":"/assets/ad_sticky_footer_publicite.png"},dS=()=>{const[r,e]=_.useState(eu),[t,n]=_.useState({});_.useEffect(()=>{(async()=>{if(eu)e(eu);else try{const d=await(await fetch("/ads_config.json")).json();let c=JSON.stringify(d);for(const p in yv)c=c.replace(new RegExp(p.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),yv[p]);const f=JSON.parse(c);eu=f,e(f)}catch(u){console.error("Failed to fetch or parse ad config:",u)}const o=localStorage.getItem("ads_overrides");if(o)try{n(JSON.parse(o))}catch(u){console.error("Failed to parse ads overrides from localStorage",u)}})()},[]);const s=i=>{if(!r||!r.slots||!r.slots[i])return null;const o=r.slots[i];return t.hasOwnProperty(i)?t[i]?o:null:o.enabled!==!1?o:null};return{config:r?.slots,getSlot:s,setOverrides:n}},Yk=({sellers:r})=>{const e=_.useRef(null),t=zn(),{getSlot:n}=dS(),s=n("ad-infeed-live"),i=d=>{if(e.current){const c=d==="left"?-300:300;e.current.scrollBy({left:c,behavior:"smooth"})}},o=d=>{const{id:c,player:f}=d,{embed_type:p,embed_src:m}=f;t(`/live/${c}?type=${encodeURIComponent(p)}&src=${encodeURIComponent(m)}`)},u=[];return s&&s.every>0?r.forEach((d,c)=>{u.push({type:"seller",data:d}),(c+1)%s.every===0&&u.push({type:"ad",data:s,key:`ad-${c}`})}):r.forEach(d=>u.push({type:"seller",data:d})),x.jsx("section",{id:"live-carousel",className:"py-12 bg-white","aria-label":"Vendedores en vivo (LiveHopp)",children:x.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[x.jsxs("div",{className:"flex items-center justify-between mb-6",children:[x.jsx("h2",{className:"text-2xl md:text-3xl font-semibold text-gray-900",children:"LiveHopp"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("button",{onClick:()=>i("left"),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors","aria-label":"Desplazar a la izquierda",children:x.jsx(yT,{className:"w-5 h-5 text-gray-700"})}),x.jsx("button",{onClick:()=>i("right"),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors","aria-label":"Desplazar a la derecha",children:x.jsx(vT,{className:"w-5 h-5 text-gray-700"})})]})]}),x.jsx("div",{ref:e,className:"flex gap-4 overflow-x-auto scroll-snap-x no-scrollbar pb-4",children:u.map((d,c)=>{if(d.type==="ad")return x.jsx("div",{className:"flex-shrink-0 w-72 scroll-snap-center",children:x.jsx(Ap,{slotKey:"ad-infeed-live",slotData:d.data,className:"rounded-lg"})},d.key);const f=d.data;return x.jsxs("div",{className:"flex-shrink-0 w-72 bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow scroll-snap-center group",children:[x.jsxs("div",{className:"relative aspect-video",children:[x.jsx(Ah.LazyLoadImage,{className:"w-full h-full object-cover",alt:`Live de ${f.name}`,src:f.thumbnail,effect:"blur",wrapperClassName:"w-full h-full"}),x.jsx("div",{className:"absolute top-2 left-2 bg-red-600 text-white text-xs font-semibold px-2 py-1 rounded",children:"LIVE"}),x.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded flex items-center gap-1",children:[x.jsx(xT,{className:"w-3 h-3"}),f.viewers.toLocaleString()]})]}),x.jsxs("div",{className:"p-4",children:[x.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[x.jsx(Ah.LazyLoadImage,{className:"w-10 h-10 rounded-full object-cover",alt:`Avatar de ${f.name}`,src:f.avatar,effect:"blur",wrapperClassName:"w-10 h-10 rounded-full overflow-hidden flex-shrink-0"}),x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsx("p",{className:"font-semibold text-gray-900 truncate",children:f.name}),x.jsx("p",{className:"text-sm text-gray-500 truncate",children:f.handle})]})]}),x.jsx("div",{className:"mb-3",children:x.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:f.category})}),x.jsxs("div",{className:"mb-3",children:[x.jsx("p",{className:"text-sm text-gray-700 font-medium",children:f.featuredProduct.name}),x.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["USD ",f.featuredProduct.price]})]}),x.jsx(nt,{variant:"outline",className:"w-full border-gray-900 text-gray-900 hover:bg-gray-50 group-hover:bg-gray-900 group-hover:text-white transition-colors",onClick:()=>o(f),"aria-label":`Ver live de ${f.name}`,children:"Ver live"})]})]},f.id)})})]})})},Lh=[{id:1,title:"Anuncio Premium 1",image:"https://images.unsplash.com/photo-1511556532299-8f662fc26c06?q=80&w=2070"},{id:2,title:"Anuncio Premium 2",image:"https://images.unsplash.com/photo-1556742502-ec7c0e9f34b1?q=80&w=2070"},{id:3,title:"Anuncio Premium 3",image:"https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=2070"},{id:4,title:"Anuncio Premium 4",image:"https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?q=80&w=2070"},{id:5,title:"Anuncio Premium 5",image:"https://images.unsplash.com/photo-1572569511254-d8f925fe2cbb?q=80&w=2070"},{id:6,title:"Anuncio Premium 6",image:"https://images.unsplash.com/photo-1560343090-f0409e92791a?q=80&w=1964"},{id:7,title:"Anuncio Premium 7",image:"https://images.unsplash.com/photo-1581235720704-06d3acfcb36f?q=80&w=1965"},{id:8,title:"Anuncio Premium 8",image:"https://images.unsplash.com/photo-1546868871-7041f2a55e12?q=80&w=1964"},{id:9,title:"Anuncio Premium 9",image:"https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?q=80&w=1964"},{id:10,title:"Anuncio Premium 10",image:"https://images.unsplash.com/photo-1552346154-21d32810aba3?q=80&w=2070"}],qk=[...Lh,...Lh],Xk=()=>{const r={animate:{x:["-100%","0%"],transition:{x:{repeat:1/0,repeatType:"loop",duration:Lh.length*5,ease:"linear"}}}};return x.jsx("section",{className:"py-12 bg-white","aria-label":"Anuncios premium",children:x.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[x.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2 text-center",children:"Anuncios Premium"}),x.jsx("div",{className:"w-48 h-1 mx-auto mb-6 brand-divider"}),x.jsx("div",{className:"w-full overflow-hidden",children:x.jsx($r.div,{className:"flex",variants:r,animate:"animate",style:{scale:1.1},children:qk.map((e,t)=>x.jsx("div",{className:"flex-shrink-0 w-1/5 px-2",children:x.jsx("div",{className:"bg-gray-100 border border-gray-200 rounded-lg overflow-hidden group",children:x.jsxs("div",{className:"aspect-video relative",children:[x.jsx("img",{className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",alt:e.title,src:e.image}),x.jsx("div",{className:"absolute top-2 right-2 bg-white/90 text-gray-700 text-xs px-2 py-1 rounded",children:"Anuncio"})]})})},t))})})]})})},Qk=()=>x.jsx("div",{className:"bg-card border-t border-b",children:x.jsxs("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:py-16 lg:px-8 lg:flex lg:items-center lg:justify-between",children:[x.jsxs("h2",{className:"text-3xl font-extrabold tracking-tight text-foreground sm:text-4xl",children:[x.jsx("span",{className:"block",children:"¿Listo para vender?"}),x.jsx("span",{className:"block text-primary",children:"Publica tu producto en minutos."})]}),x.jsxs("div",{className:"mt-8 flex lg:mt-0 lg:flex-shrink-0",children:[x.jsx("div",{className:"inline-flex rounded-md shadow",children:x.jsx(ct,{to:"/user?action=publish",children:x.jsxs(nt,{size:"lg",className:"btn-primary",children:[x.jsx(bP,{className:"mr-2 h-6 w-6"}),"Publica tu producto"]})})}),x.jsx("div",{className:"ml-3 inline-flex rounded-md shadow",children:x.jsx(ct,{to:"/sellers",children:x.jsx(nt,{size:"lg",variant:"outline",children:"Conoce a nuestros vendedores"})})})]})]})}),an=({children:r})=>x.jsx($r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:r}),cc=({product:r,onAddToCart:e})=>{const t=r.live_shopping_enabled;return x.jsxs("div",{className:"card bg-card text-card-foreground rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1",children:[x.jsx(ct,{to:`/product/${r.id}`,className:"block overflow-hidden",children:x.jsx("img",{src:r.image,alt:r.name,className:"w-full h-48 object-cover transform hover:scale-105 transition-transform duration-300"})}),x.jsxs("div",{className:"p-4",children:[x.jsx("h3",{className:"font-bold text-lg mb-2 truncate",children:r.name}),x.jsxs("div",{className:"flex justify-between items-center mb-4",children:[x.jsx("div",{children:r.offer_price?x.jsxs(x.Fragment,{children:[x.jsxs("p",{className:"text-muted-foreground line-through text-sm",children:["$",r.price]}),x.jsxs("p",{className:"text-destructive font-bold text-xl",children:["$",r.offer_price]})]}):x.jsxs("p",{className:"font-bold text-xl",children:["$",r.price]})}),x.jsx(nt,{onClick:()=>e(r),size:"icon",variant:"secondary",children:x.jsx(Uu,{size:20})})]}),x.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:[x.jsxs("p",{children:["Rating: ",r.rating," ★"]}),x.jsxs("p",{children:[r.sold_count," vendidos"]})]}),x.jsxs("div",{className:"flex justify-between gap-2",children:[x.jsx(ct,{to:`/product/${r.id}`,className:"flex-1",children:x.jsxs(nt,{variant:"outline",className:"w-full",children:[x.jsx(xT,{size:16,className:"mr-2"}),"Ver Producto"]})}),t&&x.jsx(ct,{to:`/live/${r.seller_id}`,className:"flex-1",children:x.jsxs(nt,{variant:"destructive",className:"w-full",children:[x.jsx(_P,{size:16,className:"mr-2"}),"Ver Live"]})})]})]})]})},Zk=[{question:"¿Cómo funciona la compra con 1 clic en los live streams?",answer:"Durante una transmisión en vivo, verás un botón de ‘Comprar ahora’ en los productos destacados. Si tienes tus datos guardados, un solo clic confirmará tu compra instantáneamente."},{question:"¿Qué es la publicación con IA?",answer:"Nuestra IA analiza la imagen de tu producto y genera automáticamente un título atractivo, una descripción detallada y etiquetas SEO para maximizar tu visibilidad."},{question:"¿Es segura la verificación biométrica?",answer:"Sí, utilizamos tecnología de encriptación avanzada para proteger tus datos biométricos. Este proceso verifica tu identidad para prevenir el fraude y aumentar la confianza en la plataforma."},{question:"¿Puedo integrar SimpleMarket360 con mi tienda de Shopify?",answer:"¡Sí! Nuestro Centro de Integraciones te permite conectar fácilmente con plataformas como Shopify, WooCommerce, así como con tu CRM o ERP para sincronizar inventario y pedidos."}],Jk=()=>{const[r,e]=_.useState(null),t=n=>{e(r===n?null:n)};return x.jsx("section",{className:"bg-white py-12 md:py-20",children:x.jsxs("div",{className:"max-w-3xl mx-auto px-4",children:[x.jsx("h2",{className:"text-3xl font-bold text-primary text-center mb-8",children:"Preguntas Frecuentes"}),x.jsx("div",{className:"space-y-4",children:Zk.map((n,s)=>x.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[x.jsxs("button",{onClick:()=>t(s),className:"w-full flex justify-between items-center p-5 text-left",children:[x.jsx("span",{className:"font-medium text-gray-800",children:n.question}),x.jsx(EP,{className:`w-5 h-5 text-primary transition-transform ${r===s?"transform rotate-180":""}`})]}),x.jsx(ba,{children:r===s&&x.jsx($r.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:x.jsx("div",{className:"px-5 pb-5 text-gray-600",children:x.jsx("p",{children:n.answer})})})})]},s))})]})})},eD=({categorizedData:r,sellers:e,onAddToCart:t})=>{const{categories:n}=r;return x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsx("title",{children:"SimpleMarket360 - LiveHopp - Marketplace Minimalista y Rápido"}),x.jsx("meta",{name:"description",content:"Compra y vende en vivo con LiveHopp. Marketplace con verificación biométrica, IA para publicaciones y centro de integraciones. Rápido, seguro y mobile-first."})]}),x.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-20 focus:left-4 focus:z-50 bg-primary text-primary-foreground px-4 py-2 rounded-md",children:"Saltar a contenido principal"}),x.jsx(zk,{}),x.jsx("div",{className:"my-8",children:x.jsx(Xk,{})}),x.jsx(Yk,{sellers:e}),x.jsx("main",{id:"main-content",className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n&&n.length>0?n.map(s=>s.items.length>0&&x.jsxs("section",{id:s.slug,className:"py-12",children:[x.jsxs("div",{className:"flex justify-between items-baseline mb-6",children:[x.jsx("h2",{className:"text-3xl font-bold text-foreground",children:s.name}),x.jsxs(ct,{to:`/categories#${s.slug}`,className:"text-sm font-medium text-primary hover:text-primary/90",children:["Ver todos (",s.count,")"]})]}),x.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:s.items.slice(0,5).map(i=>x.jsx(cc,{product:i,onAddToCart:t},i.id))})]},s.slug)):x.jsx("div",{className:"text-center py-16",children:x.jsx("p",{className:"text-muted-foreground",children:"Cargando productos..."})})}),x.jsx(Qk,{}),x.jsx(Jk,{})]})},tD=({products:r,onAddToCart:e})=>{const{id:t}=qh(),n=zn(),s=r.find(d=>d.id===parseInt(t));if(!s)return x.jsx(an,{children:x.jsxs("div",{className:"text-center py-20",children:[x.jsx("h1",{className:"text-2xl font-bold",children:"Producto no encontrado"}),x.jsx(nt,{onClick:()=>n("/"),className:"mt-4",children:"Volver al inicio"})]})});const i=()=>{e(s),As({title:"Producto agregado",description:`${s.name} se agregó al carrito.`})},o=s.id%5+1,u=Math.floor(Math.random()*100)+1;return x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsxs("title",{children:[s.name," - SimpleMarket360"]}),x.jsx("meta",{name:"description",content:s.description})]}),x.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[x.jsxs("button",{onClick:()=>n(-1),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground mb-6","aria-label":"Volver",children:[x.jsx(po,{className:"w-5 h-5"}),"Volver"]}),x.jsxs("div",{className:"grid md:grid-cols-2 gap-12 items-start",children:[x.jsx("div",{children:x.jsx("img",{src:s.image,alt:s.name,className:"w-full rounded-lg shadow-lg border"})}),x.jsxs("div",{children:[x.jsx(ct,{to:`/categories#${s.category.slug}`,className:"text-sm font-medium text-primary hover:text-primary/90",children:s.category.name}),x.jsx("h1",{className:"text-4xl font-extrabold tracking-tight text-foreground mt-2",children:s.name}),x.jsxs("div",{className:"mt-3 flex items-center space-x-4",children:[x.jsxs("p",{className:"text-3xl text-foreground font-bold",children:["$",s.price]}),x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"flex items-center",children:[...Array(5)].map((d,c)=>x.jsx(wP,{className:`h-5 w-5 ${c<o?"text-yellow-400":"text-muted-foreground/30"}`,fill:"currentColor"},c))}),x.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",u," reseñas)"]})]})]}),x.jsxs("div",{className:"mt-6",children:[x.jsx("h3",{className:"sr-only",children:"Descripción"}),x.jsx("p",{className:"text-base text-muted-foreground space-y-6",children:s.description})]}),x.jsx("div",{className:"mt-8",children:x.jsxs(nt,{size:"lg",className:"w-full",onClick:i,children:[x.jsx(Uu,{className:"mr-2 h-5 w-5"}),"Añadir al carrito"]})}),x.jsx("div",{className:"mt-6 text-center",children:x.jsxs(ct,{to:`/seller/${s.seller.id}`,className:"text-sm font-medium text-primary hover:underline",children:["Vendido por ",x.jsx("span",{className:"font-bold",children:s.seller.name})]})})]})]})]})]})},nD=({products:r,sellers:e,onAddToCart:t})=>{const{id:n}=qh(),s=zn(),i=e.find(u=>u.id===parseInt(n)),o=r.filter(u=>u.seller.id===parseInt(n));return i?x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsxs("title",{children:[i.name," - Perfil de Vendedor - SimpleMarket360"]}),x.jsx("meta",{name:"description",content:`Explora el perfil de ${i.name} y descubre sus productos.`})]}),x.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[x.jsxs("button",{onClick:()=>s(-1),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground mb-6","aria-label":"Volver",children:[x.jsx(po,{className:"w-5 h-5"}),"Volver"]}),x.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start text-center md:text-left mb-12",children:[x.jsx("img",{src:i.avatar,alt:i.name,className:"w-32 h-32 rounded-full object-cover mb-6 md:mb-0 md:mr-8 border-4 border-muted"}),x.jsxs("div",{children:[x.jsx("h1",{className:"text-4xl font-bold text-foreground",children:i.name}),x.jsx("p",{className:"text-xl text-muted-foreground",children:i.handle}),x.jsx("div",{className:"mt-4 flex justify-center md:justify-start space-x-2",children:x.jsx("span",{className:"text-xs bg-muted text-muted-foreground px-3 py-1 rounded-full font-medium",children:i.category})})]})]}),x.jsxs("h2",{className:"text-3xl font-bold text-foreground mb-6",children:["Productos de ",i.name]}),o.length>0?x.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:o.map(u=>x.jsx(cc,{product:u,onAddToCart:t},u.id))}):x.jsx("div",{className:"text-center py-16 border rounded-lg",children:x.jsx("p",{className:"text-muted-foreground",children:"Este vendedor aún no tiene productos publicados."})})]})]}):x.jsx(an,{children:x.jsxs("div",{className:"text-center py-20",children:[x.jsx("h1",{className:"text-2xl font-bold",children:"Vendedor no encontrado"}),x.jsx(nt,{onClick:()=>s("/"),className:"mt-4",children:"Volver al inicio"})]})})},rD=({items:r,onUpdateQuantity:e,onRemove:t,onCheckoutSuccess:n})=>{const s=zn(),[i,o]=_.useState(1),[u,d]=_.useState({street:"",city:"",zipCode:""}),[c,f]=_.useState({cardNumber:"",expiry:"",cvv:""}),p=r.reduce((T,A)=>T+A.price*A.quantity,0),m=p>0?15:0,y=p+m,v=()=>{if(i===1){if(!u.street||!u.city||!u.zipCode){As({title:"Datos incompletos",description:"Por favor completa todos los campos de envío",variant:"destructive"});return}o(2)}else if(i===2){if(!c.cardNumber||!c.expiry||!c.cvv){As({title:"Datos incompletos",description:"Por favor completa todos los campos de pago",variant:"destructive"});return}o(3),n(),As({title:"¡Compra exitosa!",description:"Tu pedido ha sido confirmado."})}},S=()=>{if(i===3)return x.jsxs("div",{className:"text-center py-12",children:[x.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:x.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),x.jsx("h1",{className:"text-3xl font-bold text-primary mb-4",children:"¡Compra confirmada!"}),x.jsx("p",{className:"text-gray-600 mb-8",children:"Tu pedido ha sido procesado exitosamente. Recibirás un email con los detalles."}),x.jsx(nt,{onClick:()=>{s("/"),o(1)},className:"bg-primary text-primary-foreground hover:bg-primary/90",size:"lg",children:"Volver al inicio"})]});if(r.length===0)return x.jsxs("div",{className:"text-center py-12",children:[x.jsx("h1",{className:"text-2xl font-semibold text-primary mb-4",children:"Tu carrito está vacío"}),x.jsx("p",{className:"text-gray-600 mb-6",children:"Agrega productos para comenzar tu compra"}),x.jsx(nt,{onClick:()=>s("/"),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Ir al catálogo"})]});if(i===1)return x.jsxs("div",{children:[x.jsx("h2",{className:"text-2xl font-semibold text-primary mb-6",children:"Datos de envío"}),x.jsxs("div",{className:"space-y-4 mb-8",children:[x.jsxs("div",{children:[x.jsx("label",{htmlFor:"street",className:"block text-sm font-medium text-gray-700 mb-2",children:"Calle y número"}),x.jsx("input",{id:"street",type:"text",value:u.street,onChange:T=>d({...u,street:T.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-2",children:"Ciudad"}),x.jsx("input",{id:"city",type:"text",value:u.city,onChange:T=>d({...u,city:T.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"zipCode",className:"block text-sm font-medium text-gray-700 mb-2",children:"Código postal"}),x.jsx("input",{id:"zipCode",type:"text",value:u.zipCode,onChange:T=>d({...u,zipCode:T.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"})]})]}),x.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[x.jsx("h3",{className:"text-lg font-semibold text-primary mb-4",children:"Resumen del pedido"}),x.jsx("div",{className:"space-y-4 mb-6",children:r.map(T=>x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded flex-shrink-0 overflow-hidden",children:x.jsx("img",{className:"w-full h-full object-cover",alt:T.name,src:T.image})}),x.jsxs("div",{className:"flex-1",children:[x.jsx("p",{className:"font-medium text-primary",children:T.name}),x.jsxs("p",{className:"text-sm text-gray-600",children:["USD ",T.price]})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("button",{onClick:()=>e(T.id,T.quantity-1),className:"p-1 border border-gray-300 rounded hover:bg-gray-50","aria-label":"Disminuir cantidad",children:x.jsx(LP,{className:"w-4 h-4"})}),x.jsx("span",{className:"w-8 text-center",children:T.quantity}),x.jsx("button",{onClick:()=>e(T.id,T.quantity+1),className:"p-1 border border-gray-300 rounded hover:bg-gray-50","aria-label":"Aumentar cantidad",children:x.jsx(IP,{className:"w-4 h-4"})}),x.jsx("button",{onClick:()=>t(T.id),className:"p-1 text-destructive hover:bg-red-50 rounded ml-2","aria-label":"Eliminar producto",children:x.jsx(RP,{className:"w-4 h-4"})})]})]},T.id))}),x.jsxs("div",{className:"space-y-2 text-sm",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Subtotal"}),x.jsxs("span",{className:"font-medium",children:["USD ",p.toFixed(2)]})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Envío"}),x.jsxs("span",{className:"font-medium",children:["USD ",m.toFixed(2)]})]}),x.jsxs("div",{className:"flex justify-between text-lg font-semibold pt-2 border-t border-gray-200",children:[x.jsx("span",{children:"Total"}),x.jsxs("span",{children:["USD ",y.toFixed(2)]})]})]})]}),x.jsx(nt,{onClick:v,className:"w-full mt-6 bg-primary text-primary-foreground hover:bg-primary/90",size:"lg",children:"Continuar al pago"})]});if(i===2)return x.jsxs("div",{children:[x.jsx("h2",{className:"text-2xl font-semibold text-primary mb-6",children:"Datos de pago"}),x.jsxs("div",{className:"space-y-4 mb-8",children:[x.jsxs("div",{children:[x.jsx("label",{htmlFor:"cardNumber",className:"block text-sm font-medium text-gray-700 mb-2",children:"Número de tarjeta"}),x.jsx("input",{id:"cardNumber",type:"text",placeholder:"1234 5678 9012 3456",value:c.cardNumber,onChange:T=>f({...c,cardNumber:T.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{htmlFor:"expiry",className:"block text-sm font-medium text-gray-700 mb-2",children:"Vencimiento"}),x.jsx("input",{id:"expiry",type:"text",placeholder:"MM/AA",value:c.expiry,onChange:T=>f({...c,expiry:T.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"cvv",className:"block text-sm font-medium text-gray-700 mb-2",children:"CVV"}),x.jsx("input",{id:"cvv",type:"text",placeholder:"123",value:c.cvv,onChange:T=>f({...c,cvv:T.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"})]})]})]}),x.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:x.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[x.jsx("span",{children:"Total a pagar"}),x.jsxs("span",{children:["USD ",y.toFixed(2)]})]})}),x.jsxs("div",{className:"flex gap-4",children:[x.jsx(nt,{onClick:()=>o(1),variant:"outline",className:"flex-1",size:"lg",children:"Volver"}),x.jsx(nt,{onClick:v,className:"flex-1 bg-primary text-primary-foreground hover:bg-primary/90",size:"lg",children:"Confirmar pago"})]})]})};return x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsx("title",{children:"Checkout - SimpleMarket360"}),x.jsx("meta",{name:"description",content:"Completa tu compra en SimpleMarket360"})]}),x.jsx("div",{className:"min-h-screen bg-white py-8",children:x.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[x.jsxs("button",{onClick:()=>i===1?s(-1):o(i-1),className:`flex items-center gap-2 text-gray-600 hover:text-primary mb-6 ${i===3?"hidden":""}`,"aria-label":"Volver",children:[x.jsx(po,{className:"w-5 h-5"}),"Volver"]}),x.jsxs("div",{className:`mb-8 ${i===3?"hidden":""}`,children:[x.jsx("div",{className:"flex items-center justify-between mb-4",children:[1,2,3].map(T=>x.jsxs("div",{className:"flex items-center flex-1",children:[x.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${T<=i?"bg-primary text-white":"bg-gray-200 text-gray-600"}`,children:i===3&&T<=3?"✓":T}),T<3&&x.jsx("div",{className:`flex-1 h-1 mx-2 ${T<i?"bg-primary":"bg-gray-200"}`})]},T))}),x.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[x.jsx("span",{children:"Envío"}),x.jsx("span",{children:"Pago"}),x.jsx("span",{children:"Confirmación"})]})]}),S()]})})]})},fS=({children:r,...e})=>x.jsx("div",{...e,children:r}),Wi=({children:r,...e})=>x.jsx("div",{...e,children:r}),hS=({children:r,...e})=>x.jsx("div",{...e,children:r}),Yi=({children:r,...e})=>x.jsx("button",{...e,children:r}),qi=({children:r,...e})=>x.jsx("div",{...e,children:r}),Xi=({children:r,...e})=>x.jsx("div",{...e,children:r}),Ih=({children:r,...e})=>x.jsx("p",{...e,children:r}),Qi=({children:r,...e})=>x.jsx("div",{...e,children:r}),Zi=({children:r,...e})=>x.jsx("h3",{...e,children:r}),Es=r=>x.jsx("input",{...r}),sD=r=>x.jsx("textarea",{...r}),iD=({children:r,...e})=>x.jsx("select",{...e,children:r}),oD=({children:r,...e})=>x.jsx("div",{...e,children:r}),Fi=({children:r,...e})=>x.jsx("option",{...e,children:r}),aD=({children:r,...e})=>x.jsx("div",{...e,children:r}),lD=({children:r,...e})=>x.jsx("div",{...e,children:r});let Qs=[];const pa=[],uD=r=>{const e={...r,id:Date.now()};Qs=[...Qs,e],pa.forEach(t=>t(Qs)),setTimeout(()=>{Qs=Qs.filter(t=>t.id!==e.id),pa.forEach(t=>t(Qs))},3e3)},pS=()=>{const[r,e]=_.useState(Qs),t=_.useCallback(n=>{e(n)},[]);return on.useEffect(()=>(pa.push(t),()=>{const n=pa.indexOf(t);n>-1&&pa.splice(n,1)}),[t]),{toast:uD,toasts:r}},cD=({onLogin:r,onRegister:e})=>{const{toast:t}=pS(),n=zn(),[s,i]=_.useState(""),[o,u]=_.useState(""),[d,c]=_.useState(""),[f,p]=_.useState(""),[m,y]=_.useState(""),v=T=>{T.preventDefault();const A=r({email:s,password:o});t({title:A.success?"¡Bienvenido!":"Error",description:A.message}),A.success&&n("/")},S=T=>{T.preventDefault();const A=e({name:d,email:f,password:m,avatar:`https://avatar.vercel.sh/${f}.png`});t({title:A.success?"¡Registro completado!":"Error",description:A.message}),A.success&&n("/")};return x.jsx("div",{className:"max-w-md mx-auto",children:x.jsxs(fS,{defaultValue:"login",className:"w-full",children:[x.jsxs(hS,{className:"grid w-full grid-cols-2",children:[x.jsx(Yi,{value:"login",children:"Iniciar Sesión"}),x.jsx(Yi,{value:"register",children:"Registro"})]}),x.jsx(Wi,{value:"login",children:x.jsxs(qi,{children:[x.jsxs(Qi,{children:[x.jsx(Zi,{children:"Iniciar Sesión"}),x.jsx(Ih,{children:"Accede a tu cuenta para continuar."})]}),x.jsx(Xi,{children:x.jsxs("form",{onSubmit:v,className:"space-y-4",children:[x.jsx(Es,{type:"email",placeholder:"Email",value:s,onChange:T=>i(T.target.value),required:!0}),x.jsx(Es,{type:"password",placeholder:"Contraseña",value:o,onChange:T=>u(T.target.value),required:!0}),x.jsx(nt,{type:"submit",className:"w-full",children:"Acceder"})]})})]})}),x.jsx(Wi,{value:"register",children:x.jsxs(qi,{children:[x.jsxs(Qi,{children:[x.jsx(Zi,{children:"Crear Cuenta"}),x.jsx(Ih,{children:"Crea una cuenta para vender y comprar."})]}),x.jsx(Xi,{children:x.jsxs("form",{onSubmit:S,className:"space-y-4",children:[x.jsx(Es,{placeholder:"Nombre completo",value:d,onChange:T=>c(T.target.value),required:!0}),x.jsx(Es,{type:"email",placeholder:"Email",value:f,onChange:T=>p(T.target.value),required:!0}),x.jsx(Es,{type:"password",placeholder:"Contraseña",value:m,onChange:T=>y(T.target.value),required:!0}),x.jsx(nt,{type:"submit",className:"w-full",children:"Registrarse"})]})})]})})]})})},dD=({user:r,onAddNewProduct:e,userProducts:t})=>{const[n]=Yx(),{toast:s}=pS(),i=n.get("action")||"profile",[o,u]=_.useState(""),[d,c]=_.useState(""),[f,p]=_.useState(""),[m,y]=_.useState(""),[v,S]=_.useState(""),T=A=>{A.preventDefault(),e({name:o,description:d,price:parseFloat(f),category:m,image:v||"https://via.placeholder.com/300x300.png?text=Sin+Imagen",rating:{rate:0,count:0}}),s({title:"¡Producto Publicado!",description:"Tu producto ya está disponible en el marketplace."}),u(""),c(""),p(""),y(""),S("")};return x.jsxs("div",{className:"max-w-4xl mx-auto",children:[x.jsxs("div",{className:"flex items-center space-x-4 mb-8",children:[x.jsx("img",{src:r.avatar,alt:r.name,className:"w-20 h-20 rounded-full border-4 border-muted"}),x.jsxs("div",{children:[x.jsxs("h1",{className:"text-3xl font-bold text-foreground",children:["Hola, ",r.name]}),x.jsx("p",{className:"text-muted-foreground",children:"Bienvenido a tu panel de control."})]})]}),x.jsxs(fS,{defaultValue:i,className:"w-full",children:[x.jsxs(hS,{className:"grid w-full grid-cols-4",children:[x.jsx(Yi,{value:"profile",children:"Perfil"}),x.jsx(Yi,{value:"publish",children:"Publicar"}),x.jsx(Yi,{value:"products",children:"Mis Productos"}),x.jsx(Yi,{value:"settings",children:"Ajustes"})]}),x.jsx(Wi,{value:"profile",children:x.jsxs(qi,{children:[x.jsx(Qi,{children:x.jsx(Zi,{children:"Tu Perfil"})}),x.jsxs(Xi,{className:"space-y-2",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"Nombre:"})," ",r.name]}),x.jsxs("p",{children:[x.jsx("strong",{children:"Email:"})," ",r.email]})]})]})}),x.jsx(Wi,{value:"publish",children:x.jsxs(qi,{children:[x.jsxs(Qi,{children:[x.jsx(Zi,{children:"Publicar Nuevo Producto"}),x.jsx(Ih,{children:"Rellena el formulario para añadir un nuevo producto."})]}),x.jsx(Xi,{children:x.jsxs("form",{onSubmit:T,className:"space-y-4",children:[x.jsx(Es,{placeholder:"Nombre del Producto",value:o,onChange:A=>u(A.target.value),required:!0}),x.jsx(sD,{placeholder:"Descripción detallada del producto...",value:d,onChange:A=>c(A.target.value),required:!0}),x.jsx(Es,{placeholder:"URL de la Imagen",value:v,onChange:A=>S(A.target.value)}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsx(Es,{type:"number",placeholder:"Precio (Ej: 25.99)",value:f,onChange:A=>p(A.target.value),required:!0,min:"0.01",step:"0.01"}),x.jsxs(iD,{onValueChange:y,value:m,required:!0,children:[x.jsx(aD,{children:x.jsx(lD,{placeholder:"Selecciona una categoría"})}),x.jsxs(oD,{children:[x.jsx(Fi,{value:"electronics",children:"Electrónica"}),x.jsx(Fi,{value:"fashion",children:"Moda"}),x.jsx(Fi,{value:"home",children:"Hogar"}),x.jsx(Fi,{value:"sports",children:"Deportes"}),x.jsx(Fi,{value:"books",children:"Libros"}),x.jsx(Fi,{value:"other",children:"Otro"})]})]})]}),x.jsx(nt,{type:"submit",className:"w-full",children:"Publicar Producto"})]})})]})}),x.jsx(Wi,{value:"products",children:x.jsxs(qi,{children:[x.jsx(Qi,{children:x.jsx(Zi,{children:"Mis Productos Publicados"})}),x.jsx(Xi,{children:t.length>0?x.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:t.map(A=>x.jsx(cc,{product:A,onAddToCart:()=>{}},A.id))}):x.jsx("p",{children:"Aún no has publicado ningún producto."})})]})}),x.jsx(Wi,{value:"settings",children:x.jsxs(qi,{children:[x.jsx(Qi,{children:x.jsx(Zi,{children:"Ajustes"})}),x.jsx(Xi,{children:x.jsx("p",{children:"Próximamente..."})})]})})]})]})},fD=({user:r,onLogin:e,onRegister:t,onAddNewProduct:n,userProducts:s})=>{const i=r?"Panel de Usuario":"Acceso de Usuario";return x.jsxs(an,{children:[x.jsx(hn,{children:x.jsxs("title",{children:[i," - SimpleMarket360"]})}),x.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:r?x.jsx(dD,{user:r,onAddNewProduct:n,userProducts:s}):x.jsx(cD,{onLogin:e,onRegister:t})})]})},hD=[{id:1,title:"Cómo vender más en live streaming",excerpt:"Descubre las mejores prácticas para aumentar tus ventas durante transmisiones en vivo.",date:"15 Oct 2025",image:"Live streaming sales tips blog post"},{id:2,title:"Optimiza tus publicaciones con IA",excerpt:"Aprende a usar inteligencia artificial para crear títulos y descripciones que venden.",date:"10 Oct 2025",image:"AI optimization for product listings"},{id:3,title:"Seguridad en marketplace: verificación biométrica",excerpt:"Todo lo que necesitas saber sobre la verificación biométrica y cómo protege tus transacciones.",date:"5 Oct 2025",image:"Biometric security in e-commerce"}],pD=()=>{const r=zn();return x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsx("title",{children:"Blog - SimpleMarket360"}),x.jsx("meta",{name:"description",content:"Noticias, consejos y guías para vendedores y compradores en SimpleMarket360"})]}),x.jsx("div",{className:"min-h-screen bg-white py-8",children:x.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[x.jsxs("button",{onClick:()=>r(-1),className:"flex items-center gap-2 text-gray-600 hover:text-primary mb-6","aria-label":"Volver",children:[x.jsx(po,{className:"w-5 h-5"}),"Volver"]}),x.jsx("h1",{className:"text-3xl font-bold text-primary mb-8",children:"Blog y Noticias"}),x.jsx("div",{className:"space-y-6",children:hD.map(e=>x.jsx("article",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow",children:x.jsxs("div",{className:"md:flex",children:[x.jsx("div",{className:"md:w-1/3",children:x.jsx("img",{className:"w-full h-48 md:h-full object-cover",alt:e.title,src:"https://images.unsplash.com/photo-1595872018818-97555653a011"})}),x.jsxs("div",{className:"p-6 md:w-2/3",children:[x.jsx("p",{className:"text-sm text-gray-500 mb-2",children:e.date}),x.jsx("h2",{className:"text-xl font-semibold text-primary mb-3",children:e.title}),x.jsx("p",{className:"text-gray-600 mb-4",children:e.excerpt}),x.jsx("button",{className:"text-accent hover:text-accent/90 font-medium",children:"Leer más →"})]})]})},e.id))})]})})]})},mD=({title:r,content:e})=>x.jsxs("section",{children:[x.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:r}),x.jsx("div",{className:"prose max-w-none text-gray-600",children:e.map((t,n)=>x.jsx("p",{className:"mb-4",children:t},n))})]}),gD=({sectionId:r,children:e})=>x.jsx(ct,{to:`/legal#${r}`,className:"text-primary hover:underline",children:e}),yD=()=>x.jsxs("div",{className:"bg-gray-100 p-8 rounded-lg text-center",children:[x.jsx("h3",{className:"text-2xl font-bold text-primary mb-4",children:"¿Tienes alguna pregunta?"}),x.jsxs("p",{className:"text-gray-600 mb-6",children:["Consulta nuestras ",x.jsx(gD,{sectionId:"returns",children:"políticas de devolución y disputas"})," o ",x.jsx(ct,{to:"/contact",className:"text-primary hover:underline",children:"contacta con nuestro equipo de soporte"}),"."]})]}),vD="Términos y Condiciones",xD=["Bienvenido a SimpleMarket360. Al utilizar nuestra plataforma, aceptas los siguientes términos y condiciones.","SimpleMarket360 es un marketplace que conecta compradores y vendedores. No somos responsables de las transacciones entre usuarios, but proporcionamos herramientas de seguridad como verificación biométrica.","Los vendedores son responsables de la calidad y entrega de sus productos. Los compradores tienen derecho a solicitar devoluciones según nuestra política."],ED={title:vD,content:xD},TD="Política de Privacidad",SD=["En SimpleMarket360 protegemos tu información personal. Recopilamos datos necesarios para procesar transacciones y mejorar tu experiencia.","Utilizamos verificación biométrica opcional para mayor seguridad. Tus datos biométricos se procesan de forma segura y nunca se comparten con terceros.","Puedes solicitar la eliminación de tus datos en cualquier momento contactando a nuestro equipo de soporte."],bD={title:TD,content:SD},AD="Devoluciones y Disputas",LD=["Los compradores tienen 30 días para solicitar devoluciones de productos que no cumplan con la descripción o lleguen defectuosos.","Para iniciar una devolución, contacta al vendedor a través de nuestro sistema de mensajería. Si no hay respuesta en 48 horas, puedes abrir una disputa.","Nuestro equipo de mediación revisará cada caso y tomará una decisión justa basada en la evidencia proporcionada por ambas partes."],ID={title:AD,content:LD},wD=[{id:"terms",data:ED},{id:"privacy",data:bD},{id:"returns",data:ID}],RD=()=>{const r=zn();return x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsx("title",{children:"Información Legal - SimpleMarket360"}),x.jsx("meta",{name:"description",content:"Términos y condiciones, política de privacidad y políticas de devolución de SimpleMarket360"})]}),x.jsx("div",{className:"min-h-screen bg-white py-8",children:x.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[x.jsxs("button",{onClick:()=>r(-1),className:"flex items-center gap-2 text-gray-600 hover:text-primary mb-6","aria-label":"Volver",children:[x.jsx(po,{className:"w-5 h-5"}),"Volver"]}),x.jsx("h1",{className:"text-3xl font-bold text-primary mb-8",children:"Información Legal"}),x.jsx("div",{className:"space-y-8",children:wD.map(e=>x.jsx(mD,{title:e.data.title,content:e.data.content},e.id))}),x.jsx("div",{className:"mt-12",children:x.jsx(yD,{})})]})})]})},ve=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},CD=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=PD},PD=Number.MAX_SAFE_INTEGER||9007199254740991;let we=(function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r})({}),z=(function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r})({}),I=(function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r})({});var Ye={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Te={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Bi{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class _D{constructor(e,t,n,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Bi(e),this.fast_=new Bi(t),this.defaultTTFB_=s,this.ttfb_=new Bi(e)}update(e,t){const{slow_:n,fast_:s,ttfb_:i}=this;n.halfLife!==e&&(this.slow_=new Bi(e,n.getEstimate(),n.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Bi(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Bi(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,s=e/1e3,i=n/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function kD(r,e,t){return(e=OD(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function rt(){return rt=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},rt.apply(null,arguments)}function vv(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function et(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vv(Object(t),!0).forEach(function(n){kD(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):vv(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function DD(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function OD(r){var e=DD(r,"string");return typeof e=="symbol"?e:e+""}class Wn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=vs,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const vs=function(){},ND={trace:vs,debug:vs,log:vs,warn:vs,info:vs,error:vs};function wh(){return rt({},ND)}function MD(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):vs}function xv(r,e,t){return e[r]?e[r].bind(e):MD(r,t)}const Rh=wh();function FD(r,e,t){const n=wh();if(typeof console=="object"&&r===!0||typeof r=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{n[i]=xv(i,r,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.13`)}catch{return wh()}s.forEach(i=>{Rh[i]=xv(i,r)})}else rt(Rh,n);return n}const tt=Rh;function ws(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function BD(r){return typeof self<"u"&&r===self.ManagedMediaSource}function mS(r,e){const t=Object.keys(r),n=Object.keys(e),s=t.length,i=n.length;return!s||!i||s===i&&!t.some(o=>n.indexOf(o)===-1)}function Nn(r,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(r);if(e){const f=c.indexOf("\0");return f!==-1?c.substring(0,f):c}return c.replace(/\0/g,"")}const t=r.length;let n,s,i,o="",u=0;for(;u<t;){if(n=r[u++],n===0&&e)return o;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:s=r[u++],o+=String.fromCharCode((n&31)<<6|s&63);break;case 14:s=r[u++],i=r[u++],o+=String.fromCharCode((n&15)<<12|(s&63)<<6|(i&63)<<0);break}}return o}function dn(r){let e="";for(let t=0;t<r.length;t++){let n=r[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function gS(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function UD(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var If={exports:{}},Ev;function jD(){return Ev||(Ev=1,(function(r,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(d,c,f){if(f=f||{},d=d.trim(),c=c.trim(),!c){if(!f.alwaysNormalize)return d;var p=u.parseURL(d);if(!p)throw new Error("Error trying to parse base URL.");return p.path=u.normalizePath(p.path),u.buildURLFromParts(p)}var m=u.parseURL(c);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return f.alwaysNormalize?(m.path=u.normalizePath(m.path),u.buildURLFromParts(m)):c;var y=u.parseURL(d);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var v=s.exec(y.path);y.netLoc=v[1],y.path=v[2]}y.netLoc&&!y.path&&(y.path="/");var S={scheme:y.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(S.netLoc=y.netLoc,m.path[0]!=="/"))if(!m.path)S.path=y.path,m.params||(S.params=y.params,m.query||(S.query=y.query));else{var T=y.path,A=T.substring(0,T.lastIndexOf("/")+1)+m.path;S.path=u.normalizePath(A)}return S.path===null&&(S.path=f.alwaysNormalize?u.normalizePath(m.path):m.path),u.buildURLFromParts(S)},parseURL:function(d){var c=n.exec(d);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(i,"");d.length!==(d=d.replace(o,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};r.exports=u})()})(If)),If.exports}var Lp=jD();class Ip{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var at={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class yS{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,VD(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let s;n.length===1?s=t?.byteRangeEndOffset||0:s=parseInt(n[1]),this._byteRange=[s,parseInt(n[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[at.AUDIO]:null,[at.VIDEO]:null,[at.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Ip),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Lp.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[at.AUDIO]=null,e[at.VIDEO]=null,e[at.AUDIOVIDEO]=null}}function Ft(r){return r.sn!=="initSegment"}class wf extends yS{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(ve(e)&&ve(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const s=this._decryptdata=t[n[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ve(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),s=n.length;if(s>1||s===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ve(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ft(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const s=t[e];s&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,s,i,o=!1){const{elementaryStreams:u}=this,d=u[e];if(!d){u[e]={startPTS:t,endPTS:n,startDTS:s,endDTS:i,partial:o};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,n),d.startDTS=Math.min(d.startDTS,s),d.endDTS=Math.max(d.endDTS,i)}}class $D extends yS{constructor(e,t,n,s,i){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function vS(r,e){const t=Object.getPrototypeOf(r);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||vS(t,e)}}function VD(r,e){const t=vS(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const Tv=Math.pow(2,32)-1,GD=[].push,xS={video:1,audio:2,id3:3,text:4};function $t(r){return String.fromCharCode.apply(null,r)}function ES(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function Me(r,e){const t=TS(r,e);return t<0?4294967296+t:t}function Sv(r,e){let t=Me(r,e);return t*=Math.pow(2,32),t+=Me(r,e+4),t}function TS(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function HD(r){const e=r.byteLength;for(let t=0;t<e;){const n=Me(r,t);if(n>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=n>1?t+n:e}return!1}function Ge(r,e){const t=[];if(!e.length)return t;const n=r.byteLength;for(let s=0;s<n;){const i=Me(r,s),o=$t(r.subarray(s+4,s+8)),u=i>1?s+i:n;if(o===e[0])if(e.length===1)t.push(r.subarray(s+8,u));else{const d=Ge(r.subarray(s+8,u),e.slice(1));d.length&&GD.apply(t,d)}s=u}return t}function KD(r){const e=[],t=r[0];let n=8;const s=Me(r,n);n+=4;let i=0,o=0;t===0?(i=Me(r,n),o=Me(r,n+4),n+=8):(i=Sv(r,n),o=Sv(r,n+8),n+=16),n+=2;let u=r.length+o;const d=ES(r,n);n+=2;for(let c=0;c<d;c++){let f=n;const p=Me(r,f);f+=4;const m=p&2147483647;if((p&2147483648)>>>31===1)return tt.warn("SIDX has hierarchical references (not supported)"),null;const v=Me(r,f);f+=4,e.push({referenceSize:m,subsegmentDuration:v,info:{duration:v/s,start:u,end:u+m-1}}),u+=m,f+=4,n=f}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:d,references:e}}function SS(r){const e=[],t=Ge(r,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=Ge(i,["tkhd"])[0];if(o){let u=o[0];const d=Me(o,u===0?12:20),c=Ge(i,["mdia","mdhd"])[0];if(c){u=c[0];const f=Me(c,u===0?12:20),p=Ge(i,["mdia","hdlr"])[0];if(p){const m=$t(p.subarray(8,12)),y={soun:at.AUDIO,vide:at.VIDEO}[m],v=Ge(i,["mdia","minf","stbl","stsd"])[0],S=zD(v);y?(e[d]={timescale:f,type:y,stsd:S},e[y]=et({timescale:f,id:d},S)):e[d]={timescale:f,type:m,stsd:S}}}}}return Ge(r,["moov","mvex","trex"]).forEach(s=>{const i=Me(s,4),o=e[i];o&&(o.default={duration:Me(s,12),flags:Me(s,20)})}),e}function zD(r){const e=r.subarray(8),t=e.subarray(86),n=$t(e.subarray(4,8));let s=n,i;const o=n==="enca"||n==="encv";if(o){const c=Ge(e,[n])[0].subarray(n==="enca"?28:78);Ge(c,["sinf"]).forEach(p=>{const m=Ge(p,["schm"])[0];if(m){const y=$t(m.subarray(4,8));if(y==="cbcs"||y==="cenc"){const v=Ge(p,["frma"])[0];v&&(s=$t(v))}}})}const u=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const d=Ge(t,["avcC"])[0];d&&d.length>3&&(s+="."+nu(d[1])+nu(d[2])+nu(d[3]),i=tu(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const d=Ge(e,[n])[0],c=Ge(d.subarray(28),["esds"])[0];if(c&&c.length>7){let f=4;if(c[f++]!==3)break;f=Rf(c,f),f+=2;const p=c[f++];if(p&128&&(f+=2),p&64&&(f+=c[f++]),c[f++]!==4)break;f=Rf(c,f);const m=c[f++];if(m===64)s+="."+nu(m);else break;if(f+=12,c[f++]!==5)break;f=Rf(c,f);const y=c[f++];let v=(y&248)>>3;v===31&&(v+=1+((y&7)<<3)+((c[f]&224)>>5)),s+="."+v}break}case"hvc1":case"hev1":{const d=Ge(t,["hvcC"])[0];if(d&&d.length>12){const c=d[1],f=["","A","B","C"][c>>6],p=c&31,m=Me(d,2),y=(c&32)>>5?"H":"L",v=d[12],S=d.subarray(6,12);s+="."+f+p,s+="."+WD(m).toString(16).toUpperCase(),s+="."+y+v;let T="";for(let A=S.length;A--;){const L=S[A];(L||T)&&(T="."+L.toString(16).toUpperCase()+T)}s+=T}i=tu(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=tu(s,t)||s;break}case"vp09":{const d=Ge(t,["vpcC"])[0];if(d&&d.length>6){const c=d[4],f=d[5],p=d[6]>>4&15;s+="."+hr(c)+"."+hr(f)+"."+hr(p)}break}case"av01":{const d=Ge(t,["av1C"])[0];if(d&&d.length>2){const c=d[1]>>>5,f=d[1]&31,p=d[2]>>>7?"H":"M",m=(d[2]&64)>>6,y=(d[2]&32)>>5,v=c===2&&m?y?12:10:m?10:8,S=(d[2]&16)>>4,T=(d[2]&8)>>3,A=(d[2]&4)>>2,L=d[2]&3;s+="."+c+"."+hr(f)+p+"."+hr(v)+"."+S+"."+T+A+L+"."+hr(1)+"."+hr(1)+"."+hr(1)+"."+0,i=tu("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:i}}function tu(r,e){const t=Ge(e,["dvvC"]),n=t.length?t[0]:Ge(e,["dvcC"])[0];if(n){const s=n[2]>>1&127,i=n[2]<<5&32|n[3]>>3&31;return r+"."+hr(s)+"."+hr(i)}}function WD(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function Rf(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function nu(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function hr(r){return(r<10?"0":"")+r}function YD(r,e){if(!r||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&bS(r,(n,s)=>{const i=n.subarray(8,24);i.some(o=>o!==0)||(tt.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${dn(i)} -> ${dn(t)}`),n.set(t,8))})}function qD(r){const e=[];return bS(r,t=>e.push(t.subarray(8,24))),e}function bS(r,e){Ge(r,["moov","trak"]).forEach(n=>{const s=Ge(n,["mdia","minf","stbl","stsd"])[0];if(!s)return;const i=s.subarray(8);let o=Ge(i,["enca"]);const u=o.length>0;u||(o=Ge(i,["encv"])),o.forEach(d=>{const c=u?d.subarray(28):d.subarray(78);Ge(c,["sinf"]).forEach(p=>{const m=AS(p);m&&e(m,u)})})})}function AS(r){const e=Ge(r,["schm"])[0];if(e){const t=$t(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=Ge(r,["schi","tenc"])[0];if(n)return n}}}function XD(r,e,t){const n={},s=Ge(r,["moof","traf"]);for(let i=0;i<s.length;i++){const o=s[i],u=Ge(o,["tfhd"])[0],d=Me(u,4),c=e[d];if(!c)continue;n[d]||(n[d]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const f=n[d],p=Ge(o,["tfdt"])[0];if(p){const w=p[0];let C=Me(p,4);w===1&&(C===Tv?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(C*=Tv+1,C+=Me(p,8))),ve(C)&&(!ve(f.start)||C<f.start)&&(f.start=C)}const m=c.default,y=Me(u,0)|m?.flags;let v=m?.duration||0;y&8&&(y&2?v=Me(u,12):v=Me(u,8));const S=Ge(o,["trun"]);let T=f.start||0,A=0,L=v;for(let w=0;w<S.length;w++){const C=S[w],P=Me(C,4),B=f.sampleCount;f.sampleCount+=P;const D=C[3]&1,N=C[3]&4,F=C[2]&1,O=C[2]&2,V=C[2]&4,H=C[2]&8;let te=8,X=P;for(D&&(te+=4),N&&P&&(!(C[te+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=B),te+=4,F?(L=Me(C,te),te+=4):L=v,O&&(te+=4),H&&(te+=4),T+=L,A+=L,X--);X--;)F?(L=Me(C,te),te+=4):L=v,O&&(te+=4),V&&(C[te+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(X+1),f.keyFrameStart=T),te+=4),H&&(te+=4),T+=L,A+=L;!A&&v&&(A+=v*P)}f.duration+=A}if(!Object.keys(n).some(i=>n[i].duration)){let i=1/0,o=0;const u=Ge(r,["sidx"]);for(let d=0;d<u.length;d++){const c=KD(u[d]);if(c!=null&&c.references){i=Math.min(i,c.earliestPresentationTime/c.timescale);const f=c.references.reduce((p,m)=>p+m.info.duration||0,0);o=Math.max(o,f+c.earliestPresentationTime/c.timescale)}}o&&ve(o)&&Object.keys(n).forEach(d=>{n[d].duration||(n[d].duration=o*n[d].timescale-n[d].start)})}return n}function QD(r){const e={valid:null,remainder:null},t=Ge(r,["moof"]);if(t.length<2)return e.remainder=r,e;const n=t[t.length-1];return e.valid=r.slice(0,n.byteOffset-8),e.remainder=r.slice(n.byteOffset-8),e}function Kn(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function bv(r,e){const t=[],n=e.samples,s=e.timescale,i=e.id;let o=!1;return Ge(n,["moof"]).map(d=>{const c=d.byteOffset-8;Ge(d,["traf"]).map(p=>{const m=Ge(p,["tfdt"]).map(y=>{const v=y[0];let S=Me(y,4);return v===1&&(S*=Math.pow(2,32),S+=Me(y,8)),S/s})[0];return m!==void 0&&(r=m),Ge(p,["tfhd"]).map(y=>{const v=Me(y,4),S=Me(y,0)&16777215,T=(S&1)!==0,A=(S&2)!==0,L=(S&8)!==0;let w=0;const C=(S&16)!==0;let P=0;const B=(S&32)!==0;let D=8;v===i&&(T&&(D+=8),A&&(D+=4),L&&(w=Me(y,D),D+=4),C&&(P=Me(y,D),D+=4),B&&(D+=4),e.type==="video"&&(o=dc(e.codec)),Ge(p,["trun"]).map(N=>{const F=N[0],O=Me(N,0)&16777215,V=(O&1)!==0;let H=0;const te=(O&4)!==0,X=(O&256)!==0;let ae=0;const Q=(O&512)!==0;let ie=0;const G=(O&1024)!==0,ee=(O&2048)!==0;let Z=0;const k=Me(N,4);let U=8;V&&(H=Me(N,U),U+=4),te&&(U+=4);let re=H+c;for(let pe=0;pe<k;pe++){if(X?(ae=Me(N,U),U+=4):ae=w,Q?(ie=Me(N,U),U+=4):ie=P,G&&(U+=4),ee&&(F===0?Z=Me(N,U):Z=TS(N,U),U+=4),e.type===at.VIDEO){let me=0;for(;me<ie;){const ye=Me(n,re);if(re+=4,ZD(o,n[re])){const ke=n.subarray(re,re+ye);wp(ke,o?2:1,r+Z/s,t)}re+=ye,me+=ye+4}}r+=ae/s}}))})})}),t}function dc(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function ZD(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function wp(r,e,t,n){const s=LS(r);let i=0;i+=e;let o=0,u=0,d=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;d=s[i++],o+=d}while(d===255);u=0;do{if(i>=s.length)break;d=s[i++],u+=d}while(d===255);const c=s.length-i;let f=i;if(u<c)i+=u;else if(u>c){tt.error(`Malformed SEI payload. ${u} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(s[f++]===181){const m=ES(s,f);if(f+=2,m===49){const y=Me(s,f);if(f+=4,y===1195456820){const v=s[f++];if(v===3){const S=s[f++],T=31&S,A=64&S,L=A?2+T*3:0,w=new Uint8Array(L);if(A){w[0]=S;for(let C=1;C<L;C++)w[C]=s[f++]}n.push({type:v,payloadType:o,pts:t,bytes:w})}}}}}else if(o===5&&u>16){const p=[];for(let v=0;v<16;v++){const S=s[f++].toString(16);p.push(S.length==1?"0"+S:S),(v===3||v===5||v===7||v===9)&&p.push("-")}const m=u-16,y=new Uint8Array(m);for(let v=0;v<m;v++)y[v]=s[f++];n.push({payloadType:o,pts:t,uuid:p.join(""),userData:Nn(y),userDataBytes:y})}}}function LS(r){const e=r.byteLength,t=[];let n=1;for(;n<e-2;)r[n]===0&&r[n+1]===0&&r[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return r;const s=e-t.length,i=new Uint8Array(s);let o=0;for(n=0;n<s;o++,n++)o===t[0]&&(o++,t.shift()),i[n]=r[o];return i}function JD(r){const e=r[0];let t="",n="",s=0,i=0,o=0,u=0,d=0,c=0;if(e===0){for(;$t(r.subarray(c,c+1))!=="\0";)t+=$t(r.subarray(c,c+1)),c+=1;for(t+=$t(r.subarray(c,c+1)),c+=1;$t(r.subarray(c,c+1))!=="\0";)n+=$t(r.subarray(c,c+1)),c+=1;n+=$t(r.subarray(c,c+1)),c+=1,s=Me(r,12),i=Me(r,16),u=Me(r,20),d=Me(r,24),c=28}else if(e===1){c+=4,s=Me(r,c),c+=4;const p=Me(r,c);c+=4;const m=Me(r,c);for(c+=4,o=2**32*p+m,CD(o)||(o=Number.MAX_SAFE_INTEGER,tt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=Me(r,c),c+=4,d=Me(r,c),c+=4;$t(r.subarray(c,c+1))!=="\0";)t+=$t(r.subarray(c,c+1)),c+=1;for(t+=$t(r.subarray(c,c+1)),c+=1;$t(r.subarray(c,c+1))!=="\0";)n+=$t(r.subarray(c,c+1)),c+=1;n+=$t(r.subarray(c,c+1)),c+=1}const f=r.subarray(c,r.byteLength);return{schemeIdUri:t,value:n,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:u,id:d,payload:f}}function eO(r,...e){const t=e.length;let n=8,s=t;for(;s--;)n+=e[s].byteLength;const i=new Uint8Array(n);for(i[0]=n>>24&255,i[1]=n>>16&255,i[2]=n>>8&255,i[3]=n&255,i.set(r,4),s=0,n=8;s<t;s++)i.set(e[s],n),n+=e[s].byteLength;return i}function tO(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let n,s;n=0,s=new Uint8Array;let i;n>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),eO([112,115,115,104],new Uint8Array([n,0,0,0]),r,i,s,o,t)}function nO(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let n=0;for(;n+32<t;){const s=new DataView(r,n),i=rO(s);e.push(i),n+=i.size}}return e}function rO(r){const e=r.getUint32(0),t=r.byteOffset,n=r.byteLength;if(n<e)return{offset:t,size:n};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const i=r.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=r.buffer,u=dn(new Uint8Array(o,t+12,16));let d=null,c=null,f=0;if(i===0)f=28;else{const m=r.getUint32(28);if(!m||n<32+m*16)return{offset:t,size:e};d=[];for(let y=0;y<m;y++)d.push(new Uint8Array(o,t+32+y*16,16));f=32+m*16}if(!f)return{offset:t,size:e};const p=r.getUint32(f);return e-32<p?{offset:t,size:e}:(c=new Uint8Array(o,t+f+4,p),{version:i,systemId:u,kids:d,data:c,offset:t,size:e})}const IS=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),uo={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Rp(r,e){const t=uo[e];return!!t&&!!t[r.slice(0,4)]}function Ia(r,e,t=!0){return!r.split(",").some(n=>!Cp(n,e,t))}function Cp(r,e,t=!0){var n;const s=ws(t);return(n=s?.isTypeSupported(wa(r,e)))!=null?n:!1}function wa(r,e){return`${e}/mp4;codecs=${r}`}function Av(r){if(r){const e=r.substring(0,4);return uo.video[e]}return 2}function $u(r){const e=IS();return r.split(",").reduce((t,n)=>{const i=e&&dc(n)?9:uo.video[n];return i?(i*2+t)/(t?3:2):(uo.audio[n]+t)/(t?2:1)},0)}const Cf={};function sO(r,e=!0){if(Cf[r])return Cf[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let s=0;s<t.length;s++){var n;if(Cp(t[s],"audio",e))return Cf[r]=t[s],t[s];if(t[s]==="mp3"&&(n=ws(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return r}const iO=/flac|opus|mp4a\.40\.34/i;function Vu(r,e=!0){return r.replace(iO,t=>sO(t.toLowerCase(),e))}function oO(r,e){const t=[];if(r){const n=r.split(",");for(let s=0;s<n.length;s++)Rp(n[s],"video")||t.push(n[s])}return e&&t.push(e),t.join(",")}function Tu(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(Lv(r,"audio")||Lv(r,"video")))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let n=t.length;n--;)if(t[n].substring(0,4)===r.substring(0,4))return t[n]}return t[0]}}return e||r}function Lv(r,e){return Rp(r,e)&&Cp(r,e)}function aO(r){const e=r.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function lO(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return r}function Iv(r){const e=ws(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Ch(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const uO={supported:!0,powerEfficient:!0,smooth:!0},cO={supported:!1,smooth:!1,powerEfficient:!1},wS={supported:!0,configurations:[],decodingInfoResults:[uO]};function RS(r,e){return{supported:!1,configurations:e,decodingInfoResults:[cO],error:r}}function dO(r,e,t,n,s,i){const o=r.videoCodec,u=r.audioCodec?r.audioGroups:null,d=i?.audioCodec,c=i?.channels,f=c?parseInt(c):d?1/0:2;let p=null;if(u!=null&&u.length)try{u.length===1&&u[0]?p=e.groups[u[0]].channels:p=u.reduce((m,y)=>{if(y){const v=e.groups[y];if(!v)throw new Error(`Audio track group ${y} not found`);Object.keys(v.channels).forEach(S=>{m[S]=(m[S]||0)+v.channels[S]})}return m},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(m=>dc(m))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(n,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(s,8e6))||!!p&&ve(f)&&Object.keys(p).some(m=>parseInt(m)>f)}function CS(r,e,t,n={}){const s=r.videoCodec;if(!s&&!r.audioCodec||!t)return Promise.resolve(wS);const i=[],o=fO(r),u=o.length,d=hO(r,e,u>0),c=d.length;for(let f=u||1*c||1;f--;){const p={type:"media-source"};if(u&&(p.video=o[f%u]),c){p.audio=d[f%c];const m=p.audio.bitrate;p.video&&m&&(p.video.bitrate-=m)}i.push(p)}if(s){const f=navigator.userAgent;if(s.split(",").some(p=>dc(p))&&IS())return Promise.resolve(RS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),i))}return Promise.all(i.map(f=>{const p=mO(f);return n[p]||(n[p]=t.decodingInfo(f))})).then(f=>({supported:!f.some(p=>!p.supported),configurations:i,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:i,decodingInfoResults:[],error:f}))}function fO(r){var e;const t=(e=r.videoCodec)==null?void 0:e.split(","),n=PS(r),s=r.width||640,i=r.height||480,o=r.frameRate||30,u=r.videoRange.toLowerCase();return t?t.map(d=>{const c={contentType:wa(lO(d),"video"),width:s,height:i,bitrate:n,framerate:o};return u!=="sdr"&&(c.transferFunction=u),c}):[]}function hO(r,e,t){var n;const s=(n=r.audioCodec)==null?void 0:n.split(","),i=PS(r);return s&&r.audioGroups?r.audioGroups.reduce((o,u)=>{var d;const c=u?(d=e.groups[u])==null?void 0:d.tracks:null;return c?c.reduce((f,p)=>{if(p.groupId===u){const m=parseFloat(p.channels||"");s.forEach(y=>{const v={contentType:wa(y,"audio"),bitrate:t?pO(y,i):i};m&&(v.channels=""+m),f.push(v)})}return f},o):o},[]):[]}function pO(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function PS(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function mO(r){let e="";const{audio:t,video:n}=r;if(n){const s=Ch(n.contentType);e+=`${s}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const s=Ch(t.contentType);e+=`${n?"_":""}${s}_c${t.channels}`}return e}const Ph=["NONE","TYPE-0","TYPE-1",null];function gO(r){return Ph.indexOf(r)>-1}const Gu=["SDR","PQ","HLG"];function yO(r){return!!r&&Gu.indexOf(r)>-1}var Su={No:"",Yes:"YES",v2:"v2"};function wv(r){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=r,s=n<e/2;return e&&s?t?Su.v2:Su.Yes:Su.No}class Rv{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ra{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Cv(this._audioGroups,e)}hasSubtitleGroup(e){return Cv(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Cv(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function vO(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function xO(r,e){let t=!1,n=[];if(r&&(t=r!=="SDR",n=[r]),e){n=e.allowedVideoRanges||Gu.slice(0);const s=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&vO(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const EO=r=>{const e=new WeakSet;return(t,n)=>{if(r&&(n=r(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},lt=(r,e)=>JSON.stringify(r,EO(e));function TO(r,e,t,n,s){const i=Object.keys(r),o=n?.channels,u=n?.audioCodec,d=s?.videoCodec,c=o&&parseInt(o)===2;let f=!1,p=!1,m=1/0,y=1/0,v=1/0,S=1/0,T=0,A=[];const{preferHDR:L,allowedVideoRanges:w}=xO(e,s);for(let N=i.length;N--;){const F=r[i[N]];f||(f=F.channels[2]>0),m=Math.min(m,F.minHeight),y=Math.min(y,F.minFramerate),v=Math.min(v,F.minBitrate),w.filter(V=>F.videoRanges[V]>0).length>0&&(p=!0)}m=ve(m)?m:0,y=ve(y)?y:0;const C=Math.max(1080,m),P=Math.max(30,y);v=ve(v)?v:t,t=Math.max(v,t),p||(e=void 0);const B=i.length>1;return{codecSet:i.reduce((N,F)=>{const O=r[F];if(F===N)return N;if(A=p?w.filter(V=>O.videoRanges[V]>0):[],B){if(O.minBitrate>t)return dr(F,`min bitrate of ${O.minBitrate} > current estimate of ${t}`),N;if(!O.hasDefaultAudio)return dr(F,"no renditions with default or auto-select sound found"),N;if(u&&F.indexOf(u.substring(0,4))%5!==0)return dr(F,`audio codec preference "${u}" not found`),N;if(o&&!c){if(!O.channels[o])return dr(F,`no renditions with ${o} channel sound found (channels options: ${Object.keys(O.channels)})`),N}else if((!u||c)&&f&&O.channels[2]===0)return dr(F,"no renditions with stereo sound found"),N;if(O.minHeight>C)return dr(F,`min resolution of ${O.minHeight} > maximum of ${C}`),N;if(O.minFramerate>P)return dr(F,`min framerate of ${O.minFramerate} > maximum of ${P}`),N;if(!A.some(V=>O.videoRanges[V]>0))return dr(F,`no variants with VIDEO-RANGE of ${lt(A)} found`),N;if(d&&F.indexOf(d.substring(0,4))%5!==0)return dr(F,`video codec preference "${d}" not found`),N;if(O.maxScore<T)return dr(F,`max score of ${O.maxScore} < selected max of ${T}`),N}return N&&($u(F)>=$u(N)||O.fragmentError>r[N].fragmentError)?N:(S=O.minIndex,T=O.maxScore,F)},void 0),videoRanges:A,preferHDR:L,minFramerate:y,minBitrate:v,minIndex:S}}function dr(r,e){tt.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function _S(r){return r.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const s=t.channels||"2";return n.channels[s]=(n.channels[s]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function SO(r,e,t,n){return r.slice(t,n+1).reduce((s,i,o)=>{if(!i.codecSet)return s;const u=i.audioGroups;let d=s[i.codecSet];d||(s[i.codecSet]=d={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),d.minBitrate=Math.min(d.minBitrate,i.bitrate);const c=Math.min(i.height,i.width);return d.minHeight=Math.min(d.minHeight,c),d.minFramerate=Math.min(d.minFramerate,i.frameRate),d.minIndex=Math.min(d.minIndex,o),d.maxScore=Math.max(d.maxScore,i.score),d.fragmentError+=i.fragmentError,d.videoRanges[i.videoRange]=(d.videoRanges[i.videoRange]||0)+1,u&&u.forEach(f=>{if(!f)return;const p=e.groups[f];p&&(d.hasDefaultAudio=d.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(m=>{d.channels[m]=(d.channels[m]||0)+p.channels[m]}))}),s},{})}function Pv(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:i}=r;return{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:i}}function gr(r,e,t){if("attrs"in r){const n=e.indexOf(r);if(n!==-1)return n}for(let n=0;n<e.length;n++){const s=e[n];if(ri(r,s,t))return n}return-1}function ri(r,e,t){const{groupId:n,name:s,lang:i,assocLang:o,default:u}=r,d=r.forced;return(n===void 0||e.groupId===n)&&(s===void 0||e.name===s)&&(i===void 0||bO(i,e.lang))&&(i===void 0||e.assocLang===o)&&(u===void 0||e.default===u)&&(d===void 0||e.forced===d)&&(!("characteristics"in r)||AO(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function bO(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function AO(r,e=""){const t=r.split(","),n=e.split(",");return t.length===n.length&&!t.some(s=>n.indexOf(s)===-1)}function Zs(r,e){const{audioCodec:t,channels:n}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function LO(r,e,t,n,s){const i=e[n],u=e.reduce((m,y,v)=>{const S=y.uri;return(m[S]||(m[S]=[])).push(v),m},{})[i.uri];u.length>1&&(n=Math.max.apply(Math,u));const d=i.videoRange,c=i.frameRate,f=i.codecSet.substring(0,4),p=_v(e,n,m=>{if(m.videoRange!==d||m.frameRate!==c||m.codecSet.substring(0,4)!==f)return!1;const y=m.audioGroups,v=t.filter(S=>!y||y.indexOf(S.groupId)!==-1);return gr(r,v,s)>-1});return p>-1?p:_v(e,n,m=>{const y=m.audioGroups,v=t.filter(S=>!y||y.indexOf(S.groupId)!==-1);return gr(r,v,s)>-1})}function _v(r,e,t){for(let n=e;n>-1;n--)if(t(r[n]))return n;for(let n=e+1;n<r.length;n++)if(t(r[n]))return n;return-1}function Hu(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class IO extends Wn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:s,partCurrent:i,hls:o}=this,{autoLevelEnabled:u,media:d}=o;if(!s||!d)return;const c=performance.now(),f=i?i.stats:s.stats,p=i?i.duration:s.duration,m=c-f.loading.start,y=o.minAutoLevel,v=s.level,S=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||v<=y){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const T=S>-1&&S!==v,A=!!t||T;if(!A&&(d.paused||!d.playbackRate||!d.readyState))return;const L=o.mainForwardBufferInfo;if(!A&&L===null)return;const w=this.bwEstimator.getEstimateTTFB(),C=Math.abs(d.playbackRate);if(m<=Math.max(w,1e3*(p/(C*2))))return;const P=L?L.len/C:0,B=f.loading.first?f.loading.first-f.loading.start:-1,D=f.loaded&&B>-1,N=this.getBwEstimate(),F=o.levels,O=F[v],V=Math.max(f.loaded,Math.round(p*(s.bitrate||O.averageBitrate)/8));let H=D?m-B:m;H<1&&D&&(H=Math.min(m,f.loaded*8/N));const te=D?f.loaded*1e3/H:0,X=w/1e3,ae=te?(V-f.loaded)/te:V*8/N+X;if(ae<=P)return;const Q=te?te*8:N,ie=((n=t?.details||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,G=this.hls.config.abrBandWidthUpFactor;let ee=Number.POSITIVE_INFINITY,Z;for(Z=v-1;Z>y;Z--){const pe=F[Z].maxBitrate,me=!F[Z].details||ie;if(ee=this.getTimeToLoadFrag(X,Q,p*pe,me),ee<Math.min(P,p+X))break}if(ee>=ae||ee>p*10)return;D?this.bwEstimator.sample(m-Math.min(w,B),f.loaded):this.bwEstimator.sampleTTFB(m);const k=F[Z].maxBitrate;this.getBwEstimate()*G>k&&this.resetEstimator(k);const U=this.findBestLevel(k,y,Z,0,P,1,1);U>-1&&(Z=U),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${v} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${P.toFixed(3)} s
      Estimated load time for current fragment: ${ae.toFixed(3)} s
      Estimated load time for down switch fragment: ${ee.toFixed(3)} s
      TTFB estimate: ${B|0} ms
      Current BW estimate: ${ve(N)?N|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Z} @ ${k|0} bps`),o.nextLoadLevel=o.nextAutoLevel=Z,this.clearTimer();const re=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===Z&&Z>0){const pe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Z>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${pe.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,Z>y){let me=this.findBestLevel(this.hls.levels[y].bitrate,y,Z,0,pe,1,1);me===-1&&(me=y),this.hls.nextLoadLevel=this.hls.nextAutoLevel=me,this.resetEstimator(this.hls.levels[me].bitrate)}}};T||ae>ee*2?re():this.timer=self.setInterval(re,ee*1e3),o.trigger(I.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new _D(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(I.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var s;this.fragCurrent=n,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case z.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:s,partCurrent:i}=this;if(n&&s&&n.sn===s.sn&&n.level===s.level){const o=performance.now(),u=i?i.stats:n.stats,d=o-u.loading.start,c=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&c>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(p,c),u.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(e,t,n,s){const i=e+n/t,o=s?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const n=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;ve(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const s=n?n.stats:t.stats;if(t.type===Te.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=n?n.duration:t.duration,o=this.hls.levels[t.level],u=(o.loaded?o.loaded.bytes:0)+s.loaded,d=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:u,duration:d},o.realBitrate=Math.round(8*u/d)}if(t.bitrateTest){const i={stats:s,frag:t,part:n,id:t.type};this.onFragBuffered(I.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:n.stats;if(i.aborted||this.ignoreFragment(n))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Te.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(n,t,e,0,s,1,1);if(i>-1)return i;const o=this.hls.firstLevel,u=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=n&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:o}=n,u=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),c=this.getStarvationDelay();let f=i.abrBandWidthFactor,p=i.abrBandWidthUpFactor;if(c){const T=this.findBestLevel(d,o,s,c,0,f,p);if(T>=0)return this.rebufferNotice=-1,T}let m=u?Math.min(u,i.maxStarvationDelay):i.maxStarvationDelay;if(!c){const T=this.bitrateTestDelay;T&&(m=(u?Math.min(u,i.maxLoadingDelay):i.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),f=p=1)}const y=this.findBestLevel(d,o,s,c,m,f,p);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`)),y>-1)return y;const v=n.levels[o],S=n.loadLevelObj;return S&&v?.bitrate<S.bitrate?o:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,s,i,o,u){var d;const c=s+i,f=this.lastLoadedFragLevel,p=f===-1?this.hls.firstLevel:f,{fragCurrent:m,partCurrent:y}=this,{levels:v,allAudioTracks:S,loadLevel:T,config:A}=this.hls;if(v.length===1)return 0;const L=v[p],w=!!((d=this.hls.latestLevelDetails)!=null&&d.live),C=T===-1||f===-1;let P,B="SDR",D=L?.frameRate||0;const{audioPreference:N,videoPreference:F}=A,O=this.audioTracksByGroup||(this.audioTracksByGroup=_S(S));let V=-1;if(C){if(this.firstSelection!==-1)return this.firstSelection;const Q=this.codecTiers||(this.codecTiers=SO(v,O,t,n)),ie=TO(Q,B,e,N,F),{codecSet:G,videoRanges:ee,minFramerate:Z,minBitrate:k,minIndex:U,preferHDR:re}=ie;V=U,P=G,B=re?ee[ee.length-1]:ee[0],D=Z,e=Math.max(e,k),this.log(`picked start tier ${lt(ie)}`)}else P=L?.codecSet,B=L?.videoRange;const H=y?y.duration:m?m.duration:0,te=this.bwEstimator.getEstimateTTFB()/1e3,X=[];for(let Q=n;Q>=t;Q--){var ae;const ie=v[Q],G=Q>p;if(!ie)continue;if(A.useMediaCapabilities&&!ie.supportedResult&&!ie.supportedPromise){const me=navigator.mediaCapabilities;typeof me?.decodingInfo=="function"&&dO(ie,O,B,D,e,N)?(ie.supportedPromise=CS(ie,O,me,this.supportedCache),ie.supportedPromise.then(ye=>{if(!this.hls)return;ie.supportedResult=ye;const ke=this.hls.levels,Ce=ke.indexOf(ie);ye.error?this.warn(`MediaCapabilities decodingInfo error: "${ye.error}" for level ${Ce} ${lt(ye)}`):ye.supported?ye.decodingInfoResults.some(Oe=>Oe.smooth===!1||Oe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ce} not smooth or powerEfficient: ${lt(ye)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ce} ${lt(ye)}`),Ce>-1&&ke.length>1&&(this.log(`Removing unsupported level ${Ce}`),this.hls.removeLevel(Ce),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ye=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ye}`)})):ie.supportedResult=wS}if((P&&ie.codecSet!==P||B&&ie.videoRange!==B||G&&D>ie.frameRate||!G&&D>0&&D<ie.frameRate||(ae=ie.supportedResult)!=null&&(ae=ae.decodingInfoResults)!=null&&ae.some(me=>me.smooth===!1))&&(!C||Q!==V)){X.push(Q);continue}const ee=ie.details,Z=(y?ee?.partTarget:ee?.averagetargetduration)||H;let k;G?k=u*e:k=o*e;const U=H&&s>=H*2&&i===0?ie.averageBitrate:ie.maxBitrate,re=this.getTimeToLoadFrag(te,k,U*Z,ee===void 0);if(k>=U&&(Q===f||ie.loadError===0&&ie.fragmentError===0)&&(re<=te||!ve(re)||w&&!this.bitrateTestDelay||re<c)){const me=this.forcedAutoLevel;return Q!==T&&(me===-1||me!==T)&&(X.length&&this.trace(`Skipped level(s) ${X.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${v[X[0]].codecs}" ${v[X[0]].videoRange}; not compatible with "${P}" ${B}`),this.info(`switch candidate:${p}->${Q} adjustedbw(${Math.round(k)})-bitrate=${Math.round(k-U)} ttfb:${te.toFixed(1)} avgDuration:${Z.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${re.toFixed(1)} firstSelection:${C} codecSet:${ie.codecSet} videoRange:${ie.videoRange} hls.loadLevel:${T}`)),C&&(this.firstSelection=Q),Q}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const kS={search:function(r,e){let t=0,n=r.length-1,s=null,i=null;for(;t<=n;){s=(t+n)/2|0,i=r[s];const o=e(i);if(o>0)t=s+1;else if(o<0)n=s-1;else return i}return null}};function wO(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!ve(e))return null;const n=r[0].programDateTime;if(e<(n||0))return null;const s=r[r.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<r.length;++i){const o=r[i];if(CO(e,t,o))return o}return null}function ai(r,e,t=0,n=0,s=.005){let i=null;if(r){i=e[1+r.sn-e[0].sn]||null;const u=r.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),i&&r.level!==i.level&&i.end<=r.end&&(i=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!r||r.level===i.level)&&kv(t,n,i)===0||RO(i,r,Math.min(s,n))))return i;const o=kS.search(e,kv.bind(null,t,n));return o&&(o!==r||!i)?o:i}function RO(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return r.start<=n}return!1}function kv(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=r?1:t.start-n>r&&t.start?-1:0}function CO(r,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>r}function DS(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let n=r.fragments;const{fragmentHint:s}=r;s&&(n=n.concat(s));let i;return kS.search(n,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function Ku(r){switch(r.details){case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_TIMEOUT:case z.LEVEL_LOAD_TIMEOUT:case z.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function OS(r){return r.details.startsWith("key")}function NS(r){return OS(r)&&!!r.frag&&!r.frag.decryptdata}function Dv(r,e){const t=Ku(e);return r.default[`${t?"timeout":"error"}Retry`]}function Pp(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function Ov(r){return et(et({},r),{errorRetry:null,timeoutRetry:null})}function zu(r,e,t,n){if(!r)return!1;const s=n?.code,i=e<r.maxNumRetry&&(PO(s)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,n,i):i}function PO(r){return _h(r)||!!r&&(r<400||r>499)}function _h(r){return r===0&&navigator.onLine===!1}var Qt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},_n={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class _O extends Wn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(I.ERROR,this.onError,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(I.ERROR,this.onError,this),e.off(I.ERROR,this.onErrorOut,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===Te.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(o=>s.indexOf(o.groupId)>=0).some(o=>{var u;return(u=o.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case z.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=no();return}case z.FRAG_GAP:case z.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Qt.SendAlternateToPenaltyBox;return}case z.LEVEL_EMPTY_ERROR:case z.LEVEL_PARSING_ERROR:{var o;const d=t.parent===Te.MAIN?t.level:s.loadLevel;t.details===z.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,d):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,d))}return;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:typeof i?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.SUBTITLE_LOAD_ERROR:case z.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const d=s.loadLevelObj;if(d&&(i.type===Ye.AUDIO_TRACK&&d.hasAudioGroup(i.groupId)||i.type===Ye.SUBTITLE_TRACK&&d.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=Qt.SendAlternateToPenaltyBox,t.errorAction.flags=_n.MoveAllAlternatesMatchingHost;return}}return;case z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Qt.SendAlternateToPenaltyBox,flags:_n.MoveAllAlternatesMatchingHDCP};return;case z.KEY_SYSTEM_SESSION_UPDATE_FAILED:case z.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case z.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Qt.SendAlternateToPenaltyBox,flags:_n.MoveAllAlternatesMatchingKey};return;case z.BUFFER_ADD_CODEC_ERROR:case z.REMUX_ALLOC_ERROR:case z.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:s.loadLevel)}return;case z.INTERNAL_EXCEPTION:case z.BUFFER_APPENDING_ERROR:case z.BUFFER_FULL_ERROR:case z.LEVEL_SWITCH_ERROR:case z.BUFFER_STALLED_ERROR:case z.BUFFER_SEEK_OVER_HOLE:case z.BUFFER_NUDGE_ON_STALL:t.errorAction=no();return}t.type===we.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=no())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,s=Dv(n.config.playlistLoadPolicy,e),i=this.playlistError++;if(zu(s,i,Ku(e),e.response))return{action:Qt.RetryRequest,flags:_n.None,retryConfig:s,retryCount:i};const u=this.getLevelSwitchAction(e,t);return s&&(u.retryConfig=s,u.retryCount=i),u}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),s=t.levels[n],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,u=Dv(OS(e)?o:i,e),d=t.levels.reduce((f,p)=>f+p.fragmentError,0);if(s&&(e.details!==z.FRAG_GAP&&s.fragmentError++,!NS(e)&&zu(u,d,Ku(e),e.response)))return{action:Qt.RetryRequest,flags:_n.None,retryConfig:u,retryCount:d};const c=this.getLevelSwitchAction(e,n);return u&&(c.retryConfig=u,c.retryCount=d),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const s=this.hls.levels[t];if(s){var i,o;const c=e.details;s.loadError++,c===z.BUFFER_APPEND_ERROR&&s.fragmentError++;let f=-1;const{levels:p,loadLevel:m,minAutoLevel:y,maxAutoLevel:v}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const S=(i=e.frag)==null?void 0:i.type,A=(S===Te.AUDIO&&c===z.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===z.BUFFER_ADD_CODEC_ERROR||c===z.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:B})=>s.audioCodec!==B),w=e.sourceBufferName==="video"&&(c===z.BUFFER_ADD_CODEC_ERROR||c===z.BUFFER_APPEND_ERROR)&&p.some(({codecSet:B,audioCodec:D})=>s.codecSet!==B&&s.audioCodec===D),{type:C,groupId:P}=(o=e.context)!=null?o:{};for(let B=p.length;B--;){const D=(B+m)%p.length;if(D!==m&&D>=y&&D<=v&&p[D].loadError===0){var u,d;const N=p[D];if(c===z.FRAG_GAP&&S===Te.MAIN&&e.frag){const F=p[D].details;if(F){const O=ai(e.frag,F.fragments,e.frag.start);if(O!=null&&O.gap)continue}}else{if(C===Ye.AUDIO_TRACK&&N.hasAudioGroup(P)||C===Ye.SUBTITLE_TRACK&&N.hasSubtitleGroup(P))continue;if(S===Te.AUDIO&&(u=s.audioGroups)!=null&&u.some(F=>N.hasAudioGroup(F))||S===Te.SUBTITLE&&(d=s.subtitleGroups)!=null&&d.some(F=>N.hasSubtitleGroup(F))||A&&s.audioCodec===N.audioCodec||w&&s.codecSet===N.codecSet||!A&&s.codecSet!==N.codecSet)continue}f=D;break}}if(f>-1&&n.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:Qt.SendAlternateToPenaltyBox,flags:_n.None,nextAutoLevel:f}}return{action:Qt.SendAlternateToPenaltyBox,flags:_n.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Qt.DoNothing:break;case Qt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==z.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:s}=n,i=n.nextAutoLevel;switch(s){case _n.None:this.switchLevel(e,i);break;case _n.MoveAllAlternatesMatchingHDCP:{const d=this.getVariantLevelIndex(e.frag),c=t.levels[d],f=c?.attrs["HDCP-LEVEL"];if(n.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){t.maxHdcpLevel=Ph[Ph.indexOf(f)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case _n.MoveAllAlternatesMatchingKey:{const d=e.decryptdata;if(d){const c=this.hls.levels,f=c.length;for(let m=f;m--;)if(this.variantHasKey(c[m],d)){var o,u;this.log(`Banned key found in level ${m} (${c[m].bitrate}bps) or audio group "${(o=c[m].audioGroups)==null?void 0:o.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${dn(d.keyId||[])}`),c[m].fragmentError++,c[m].loadError++,this.log(`Removing level ${m} with key error (${e.error})`),this.hls.removeLevel(m)}const p=e.frag;if(this.hls.levels.length<f)n.resolved=!0;else if(p&&p.type!==Te.MAIN){const m=p.decryptdata;m&&!d.matches(m)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===z.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=Ch(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${i} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(i))}}}function no(r){const e={action:Qt.DoNothing,flags:_n.None};return r&&(e.resolved=!0),e}var Vt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class kO{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let s=n.length;s--;){const i=n[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:s}=this,i=Object.keys(s);for(let o=i.length;o--;){const u=s[i[o]];if(u?.body.type===t&&(!n||u.buffered)){const d=u.body;if(d.start<=e&&e<=d.end)return d}}return null}detectEvictedFragments(e,t,n,s,i){this.timeRanges&&(this.timeRanges[e]=t);const o=s?.fragment.sn||-1;Object.keys(this.fragments).forEach(u=>{const d=this.fragments[u];if(!d||o>=d.body.sn)return;if(!d.buffered&&(!d.loaded||i)){d.body.type===n&&this.removeFragment(d.body);return}const c=d.range[e];if(c){if(c.time.length===0){this.removeFragment(d.body);return}c.time.some(f=>{const p=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return p&&this.removeFragment(d.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,s=Ui(n),i=this.fragments[s];if(!i||i.buffered&&n.gap)return;const o=!n.relurl;Object.keys(t).forEach(u=>{const d=n.elementaryStreams[u];if(!d)return;const c=t[u],f=o||d.partial===!0;i.range[u]=this.getBufferedTimes(n,e.part,f,c)}),i.loaded=null,Object.keys(i.range).length?(i.buffered=!0,(i.body.endList=n.endList||i.body.endList)&&(this.endListFragments[i.body.type]=i),ru(i)||this.removeParts(n.sn-1,n.type)):this.removeFragment(i.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=Nv(n,s=>s.fragment.sn>=e))}fragBuffered(e,t){const n=Ui(e);let s=this.fragments[n];!s&&t&&(s=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,n,s){const i={time:[],partial:n},o=e.start,u=e.end,d=e.minEndPTS||u,c=e.maxStartPTS||o;for(let f=0;f<s.length;f++){const p=s.start(f)-this.bufferPadding,m=s.end(f)+this.bufferPadding;if(c>=p&&d<=m){i.time.push({startPTS:Math.max(o,s.start(f)),endPTS:Math.min(u,s.end(f))});break}else if(o<m&&u>p){const y=Math.max(o,s.start(f)),v=Math.min(u,s.end(f));v>y&&(i.partial=!0,i.time.push({startPTS:y,endPTS:v}))}else if(u<=p)break}return i}getPartialFragment(e){let t=null,n,s,i,o=0;const{bufferPadding:u,fragments:d}=this;return Object.keys(d).forEach(c=>{const f=d[c];f&&ru(f)&&(s=f.body.start-u,i=f.body.end+u,e>=s&&e<=i&&(n=Math.min(e-s,i-e),o<=n&&(t=f.body,o=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||ru(t))}getState(e){const t=Ui(e),n=this.fragments[t];return n?n.buffered?ru(n)?Vt.PARTIAL:Vt.OK:Vt.APPENDING:Vt.NOT_LOADED}isTimeBuffered(e,t,n){let s,i;for(let o=0;o<n.length;o++){if(s=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,s=t.part?null:t,i=Ui(n);this.fragments[i]={body:n,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:s,timeRanges:i,type:o}=t;if(n.sn==="initSegment")return;const u=n.type;if(s){let c=this.activePartLists[u];c||(this.activePartLists[u]=c=[]),c.push(s)}this.timeRanges=i;const d=i[o];this.detectEvictedFragments(o,d,u,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ui(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let s=n.length;s--;){const i=t[n[s]];if(i?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u)return;const d=u.body;d.type!==n||s&&!d.gap||d.start<t&&d.end>e&&(u.buffered||i)&&this.removeFragment(d)})}removeFragment(e){const t=Ui(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const s=e.sn;this.activePartLists[e.type]=Nv(n,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function ru(r){var e,t,n;return r.buffered&&!!(r.body.gap||(e=r.range.video)!=null&&e.partial||(t=r.range.audio)!=null&&t.partial||(n=r.range.audiovideo)!=null&&n.partial)}function Ui(r){return`${r.type}_${r.level}_${r.sn}`}function Nv(r,e){return r.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var Rs={cbc:0,ctr:1};class DO{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case Rs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Rs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function OO(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class NO{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let s=0;s<4;s++)n[s]=t.getUint32(s*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,s=n[0],i=n[1],o=n[2],u=n[3],d=this.invSubMix,c=d[0],f=d[1],p=d[2],m=d[3],y=new Uint32Array(256);let v=0,S=0,T=0;for(T=0;T<256;T++)T<128?y[T]=T<<1:y[T]=T<<1^283;for(T=0;T<256;T++){let A=S^S<<1^S<<2^S<<3^S<<4;A=A>>>8^A&255^99,e[v]=A,t[A]=v;const L=y[v],w=y[L],C=y[w];let P=y[A]*257^A*16843008;s[v]=P<<24|P>>>8,i[v]=P<<16|P>>>16,o[v]=P<<8|P>>>24,u[v]=P,P=C*16843009^w*65537^L*257^v*16843008,c[A]=P<<24|P>>>8,f[A]=P<<16|P>>>16,p[A]=P<<8|P>>>24,m[A]=P,v?(v=L^y[y[y[C^L]]],S^=y[y[S]]):v=S=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,s=0;for(;s<t.length&&n;)n=t[s]===this.key[s],s++;if(n)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let u,d;const c=this.keySchedule=new Uint32Array(o),f=this.invKeySchedule=new Uint32Array(o),p=this.sBox,m=this.rcon,y=this.invSubMix,v=y[0],S=y[1],T=y[2],A=y[3];let L,w;for(u=0;u<o;u++){if(u<i){L=c[u]=t[u];continue}w=L,u%i===0?(w=w<<8|w>>>24,w=p[w>>>24]<<24|p[w>>>16&255]<<16|p[w>>>8&255]<<8|p[w&255],w^=m[u/i|0]<<24):i>6&&u%i===4&&(w=p[w>>>24]<<24|p[w>>>16&255]<<16|p[w>>>8&255]<<8|p[w&255]),c[u]=L=(c[u-i]^w)>>>0}for(d=0;d<o;d++)u=o-d,d&3?w=c[u]:w=c[u-4],d<4||u<=4?f[d]=w:f[d]=v[p[w>>>24]]^S[p[w>>>16&255]]^T[p[w>>>8&255]]^A[p[w&255]],f[d]=f[d]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,u=this.invSubMix,d=u[0],c=u[1],f=u[2],p=u[3],m=this.uint8ArrayToUint32Array_(n);let y=m[0],v=m[1],S=m[2],T=m[3];const A=new Int32Array(e),L=new Int32Array(A.length);let w,C,P,B,D,N,F,O,V,H,te,X,ae,Q;const ie=this.networkToHostOrderSwap;for(;t<A.length;){for(V=ie(A[t]),H=ie(A[t+1]),te=ie(A[t+2]),X=ie(A[t+3]),D=V^i[0],N=X^i[1],F=te^i[2],O=H^i[3],ae=4,Q=1;Q<s;Q++)w=d[D>>>24]^c[N>>16&255]^f[F>>8&255]^p[O&255]^i[ae],C=d[N>>>24]^c[F>>16&255]^f[O>>8&255]^p[D&255]^i[ae+1],P=d[F>>>24]^c[O>>16&255]^f[D>>8&255]^p[N&255]^i[ae+2],B=d[O>>>24]^c[D>>16&255]^f[N>>8&255]^p[F&255]^i[ae+3],D=w,N=C,F=P,O=B,ae=ae+4;w=o[D>>>24]<<24^o[N>>16&255]<<16^o[F>>8&255]<<8^o[O&255]^i[ae],C=o[N>>>24]<<24^o[F>>16&255]<<16^o[O>>8&255]<<8^o[D&255]^i[ae+1],P=o[F>>>24]<<24^o[O>>16&255]<<16^o[D>>8&255]<<8^o[N&255]^i[ae+2],B=o[O>>>24]<<24^o[D>>16&255]<<16^o[N>>8&255]<<8^o[F&255]^i[ae+3],L[t]=ie(w^y),L[t+1]=ie(B^v),L[t+2]=ie(P^S),L[t+3]=ie(C^T),y=V,v=H,S=te,T=X,t=t+4}return L.buffer}}class MO{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=FO(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function FO(r){switch(r){case Rs.cbc:return"AES-CBC";case Rs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const BO=16;class _p{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?OO(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,s){return this.useSoftware?new Promise((i,o)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,n,s);const d=this.flush();d?i(d.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,s)}softwareDecrypt(e,t,n,s){const{currentIV:i,currentResult:o,remainderData:u}=this;if(s!==Rs.cbc||t.byteLength!==16)return tt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=Kn(u,e),this.remainderData=null);const d=this.getValidChunk(e);if(!d.length)return null;i&&(n=i);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new NO),c.expandKey(t);const f=o;return this.currentResult=c.decrypt(d.buffer,0,n),this.currentIV=d.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,n,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,s));this.key=t,this.fastAesKey=new MO(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new DO(this.subtle,new Uint8Array(n),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(tt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,n,s)))}onWebCryptoError(e,t,n,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%BO;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(tt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Mv=Math.pow(2,17);class UO{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Br({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(v=>v[0]==="GAP")){d(Bv(e));return}else e.gap=!1;const c=this.loader=i?new i(s):new o(s),f=Fv(e);e.loader=c;const p=Ov(s.fragLoadPolicy.default),m={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Mv};e.stats=c.stats;const y={onSuccess:(v,S,T,A)=>{this.resetLoader(e,c);let L=v.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(L.slice(0,16)),L=L.slice(16)),u({frag:e,part:null,payload:L,networkDetails:A})},onError:(v,S,T,A)=>{this.resetLoader(e,c),d(new Br({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:et({url:n,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:T,stats:A}))},onAbort:(v,S,T)=>{this.resetLoader(e,c),d(new Br({type:we.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:v}))},onTimeout:(v,S,T)=>{this.resetLoader(e,c),d(new Br({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:T,stats:v}))}};t&&(y.onProgress=(v,S,T,A)=>t({frag:e,part:null,payload:T,networkDetails:A})),c.load(f,m,y)})}loadPart(e,t,n){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){d(Bv(e,t));return}const c=this.loader=i?new i(s):new o(s),f=Fv(e,t);e.loader=c;const p=Ov(s.fragLoadPolicy.default),m={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Mv};t.stats=c.stats,c.load(f,m,{onSuccess:(y,v,S,T)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:y.data,networkDetails:T};n(A),u(A)},onError:(y,v,S,T)=>{this.resetLoader(e,c),d(new Br({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:et({url:f.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:S,stats:T}))},onAbort:(y,v,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),d(new Br({type:we.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:y}))},onTimeout:(y,v,S)=>{this.resetLoader(e,c),d(new Br({type:we.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:S,stats:y}))}})})}updateStatsFromPart(e,t){const n=e.stats,s=t.stats,i=s.total;if(n.loaded+=s.loaded,i){const d=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/i),d),p=(d-c)*Math.round(n.loaded/c);n.total=n.loaded+p}else n.total=Math.max(n.loaded,n.total);const o=n.loading,u=s.loading;o.start?o.first+=u.first-u.start:(o.start=u.start,o.first=u.first),o.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Fv(r,e=null){const t=e||r,n={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(ve(s)&&ve(i)){var o;let u=s,d=i;if(r.sn==="initSegment"&&jO((o=r.decryptdata)==null?void 0:o.method)){const c=i-s;c%16&&(d=i+(16-c%16)),s!==0&&(n.resetIV=!0,u=s-16)}n.rangeStart=u,n.rangeEnd=d}return n}function Bv(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),n={type:we.MEDIA_ERROR,details:z.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(n.part=e),(e||r).stats.aborted=!0,new Br(n)}function jO(r){return r==="AES-128"||r==="AES-256"}class Br extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class MS extends Wn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class kp{constructor(e,t,n,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=su(),this.buffering={audio:su(),video:su(),audiovideo:su()},this.level=e,this.sn=t,this.id=n,this.size=s,this.part=i,this.partial=o}}function su(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Uv={length:0,start:()=>0,end:()=>0};class Ue{static isBuffered(e,t){if(e){const n=Ue.getBuffered(e);for(let s=n.length;s--;)if(t>=n.start(s)&&t<=n.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=Ue.getBuffered(e);return Ue.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const s=Ue.bufferedRanges(e);if(s.length)return Ue.bufferedInfo(s,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((f,p)=>f.start-p.start||p.end-f.end);let s=-1,i=[];if(n)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(s=f);const p=i.length;if(p){const m=i[p-1].end;e[f].start-m<n?e[f].end>m&&(i[p-1].end=e[f].end):i.push(e[f])}else i.push(e[f])}else i=e;let o=0,u,d=t,c=t;for(let f=0;f<i.length;f++){const p=i[f].start,m=i[f].end;if(s===-1&&t>=p&&t<=m&&(s=f),t+n>=p&&t<m)d=p,c=m,o=c-t;else if(t+n<p){u=p;break}}return{len:o,start:d||0,end:c||0,nextStart:u,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Uv}catch(t){return tt.log("failed to get media.buffered",t),Uv}}}const FS=/\{\$([a-zA-Z0-9-_]+)\}/g;function jv(r){return FS.test(r)}function kh(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(FS,n=>{const s=n.substring(2,n.length-1),i=t?.[s];return i===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),n):i})}return e}function $v(r,e,t){let n=r.variableList;n||(r.variableList=n={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))i=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in n?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):n[s]=i||""}function $O(r,e,t){const n=e.IMPORT;if(t&&n in t){let s=r.variableList;s||(r.variableList=s={}),s[n]=t[n]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const VO=/^(\d+)x(\d+)$/,Vv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class St{constructor(e,t){typeof e=="string"&&(e=St.parseAttrList(e,t)),rt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)n[s]=parseInt(t.slice(s*2,s*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=VO.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const s={};for(Vv.lastIndex=0;(n=Vv.exec(e))!==null;){const o=n[1].trim();let u=n[2];const d=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let c=!1;if(d)u=u.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(d||c))u=kh(t,u);else if(!c&&!d)switch(o){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":tt.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=u}return s}}const GO="com.apple.hls.interstitial";function HO(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function KO(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class BS{constructor(e,t,n=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(s=t?.tagOrder)!=null?s:n,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){tt.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=rt(new St({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=t?.endDate||new Date(this.attr["END-DATE"]);ve(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(tt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ve(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===GO}get isValid(){return!!this.id&&!this._badValueForSameId&&ve(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const zO=10;class WO{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?ve(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||zO}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Wu(r,e){return r.length===e.length?!r.some((t,n)=>t!==e[n]):!1}function Gv(r,e){return!r&&!e?!0:!r||!e?!1:Wu(r,e)}function ro(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function Dp(r){switch(r){case"AES-128":case"AES-256":return Rs.cbc;case"AES-256-CTR":return Rs.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function Op(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function Dh(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function YO(r){const e=Dh(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function US(r){const e=function(n,s,i){const o=n[s];n[s]=n[i],n[i]=o};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function jS(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),s=n[n.length-1].split(",");if(s.length===2){const i=s[0]==="base64",o=s[1];i?(n.splice(-1,1),t=Op(o)):t=YO(o)}}return t}const Yu=typeof self<"u"?self:void 0;var bt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Zt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function bu(r){switch(r){case Zt.FAIRPLAY:return bt.FAIRPLAY;case Zt.PLAYREADY:return bt.PLAYREADY;case Zt.WIDEVINE:return bt.WIDEVINE;case Zt.CLEARKEY:return bt.CLEARKEY}}function Pf(r){switch(r){case bt.FAIRPLAY:return Zt.FAIRPLAY;case bt.PLAYREADY:return Zt.PLAYREADY;case bt.WIDEVINE:return Zt.WIDEVINE;case bt.CLEARKEY:return Zt.CLEARKEY}}function la(r){const{drmSystems:e,widevineLicenseUrl:t}=r,n=e?[bt.FAIRPLAY,bt.WIDEVINE,bt.PLAYREADY,bt.CLEARKEY].filter(s=>!!e[s]):[];return!n[bt.WIDEVINE]&&t&&n.push(bt.WIDEVINE),n}const $S=(function(r){return Yu!=null&&(r=Yu.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function qO(r,e,t,n){let s;switch(r){case bt.FAIRPLAY:s=["cenc","sinf"];break;case bt.WIDEVINE:case bt.PLAYREADY:s=["cenc"];break;case bt.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return XO(s,e,t,n)}function XO(r,e,t,n){return[{initDataTypes:r,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function QO(r){var e;return!!r&&(r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function VS(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(o){const u=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(u){const d=Op(u).subarray(0,16);return US(d),d}}return null}let iu={};class si{static clearKeyUriToKeyIdMap(){iu={}}static setKeyIdForUri(e,t){iu[e]=t}constructor(e,t,n,s=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ro(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(gS(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Wu(e.keyFormatVersions,this.keyFormatVersions)&&Gv(e.iv,this.iv)&&Gv(e.keyId,this.keyId)}isSupported(){if(this.method){if(ro(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Zt.FAIRPLAY:case Zt.WIDEVINE:case Zt.PLAYREADY:case Zt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(ro(this.method)){let i=this.iv;return i||(typeof e!="number"&&(tt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=JO(e)),new si(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=iu[this.uri];if(i&&!Wu(this.keyId,i)&&si.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=jS(this.uri);if(n)switch(this.keyFormat){case Zt.WIDEVINE:if(this.pssh=n,!this.keyId){const i=nO(n.buffer);if(i.length){var s;const o=i[0];this.keyId=(s=o.kids)!=null&&s.length?o.kids[0]:null}}this.keyId||(this.keyId=Hv(t));break;case Zt.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=tO(i,null,n),this.keyId=VS(n);break}default:{let i=n.subarray(0,16);if(i.length!==16){const o=new Uint8Array(16);o.set(i,16-i.length),i=o}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=ZO(t),i||(i=Hv(t),i||(i=iu[this.uri])),i&&(this.keyId=i,si.setKeyIdForUri(this.uri,i))}return this}}function ZO(r){const e=r?.[Zt.WIDEVINE];return e?e.keyId:null}function Hv(r){const e=r?.[Zt.PLAYREADY];if(e){const t=jS(e.uri);if(t)return VS(t)}return null}function JO(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const Kv=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,zv=/#EXT-X-MEDIA:(.*)/g,eN=/^#EXT(?:INF|-X-TARGETDURATION):/m,_f=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),tN=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class yr{static findGroup(e,t){for(let n=0;n<e.length;n++){const s=e[n];if(s.id===t)return s}}static resolve(e,t){return Lp.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return eN.test(e)}static parseMasterPlaylist(e,t){const n=jv(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},i=[];if(Kv.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let o;for(;(o=Kv.exec(e))!=null;)if(o[1]){var u;const c=new St(o[1],s),f=kh(s,o[2]),p={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:yr.resolve(f,t)},m=c.decimalResolution("RESOLUTION");m&&(p.width=m.width,p.height=m.height),qv(c.CODECS,p);const y=c["SUPPLEMENTAL-CODECS"];y&&(p.supplemental={},qv(y,p.supplemental)),(u=p.unknownCodecs)!=null&&u.length||i.push(p),s.levels.push(p)}else if(o[3]){const c=o[3],f=o[4];switch(c){case"SESSION-DATA":{const p=new St(f,s),m=p["DATA-ID"];m&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[m]=p);break}case"SESSION-KEY":{const p=Wv(f,t,s);p.encrypted&&p.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(p)):tt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const p=new St(f,s);$v(s,p,t)}break}case"CONTENT-STEERING":{const p=new St(f,s);s.contentSteering={uri:yr.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Yv(f);break}}}const d=i.length>0&&i.length<s.levels.length;return s.levels=d?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,n){let s;const i={},o=n.levels,u={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(zv.lastIndex=0;(s=zv.exec(e))!==null;){const c=new St(s[1],n),f=c.TYPE;if(f){const p=u[f],m=i[f]||[];i[f]=m;const y=c.LANGUAGE,v=c["ASSOC-LANGUAGE"],S=c.CHANNELS,T=c.CHARACTERISTICS,A=c["INSTREAM-ID"],L={attrs:c,bitrate:0,id:d++,groupId:c["GROUP-ID"]||"",name:c.NAME||y||"",type:f,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:y,url:c.URI?yr.resolve(c.URI,t):""};if(v&&(L.assocLang=v),S&&(L.channels=S),T&&(L.characteristics=T),A&&(L.instreamId=A),p!=null&&p.length){const w=yr.findGroup(p,L.groupId)||p[0];Xv(L,w,"audioCodec"),Xv(L,w,"textCodec")}m.push(L)}}return i}static parseLevelPlaylist(e,t,n,s,i,o){var u;const d={url:t},c=new WO(t),f=c.fragments,p=[];let m=null,y=0,v=0,S=0,T=0,A=0,L=null,w=new wf(s,d),C,P,B,D=-1,N=!1,F=null,O;if(_f.lastIndex=0,c.m3u8=e,c.hasVariableRefs=jv(e),((u=_f.exec(e))==null?void 0:u[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(C=_f.exec(e))!==null;){N&&(N=!1,w=new wf(s,d),w.playlistOffset=S,w.setStart(S),w.sn=y,w.cc=T,A&&(w.bitrate=A),w.level=n,m&&(w.initSegment=m,m.rawProgramDateTime&&(w.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),F&&(w.setByteRange(F),F=null)));const X=C[1];if(X){w.duration=parseFloat(X);const ae=(" "+C[2]).slice(1);w.title=ae||null,w.tagList.push(ae?["INF",X,ae]:["INF",X])}else if(C[3]){if(ve(w.duration)){w.playlistOffset=S,w.setStart(S),B&&Zv(w,B,c),w.sn=y,w.level=n,w.cc=T,f.push(w);const ae=(" "+C[3]).slice(1);w.relurl=kh(c,ae),Oh(w,L,p),L=w,S+=w.duration,y++,v=0,N=!0}}else{if(C=C[0].match(tN),!C){tt.warn("No matches on slow regex match for level playlist!");continue}for(P=1;P<C.length&&C[P]===void 0;P++);const ae=(" "+C[P]).slice(1),Q=(" "+C[P+1]).slice(1),ie=C[P+2]?(" "+C[P+2]).slice(1):null;switch(ae){case"BYTERANGE":L?w.setByteRange(Q,L):w.setByteRange(Q);break;case"PROGRAM-DATE-TIME":w.rawProgramDateTime=Q,w.tagList.push(["PROGRAM-DATE-TIME",Q]),D===-1&&(D=f.length);break;case"PLAYLIST-TYPE":c.type&&Mr(c,ae,C),c.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?Mr(c,ae,C):f.length>0&&Jv(c,ae,C),y=c.startSN=parseInt(Q);break;case"SKIP":{c.skippedSegments&&Mr(c,ae,C);const G=new St(Q,c),ee=G.decimalInteger("SKIPPED-SEGMENTS");if(ve(ee)){c.skippedSegments+=ee;for(let k=ee;k--;)f.push(null);y+=ee}const Z=G.enumeratedString("RECENTLY-REMOVED-DATERANGES");Z&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(Z.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&Mr(c,ae,C),c.targetduration=Math.max(parseInt(Q),1);break;case"VERSION":c.version!==null&&Mr(c,ae,C),c.version=parseInt(Q);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||Mr(c,ae,C),c.live=!1;break;case"#":(Q||ie)&&w.tagList.push(ie?[Q,ie]:[Q]);break;case"DISCONTINUITY":T++,w.tagList.push(["DIS"]);break;case"GAP":w.gap=!0,w.tagList.push([ae]);break;case"BITRATE":w.tagList.push([ae,Q]),A=parseInt(Q)*1e3,ve(A)?w.bitrate=A:A=0;break;case"DATERANGE":{const G=new St(Q,c),ee=new BS(G,c.dateRanges[G.ID],c.dateRangeTagCount);c.dateRangeTagCount++,ee.isValid||c.skippedSegments?c.dateRanges[ee.id]=ee:tt.warn(`Ignoring invalid DATERANGE tag: "${Q}"`),w.tagList.push(["EXT-X-DATERANGE",Q]);break}case"DEFINE":{{const G=new St(Q,c);"IMPORT"in G?$O(c,G,o):$v(c,G,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?Mr(c,ae,C):f.length>0&&Jv(c,ae,C),c.startCC=T=parseInt(Q);break;case"KEY":{const G=Wv(Q,t,c);if(G.isSupported()){if(G.method==="NONE"){B=void 0;break}B||(B={});const ee=B[G.keyFormat];ee!=null&&ee.matches(G)||(ee&&(B=rt({},B)),B[G.keyFormat]=G)}else tt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${Q}"`);break}case"START":c.startTimeOffset=Yv(Q);break;case"MAP":{const G=new St(Q,c);if(w.duration){const ee=new wf(s,d);Qv(ee,G,n,B),m=ee,w.initSegment=m,m.rawProgramDateTime&&!w.rawProgramDateTime&&(w.rawProgramDateTime=m.rawProgramDateTime)}else{const ee=w.byteRangeEndOffset;if(ee){const Z=w.byteRangeStartOffset;F=`${ee-Z}@${Z}`}else F=null;Qv(w,G,n,B),m=w,N=!0}m.cc=T;break}case"SERVER-CONTROL":{O&&Mr(c,ae,C),O=new St(Q),c.canBlockReload=O.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=O.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&O.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=O.optionalFloat("PART-HOLD-BACK",0),c.holdBack=O.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&Mr(c,ae,C);const G=new St(Q);c.partTarget=G.decimalFloatingPoint("PART-TARGET");break}case"PART":{let G=c.partList;G||(G=c.partList=[]);const ee=v>0?G[G.length-1]:void 0,Z=v++,k=new St(Q,c),U=new $D(k,w,d,Z,ee);G.push(U),w.duration+=U.duration;break}case"PRELOAD-HINT":{const G=new St(Q,c);c.preloadHint=G;break}case"RENDITION-REPORT":{const G=new St(Q,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(G);break}default:tt.warn(`line parsed but not handled: ${C}`);break}}}L&&!L.relurl?(f.pop(),S-=L.duration,c.partList&&(c.fragmentHint=L)):c.partList&&(Oh(w,L,p),w.cc=T,c.fragmentHint=w,B&&Zv(w,B,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const V=f.length,H=f[0],te=f[V-1];if(S+=c.skippedSegments*c.targetduration,S>0&&V&&te){c.averagetargetduration=S/V;const X=te.sn;c.endSN=X!=="initSegment"?X:0,c.live||(te.endList=!0),D>0&&(rN(f,D),H&&p.unshift(H))}return c.fragmentHint&&(S+=c.fragmentHint.duration),c.totalduration=S,p.length&&c.dateRangeTagCount&&H&&GS(p,c),c.endCC=T,c}}function GS(r,e){let t=r.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];r.push(u),t++}else return;const n=r[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let u=i.length;u--;){const d=e.dateRanges[i[u]],c=d.startDate.getTime();d.tagAnchor=n.ref;for(let f=t;f--;){var o;if(((o=r[f])==null?void 0:o.sn)<e.startSN)break;const p=nN(e,c,r,f,s);if(p!==-1){d.tagAnchor=e.fragments[p].ref;break}}}}function nN(r,e,t,n,s){const i=t[n];if(i){const u=i.programDateTime;if(e>=u||n===0){var o;const d=(((o=t[n+1])==null?void 0:o.start)||s)-i.start;if(e<=u+d*1e3){const c=t[n].sn-r.startSN;if(c<0)return-1;const f=r.fragments;if(f.length>t.length){const m=(t[n+1]||f[f.length-1]).sn-r.startSN;for(let y=m;y>c;y--){const v=f[y].programDateTime;if(e>=v&&e<v+f[y].duration*1e3)return y}}return c}}}return-1}function Wv(r,e,t){var n,s;const i=new St(r,t),o=(n=i.METHOD)!=null?n:"",u=i.URI,d=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,f=(s=i.KEYFORMAT)!=null?s:"identity";u&&i.IV&&!d&&tt.error(`Invalid IV: ${i.IV}`);const p=u?yr.resolve(u,e):"",m=(c||"1").split("/").map(Number).filter(Number.isFinite);return new si(o,p,f,m,d,i.KEYID)}function Yv(r){const t=new St(r).decimalFloatingPoint("TIME-OFFSET");return ve(t)?t:null}function qv(r,e){let t=(r||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const s=t.filter(i=>Rp(i,n));s.length&&(e[`${n}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function Xv(r,e,t){const n=e[t];n&&(r[t]=n)}function rN(r,e){let t=r[e];for(let n=e;n--;){const s=r[n];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Oh(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function Qv(r,e,t,n){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",n&&(r.levelkeys=n),r.initSegment=null}function Zv(r,e,t){r.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&n.push(r)}function Mr(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Jv(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function kf(r,e){const t=e.startPTS;if(ve(t)){let n=0,s;e.sn>r.sn?(n=t-r.start,s=r):(n=r.start-t,s=e),s.duration!==n&&s.setDuration(n)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function HS(r,e,t,n,s,i,o){n-t<=0&&(o.warn("Fragment should have a positive duration",e),n=t+e.duration,i=s+e.duration);let d=t,c=n;const f=e.startPTS,p=e.endPTS;if(ve(f)){const A=Math.abs(f-t);r&&A>r.totalduration?o.warn(`media timestamps and playlist times differ by ${A}s for level ${e.level} ${r.url}`):ve(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,d=Math.max(t,f),t=Math.min(t,f),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,c=Math.min(n,p),n=Math.max(n,p),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const m=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=d,e.startDTS=s,e.endPTS=n,e.minEndPTS=c,e.endDTS=i;const y=e.sn;if(!r||y<r.startSN||y>r.endSN)return 0;let v;const S=y-r.startSN,T=r.fragments;for(T[S]=e,v=S;v>0;v--)kf(T[v],T[v-1]);for(v=S;v<T.length-1;v++)kf(T[v],T[v+1]);return r.fragmentHint&&kf(T[T.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,m}function sN(r,e,t){if(r===e)return;let n=null;const s=r.fragments;for(let f=s.length-1;f>=0;f--){const p=s[f].initSegment;if(p){n=p;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let i;aN(r,e,(f,p,m,y)=>{if((!e.startCC||e.skippedSegments)&&p.cc!==f.cc){const v=f.cc-p.cc;for(let S=m;S<y.length;S++)y[S].cc+=v;e.endCC=y[y.length-1].cc}ve(f.startPTS)&&ve(f.endPTS)&&(p.setStart(p.startPTS=f.startPTS),p.startDTS=f.startDTS,p.maxStartPTS=f.maxStartPTS,p.endPTS=f.endPTS,p.endDTS=f.endDTS,p.minEndPTS=f.minEndPTS,p.setDuration(f.endPTS-f.startPTS),p.duration&&(i=p),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(p.elementaryStreams=f.elementaryStreams),p.loader=f.loader,f.hasStats&&(p.stats=f.stats),f.initSegment&&(p.initSegment=f.initSegment,n=f.initSegment)});const o=e.fragments,u=e.fragmentHint?o.concat(e.fragmentHint):o;if(n&&u.forEach(f=>{var p;f&&(!f.initSegment||f.initSegment.relurl===((p=n)==null?void 0:p.relurl))&&(f.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(f=>!f),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=iN(r.dateRanges,e,t));const f=r.fragments.filter(p=>p.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let p=1;p<u.length;p++)u[p].programDateTime===null&&Oh(u[p],u[p-1],f);GS(f,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var d;const f=WS(r,e.startSN-1);e.startCC=(d=f?.cc)!=null?d:o[0].cc}oN(r.partList,e.partList,(f,p)=>{p.elementaryStreams=f.elementaryStreams,p.stats=f.stats}),i?HS(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):KS(r,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const f=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=f),e.driftEndTime=c,e.driftEnd=f}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function iN(r,e,t){const{dateRanges:n,recentlyRemovedDateranges:s}=e,i=rt({},r);s&&s.forEach(d=>{delete i[d]});const u=Object.keys(i).length;return u?(Object.keys(n).forEach(d=>{const c=i[d],f=new BS(n[d].attr,c);f.isValid?(i[d]=f,c||(f.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${lt(n[d].attr)}"`)}),i):n}function oN(r,e,t){if(r&&e){let n=0;for(let s=0,i=r.length;s<=i;s++){const o=r[s],u=e[s+n];o&&u&&o.index===u.index&&o.fragment.sn===u.fragment.sn?t(o,u):n--}}}function aN(r,e,t){const n=e.skippedSegments,s=Math.max(r.startSN,e.startSN)-e.startSN,i=(r.fragmentHint?1:0)+(n?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,o=e.startSN-r.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let c=s;c<=i;c++){const f=d[o+c];let p=u[c];if(n&&!p&&f&&(p=e.fragments[c]=f),f&&p){t(f,p,c,u);const m=f.relurl,y=p.relurl;if(m&&lN(m,y)){e.playlistParsingError=ex(`media sequence mismatch ${p.sn}:`,r,e,f,p);return}else if(f.cc!==p.cc){e.playlistParsingError=ex(`discontinuity sequence mismatch (${f.cc}!=${p.cc})`,r,e,f,p);return}}}}function ex(r,e,t,n,s){return new Error(`${r} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function KS(r,e,t=!0){const n=e.startSN+e.skippedSegments-r.startSN,s=r.fragments,i=n>=0;let o=0;if(i&&n<s.length)o=s[n].start;else if(i&&e.startSN===r.endSN+1)o=r.fragmentEnd;else if(i&&t)o=r.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=r.fragmentStart;else return;Nh(e,o)}function Nh(r,e){if(e){const t=r.fragments;for(let n=r.skippedSegments;n<t.length;n++)t[n].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function zS(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const n=r.fragments;if(n.length&&t*4>e){const i=n[n.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function WS(r,e,t){if(!r)return null;let n=r.fragments[e-r.startSN];return n||(n=r.fragmentHint,n&&n.sn===e)?n:e<r.startSN&&t&&t.sn===e?t:null}function tx(r,e,t){return r?YS(r.partList,e,t):null}function YS(r,e,t){if(r)for(let n=r.length;n--;){const s=r[n];if(s.index===t&&s.fragment.sn===e)return s}return null}function qS(r){r.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function lN(r,e){return r!==e&&e?nx(r)!==nx(e):!1}function nx(r){return r.replace(/\?[^?]*$/,"")}function ma(r,e){for(let n=0,s=r.length;n<s;n++){var t;if(((t=r[n])==null?void 0:t.cc)===e)return r[n]}return null}function uN(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function rx(r,e){const t=r.start+e;r.startPTS=t,r.setStart(t),r.endPTS=t+r.duration}function XS(r,e){const t=e.fragments;for(let n=0,s=t.length;n<s;n++)rx(t[n],r);e.fragmentHint&&rx(e.fragmentHint,r),e.alignedSliding=!0}function cN(r,e){r&&(QS(e,r),e.alignedSliding||qu(e,r),!e.alignedSliding&&!e.skippedSegments&&KS(r,e,!1))}function QS(r,e){if(!uN(e,r))return;const t=Math.min(e.endCC,r.endCC),n=ma(e.fragments,t),s=ma(r.fragments,t);if(!n||!s)return;tt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=n.start-s.start;XS(i,r)}function qu(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,n=e.fragments;if(!t.length||!n.length)return;let s,i;const o=Math.min(e.endCC,r.endCC);e.startCC<o&&r.startCC<o&&(s=ma(n,o),i=ma(t,o)),(!s||!i)&&(s=n[Math.floor(n.length/2)],i=ma(t,s.cc)||t[Math.floor(t.length/2)]);const u=s.programDateTime,d=i.programDateTime;if(!u||!d)return;const c=(d-u)/1e3-(i.start-s.start);XS(c,r)}function fn(r,e,t){bn(r,e,t),r.addEventListener(e,t)}function bn(r,e,t){r.removeEventListener(e,t)}const dN={toString:function(r){let e="";const t=r.length;for(let n=0;n<t;n++)e+=`[${r.start(n).toFixed(3)}-${r.end(n).toFixed(3)}]`;return e}},se={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Np extends MS{constructor(e,t,n,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=se.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:u,media:d,mediaBuffer:c,state:f}=this,p=d?d.currentTime:0,m=Ue.bufferInfo(c||d,p,o.maxBufferHole),y=!m.len;if(this.log(`Media seeking to ${ve(p)?p.toFixed(3):p}, state: ${f}, ${y?"out of":"in"} buffer`),this.state===se.ENDED)this.resetLoadingState();else if(u){const v=o.maxFragLookUpTolerance,S=u.start-v,T=u.start+u.duration+v;if(y||T<m.start||S>m.end){const A=p>T;(p<S||A)&&(A&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(d){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const v=this.lastCurrentTime;if(p>v&&(this.lastCurrentTime=p),!this.loadingParts){const S=Math.max(m.end,p),T=this.shouldLoadParts(this.getLevelDetails(),S);T&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${S.toFixed(2)}`),this.loadingParts=T)}}this.hls.hasEnoughToStart||(this.log(`Setting ${y?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,y&&(this.startPosition=p)),y&&this.state===se.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new UO(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new _p(e.config)}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===se.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=se.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,s=this.config.timelineOffset||0;if(n<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=Ue.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>s&&o<t.edge||this.media.currentTime<e.start)return!1;const d=t.partList;if(d!=null&&d.length){const f=d[d.length-1];return Ue.isBuffered(this.media,f.start+f.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;fn(n,"seeking",this.onMediaSeeking),fn(n,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===se.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),bn(s,"seeking",this.onMediaSeeking),bn(s,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=se.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const s=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,n,s).then(i=>{if(!i)return;const o=this.state,u=i.frag;if(this.fragContextChanged(u)){(o===se.FRAG_LOADING||!this.fragCurrent&&o===se.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=se.IDLE);return}"payload"in i&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(I.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===se.STOPPED||this.state===se.ERROR||(this.warn(`Frag error: ${i?.message||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===Vt.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),u=Math.max(e.duration,o?o.len:this.config.maxBufferLength),d=this.backtrackFragment;((d?e.sn-d.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===Vt.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:n};this.hls.trigger(I.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const s=n?.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:s}=this,{frag:i,payload:o}=n,u=i.decryptdata;if(o&&o.byteLength>0&&u!=null&&u.key&&u.iv&&ro(u.method)){const d=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),u.key.buffer,u.iv.buffer,Dp(u.method)).catch(c=>{throw s.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:i}),c}).then(c=>{const f=self.performance.now();return s.trigger(I.FRAG_DECRYPTED,{frag:i,payload:c,stats:{tstart:d,tdecrypt:f}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===se.STOPPED||this.state===se.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==se.STOPPED&&(this.state=se.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,s;const i=e.tracks;if(i&&!t.encrypted&&((n=i.audio)!=null&&n.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(u.message),!o||o.mediaKeys?!1:(this.hls.trigger(I.ERROR,{type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?dN.toString(Ue.getBuffered(n)):"(detached)"})`),Ft(e)){var s;if(e.type!==Te.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(u=>!!o[u])){this.state=se.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=se.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:s,partsLoaded:i}=e,o=!i||i.length===0||i.some(d=>!d),u=new kp(n.level,n.sn,n.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,s){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let u=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=se.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(m=>{if(!this.fragContextChanged(m.frag))return this.hls.trigger(I.KEY_LOADED,m),this.state===se.KEY_LOADING&&(this.state=se.IDLE),m}),this.hls.trigger(I.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const d=this.fragPrevious;if(Ft(e)&&(!d||e.sn!==d.sn)){const m=this.shouldLoadParts(t.details,e.end);m!==this.loadingParts&&(this.log(`LL-Part loading ${m?"ON":"OFF"} loading sn ${d?.sn}->${e.sn}`),this.loadingParts=m)}if(n=Math.max(e.start,n||0),this.loadingParts&&Ft(e)){const m=o.partList;if(m&&s){n>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const y=this.getNextPart(m,e,n);if(y>-1){const v=m[y];e=this.fragCurrent=v.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${v.index} (${y}/${m.length-1}) of ${this.fragInfo(e,!1,v)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=v.start+v.duration,this.state=se.FRAG_LOADING;let S;return u?S=u.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,v,t,s)).catch(T=>this.handleFragLoadError(T)):S=this.doFragPartsLoad(e,v,t,s).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(I.FRAG_LOADING,{frag:e,part:v,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):S}else if(!e.url||this.loadedEndOfParts(m,n))return Promise.resolve(null)}}if(Ft(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=o.partList)==null?void 0:c.filter(m=>m.loaded).map(m=>`[${m.start}-${m.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),ve(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=se.FRAG_LOADING;const f=this.config.progressive;let p;return f&&u?p=u.then(m=>!m||this.fragContextChanged(m.frag)?null:this.fragmentLoader.load(e,s)).catch(m=>this.handleFragLoadError(m)):p=Promise.all([this.fragmentLoader.load(e,f?s:void 0),u]).then(([m])=>(!f&&s&&s(m),m)).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(I.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(e,t,n,s){return new Promise((i,o)=>{var u;const d=[],c=(u=n.details)==null?void 0:u.partList,f=p=>{this.fragmentLoader.loadPart(e,p,s).then(m=>{d[p.index]=m;const y=m.part;this.hls.trigger(I.FRAG_LOADED,m);const v=tx(n.details,e.sn,p.index+1)||YS(c,e.sn,p.index+1);if(v)f(v);else return i({frag:e,part:y,partsLoaded:d})}).catch(o)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===z.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===we.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(I.ERROR,t)}else this.hls.trigger(I.ERROR,{type:we.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==se.PARSING){!this.fragCurrent&&this.state!==se.STOPPED&&this.state!==se.ERROR&&(this.state=se.IDLE);return}const{frag:n,part:s,level:i}=t,o=self.performance.now();n.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const u=this.getLevelDetails(),c=u&&n.sn>u.endSN||this.shouldLoadParts(u,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const i=e.partList[0];if(i.fragment.type===Te.SUBTITLE)return!1;const o=i.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:s,sn:i,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const u=t[s],d=u.details,c=o>-1?tx(d,i,o):null,f=c?c.fragment:WS(d,i,n);return f?(n&&n!==f&&(f.stats=n.stats),{frag:f,part:c,level:u}):null}bufferFragmentData(e,t,n,s,i){if(this.state!==se.PARSING)return;const{data1:o,data2:u}=e;let d=o;if(u&&(d=Kn(o,u)),!d.length)return;const c=this.initPTS[t.cc],f=c?-c.baseTime/c.timescale:void 0,p={type:e.type,frag:t,part:n,chunkMeta:s,offset:f,parent:t.type,data:d};if(this.hls.trigger(I.BUFFER_APPENDING,p),e.dropped&&e.independent&&!n){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ue.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,s=Ue.bufferInfo(t,n,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),u=Math.max(Math.min(e.start-o,s.end-o),n+o);e.start-u>o&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var n;const s=this.getLoadPosition();if(!ve(s))return null;const o=this.lastCurrentTime>s||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,n,s){const i=Ue.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,n);if(o&&(i.nextStart<=o.end||o.gap)){const u=Math.max(Math.min(i.nextStart,o.end)-t,s);return Ue.bufferInfo(e,t,u)}}return i}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,s=Math.max(Math.min(e-t,n.maxBufferLength),t),i=Math.max(e-t*3,n.maxMaxBufferLength/2,s);return i>=s?(n.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=Te.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,s=n.length;if(!s)return null;const{config:i}=this,o=n[0].start,u=i.lowLatencyMode&&!!t.partList;let d=null;if(t.live){const p=i.initialLiveManifestSize;if(s<p)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var c;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t);const m=this.hls.startPosition,y=this.hls.liveSyncPosition,v=d?(m!==-1&&m>=o?m:y)||d.start:e;this.log(`Setting startPosition to ${v} to match start frag at live edge. mainStart: ${m} liveSyncPosition: ${y} frag.start: ${(c=d)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=v}}else e<=o&&(d=n[0]);if(!d){const p=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,p,t)}let f=this.filterReplacedPrimary(d,t);if(!f&&d){const p=d.sn-t.startSN;f=this.filterReplacedPrimary(n[p+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===Vt.OK||n===Vt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,s,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&n.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,s,0);if(u!==null&&n.len+u.len>=i){const d=o.sn;return this.loopSn!==d&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${d}`),this.loopSn=d),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(sx(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(sx(this.config)&&e.type!==Te.SUBTITLE){const n=this.hls.interstitialsManager,s=n?.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&t?.live===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=n?.playerQueue;if(i)for(let o=i.length;o--;){const u=i[o].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let s=-1,i=!1,o=!0;for(let u=0,d=e.length;u<d;u++){const c=e[u];if(o=o&&!c.independent,s>-1&&n<c.start)break;const f=c.loaded;f?s=-1:(i||(c.independent||o)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${c.start}`),s=u),i=f}return s}loadedEndOfParts(e,t){let n;for(let s=e.length;s--;){if(n=e[s],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let s=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),s=wO(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=n.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];n.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=DS(e,n.cc,n.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,n){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:u}=n;const{fragmentHint:d}=n,{maxFragLookUpTolerance:c}=s,f=n.partList,p=!!(this.loadingParts&&f!=null&&f.length&&d);p&&!this.bitrateTest&&f[f.length-1].fragment.sn===d.sn&&(o=o.concat(d),u=d.sn);let m;if(e<t){var y;const S=e<this.lastCurrentTime||e>t-c||(y=this.media)!=null&&y.paused||!this.startFragRequested?0:c;m=ai(i,o,e,S)}else m=o[o.length-1];if(m){const v=m.sn-n.startSN,S=this.fragmentTracker.getState(m);if((S===Vt.OK||S===Vt.PARTIAL&&m.gap)&&(i=m),i&&m.sn===i.sn&&(!p||f[0].fragment.sn>m.sn||!n.live)&&m.level===i.level){const A=o[v+1];m.sn<u&&this.fragmentTracker.getState(A)!==Vt.OK?m=A:m=null}}return m}alignPlaylists(e,t,n){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,u=e.alignedSliding&&ve(i);if(o||!u&&!i){cN(n,e);const d=e.fragmentStart;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),d}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const s=this.timelineOffset;if(n===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&ve(o)?(n=t+o,o<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+s}this.nextLoadPosition=n+s}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ft(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==se.FRAG_LOADING_WAITING_RETRY)&&(this.state=se.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const A=this.getCurrentContext(t.chunkMeta);A&&(t.frag=A.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===z.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(s,!0);const u=t.errorAction;if(!u){this.state=se.ERROR;return}const{action:d,flags:c,retryCount:f=0,retryConfig:p}=u,m=!!p,y=m&&d===Qt.RetryRequest,v=m&&!u.resolved&&c===_n.MoveAllAlternatesMatchingHost,S=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!y&&v&&Ft(s)&&!s.endList&&S&&!NS(t))this.resetFragmentErrors(e),this.treatAsGap(s),u.resolved=!0;else if((y||v)&&f<p.maxNumRetry){var T;const A=_h((T=t.response)==null?void 0:T.code),L=Pp(p,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+L,this.state=se.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,A){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${f+1}/${p.maxNumRetry} in ${L}ms`)}else if(p)if(this.resetFragmentErrors(e),f<p.maxNumRetry)!o&&d!==Qt.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else d===Qt.SendAlternateToPenaltyBox?this.state=se.WAITING_LEVEL:this.state=se.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!_h(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=se.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===se.PARSING||this.state===se.PARSED){const t=e.frag,n=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,n),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,t?.duration||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===Te.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==se.STOPPED&&(this.state=se.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const s=Ue.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,n),this.state===se.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==se.STOPPED&&(this.state=se.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,s){const i=n.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((d,c)=>{const f=e.elementaryStreams[c];if(f){const p=f.endPTS-f.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${p})`),d||!1;const m=s?0:HS(i,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger(I.LEVEL_PTS_UPDATED,{details:i,level:n,drift:m,type:c,frag:e,start:f.startPTS,end:f.endPTS}),!0}return d},!1)){var u;if(n.fragmentError===0&&this.treatAsGap(e,n),((u=this.transmuxer)==null?void 0:u.error)===null){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=se.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(I.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Te.MAIN?"level":"track"}fragInfo(e,t=!0,n){var s,i;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((s=t&&!n?e.startPTS:(n||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!n?e.endPTS:(n||e).end)!=null?i:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function sx(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class ZS{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=fN(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function fN(r,e){const t=new Uint8Array(e);let n=0;for(let s=0;s<r.length;s++){const i=r[s];t.set(i,n),n+=i.length}return t}var Df={exports:{}},ix;function hN(){return ix||(ix=1,(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(d,c,f){this.fn=d,this.context=c,this.once=f||!1}function i(d,c,f,p,m){if(typeof f!="function")throw new TypeError("The listener must be a function");var y=new s(f,p||d,m),v=t?t+c:c;return d._events[v]?d._events[v].fn?d._events[v]=[d._events[v],y]:d._events[v].push(y):(d._events[v]=y,d._eventsCount++),d}function o(d,c){--d._eventsCount===0?d._events=new n:delete d._events[c]}function u(){this._events=new n,this._eventsCount=0}u.prototype.eventNames=function(){var c=[],f,p;if(this._eventsCount===0)return c;for(p in f=this._events)e.call(f,p)&&c.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(f)):c},u.prototype.listeners=function(c){var f=t?t+c:c,p=this._events[f];if(!p)return[];if(p.fn)return[p.fn];for(var m=0,y=p.length,v=new Array(y);m<y;m++)v[m]=p[m].fn;return v},u.prototype.listenerCount=function(c){var f=t?t+c:c,p=this._events[f];return p?p.fn?1:p.length:0},u.prototype.emit=function(c,f,p,m,y,v){var S=t?t+c:c;if(!this._events[S])return!1;var T=this._events[S],A=arguments.length,L,w;if(T.fn){switch(T.once&&this.removeListener(c,T.fn,void 0,!0),A){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,f),!0;case 3:return T.fn.call(T.context,f,p),!0;case 4:return T.fn.call(T.context,f,p,m),!0;case 5:return T.fn.call(T.context,f,p,m,y),!0;case 6:return T.fn.call(T.context,f,p,m,y,v),!0}for(w=1,L=new Array(A-1);w<A;w++)L[w-1]=arguments[w];T.fn.apply(T.context,L)}else{var C=T.length,P;for(w=0;w<C;w++)switch(T[w].once&&this.removeListener(c,T[w].fn,void 0,!0),A){case 1:T[w].fn.call(T[w].context);break;case 2:T[w].fn.call(T[w].context,f);break;case 3:T[w].fn.call(T[w].context,f,p);break;case 4:T[w].fn.call(T[w].context,f,p,m);break;default:if(!L)for(P=1,L=new Array(A-1);P<A;P++)L[P-1]=arguments[P];T[w].fn.apply(T[w].context,L)}}return!0},u.prototype.on=function(c,f,p){return i(this,c,f,p,!1)},u.prototype.once=function(c,f,p){return i(this,c,f,p,!0)},u.prototype.removeListener=function(c,f,p,m){var y=t?t+c:c;if(!this._events[y])return this;if(!f)return o(this,y),this;var v=this._events[y];if(v.fn)v.fn===f&&(!m||v.once)&&(!p||v.context===p)&&o(this,y);else{for(var S=0,T=[],A=v.length;S<A;S++)(v[S].fn!==f||m&&!v[S].once||p&&v[S].context!==p)&&T.push(v[S]);T.length?this._events[y]=T.length===1?T[0]:T:o(this,y)}return this},u.prototype.removeAllListeners=function(c){var f;return c?(f=t?t+c:c,this._events[f]&&o(this,f)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,r.exports=u})(Df)),Df.exports}var pN=hN(),Mp=UD(pN);const Ca="1.6.13",co={};function mN(){return typeof __HLS_WORKER_BUNDLE__=="function"}function gN(){const r=co[Ca];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return co[Ca]=s,s}function yN(r){const e=co[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return co[r]=s,s}function vN(r){const e=co[r||Ca];if(e&&e.clientCount--===1){const{worker:n,objectURL:s}=e;delete co[r||Ca],s&&self.URL.revokeObjectURL(s),n.terminate()}}function JS(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function Fp(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function fc(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function Pa(r,e){const t=e;let n=0;for(;Fp(r,e);){n+=10;const s=fc(r,e+6);n+=s,JS(r,e+10)&&(n+=10),e+=n}if(n>0)return r.subarray(t,t+n)}function xN(r,e,t,n){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const y=new Error(`invalid ADTS sampling index:${o}`);r.emit(I.ERROR,I.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}const u=(i>>6&3)+1,d=e[t+3]>>6&3|(i&1)<<2,c="mp4a.40."+u,f=s[o];let p=o;(u===5||u===29)&&(p-=3);const m=[u<<3|(p&14)>>1,(p&1)<<7|d<<3];return tt.log(`manifest codec:${n}, parsed codec:${c}, channels:${d}, rate:${f} (ADTS object type:${u} sampling index:${o})`),{config:m,samplerate:f,channelCount:d,codec:c,parsedCodec:c,manifestCodec:n}}function eb(r,e){return r[e]===255&&(r[e+1]&246)===240}function tb(r,e){return r[e+1]&1?7:9}function Bp(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function EN(r,e){return e+5<r.length}function Xu(r,e){return e+1<r.length&&eb(r,e)}function TN(r,e){return EN(r,e)&&eb(r,e)&&Bp(r,e)<=r.length-e}function SN(r,e){if(Xu(r,e)){const t=tb(r,e);if(e+t>=r.length)return!1;const n=Bp(r,e);if(n<=t)return!1;const s=e+n;return s===r.length||Xu(r,s)}return!1}function nb(r,e,t,n,s){if(!r.samplerate){const i=xN(e,t,n,s);if(!i)return;rt(r,i)}}function rb(r){return 1024*9e4/r}function bN(r,e){const t=tb(r,e);if(e+t<=r.length){const n=Bp(r,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function sb(r,e,t,n,s){const i=rb(r.samplerate),o=n+s*i,u=bN(e,t);let d;if(u){const{frameLength:p,headerLength:m}=u,y=m+p,v=Math.max(0,t+y-e.length);v?(d=new Uint8Array(y-m),d.set(e.subarray(t+m,e.length),0)):d=e.subarray(t+m,t+y);const S={unit:d,pts:o};return v||r.samples.push(S),{sample:S,length:y,missing:v}}const c=e.length-t;return d=new Uint8Array(c),d.set(e.subarray(t,e.length),0),{sample:{unit:d,pts:o},length:c,missing:-1}}function AN(r,e){return Fp(r,e)&&fc(r,e+6)+10<=r.length-e}function LN(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function Of(r,e=0,t=1/0){return IN(r,e,t,Uint8Array)}function IN(r,e,t,n){const s=wN(r);let i=1;"BYTES_PER_ELEMENT"in n&&(i=n.BYTES_PER_ELEMENT);const o=RN(r)?r.byteOffset:0,u=(o+r.byteLength)/i,d=(o+e)/i,c=Math.floor(Math.max(0,Math.min(d,u))),f=Math.floor(Math.min(c+Math.max(t,0),u));return new n(s,c,f-c)}function wN(r){return r instanceof ArrayBuffer?r:r.buffer}function RN(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function CN(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=r.data.subarray(1).indexOf(0);if(n===-1)return;const s=Nn(Of(r.data,1,n)),i=r.data[2+n],o=r.data.subarray(3+n).indexOf(0);if(o===-1)return;const u=Nn(Of(r.data,3+n,o));let d;return s==="-->"?d=Nn(Of(r.data,4+n+o)):d=LN(r.data.subarray(4+n+o)),e.mimeType=s,e.pictureType=i,e.description=u,e.data=d,e}function PN(r){if(r.size<2)return;const e=Nn(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function _N(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const n=Nn(r.data.subarray(t),!0);t+=n.length+1;const s=Nn(r.data.subarray(t));return{key:r.type,info:n,data:s}}const e=Nn(r.data.subarray(1));return{key:r.type,info:"",data:e}}function kN(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const n=Nn(r.data.subarray(t),!0);t+=n.length+1;const s=Nn(r.data.subarray(t));return{key:r.type,info:n,data:s}}const e=Nn(r.data);return{key:r.type,info:"",data:e}}function DN(r){return r.type==="PRIV"?PN(r):r.type[0]==="W"?kN(r):r.type==="APIC"?CN(r):_N(r)}function ON(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=fc(r,4),n=10;return{type:e,size:t,data:r.subarray(n,n+t)}}const ou=10,NN=10;function ib(r){let e=0;const t=[];for(;Fp(r,e);){const n=fc(r,e+6);r[e+5]>>6&1&&(e+=ou),e+=ou;const s=e+n;for(;e+NN<s;){const i=ON(r.subarray(e)),o=DN(i);o&&t.push(o),e+=i.size+ou}JS(r,e)&&(e+=ou)}return t}function ob(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function MN(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function Up(r){const e=ib(r);for(let t=0;t<e.length;t++){const n=e[t];if(ob(n))return MN(n)}}let Dn=(function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r})({});function pr(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class jp{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Kn(this.cachedData,e),this.cachedData=null);let n=Pa(e,0),s=n?n.length:0,i;const o=this._audioTrack,u=this._id3Track,d=n?Up(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&ve(d))&&(this.basePTS=FN(d,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Dn.audioId3,duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const f=this.appendFrame(o,e,s);f?(this.frameIndex++,this.lastPTS=f.sample.pts,s+=f.length,i=s):s=c}else AN(e,s)?(n=Pa(e,s),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Dn.audioId3,duration:Number.POSITIVE_INFINITY}),s+=n.length,i=s):s++;if(s===c&&i!==c){const f=e.slice(i);this.cachedData?this.cachedData=Kn(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:pr(),id3Track:u,textTrack:pr()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:pr(),id3Track:this._id3Track,textTrack:pr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const FN=(r,e,t)=>{if(ve(r))return r*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let au=null;const BN=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],UN=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],jN=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],$N=[0,1,1,4];function ab(r,e,t,n,s){if(t+24>e.length)return;const i=lb(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,u=n+s*o,d={unit:e.subarray(t,t+i.frameLength),pts:u,dts:u};return r.config=[],r.channelCount=i.channelCount,r.samplerate=i.sampleRate,r.samples.push(d),{sample:d,length:i.frameLength,missing:0}}}function lb(r,e){const t=r[e+1]>>3&3,n=r[e+1]>>1&3,s=r[e+2]>>4&15,i=r[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const o=r[e+2]>>1&1,u=r[e+3]>>6,d=t===3?3-n:n===3?3:4,c=BN[d*14+s-1]*1e3,p=UN[(t===3?0:t===2?1:2)*3+i],m=u===3?1:2,y=jN[t][n],v=$N[n],S=y*8*v,T=Math.floor(y*c/p+o)*v;if(au===null){const w=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);au=w?parseInt(w[1]):0}return!!au&&au<=87&&n===2&&c>=224e3&&u===0&&(r[e+3]=r[e+3]|128),{sampleRate:p,channelCount:m,frameLength:T,samplesPerFrame:S}}}function $p(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function ub(r,e){return e+1<r.length&&$p(r,e)}function VN(r,e){return $p(r,e)&&4<=r.length-e}function cb(r,e){if(e+1<r.length&&$p(r,e)){const n=lb(r,e);let s=4;n!=null&&n.frameLength&&(s=n.frameLength);const i=e+s;return i===r.length||ub(r,i)}return!1}class GN extends jp{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Pa(e,0);let s=n?.length||0;if(cb(e,s))return!1;for(let i=e.length;s<i;s++)if(SN(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return TN(e,t)}appendFrame(e,t,n){nb(e,this.observer,t,n,e.manifestCodec);const s=sb(e,t,n,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const db=(r,e)=>{let t=0,n=5;e+=n;const s=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;n>0;){o[0]=r[e];const u=Math.min(n,8),d=8-u;i[0]=4278190080>>>24+d<<d,s[0]=(o[0]&i[0])>>d,t=t?t<<u|s[0]:s[0],e+=1,n-=u}return t};class HN extends jp{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const s=fb(e,t,n,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Pa(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&Up(t)!==void 0&&db(e,n)<16}}function fb(r,e,t,n,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const u=[48e3,44100,32e3][i],d=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+i]*2;if(t+f>e.length)return-1;const p=e[t+6]>>5;let m=0;p===2?m+=2:(p&1&&p!==1&&(m+=2),p&4&&(m+=2));const y=(e[t+6]<<8|e[t+7])>>12-m&1,S=[2,1,2,3,3,4,4,5][p]+y,T=e[t+5]>>3,A=e[t+5]&7,L=new Uint8Array([i<<6|T<<1|A>>2,(A&3)<<6|p<<3|y<<2|d>>4,d<<4&224]),w=1536/u*9e4,C=n+s*w,P=e.subarray(t,t+f);return r.config=L,r.channelCount=S,r.samplerate=u,r.samples.push({unit:P,pts:C}),f}class KN extends jp{resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Pa(e,0);let n=t?.length||0;if(t&&e[n]===11&&e[n+1]===119&&Up(t)!==void 0&&db(e,n)<=16)return!1;for(let s=e.length;n<s;n++)if(cb(e,n))return tt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return VN(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return ab(e,t,n,this.basePTS,this.frameIndex)}}const zN=/\/emsg[-/]ID3/i;class WN{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,s){const i=this.videoTrack=pr("video",1),o=this.audioTrack=pr("audio",1),u=this.txtTrack=pr("text",1);if(this.id3Track=pr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const d=SS(e);if(d.video){const{id:c,timescale:f,codec:p,supplemental:m}=d.video;i.id=c,i.timescale=u.timescale=f,i.codec=p,i.supplemental=m}if(d.audio){const{id:c,timescale:f,codec:p}=d.audio;o.id=c,o.timescale=f,o.codec=p}u.id=xS.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return HD(e)}demux(e,t){this.timeOffset=t;let n=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Kn(this.remainderData,e));const u=QD(n);this.remainderData=u.remainder,s.samples=u.valid||new Uint8Array}else s.samples=n;const o=this.extractID3Track(s,t);return i.samples=bv(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return n.samples=bv(e,t),{videoTrack:t,audioTrack:pr(),id3Track:s,textTrack:pr()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const s=Ge(e.samples,["emsg"]);s&&s.forEach(i=>{const o=JD(i);if(zN.test(o.schemeIdUri)){const u=ox(o,t);let d=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const c=o.payload;n.samples.push({data:c,len:c.byteLength,dts:u,pts:u,type:Dn.emsg,duration:d})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=ox(o,t);n.samples.push({data:o.payload,len:o.payload.byteLength,dts:u,pts:u,type:Dn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function ox(r,e){return ve(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class YN{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new _p(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Rs.cbc)}decryptAacSample(e,t,n){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(u=>{const d=new Uint8Array(u);s.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)n.set(e.subarray(i,i+16),s);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(n.subarray(s,s+16),i);return e}decryptAvcSample(e,t,n,s,i){const o=LS(i.data),u=this.getAvcEncryptedData(o);this.decryptBuffer(u.buffer).then(d=>{i.data=this.getAvcDecryptedUnit(o,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,s)}).catch(s)}decryptAvcSamples(e,t,n,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(n>=i.length);n++){const o=i[n];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,n,s,o),!this.decrypter.isSync()))return}}}}class hb{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,s;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const i=n.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,s=n.length;if(s){const i=n[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const s=t.byteLength;let i=e.naluState||0;const o=i,u=[];let d=0,c,f,p,m=-1,y=0;for(i===-1&&(m=0,y=this.getNALuType(t,0),i=0,d=1);d<s;){if(c=t[d++],!i){i=c?0:1;continue}if(i===1){i=c?0:2;continue}if(!c)i=3;else if(c===1){if(f=d-i-1,m>=0){const v={data:t.subarray(m,f),type:y};u.push(v)}else{const v=this.getLastNalUnit(e.samples);v&&(o&&d<=4-o&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-o)),f>0&&(v.data=Kn(v.data,t.subarray(0,f)),v.state=0))}d<s?(p=this.getNALuType(t,d),m=d,y=p,i=0):i=-1}else i=0}if(m>=0&&i>=0){const v={data:t.subarray(m,s),type:y,state:i};u.push(v)}if(u.length===0){const v=this.getLastNalUnit(e.samples);v&&(v.data=Kn(v.data,t))}return e.naluState=i,u}}class ga{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(n,n+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&tt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class qN extends hb{parsePES(e,t,n,s){const i=this.parseNALu(e,n.data,s);let o=this.VideoSample,u,d=!1;n.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(c=>{var f,p;switch(c.type){case 1:{let S=!1;u=!0;const T=c.data;if(d&&T.length>4){const A=this.readSliceType(T);(A===2||A===4||A===7||A===9)&&(S=!0)}if(S){var m;(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.frame=!0,o.key=S;break}case 5:u=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 6:{u=!0,wp(c.data,1,n.pts,t.samples);break}case 7:{var y,v;u=!0,d=!0;const S=c.data,T=this.readSPS(S);if(!e.sps||e.width!==T.width||e.height!==T.height||((y=e.pixelRatio)==null?void 0:y[0])!==T.pixelRatio[0]||((v=e.pixelRatio)==null?void 0:v[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[S];const A=S.subarray(1,4);let L="avc1.";for(let w=0;w<3;w++){let C=A[w].toString(16);C.length<2&&(C="0"+C),L+=C}e.codec=L}break}case 8:u=!0,e.pps=[c.data];break;case 9:u=!0,e.audFound=!0,(p=o)!=null&&p.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:u=!0;break;default:u=!1;break}o&&u&&o.units.push(c)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new ga(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,s=8,i;for(let o=0;o<e;o++)s!==0&&(i=t.readEG(),s=(n+i+256)%256),n=s===0?n:s}readSPS(e){const t=new ga(e);let n=0,s=0,i=0,o=0,u,d,c;const f=t.readUByte.bind(t),p=t.readBits.bind(t),m=t.readUEG.bind(t),y=t.readBoolean.bind(t),v=t.skipBits.bind(t),S=t.skipEG.bind(t),T=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);f();const L=f();if(p(5),v(3),f(),T(),L===100||L===110||L===122||L===244||L===44||L===83||L===86||L===118||L===128){const N=m();if(N===3&&v(1),T(),T(),v(1),y())for(d=N!==3?8:12,c=0;c<d;c++)y()&&(c<6?A(16,t):A(64,t))}T();const w=m();if(w===0)m();else if(w===1)for(v(1),S(),S(),u=m(),c=0;c<u;c++)S();T(),v(1);const C=m(),P=m(),B=p(1);B===0&&v(1),v(1),y()&&(n=m(),s=m(),i=m(),o=m());let D=[1,1];if(y()&&y())switch(f()){case 1:D=[1,1];break;case 2:D=[12,11];break;case 3:D=[10,11];break;case 4:D=[16,11];break;case 5:D=[40,33];break;case 6:D=[24,11];break;case 7:D=[20,11];break;case 8:D=[32,11];break;case 9:D=[80,33];break;case 10:D=[18,11];break;case 11:D=[15,11];break;case 12:D=[64,33];break;case 13:D=[160,99];break;case 14:D=[4,3];break;case 15:D=[3,2];break;case 16:D=[2,1];break;case 255:{D=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((C+1)*16-n*2-s*2),height:(2-B)*(P+1)*16-(B?2:4)*(i+o),pixelRatio:D}}}class XN extends hb{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,s){const i=this.parseNALu(e,n.data,s);let o=this.VideoSample,u,d=!1;n.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(c=>{var f,p;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,d){var m;(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:u=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 39:u=!0,wp(c.data,2,n.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=rt(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(u=!0,d=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const y=this.readSPS(c.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const v in y.params)e.params[v]=y.params[v]}this.pushParameterSet(e.sps,c.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const y=this.readPPS(c.data);for(const v in y)e.params[v]=y[v]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(p=o)!=null&&p.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:u=!1;break}o&&u&&o.units.push(c)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[n]=e[s],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new ga(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:s}}readSPS(e){const t=new ga(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),u=t.readUByte(),d=t.readUByte(),c=t.readUByte(),f=t.readUByte(),p=t.readUByte(),m=t.readUByte(),y=t.readUByte(),v=t.readUByte(),S=t.readUByte(),T=t.readUByte(),A=t.readUByte(),L=[],w=[];for(let ze=0;ze<n;ze++)L.push(t.readBoolean()),w.push(t.readBoolean());if(n>0)for(let ze=n;ze<8;ze++)t.readBits(2);for(let ze=0;ze<n;ze++)L[ze]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),w[ze]&&t.readUByte();t.readUEG();const C=t.readUEG();C==3&&t.skipBits(1);const P=t.readUEG(),B=t.readUEG(),D=t.readBoolean();let N=0,F=0,O=0,V=0;D&&(N+=t.readUEG(),F+=t.readUEG(),O+=t.readUEG(),V+=t.readUEG());const H=t.readUEG(),te=t.readUEG(),X=t.readUEG(),ae=t.readBoolean();for(let ze=ae?0:n;ze<=n;ze++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let wt=0;wt<4;wt++)for(let Dt=0;Dt<(wt===3?2:6);Dt++)if(!t.readBoolean())t.readUEG();else{const Ot=Math.min(64,1<<4+(wt<<1));wt>1&&t.readEG();for(let Yt=0;Yt<Ot;Yt++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const G=t.readUEG();let ee=0;for(let ze=0;ze<G;ze++){let wt=!1;if(ze!==0&&(wt=t.readBoolean()),wt){ze===G&&t.readUEG(),t.readBoolean(),t.readUEG();let Dt=0;for(let Ln=0;Ln<=ee;Ln++){const Ot=t.readBoolean();let Yt=!1;Ot||(Yt=t.readBoolean()),(Ot||Yt)&&Dt++}ee=Dt}else{const Dt=t.readUEG(),Ln=t.readUEG();ee=Dt+Ln;for(let Ot=0;Ot<Dt;Ot++)t.readUEG(),t.readBoolean();for(let Ot=0;Ot<Ln;Ot++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ze=t.readUEG();for(let wt=0;wt<ze;wt++){for(let Dt=0;Dt<X+4;Dt++)t.readBits(1);t.readBits(1)}}let k=0,U=1,re=1,pe=!0,me=1,ye=0;t.readBoolean(),t.readBoolean();let ke=!1;if(t.readBoolean()){if(t.readBoolean()){const Jt=t.readUByte(),br=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Ar=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Jt>0&&Jt<16?(U=br[Jt-1],re=Ar[Jt-1]):Jt===255&&(U=t.readBits(16),re=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ke=t.readBoolean(),ke&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(me=t.readBits(32),ye=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Ar=t.readBoolean(),le=t.readBoolean();let Y=!1;(Ar||le)&&(Y=t.readBoolean(),Y&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Y&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let de=0;de<=n;de++){pe=t.readBoolean();const fe=pe||t.readBoolean();let Be=!1;fe?t.readEG():Be=t.readBoolean();const Fe=Be?1:t.readUEG()+1;if(Ar)for(let $e=0;$e<Fe;$e++)t.readUEG(),t.readUEG(),Y&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(le)for(let $e=0;$e<Fe;$e++)t.readUEG(),t.readUEG(),Y&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),k=t.readUEG())}let Oe=P,He=B;if(D){let ze=1,wt=1;C===1?ze=wt=2:C==2&&(ze=2),Oe=P-ze*F-ze*N,He=B-wt*V-wt*O}const Ke=s?["A","B","C"][s]:"",Gt=u<<24|d<<16|c<<8|f;let xt=0;for(let ze=0;ze<32;ze++)xt=(xt|(Gt>>ze&1)<<31-ze)>>>0;let Sr=xt.toString(16);return o===1&&Sr==="2"&&(Sr="6"),{codecString:`hvc1.${Ke}${o}.${Sr}.${i?"H":"L"}${A}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[u,d,c,f],general_constraint_indicator_flags:[p,m,y,v,S,T],general_level_idc:A,bit_depth:H+8,bit_depth_luma_minus8:H,bit_depth_chroma_minus8:te,min_spatial_segmentation_idc:k,chroma_format_idc:C,frame_rate:{fixed:pe,fps:ye/me}},width:Oe,height:He,pixelRatio:[U,re]}}readPPS(e){const t=new ga(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let o=1;return i&&s?o=0:i?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Wt=188;class xs{constructor(e,t,n,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=s,this.videoParser=null}static probe(e,t){const n=xs.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(Wt*5,t-Wt)+1,s=0;for(;s<n;){let i=!1,o=-1,u=0;for(let d=s;d<t;d+=Wt)if(e[d]===71&&(t-d===Wt||e[d+Wt]===71)){if(u++,o===-1&&(o=d,o!==0&&(n=Math.min(o+Wt*99,e.length-Wt)+1)),i||(i=Mh(e,d)===0),i&&u>1&&(o===0&&u>2||d+Wt>n))return o}else{if(u)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:xS[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=xs.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=xs.createTrack("audio",s),this._id3Track=xs.createTrack("id3"),this._txtTrack=xs.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,s=!1){n||(this.sampleAes=null);let i;const o=this._videoTrack,u=this._audioTrack,d=this._id3Track,c=this._txtTrack;let f=o.pid,p=o.pesData,m=u.pid,y=d.pid,v=u.pesData,S=d.pesData,T=null,A=this.pmtParsed,L=this._pmtId,w=e.length;if(this.remainderData&&(e=Kn(this.remainderData,e),w=e.length,this.remainderData=null),w<Wt&&!s)return this.remainderData=e,{audioTrack:u,videoTrack:o,id3Track:d,textTrack:c};const C=Math.max(0,xs.syncOffset(e));w-=(w-C)%Wt,w<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,w,e.buffer.byteLength-w));let P=0;for(let D=C;D<w;D+=Wt)if(e[D]===71){const N=!!(e[D+1]&64),F=Mh(e,D),O=(e[D+3]&48)>>4;let V;if(O>1){if(V=D+5+e[D+4],V===D+Wt)continue}else V=D+4;switch(F){case f:N&&(p&&(i=ji(p,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,c,i,!1)),p={data:[],size:0}),p&&(p.data.push(e.subarray(V,D+Wt)),p.size+=D+Wt-V);break;case m:if(N){if(v&&(i=ji(v,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,i);break;case"mp3":this.parseMPEGPES(u,i);break;case"ac3":this.parseAC3PES(u,i);break}v={data:[],size:0}}v&&(v.data.push(e.subarray(V,D+Wt)),v.size+=D+Wt-V);break;case y:N&&(S&&(i=ji(S,this.logger))&&this.parseID3PES(d,i),S={data:[],size:0}),S&&(S.data.push(e.subarray(V,D+Wt)),S.size+=D+Wt-V);break;case 0:N&&(V+=e[V]+1),L=this._pmtId=QN(e,V);break;case L:{N&&(V+=e[V]+1);const H=ZN(e,V,this.typeSupported,n,this.observer,this.logger);f=H.videoPid,f>0&&(o.pid=f,o.segmentCodec=H.segmentVideoCodec),m=H.audioPid,m>0&&(u.pid=m,u.segmentCodec=H.segmentAudioCodec),y=H.id3Pid,y>0&&(d.pid=y),T!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${D} after unknown PID '${T}'. Backtracking to sync byte @${C} to parse all TS packets.`),T=null,D=C-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=F;break}}else P++;P>0&&Fh(this.observer,new Error(`Found ${P} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=p,u.pesData=v,d.pesData=S;const B={audioTrack:u,videoTrack:o,id3Track:d,textTrack:c};return s&&this.extractRemainingSamples(B),B}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:s,textTrack:i}=e,o=n.pesData,u=t.pesData,d=s.pesData;let c;if(o&&(c=ji(o,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,i,c,!0),n.pesData=null)):n.pesData=o,u&&(c=ji(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;d&&(c=ji(d,this.logger))?(this.parseID3PES(s,c),s.pesData=null):s.pesData=d}demuxSampleAes(e,t,n){const s=this.demux(e,n,!0,!this.config.progressive),i=this.sampleAes=new YN(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new qN:e==="hevc"&&(this.videoParser=new XN))}decrypt(e,t){return new Promise(n=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{n(e)}):n(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const p=s.missing,m=s.sample.unit.byteLength;if(p===-1)i=Kn(s.sample.unit,i);else{const y=m-p;s.sample.unit.set(i.subarray(0,p),y),e.samples.push(s.sample),n=s.missing}}let o,u;for(o=n,u=i.length;o<u-1&&!Xu(i,o);o++);if(o!==n){let p;const m=o<u-1;if(m?p=`AAC PES did not start with ADTS header,offset:${o}`:p="No ADTS header found in AAC PES",Fh(this.observer,new Error(p),m,this.logger),!m)return}nb(e,this.observer,i,o,this.audioCodec);let d;if(t.pts!==void 0)d=t.pts;else if(s){const p=rb(e.samplerate);d=s.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,f;for(;o<u;)if(f=sb(e,i,o,d,c),o+=f.length,f.missing){this.aacOverFlow=f;break}else for(c++;o<u-1&&!Xu(i,o);o++);}parseMPEGPES(e,t){const n=t.data,s=n.length;let i=0,o=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(ub(n,o)){const d=ab(e,n,o,u,i);if(d)o+=d.length,i++;else break}else o++}parseAC3PES(e,t){{const n=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=n.length;let o=0,u=0,d;for(;u<i&&(d=fb(e,n,u,s,o++))>0;)u+=d}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=rt({},t,{type:this._videoTrack?Dn.emsg:Dn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function Mh(r,e){return((r[e+1]&31)<<8)+r[e+2]}function QN(r,e){return(r[e+10]&31)<<8|r[e+11]}function ZN(r,e,t,n,s,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(r[e+1]&15)<<8|r[e+2],d=e+3+u-4,c=(r[e+10]&15)<<8|r[e+11];for(e+=12+c;e<d;){const f=Mh(r,e),p=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!n){Nf("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=f);break;case 21:o.id3Pid===-1&&(o.id3Pid=f);break;case 219:if(!n){Nf("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="mp3");break;case 193:if(!n){Nf("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&p>0){let m=e+5,y=p;for(;y>2;){switch(r[m]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=f,o.segmentAudioCodec="ac3");break}const S=r[m+1]+2;m+=S,y-=S}}break;case 194:case 135:return Fh(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=f,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=p+5}return o}function Fh(r,e,t,n){n.warn(`parsing error: ${e.message}`),r.emit(I.ERROR,I.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Nf(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function ji(r,e){let t=0,n,s,i,o,u;const d=r.data;if(!r||r.size===0)return null;for(;d[0].length<19&&d.length>1;)d[0]=Kn(d[0],d[1]),d.splice(1,1);if(n=d[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(s=(n[4]<<8)+n[5],s&&s>r.size-6)return null;const f=n[7];f&192&&(o=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,f&64?(u=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,o-u>60*9e4&&(e.warn(`${Math.round((o-u)/9e4)}s delta between PTS and DTS, align them`),o=u)):u=o),i=n[8];let p=i+9;if(r.size<=p)return null;r.size-=p;const m=new Uint8Array(r.size);for(let y=0,v=d.length;y<v;y++){n=d[y];let S=n.byteLength;if(p)if(p>S){p-=S;continue}else n=n.subarray(p),S-=p,p=0;m.set(n,t),t+=S}return s&&(s-=i+3),{data:m,pts:o,dts:u,len:s}}return null}class JN{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const ps=Math.pow(2,32)-1;class K{static init(){K.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in K.types)K.types.hasOwnProperty(e)&&(K.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);K.HDLR_TYPES={video:t,audio:n};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);K.STTS=K.STSC=K.STCO=i,K.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),K.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),K.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),K.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);K.FTYP=K.box(K.types.ftyp,o,d,o,u),K.DINF=K.box(K.types.dinf,K.box(K.types.dref,s))}static box(e,...t){let n=8,s=t.length;const i=s;for(;s--;)n+=t[s].byteLength;const o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=n&255,o.set(e,4),s=0,n=8;s<i;s++)o.set(t[s],n),n+=t[s].byteLength;return o}static hdlr(e){return K.box(K.types.hdlr,K.HDLR_TYPES[e])}static mdat(e){return K.box(K.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(ps+1)),s=Math.floor(t%(ps+1));return K.box(K.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return K.box(K.types.mdia,K.mdhd(e.timescale||0,e.duration||0),K.hdlr(e.type),K.minf(e))}static mfhd(e){return K.box(K.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?K.box(K.types.minf,K.box(K.types.smhd,K.SMHD),K.DINF,K.stbl(e)):K.box(K.types.minf,K.box(K.types.vmhd,K.VMHD),K.DINF,K.stbl(e))}static moof(e,t,n){return K.box(K.types.moof,K.mfhd(e),K.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=K.trak(e[t]);return K.box.apply(null,[K.types.moov,K.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(K.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=K.trex(e[t]);return K.box.apply(null,[K.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(ps+1)),s=Math.floor(t%(ps+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return K.box(K.types.mvhd,i)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,n[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return K.box(K.types.sdtp,n)}static stbl(e){return K.box(K.types.stbl,K.stsd(e),K.box(K.types.stts,K.STTS),K.box(K.types.stsc,K.STSC),K.box(K.types.stsz,K.STSZ),K.box(K.types.stco,K.STCO))}static avc1(e){let t=[],n=[],s,i,o;for(s=0;s<e.sps.length;s++)i=e.sps[s],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],o=i.byteLength,n.push(o>>>8&255),n.push(o&255),n=n.concat(Array.prototype.slice.call(i));const u=K.box(K.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),d=e.width,c=e.height,f=e.pixelRatio[0],p=e.pixelRatio[1];return K.box(K.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,K.box(K.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),K.box(K.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return K.box(K.types.mp4a,K.audioStsd(e),K.box(K.types.esds,K.esds(e)))}static mp3(e){return K.box(K.types[".mp3"],K.audioStsd(e))}static ac3(e){return K.box(K.types["ac-3"],K.audioStsd(e),K.box(K.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return K.box(K.types.stsd,K.STSD,K.mp4a(e));if(t==="ac3"&&e.config)return K.box(K.types.stsd,K.STSD,K.ac3(e));if(t==="mp3"&&e.codec==="mp3")return K.box(K.types.stsd,K.STSD,K.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return K.box(K.types.stsd,K.STSD,K.avc1(e));if(t==="hevc"&&e.vps)return K.box(K.types.stsd,K.STSD,K.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,o=Math.floor(n/(ps+1)),u=Math.floor(n%(ps+1));return K.box(K.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const n=K.sdtp(e),s=e.id,i=Math.floor(t/(ps+1)),o=Math.floor(t%(ps+1));return K.box(K.types.traf,K.box(K.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),K.box(K.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),K.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,K.box(K.types.trak,K.tkhd(e),K.mdia(e))}static trex(e){const t=e.id;return K.box(K.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],s=n.length,i=12+16*s,o=new Uint8Array(i);let u,d,c,f,p,m;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<s;u++)d=n[u],c=d.duration,f=d.size,p=d.flags,m=d.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,m>>>24&255,m>>>16&255,m>>>8&255,m&255],12+16*u);return K.box(K.types.trun,o)}static initSegment(e){K.types||K.init();const t=K.moov(e);return Kn(K.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let o=i.length;for(let v=0;v<n.length;v+=1){o+=3;for(let S=0;S<n[v].length;S+=1)o+=2+n[v][S].length}const u=new Uint8Array(o);u.set(i,0),o=i.length;const d=n.length-1;for(let v=0;v<n.length;v+=1){u.set(new Uint8Array([32+v|(v===d?128:0),0,n[v].length]),o),o+=3;for(let S=0;S<n[v].length;S+=1)u.set(new Uint8Array([n[v][S].length>>8,n[v][S].length&255]),o),o+=2,u.set(n[v][S],o),o+=n[v][S].length}const c=K.box(K.types.hvcC,u),f=e.width,p=e.height,m=e.pixelRatio[0],y=e.pixelRatio[1];return K.box(K.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,K.box(K.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),K.box(K.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,y>>24,y>>16&255,y>>8&255,y&255])))}}K.types=void 0;K.HDLR_TYPES=void 0;K.STTS=void 0;K.STSC=void 0;K.STCO=void 0;K.STSZ=void 0;K.VMHD=void 0;K.SMHD=void 0;K.STSD=void 0;K.FTYP=void 0;K.DINF=void 0;const pb=9e4;function Vp(r,e,t=1,n=!1){const s=r*e*t;return n?Math.round(s):s}function eM(r,e,t=1,n=!1){return Vp(r,e,1/t,n)}function oa(r,e=!1){return Vp(r,1e3,1/pb,e)}function tM(r,e=1){return Vp(r,pb,1/e)}function ax(r){const{baseTime:e,timescale:t,trackId:n}=r;return`${e/t} (${e}/${t}) trackId: ${n}`}const nM=10*1e3,rM=1024,sM=1152,iM=1536;let $i=null,Mf=null;function lx(r,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class Au extends Wn{constructor(e,t,n,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,$i===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$i=o?parseInt(o[1]):0}if(Mf===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);Mf=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&ax(t)} > ${e&&ax(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,s=e.reduce((i,o)=>{let u=o.pts,d=u-i;return d<-4294967296&&(t=!0,u=kn(u,n),d=u-i),d>0?i:u},n);return t&&this.debug("PTS rollover detected"),s}remux(e,t,n,s,i,o,u,d){let c,f,p,m,y,v,S=i,T=i;const A=e.pid>-1,L=t.pid>-1,w=t.samples.length,C=e.samples.length>0,P=u&&w>0||w>1;if((!A||C)&&(!L||P)||this.ISGenerated||u){if(this.ISGenerated){var D,N,F,O;const X=this.videoTrackConfig;(X&&(t.width!==X.width||t.height!==X.height||((D=t.pixelRatio)==null?void 0:D[0])!==((N=X.pixelRatio)==null?void 0:N[0])||((F=t.pixelRatio)==null?void 0:F[1])!==((O=X.pixelRatio)==null?void 0:O[1]))||!X&&P||this.nextAudioTs===null&&C)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,i,o));const V=this.isVideoContiguous;let H=-1,te;if(P&&(H=oM(t.samples),!V&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,H>0){this.warn(`Dropped ${H} out of ${w} video samples due to a missing keyframe`);const X=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(H),t.dropped+=H,T+=(t.samples[0].pts-X)/t.inputTimeScale,te=T}else H===-1&&(this.warn(`No keyframe found out of ${w} video samples`),v=!1);if(this.ISGenerated){if(C&&P){const X=this.getVideoStartPts(t.samples),Q=(kn(e.samples[0].pts,X)-X)/t.inputTimeScale;S+=Math.max(0,Q),T+=Math.max(0,-Q)}if(C){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,i,o)),f=this.remuxAudio(e,S,this.isAudioContiguous,o,L||P||d===Te.AUDIO?T:void 0),P){const X=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,i,o)),c=this.remuxVideo(t,T,V,X)}}else P&&(c=this.remuxVideo(t,T,V,0));c&&(c.firstKeyFrame=H,c.independent=H!==-1,c.firstKeyFramePTS=te)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(y=mb(n,i,this._initPTS,this._initDTS)),s.samples.length&&(m=gb(s,i,this._initPTS))),{audio:f,video:c,initSegment:p,independent:v,text:m,id3:y}}computeInitPts(e,t,n,s){const i=Math.round(n*t);let o=kn(e,i);if(o<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-o)/t} ${s}`);o<i+t;)o+=8589934592;return o-i}generateIS(e,t,n,s){const i=e.samples,o=t.samples,u=this.typeSupported,d={},c=this._initPTS;let f=!c||s,p="audio/mp4",m,y,v,S=-1;if(f&&(m=y=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(p="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):K.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(S=e.id,v=e.inputTimeScale,!c||v!==c.timescale?m=y=this.computeInitPts(i[0].pts,v,n,"audio"):f=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:K.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(S=t.id,v=t.inputTimeScale,!c||v!==c.timescale){const T=this.getVideoStartPts(o),A=kn(o[0].dts,T),L=this.computeInitPts(A,v,n,"video"),w=this.computeInitPts(T,v,n,"video");y=Math.min(y,L),m=Math.min(m,w)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,f?(c&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${n} ${m/v} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${m/v} (${m}/${v}) trackId: ${S}`),this._initPTS={baseTime:m,timescale:v,trackId:S},this._initDTS={baseTime:y,timescale:v,trackId:S}):m=v=void 0,{tracks:d,initPTS:m,timescale:v,trackId:S}}remuxVideo(e,t,n,s){const i=e.inputTimeScale,o=e.samples,u=[],d=o.length,c=this._initPTS,f=c.baseTime*i/c.timescale;let p=this.nextVideoTs,m=8,y=this.videoSampleDuration,v,S,T=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,L=!1;if(!n||p===null){const k=f+t*i,U=o[0].pts-kn(o[0].dts,o[0].pts);$i&&p!==null&&Math.abs(k-U-(p+f))<15e3?n=!0:p=k-U-f}const w=p+f;for(let k=0;k<d;k++){const U=o[k];U.pts=kn(U.pts,w),U.dts=kn(U.dts,w),U.dts<o[k>0?k-1:k].dts&&(L=!0)}L&&o.sort(function(k,U){const re=k.dts-U.dts,pe=k.pts-U.pts;return re||pe}),v=o[0].dts,S=o[o.length-1].dts;const C=S-v,P=C?Math.round(C/(d-1)):y||e.inputTimeScale/30;if(n){const k=v-w,U=k>P,re=k<-1;if((U||re)&&(U?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${oa(k,!0)} ms (${k}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${oa(-k,!0)} ms (${k}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!re||w>=o[0].pts||$i)){v=w;const pe=o[0].pts-k;if(U)o[0].dts=v,o[0].pts=pe;else{let me=!0;for(let ye=0;ye<o.length&&!(o[ye].dts>pe&&me);ye++){const ke=o[ye].pts;if(o[ye].dts-=k,o[ye].pts-=k,ye<o.length-1){const Ce=o[ye+1].pts,Oe=o[ye].pts,He=Ce<=Oe,Ke=Ce<=ke;me=He==Ke}}}this.log(`Video: Initial PTS/DTS adjusted: ${oa(pe,!0)}/${oa(v,!0)}, delta: ${oa(k,!0)} ms`)}}v=Math.max(0,v);let B=0,D=0,N=v;for(let k=0;k<d;k++){const U=o[k],re=U.units,pe=re.length;let me=0;for(let ye=0;ye<pe;ye++)me+=re[ye].data.length;D+=me,B+=pe,U.length=me,U.dts<N?(U.dts=N,N+=P/4|0||1):N=U.dts,T=Math.min(U.pts,T),A=Math.max(U.pts,A)}S=o[d-1].dts;const F=D+4*B+8;let O;try{O=new Uint8Array(F)}catch(k){this.observer.emit(I.ERROR,I.ERROR,{type:we.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:k,bytes:F,reason:`fail allocating video mdat ${F}`});return}const V=new DataView(O.buffer);V.setUint32(0,F),O.set(K.types.mdat,4);let H=!1,te=Number.POSITIVE_INFINITY,X=Number.POSITIVE_INFINITY,ae=Number.NEGATIVE_INFINITY,Q=Number.NEGATIVE_INFINITY;for(let k=0;k<d;k++){const U=o[k],re=U.units;let pe=0;for(let ke=0,Ce=re.length;ke<Ce;ke++){const Oe=re[ke],He=Oe.data,Ke=Oe.data.byteLength;V.setUint32(m,Ke),m+=4,O.set(He,m),m+=Ke,pe+=4+Ke}let me;if(k<d-1)y=o[k+1].dts-U.dts,me=o[k+1].pts-U.pts;else{const ke=this.config,Ce=k>0?U.dts-o[k-1].dts:P;if(me=k>0?U.pts-o[k-1].pts:P,ke.stretchShortVideoTrack&&this.nextAudioTs!==null){const Oe=Math.floor(ke.maxBufferHole*i),He=(s?T+s*i:this.nextAudioTs+f)-U.pts;He>Oe?(y=He-Ce,y<0?y=Ce:H=!0,this.log(`It is approximately ${He/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=Ce}else y=Ce}const ye=Math.round(U.pts-U.dts);te=Math.min(te,y),ae=Math.max(ae,y),X=Math.min(X,me),Q=Math.max(Q,me),u.push(lx(U.key,y,pe,ye))}if(u.length){if($i){if($i<70){const k=u[0].flags;k.dependsOn=2,k.isNonSync=0}}else if(Mf&&Q-X<ae-te&&P/ae<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let k=v;for(let U=0,re=u.length;U<re;U++){const pe=k+u[U].duration,me=k+u[U].cts;if(U<re-1){const ye=pe+u[U+1].cts;u[U].duration=ye-me}else u[U].duration=U?u[U-1].duration:P;u[U].cts=0,k=pe}}}y=H||!y?P:y;const ie=S+y;this.nextVideoTs=p=ie-f,this.videoSampleDuration=y,this.isVideoContiguous=!0;const Z={data1:K.moof(e.sequenceNumber++,v,rt(e,{samples:u})),data2:O,startPTS:(T-f)/i,endPTS:(A+y-f)/i,startDTS:(v-f)/i,endDTS:p/i,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Z}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return sM;case"ac3":return iM;default:return rM}}remuxAudio(e,t,n,s,i){const o=e.inputTimeScale,u=e.samplerate?e.samplerate:o,d=o/u,c=this.getSamplesPerFrame(e),f=c*d,p=this._initPTS,m=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],v=i!==void 0;let S=e.samples,T=m?0:8,A=this.nextAudioTs||-1;const L=p.baseTime*o/p.timescale,w=L+t*o;if(this.isAudioContiguous=n=n||S.length&&A>0&&(s&&Math.abs(w-(A+L))<9e3||Math.abs(kn(S[0].pts,w)-(A+L))<20*f),S.forEach(function(Q){Q.pts=kn(Q.pts,w)}),!n||A<0){const Q=S.length;if(S=S.filter(ie=>ie.pts>=0),Q!==S.length&&this.warn(`Removed ${S.length-Q} of ${Q} samples (initPTS ${L} / ${o})`),!S.length)return;i===0?A=0:s&&!v?A=Math.max(0,w-L):A=S[0].pts-L}if(e.segmentCodec==="aac"){const Q=this.config.maxAudioFramesDrift;for(let ie=0,G=A+L;ie<S.length;ie++){const ee=S[ie],Z=ee.pts,k=Z-G,U=Math.abs(1e3*k/o);if(k<=-Q*f&&v)ie===0&&(this.warn(`Audio frame @ ${(Z/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*k/o)} ms.`),this.nextAudioTs=A=Z-L,G=Z);else if(k>=Q*f&&U<nM&&v){let re=Math.round(k/f);for(G=Z-re*f;G<0&&re&&f;)re--,G+=f;ie===0&&(this.nextAudioTs=A=G-L),this.warn(`Injecting ${re} audio frames @ ${((G-L)/o).toFixed(3)}s due to ${Math.round(1e3*k/o)} ms gap.`);for(let pe=0;pe<re;pe++){let me=JN.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);me||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),me=ee.unit.subarray()),S.splice(ie,0,{unit:me,pts:G}),G+=f,ie++}}ee.pts=G,G+=f}}let C=null,P=null,B,D=0,N=S.length;for(;N--;)D+=S[N].unit.byteLength;for(let Q=0,ie=S.length;Q<ie;Q++){const G=S[Q],ee=G.unit;let Z=G.pts;if(P!==null){const U=y[Q-1];U.duration=Math.round((Z-P)/d)}else if(n&&e.segmentCodec==="aac"&&(Z=A+L),C=Z,D>0){D+=T;try{B=new Uint8Array(D)}catch(U){this.observer.emit(I.ERROR,I.ERROR,{type:we.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:U,bytes:D,reason:`fail allocating audio mdat ${D}`});return}m||(new DataView(B.buffer).setUint32(0,D),B.set(K.types.mdat,4))}else return;B.set(ee,T);const k=ee.byteLength;T+=k,y.push(lx(!0,c,k,0)),P=Z}const F=y.length;if(!F)return;const O=y[y.length-1];A=P-L,this.nextAudioTs=A+d*O.duration;const V=m?new Uint8Array(0):K.moof(e.sequenceNumber++,C/d,rt({},e,{samples:y}));e.samples=[];const H=(C-L)/o,te=A/o,ae={data1:V,data2:B,startPTS:H,endPTS:te,startDTS:H,endDTS:te,type:"audio",hasAudio:!0,hasVideo:!1,nb:F};return this.isAudioContiguous=!0,ae}}function kn(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function oM(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function mb(r,e,t,n){const s=r.samples.length;if(!s)return;const i=r.inputTimeScale;for(let u=0;u<s;u++){const d=r.samples[u];d.pts=kn(d.pts-t.baseTime*i/t.timescale,e*i)/i,d.dts=kn(d.dts-n.baseTime*i/n.timescale,e*i)/i}const o=r.samples;return r.samples=[],{samples:o}}function gb(r,e,t){const n=r.samples.length;if(!n)return;const s=r.inputTimeScale;for(let o=0;o<n;o++){const u=r.samples[o];u.pts=kn(u.pts-t.baseTime*s/t.timescale,e*s)/s}r.samples.sort((o,u)=>o.pts-u.pts);const i=r.samples;return r.samples=[],{samples:i}}class aM extends Wn{constructor(e,t,n,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,s){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=SS(e);if(t)YD(e,t);else{const d=i||o;d!=null&&d.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${d.codec}")!`)}i&&(n=ux(i,at.AUDIO,this)),o&&(s=ux(o,at.VIDEO,this));const u={};i&&o?u.audiovideo={container:"video/mp4",codec:n+","+s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?u.audio={container:"audio/mp4",codec:n,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?u.video={container:"video/mp4",codec:s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,n,s,i,o){var u,d;let{initPTS:c,lastEndTime:f}=this;const p={audio:void 0,video:void 0,text:s,id3:n,initSegment:void 0};ve(f)||(f=this.lastEndTime=i||0);const m=t.samples;if(!m.length)return p;const y={initPTS:void 0,timescale:void 0,trackId:void 0};let v=this.initData;if((u=v)!=null&&u.length||(this.generateInitSegment(m),v=this.initData),!((d=v)!=null&&d.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);const S=XD(m,v,this),T=v.audio?S[v.audio.id]:null,A=v.video?S[v.video.id]:null,L=lu(A,1/0),w=lu(T,1/0),C=lu(A,0,!0),P=lu(T,0,!0);let B=i,D=0;const N=T&&(!A||!c&&w<L||c&&c.trackId===v.audio.id),F=N?T:A;if(F){const G=F.timescale,ee=F.start-i*G,Z=N?v.audio.id:v.video.id;B=F.start/G,D=N?P-w:C-L,(o||!c)&&(lM(c,B,i,D)||G!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${ee/G} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${B-i} (${ee}/${G}) trackId: ${Z}`),c=null,y.initPTS=ee,y.timescale=G,y.trackId=Z)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);c?(y.initPTS=c.baseTime,y.timescale=c.timescale,y.trackId=c.trackId):((!y.timescale||y.trackId===void 0||y.initPTS===void 0)&&(this.warn("Could not set initPTS"),y.initPTS=B,y.timescale=1,y.trackId=-1),this.initPTS=c={baseTime:y.initPTS,timescale:y.timescale,trackId:y.trackId});const O=B-c.baseTime/c.timescale,V=O+D;D>0?this.lastEndTime=V:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const H=!!v.audio,te=!!v.video;let X="";H&&(X+="audio"),te&&(X+="video");const ae=(v.audio?v.audio.encrypted:!1)||(v.video?v.video.encrypted:!1),Q={data1:m,startPTS:O,startDTS:O,endPTS:V,endDTS:V,type:X,hasAudio:H,hasVideo:te,nb:1,dropped:0,encrypted:ae};p.audio=H&&!te?Q:void 0,p.video=te?Q:void 0;const ie=A?.sampleCount;if(ie){const G=A.keyFrameIndex,ee=G!==-1;Q.nb=ie,Q.dropped=G===0||this.isVideoContiguous?0:ee?G:ie,Q.independent=ee,Q.firstKeyFrame=G,ee&&A.keyFrameStart&&(Q.firstKeyFramePTS=(A.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(p.independent=ee),this.isVideoContiguous||(this.isVideoContiguous=ee),Q.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${G}/${ie} dropped: ${Q.dropped} start: ${Q.firstKeyFramePTS||"NA"}`)}return p.initSegment=y,p.id3=mb(n,i,c,c),s.samples.length&&(p.text=gb(s,i,c)),p}}function lu(r,e,t=!1){return r?.start!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function lM(r,e,t,n){if(r===null)return!0;const s=Math.max(n,1),i=e-r.baseTime/r.timescale;return Math.abs(i-t)>s}function ux(r,e,t){const n=r.codec;return n&&n.length>4?n:e===at.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?Vu(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let Ur;try{Ur=self.performance.now.bind(self.performance)}catch{Ur=Date.now}const Lu=[{demux:WN,remux:aM},{demux:xs,remux:Au},{demux:GN,remux:Au},{demux:KN,remux:Au}];Lu.splice(2,0,{demux:HN,remux:Au});class cx{constructor(e,t,n,s,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,s){const i=n.transmuxing;i.executeStart=Ur();let o=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:d}=this;s&&(this.currentTransmuxState=s);const{contiguous:c,discontinuity:f,trackSwitch:p,accurateTimeOffset:m,timeOffset:y,initSegmentChange:v}=s||u,{audioCodec:S,videoCodec:T,defaultInitPts:A,duration:L,initSegmentData:w}=d,C=uM(o,t);if(C&&ro(C.method)){const N=this.getDecrypter(),F=Dp(C.method);if(N.isSync()){let O=N.softwareDecrypt(o,C.key.buffer,C.iv.buffer,F);if(n.part>-1){const H=N.flush();O=H&&H.buffer}if(!O)return i.executeEnd=Ur(),Ff(n);o=new Uint8Array(O)}else return this.asyncResult=!0,this.decryptionPromise=N.webCryptoDecrypt(o,C.key.buffer,C.iv.buffer,F).then(O=>{const V=this.push(O,null,n);return this.decryptionPromise=null,V}),this.decryptionPromise}const P=this.needsProbing(f,p);if(P){const N=this.configureTransmuxer(o);if(N)return this.logger.warn(`[transmuxer] ${N.message}`),this.observer.emit(I.ERROR,I.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:N,reason:N.message}),i.executeEnd=Ur(),Ff(n)}(f||p||v||P)&&this.resetInitSegment(w,S,T,L,t),(f||v||P)&&this.resetInitialTimestamp(A),c||this.resetContiguity();const B=this.transmux(o,C,y,m,n);this.asyncResult=_a(B);const D=this.currentTransmuxState;return D.contiguous=!0,D.discontinuity=!1,D.trackSwitch=!1,i.executeEnd=Ur(),B}flush(e){const t=e.transmuxing;t.executeStart=Ur();const{decrypter:n,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:u}=s;if(n){const p=n.flush();p&&o.push(this.push(p.buffer,null,e))}const{demuxer:d,remuxer:c}=this;if(!d||!c){t.executeEnd=Ur();const p=[Ff(e)];return this.asyncResult?Promise.resolve(p):p}const f=d.flush(u);return _a(f)?(this.asyncResult=!0,f.then(p=>(this.flushRemux(o,p,e),o))):(this.flushRemux(o,f,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,n){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:u}=t,{accurateTimeOffset:d,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===Te.MAIN?"level":"track"} ${n.level}`);const f=this.remuxer.remux(s,i,o,u,c,d,!0,this.id);e.push({remuxResult:f,chunkMeta:n}),n.transmuxing.executeEnd=Ur()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,s,i){const{demuxer:o,remuxer:u}=this;!o||!u||(o.resetInitSegment(e,t,n,s),u.resetInitSegment(e,t,n,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,s,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,n,s,i):o=this.transmuxUnencrypted(e,n,s,i),o}transmuxUnencrypted(e,t,n,s){const{audioTrack:i,videoTrack:o,id3Track:u,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,u,d,t,n,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,n,s,i){return this.demuxer.demuxSampleAes(e,t,n).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,n,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:s}=this;let i;for(let p=0,m=Lu.length;p<m;p++){var o;if((o=Lu[p].demux)!=null&&o.probe(e,this.logger)){i=Lu[p];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,d=this.remuxer,c=i.remux,f=i.demux;(!d||!(d instanceof c))&&(this.remuxer=new c(n,t,s,this.logger)),(!u||!(u instanceof f))&&(this.demuxer=new f(n,t,s,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new _p(this.config)),e}}function uM(r,e){let t=null;return r.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Ff=r=>({remuxResult:{},chunkMeta:r});function _a(r){return"then"in r&&r.then instanceof Function}class cM{constructor(e,t,n,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=s,this.defaultInitPts=i||null}}class dM{constructor(e,t,n,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}let dx=0;class yb{constructor(e,t,n,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=dx++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=d=>{const c=d.data,f=this.hls;if(!(!f||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var p;const m=(p=this.workerContext)==null?void 0:p.objectURL;m&&self.URL.revokeObjectURL(m);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{f.logger[c.data.logType]&&f.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,f.trigger(c.event,c.data);break}}},this.onWorkerError=d=>{if(!this.hls)return;const c=new Error(`${d.message}  (${d.filename}:${d.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(I.ERROR,{type:we.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=n,this.onFlush=s;const o=(d,c)=>{c=c||{},c.frag=this.frag||void 0,d===I.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(d,c)};this.observer=new Mp,this.observer.on(I.FRAG_DECRYPTED,o),this.observer.on(I.ERROR,o);const u=Iv(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const d=this.hls.logger;if(i.workerPath||mN()){try{i.workerPath?(d.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=yN(i.workerPath)):(d.log(`injecting Web Worker for "${t}"`),this.workerContext=gN());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:lt(i)})}catch(f){d.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new cx(this.observer,u,i,"",t,e.logger)}return}}this.transmuxer=new cx(this.observer,u,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=dx++;const t=this.hls.config,n=Iv(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:lt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),vN(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,s,i,o,u,d,c,f){var p,m;c.transmuxing.start=self.performance.now();const{instanceNo:y,transmuxer:v}=this,S=o?o.start:i.start,T=i.decryptdata,A=this.frag,L=!(A&&i.cc===A.cc),w=!(A&&c.level===A.level),C=A?c.sn-A.sn:-1,P=this.part?c.part-this.part.index:-1,B=C===0&&c.id>1&&c.id===A?.stats.chunkCount,D=!w&&(C===1||C===0&&(P===1||B&&P<=0)),N=self.performance.now();(w||C||i.stats.parsing.start===0)&&(i.stats.parsing.start=N),o&&(P||!D)&&(o.stats.parsing.start=N);const F=!(A&&((p=i.initSegment)==null?void 0:p.url)===((m=A.initSegment)==null?void 0:m.url)),O=new dM(L,D,d,w,S,F);if(!D||L||F){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===Te.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${L}
        trackSwitch: ${w}
        contiguous: ${D}
        accurateTimeOffset: ${d}
        timeOffset: ${S}
        initSegmentChange: ${F}`);const V=new cM(n,s,t,u,f);this.configureTransmuxer(V)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:y,cmd:"demux",data:e,decryptdata:T,chunkMeta:c,state:O},e instanceof ArrayBuffer?[e]:[]);else if(v){const V=v.push(e,T,c,O);_a(V)?V.then(H=>{this.handleTransmuxComplete(H)}).catch(H=>{this.transmuxerError(H,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(V)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const s=n.flush(e);_a(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const fx=100;class fM extends Np{constructor(e,t,n){super(e,t,n,"audio-stream-controller",Te.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(I.BUFFER_RESET,this.onBufferReset,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(I.BUFFER_RESET,this.onBufferReset,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:i,trackId:o}){if(n===Te.MAIN){const u=t.cc,d=this.fragCurrent;if(this.initPTS[u]={baseTime:s,timescale:i,trackId:o},this.log(`InitPTS for cc: ${u} found from main: ${s/i} (${s}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===se.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==u)&&this.syncWithAnchor(t,c?.frag)}else!this.hls.hasEnoughToStart&&d&&d.cc!==u?(d.abortRequests(),this.syncWithAnchor(t,d)):this.state===se.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const s=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&s?.cc===t.cc)return;const i=(s||e).cc,o=this.getLevelDetails(),u=this.getLoadPosition(),d=DS(o,i,u);d&&(this.log(`Syncing with main frag at ${d.start} cc ${d.cc}`),this.startFragRequested=!1,this.nextLoadPosition=d.start,this.resetLoadingState(),this.state===se.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=se.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(fx),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=se.IDLE):this.state=se.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case se.IDLE:this.doTickIdle();break;case se.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e?.[t],s=n?.details;if(s&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(s))break;this.state=se.WAITING_INIT_PTS}break}case se.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case se.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:s,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=se.FRAG_LOADING;const u=s.flush().buffer,d={frag:t,part:n,payload:u,networkDetails:null};this._handleFragmentLoadProgress(d),i&&super._handleFragmentLoadComplete(d)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=se.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:s,trackId:i}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(n!=null&&n[i]))return;const u=n[i],d=u.details;if(!d||this.waitForLive(u)||this.waitForCdnTuneIn(d)){this.state=se.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,at.AUDIO,Te.AUDIO));const f=this.getFwdBufferInfo(c,Te.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,d)){t.trigger(I.BUFFER_EOS,{type:"audio"}),this.state=se.ENDED;return}const p=f.len,m=t.maxBufferLength,y=d.fragments,v=y[0].start,S=this.getLoadPosition(),T=this.flushing?S:f.end;if(this.switchingTrack&&s){const w=S;d.PTSKnown&&w<v&&(f.end>v||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=v+.05)}if(p>=m&&!this.switchingTrack&&T<y[y.length-1].start)return;let A=this.getNextFragment(T,d);if(A&&this.isLoopLoading(A,T)&&(A=this.getNextFragmentLoopLoading(A,d,f,Te.MAIN,m)),!A){this.bufferFlushed=!0;return}let L=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&L&&Ft(A)&&!A.endList&&(!d.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(L)===Vt.OK&&(this.mainFragLoading=L=null),L&&Ft(L))){if(A.start>L.end){const C=this.fragmentTracker.getFragAtPos(T,Te.MAIN);C&&C.end>L.end&&(L=C,this.mainFragLoading={frag:C,targetBufferTime:null})}if(A.start>L.end)return}this.loadFragment(A,u,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Ra(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==se.STOPPED&&(this.setInterval(fx),this.state=se.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(I.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:s}=this,{details:i,id:o,groupId:u,track:d}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${d.name}" of "${u}"`);return}const c=this.mainDetails;if(!c||i.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==se.STOPPED&&(this.state=se.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${d.name}" of "${u}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const f=s[o];let p=0;if(i.live||(n=f.details)!=null&&n.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(f.details){var m;p=this.alignPlaylists(i,f.details,(m=this.levelLastLoaded)==null?void 0:m.details)}i.alignedSliding||(QS(i,c),i.alignedSliding||qu(i,c),p=i.fragmentStart)}f.details=i,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(c,p),this.hls.trigger(I.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===se.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=se.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:i}=e,{config:o,trackId:u,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=d[u];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const f=c.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const p=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let m=this.transmuxer;m||(m=this.transmuxer=new yb(this.hls,Te.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const y=this.initPTS[n.cc],v=(t=n.initSegment)==null?void 0:t.data;if(y!==void 0){const T=s?s.index:-1,A=T!==-1,L=new kp(n.level,n.sn,n.stats.chunkCount,i.byteLength,T,A);m.push(i,v,p,"",n,s,f.totalduration,!1,L,y)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${f.startSN} ,${f.endSN}],track ${u}`);const{cache:S}=this.waitingData=this.waitingData||{frag:n,part:s,cache:new ZS,complete:!1};S.push(new Uint8Array(i)),this.state!==se.STOPPED&&(this.state=se.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Te.MAIN&&Ft(t.frag)&&(this.mainFragLoading=t,this.state===se.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:s}=t;if(n.type!==Te.AUDIO){!this.audioOnly&&n.type===Te.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ft(n)){this.fragPrevious=n;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(I.AUDIO_TRACK_SWITCHED,et({},i)))}this.fragBufferedComplete(n,s),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=se.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Te.AUDIO,t);break;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===se.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===Ye.AUDIO_TRACK&&(this.state=se.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==at.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==at.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===se.ENDED&&(this.state=se.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,Te.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,u=this.getCurrentContext(o);if(!u){this.resetWhenMissingContext(o);return}const{frag:d,part:c,level:f}=u,{details:p}=f,{audio:m,text:y,id3:v,initSegment:S}=i;if(this.fragContextChanged(d)||!p){this.fragmentTracker.removeFragment(d);return}if(this.state=se.PARSING,this.switchingTrack&&m&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){const T=d.initSegment||d;if(this.unhandledEncryptionError(S,d))return;this._bufferInitSegment(f,S.tracks,T,o),s.trigger(I.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:n,tracks:S.tracks})}if(m){const{startPTS:T,endPTS:A,startDTS:L,endDTS:w}=m;c&&(c.elementaryStreams[at.AUDIO]={startPTS:T,endPTS:A,startDTS:L,endDTS:w}),d.setElementaryStreamInfo(at.AUDIO,T,A,L,w),this.bufferFragmentData(m,d,c,o)}if(v!=null&&(t=v.samples)!=null&&t.length){const T=rt({id:n,frag:d,details:p},v);s.trigger(I.FRAG_PARSING_METADATA,T)}if(y){const T=rt({id:n,frag:d,details:p},y);s.trigger(I.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,n,s){if(this.state!==se.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=Te.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(I.BUFFER_CODECS,t);const u=i.initSegment;if(u!=null&&u.byteLength){const d={type:"audio",frag:n,part:null,chunkMeta:s,parent:n.type,data:u};this.hls.trigger(I.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===Vt.NOT_LOADED||s===Vt.PARTIAL){var i;if(!Ft(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=se.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&qu(t.details,o)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:s,characteristics:i,audioCodec:o,channels:u}=this.bufferedTrack;ri({name:t,lang:n,assocLang:s,characteristics:i,audioCodec:o,channels:u},e,Zs)||(Hu(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(I.AUDIO_TRACK_SWITCHED,et({},e))}}class Gp extends Wn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const s=t?.renditionReports;if(s){let i=-1;for(let o=0;o<s.length;o++){const u=s[o];let d;try{d=new self.URL(u.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),d=u.URI||""}if(d===e){i=o;break}else d===e.substring(0,d.length)&&(i=o)}if(i!==-1){const o=s[i],u=parseInt(o["LAST-MSN"])||t.lastPartSn;let d=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&f>t.partTarget&&(d+=1)}const c=n&&wv(n);return new Rv(u,d>=0?d:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:s,stats:i}=t,o=self.performance.now(),u=i.loading.first?Math.max(0,o-i.loading.first):0;s.advancedDateTime=Date.now()-u;const d=this.hls.config.timelineOffset;if(d!==s.appliedTimelineOffset){const f=Math.max(d||0,0);s.appliedTimelineOffset=f,s.fragments.forEach(p=>{p.setStart(p.playlistOffset+f)})}if(s.live||n!=null&&n.live){const f="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(n),n&&s.fragments.length>0){sN(n,s,this);const L=s.playlistParsingError;if(L){this.warn(L);const w=this.hls;if(!w.config.ignorePlaylistParsingErrors){var c;const{networkDetails:C}=t;w.trigger(I.ERROR,{type:we.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:L,reason:L.message,level:t.level||void 0,parent:(c=s.fragments[0])==null?void 0:c.type,networkDetails:C,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const p=this.hls.mainForwardBufferInfo,m=p?p.end-p.len:0,y=(s.edge-m)*1e3,v=zS(s,y);if(s.requestScheduled+v<o?s.requestScheduled=o:s.requestScheduled+=v,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let S,T,A;if(s.canBlockReload&&s.endSN&&s.advanced){const L=this.hls.config.lowLatencyMode,w=s.lastPartSn,C=s.endSN,P=s.lastPartIndex,B=P!==-1,D=w===C;B?D?(T=C+1,A=L?0:P):(T=w,A=L?P+1:s.maxPartIndex):T=C+1;const N=s.age,F=N+s.ageHeader;let O=Math.min(F-s.partTarget,s.targetduration*1.5);if(O>0){if(F>s.targetduration*3)this.log(`Playlist last advanced ${N.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,A=void 0;else if(n!=null&&n.tuneInGoal&&F-s.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${O} with playlist age: ${s.age}`),O=0;else{const V=Math.floor(O/s.targetduration);if(T+=V,A!==void 0){const H=Math.round(O%s.targetduration/s.partTarget);A+=H}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${N.toFixed(2)}s goal: ${O} skip sn ${V} to part ${A}`)}s.tuneInGoal=O}if(S=this.getDeliveryDirectives(s,t.deliveryDirectives,T,A),L||!D){s.requestScheduled=o,this.loadingPlaylist(f,S);return}}else(s.canBlockReload||s.canSkipUntil)&&(S=this.getDeliveryDirectives(s,t.deliveryDirectives,T,A));S&&T!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(v-u*2,v/2)),this.scheduleLoading(f,S,s)}else this.clearTimer()}scheduleLoading(e,t,n){const s=n||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=s.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const u=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,n,s){let i=wv(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,s=t.part,i=Su.No),new Rv(n,s,i)}checkRetry(e){const t=e.details,n=Ku(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:u}=s||{},d=!!s&&!!u&&(i===Qt.RetryRequest||!s.resolved&&i===Qt.SendAlternateToPenaltyBox);if(d){var c;if(o>=u.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=Pp(u,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,s.resolved=!0}return d}}function vb(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!ka(r[t].attrs,e[t].attrs))return!1;return!0}function ka(r,e,t){const n=r["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>r[s]!==e[s])}function Bh(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class hM extends Gp{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(I.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:s,details:i}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==s){this.warn(`Audio track with id:${n} and group:${s} not found in active group ${o?.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Audio track ${n} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!n||s?.length!==n?.length||n!=null&&n.some(u=>s?.indexOf(u)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(m=>!n||n.indexOf(m.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(m=>m.default)&&(this.selectDefaultTrack=!1),u.forEach((m,y)=>{m.id=y});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const d=this.hls.config.audioPreference;if(!i&&d){const m=gr(d,u,Zs);if(m>-1)i=u[m];else{const y=gr(d,this.tracks);i=this.tracks[y]}}let c=this.findTrackId(i);c===-1&&i&&(c=this.findTrackId(null));const f={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${n?.join(",")}`),this.hls.trigger(I.AUDIO_TRACKS_UPDATED,f);const p=this.trackId;if(c!==-1&&p===-1)this.setAudioTrack(c);else if(u.length&&p===-1){var o;const m=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${u.length}`);this.warn(m.message),this.hls.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ye.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const s=this.currentTrack;if(s&&ri(e,s,Zs))return s;const i=gr(e,this.tracksInGroup,Zs);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const u=LO(e,t.levels,n,o,Zs);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const o=gr(e,n);if(o>-1)return n[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===n&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(I.AUDIO_TRACK_SWITCHING,et({},s)),i))return;const o=this.switchParams(s.url,n?.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(!(this.selectDefaultTrack&&!s.default)&&(!e||ri(e,s,Zs)))return n}if(e){const{name:n,lang:s,assocLang:i,characteristics:o,audioCodec:u,channels:d}=e;for(let c=0;c<t.length;c++){const f=t[c];if(ri({name:n,lang:s,assocLang:i,characteristics:o,audioCodec:u,channels:d},f,Zs))return c}for(let c=0;c<t.length;c++){const f=t[c];if(ka(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const f=t[c];if(ka(e.attrs,f.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Hu(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,u=o?.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(I.AUDIO_TRACK_LOADING,{url:i,id:n,groupId:s,deliveryDirectives:t||null,track:e})}}class pM{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var n;if(s.onError(i),this.queues===null||this.tracks===null)return;const o=(n=this.tracks[e])==null?void 0:n.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],s=n?.buffer;return s?`SourceBuffer${s.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const hx=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,xb="HlsJsTrackRemovedError";class mM extends Error{constructor(e){super(e),this.name=xb}}class gM extends Wn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:s,mediaSource:i}=this;n&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(I.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:s}=this;n!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=BD(ws(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.BUFFER_RESET,this.onBufferReset,this),e.on(I.BUFFER_APPENDING,this.onBufferAppending,this),e.on(I.BUFFER_CODECS,this.onBufferCodecs,this),e.on(I.BUFFER_EOS,this.onBufferEos,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.FRAG_PARSED,this.onFragParsed,this),e.on(I.FRAG_CHANGED,this.onFragChanged,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.BUFFER_RESET,this.onBufferReset,this),e.off(I.BUFFER_APPENDING,this.onBufferAppending,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.BUFFER_EOS,this.onBufferEos,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.FRAG_PARSED,this.onFragParsed,this),e.off(I.FRAG_CHANGED,this.onFragChanged,this),e.off(I.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?rt(n,s.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(n[o]=rt({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const s=ws(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),i)this._objectUrl=n.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{n.removeAttribute("src");const d=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||d&&o instanceof d,px(n),yM(n,u),n.load()}catch{n.src=u}else n.src=u}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,s=t.tracks,i=s?Object.keys(s):null,o=i?i.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${lt(n,(d,c)=>d==="initSegment"?void 0:c)};
transfer tracks: ${lt(s,(d,c)=>d==="initSegment"?void 0:c)}}`),!mS(s,n)){t.mediaSource=null,t.tracks=void 0;const d=e.currentTime,c=this.details,f=Math.max(d,c?.fragments[0].start||0);if(f-d>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${d} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(n)}") start time: ${f} currentTime: ${d}`),this.onMediaDetaching(I.MEDIA_DETACHING,{}),this.onMediaAttaching(I.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,i.forEach(d=>{const c=d,f=s[c];if(f){const p=f.buffer;if(p){const m=this.fragmentTracker,y=f.id;if(m.hasFragments(y)||m.hasParts(y)){const T=Ue.getBuffered(p);m.detectEvictedFragments(c,T,y,null,!0)}const v=Bf(c),S=[c,p];this.sourceBuffers[v]=S,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,f)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=i.readyState==="open";try{const d=i.sourceBuffers;for(let c=d.length;c--;)u&&d[c].abort(),i.removeSourceBuffer(d[c]);u&&i.endOfStream()}catch(d){this.warn(`onMediaDetaching: ${d.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),n||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&px(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(I.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Bf(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new pM(this.tracks)}onBufferCodecs(e,t){var n;const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),u=!o&&this.sourceBufferCount&&this.media&&i.some(d=>!s[d]);if(o||u){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`);return}i.forEach(d=>{var c,f;const p=t[d],{id:m,codec:y,levelCodec:v,container:S,metadata:T,supplemental:A}=p;let L=s[d];const w=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[d],C=w!=null&&w.buffer?w:L,P=C?.pendingCodec||C?.codec,B=C?.levelCodec;L||(L=s[d]={buffer:void 0,listeners:[],codec:y,supplemental:A,container:S,levelCodec:v,metadata:T,id:m});const D=Tu(P,B),N=D?.replace(hx,"$1");let F=Tu(y,v);const O=(f=F)==null?void 0:f.replace(hx,"$1");F&&D&&N!==O&&(d.slice(0,5)==="audio"&&(F=Vu(F,this.appendSource)),this.log(`switching codec ${P} to ${F}`),F!==(L.pendingCodec||L.codec)&&(L.pendingCodec=F),L.container=S,this.appendChangeType(d,S,F))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const s=`${t};codecs=${n}`,i={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const u=o.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),u.changeType(s),o.codec=n,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,s=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,Te.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var u;const d=this.tracks.video;(this.lastVideoAppendEnd>s||d!=null&&d.buffer&&Ue.isBuffered(d.buffer,s)||((u=this.fragmentTracker.getAppendedFrag(s,Te.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:s,type:i,parent:o,frag:u,part:d,chunkMeta:c,offset:f}=t,p=c.buffering[i],{sn:m,cc:y}=u,v=self.performance.now();p.start=v;const S=u.stats.buffering,T=d?d.stats.buffering:null;S.start===0&&(S.start=v),T&&T.start===0&&(T.start=v);const A=n.audio;let L=!1;i==="audio"&&A?.container==="audio/mpeg"&&(L=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const w=n.video,C=w?.buffer;if(C&&m!=="initSegment"){const D=d||u,N=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(w.ending||w.ended)){const O=D.start+D.duration*.05,V=C.buffered,H=this.currentOp("video");!V.length&&!H?this.blockAudio(D):!H&&!Ue.isBuffered(C,O)&&this.lastVideoAppendEnd<O&&this.blockAudio(D)}else if(i==="video"){const F=D.end;if(N){const O=N.frag.start;(F>O||F<this.lastVideoAppendEnd||Ue.isBuffered(C,O))&&this.unblockAudio()}this.lastVideoAppendEnd=F}}const P=(d||u).start,B={label:`append-${i}`,execute:()=>{var D;p.executeStart=self.performance.now();const N=(D=this.tracks[i])==null?void 0:D.buffer;N&&(L?this.updateTimestampOffset(N,P,.1,i,m,y):f!==void 0&&ve(f)&&this.updateTimestampOffset(N,f,1e-6,i,m,y)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const D=self.performance.now();p.executeEnd=p.end=D,S.first===0&&(S.first=D),T&&T.first===0&&(T.first=D);const N={};this.sourceBuffers.forEach(([F,O])=>{F&&(N[F]=Ue.getBuffered(O))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(I.BUFFER_APPENDED,{type:i,frag:u,part:d,chunkMeta:c,parent:u.type,timeRanges:N})},onError:D=>{var N;const F={type:we.MEDIA_ERROR,parent:u.type,details:z.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:u,part:d,chunkMeta:c,error:D,err:D,fatal:!1},O=(N=this.media)==null?void 0:N.error;if(D.code===DOMException.QUOTA_EXCEEDED_ERR||D.name=="QuotaExceededError"||"quota"in D)F.details=z.BUFFER_FULL_ERROR;else if(D.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!O)F.errorAction=no(!0);else if(D.name===xb&&this.sourceBufferCount===0)F.errorAction=no(!0);else{const V=++this.appendErrors[i];this.warn(`Failed ${V}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${O||"no media error"})`),(V>=this.hls.config.appendErrorMaxRetry||O)&&(F.fatal=!0)}this.hls.trigger(I.ERROR,F)}};this.log(`queuing "${i}" append sn: ${m}${d?" p: "+d.index:""} of ${u.type===Te.MAIN?"level":"track"} ${u.level} cc: ${y}`),this.append(B,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(I.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:n,startOffset:s,endOffset:i}=t;n?this.append(this.getFlushOp(n,s,i),n):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,i),o)})}onFragParsed(e,t){const{frag:n,part:s}=t,i=[],o=s?s.elementaryStreams:n.elementaryStreams;o[at.AUDIOVIDEO]?i.push("audiovideo"):(o[at.AUDIO]&&i.push("audio"),o[at.VIDEO]&&i.push("video"));const u=()=>{const d=self.performance.now();n.stats.buffering.end=d,s&&(s.stats.buffering.end=d);const c=s?s.stats:n.stats;this.hls.trigger(I.FRAG_BUFFERED,{frag:n,part:s,stats:c,id:n.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(u,i).catch(d=>{this.warn(`Fragment buffered callback ${d}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([o])=>{if(o){const u=this.tracks[o];(!t.type||t.type===o)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var u;return o&&!((u=this.tracks[o])!=null&&u.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(I.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(I.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===z.BUFFER_APPEND_ERROR&&t.frag){var n;const s=(n=t.errorAction)==null?void 0:n.nextAutoLevel;ve(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const s=e.config,i=n.currentTime,o=t.levelTargetDuration,u=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(ve(u)&&u>=0){const c=Math.max(u,o),f=Math.floor(i/o)*o-c;this.flushBackBuffer(i,o,f)}const d=s.frontBufferFlushThreshold;if(ve(d)&&d>0){const c=Math.max(s.maxBufferLength,d),f=Math.max(c,o),p=Math.floor(i/o)*o+f;this.flushFrontBuffer(i,o,p)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([s,i])=>{if(i){const u=Ue.getBuffered(i);if(u.length>0&&n>u.start(0)){var o;this.hls.trigger(I.BACK_BUFFER_REACHED,{bufferEnd:n});const d=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(I.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(d!=null&&d.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:s})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=Ue.getBuffered(i),u=o.length;if(u<2)return;const d=o.start(u-1),c=o.end(u-1);if(n>d||e>=d&&e<=c)return;this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||n?.readyState!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),f=Math.max(c,s);return{duration:1/0,start:c,end:f}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return ve(i)?{duration:i}:null;const o=this.media.duration,u=ve(n.duration)?n.duration:0;return s>u&&s>o||!ve(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:n}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(ve(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${n}.`),s.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${lt(n)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const s=this.tracks[t];e[t]={buffer:n,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(I.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,u=e[o];if(this.isPending(u)){const d=this.getTrackCodec(u,o),c=`${u.container};codecs=${d}`;u.codec=d,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${lt(u)}`);try{const f=n.addSourceBuffer(c),p=Bf(o),m=[o,f];t[p]=m,u.buffer=f}catch(f){var s;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:o,mimeType:c,parent:u.id});return}this.trackSourceBuffer(o,u)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let s=e.codec;n&&(t==="video"||t==="audiovideo")&&Ia(n,"video")&&(s=oO(s,n));const i=Tu(s,e.levelCodec);return i?t.slice(0,5)==="audio"?Vu(i,this.appendSource):i:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const u=o.removedRanges;u!=null&&u.length&&this.hls.trigger(I.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${s}`,t),this.hls.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,n,s,i,o){const u=t-e.timestampOffset;Math.abs(u)>=n&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:s,mediaSource:i}=this,o=this.tracks[e],u=o?.buffer;if(!s||!i||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const d=ve(s.duration)?s.duration:1/0,c=ve(i.duration)?i.duration:1/0,f=Math.max(0,t),p=Math.min(n,d,c);p>f&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${f},${p}] from the ${e} SourceBuffer`),u.remove(f,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],s=n?.buffer;if(!s)throw new mM(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const s=(n=this.tracks[t])==null?void 0:n.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const o=n.bind(this,e);s.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(s=>{n.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function px(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function yM(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function Bf(r){return r==="audio"?1:0}class Hp{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(I.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.BUFFER_CODECS,this.onBufferCodecs,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(I.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&ve(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,Hp.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const s=(u,d)=>d?u.width!==d.width||u.height!==d.height:!0;let i=e.length-1;const o=Math.max(t,n);for(let u=0;u<e.length;u+=1){const d=e[u];if((d.width>=o||d.height>=o)&&s(d,e[u+1])){i=u;break}}return i}}const vM={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},En=vM,xM={HLS:"h"},EM=xM;class xr{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof xr?n:new xr(n))),this.value=e,this.params=t}}const TM="Dict";function SM(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function bM(r,e,t,n){return new Error(`failed to ${r} "${SM(e)}" as ${t}`,{cause:n})}function Er(r,e,t){return bM("serialize",r,e,t)}class Eb{constructor(e){this.description=e}}const mx="Bare Item",AM="Boolean";function LM(r){if(typeof r!="boolean")throw Er(r,AM);return r?"?1":"?0"}function IM(r){return btoa(String.fromCharCode(...r))}const wM="Byte Sequence";function RM(r){if(ArrayBuffer.isView(r)===!1)throw Er(r,wM);return`:${IM(r)}:`}const CM="Integer";function PM(r){return r<-999999999999999||999999999999999<r}function Tb(r){if(PM(r))throw Er(r,CM);return r.toString()}function _M(r){return`@${Tb(r.getTime()/1e3)}`}function Sb(r,e){if(r<0)return-Sb(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const s=Math.floor(r*t);return(s%2===0?s:s+1)/t}else return Math.round(r*t)/t}const kM="Decimal";function DM(r){const e=Sb(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Er(r,kM);const t=e.toString();return t.includes(".")?t:`${t}.0`}const OM="String",NM=/[\x00-\x1f\x7f]+/;function MM(r){if(NM.test(r))throw Er(r,OM);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function FM(r){return r.description||r.toString().slice(7,-1)}const BM="Token";function gx(r){const e=FM(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Er(e,BM);return e}function Uh(r){switch(typeof r){case"number":if(!ve(r))throw Er(r,mx);return Number.isInteger(r)?Tb(r):DM(r);case"string":return MM(r);case"symbol":return gx(r);case"boolean":return LM(r);case"object":if(r instanceof Date)return _M(r);if(r instanceof Uint8Array)return RM(r);if(r instanceof Eb)return gx(r);default:throw Er(r,mx)}}const UM="Key";function jh(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw Er(r,UM);return r}function Kp(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${jh(e)}`:`;${jh(e)}=${Uh(t)}`).join("")}function bb(r){return r instanceof xr?`${Uh(r.value)}${Kp(r.params)}`:Uh(r)}function jM(r){return`(${r.value.map(bb).join(" ")})${Kp(r.params)}`}function $M(r,e={whitespace:!0}){if(typeof r!="object"||r==null)throw Er(r,TM);const t=r instanceof Map?r.entries():Object.entries(r),n=e?.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof xr||(i=new xr(i));let o=jh(s);return i.value===!0?o+=Kp(i.params):(o+="=",Array.isArray(i.value)?o+=jM(i):o+=bb(i)),o}).join(`,${n}`)}function Ab(r,e){return $M(r,e)}const fr="CMCD-Object",Ct="CMCD-Request",zs="CMCD-Session",ms="CMCD-Status",VM={br:fr,ab:fr,d:fr,ot:fr,tb:fr,tpb:fr,lb:fr,tab:fr,lab:fr,url:fr,pb:Ct,bl:Ct,tbl:Ct,dl:Ct,ltc:Ct,mtp:Ct,nor:Ct,nrr:Ct,rc:Ct,sn:Ct,sta:Ct,su:Ct,ttfb:Ct,ttfbb:Ct,ttlb:Ct,cmsdd:Ct,cmsds:Ct,smrt:Ct,df:Ct,cs:Ct,ts:Ct,cid:zs,pr:zs,sf:zs,sid:zs,st:zs,v:zs,msd:zs,bs:ms,bsd:ms,cdn:ms,rtp:ms,bg:ms,pt:ms,ec:ms,e:ms},GM={REQUEST:Ct};function HM(r){return Object.keys(r).reduce((e,t)=>{var n;return(n=r[t])===null||n===void 0||n.forEach(s=>e[s]=t),e},{})}function KM(r,e){const t={};if(!r)return t;const n=Object.keys(r),s=e?HM(e):{};return n.reduce((i,o)=>{var u;const d=VM[o]||s[o]||GM.REQUEST,c=(u=i[d])!==null&&u!==void 0?u:i[d]={};return c[o]=r[o],i},t)}function zM(r){return["ot","sf","st","e","sta"].includes(r)}function WM(r){return typeof r=="number"?ve(r):r!=null&&r!==""&&r!==!1}const Lb="event";function YM(r,e){const t=new URL(r),n=new URL(e);if(t.origin!==n.origin)return r;const s=t.pathname.split("/").slice(1),i=n.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const Iu=r=>Math.round(r),$h=(r,e)=>Array.isArray(r)?r.map(t=>$h(t,e)):r instanceof xr&&typeof r.value=="string"?new xr($h(r.value,e),r.params):(e.baseUrl&&(r=YM(r,e.baseUrl)),e.version===1?encodeURIComponent(r):r),uu=r=>Iu(r/100)*100,qM=(r,e)=>{let t=r;return e.version>=2&&(r instanceof xr&&typeof r.value=="string"?t=new xr([r]):typeof r=="string"&&(t=[r])),$h(t,e)},XM={br:Iu,d:Iu,bl:uu,dl:uu,mtp:uu,nor:qM,rtp:uu,tb:Iu},Ib="request",wb="response",zp=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],QM=["e"],ZM=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function hc(r){return ZM.test(r)}function JM(r){return zp.includes(r)||QM.includes(r)||hc(r)}const Rb=["d","dl","nor","ot","rtp","su"];function eF(r){return zp.includes(r)||Rb.includes(r)||hc(r)}const tF=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function nF(r){return zp.includes(r)||Rb.includes(r)||tF.includes(r)||hc(r)}const rF=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function sF(r){return rF.includes(r)||hc(r)}const iF={[wb]:nF,[Lb]:JM,[Ib]:eF};function Cb(r,e={}){const t={};if(r==null||typeof r!="object")return t;const n=e.version||r.v||1,s=e.reportingMode||Ib,i=n===1?sF:iF[s];let o=Object.keys(r).filter(i);const u=e.filter;typeof u=="function"&&(o=o.filter(u));const d=s===wb||s===Lb;d&&!o.includes("ts")&&o.push("ts"),n>1&&!o.includes("v")&&o.push("v");const c=rt({},XM,e.formatters),f={version:n,reportingMode:s,baseUrl:e.baseUrl};return o.sort().forEach(p=>{let m=r[p];const y=c[p];if(typeof y=="function"&&(m=y(m,f)),p==="v"){if(n===1)return;m=n}p=="pr"&&m===1||(d&&p==="ts"&&!ve(m)&&(m=Date.now()),WM(m)&&(zM(p)&&typeof m=="string"&&(m=new Eb(m)),t[p]=m))}),t}function oF(r,e={}){const t={};if(!r)return t;const n=Cb(r,e),s=KM(n,e?.customHeaderMap);return Object.entries(s).reduce((i,[o,u])=>{const d=Ab(u,{whitespace:!1});return d&&(i[o]=d),i},t)}function aF(r,e,t){return rt(r,oF(e,t))}const lF="CMCD";function uF(r,e={}){return r?Ab(Cb(r,e),{whitespace:!1}):""}function cF(r,e={}){if(!r)return"";const t=uF(r,e);return encodeURIComponent(t)}function dF(r,e={}){if(!r)return"";const t=cF(r,e);return`${lF}=${t}`}const yx=/CMCD=[^&#]+/;function fF(r,e,t){const n=dF(e,t);if(!n)return r;if(yx.test(r))return r.replace(yx,n);const s=r.includes("?")?"&":"?";return`${r}${s}${n}`}class hF{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:En.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:o}=s,u=this.hls.levels[i.level],d=this.getObjectType(i),c={d:(o||i).duration*1e3,ot:d};(d===En.VIDEO||d===En.AUDIO||d==En.MUXED)&&(c.br=u.bitrate/1e3,c.tb=this.getTopBandwidth(d)/1e3,c.bl=this.getBufferLength(d));const f=o?this.getNextPart(o):this.getNextFrag(i);f!=null&&f.url&&f.url!==i.url&&(c.nor=f.url),this.apply(s,c)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHED,this.onMediaDetached,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHED,this.onMediaDetached,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,s;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:EM.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){rt(t,this.createData());const n=t.ot===En.INIT||t.ot===En.VIDEO||t.ot===En.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,u)=>(s.includes(u)&&(o[u]=t[u]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),aF(e.headers,t,i)):e.url=fF(e.url,t,i)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const s=e.sn-n.startSN;return n.fragments[s+1]}}getNextPart(e){var t;const{index:n,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=s;for(let u=i.length-1;u>=0;u--){const d=i[u];if(d.index===n&&d.fragment.sn===o)return i[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return En.TIMED_TEXT;if(e.sn==="initSegment")return En.INIT;if(t==="audio")return En.AUDIO;if(t==="main")return this.hls.audioTracks.length?En.VIDEO:En.MUXED}getTopBandwidth(e){let t=0,n;const s=this.hls;if(e===En.AUDIO)n=s.audioTracks;else{const i=s.maxAutoLevel,o=i>-1?i+1:s.levels.length;n=s.levels.slice(0,o)}return n.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===En.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:Ue.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new n(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,u){t(i),this.loader.load(i,o,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new n(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,u){t(i),this.loader.load(i,o,u)}}}}const pF=3e5;class mF extends Wn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if(n?.action===Qt.SendAlternateToPenaltyBox&&n.flags===_n.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:u,pathwayId:d,type:c}=t.context;u&&s?o=this.getPathwayForGroupId(u,c,o):d&&(o=d)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==o),t.details===z.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${lt(i)} penalized: ${lt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,s=performance.now();Object.keys(n).forEach(i=>{s-n[i]>pF&&delete n[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in n)continue;if(o===this.pathwayId)return;const u=this.hls.nextLoadLevel,d=this.hls.levels[u];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,qS(t),this.hls.trigger(I.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[u];d&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,n){const s=this.getLevelsForPathway(n).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===Ye.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===Ye.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":u,"URI-REPLACEMENT":d}=i;if(t.some(f=>f.pathwayId===o))return;const c=this.getLevelsForPathway(u).map(f=>{const p=new St(f.attrs);p["PATHWAY-ID"]=o;const m=p.AUDIO&&`${p.AUDIO}_clone_${o}`,y=p.SUBTITLES&&`${p.SUBTITLES}_clone_${o}`;m&&(n[p.AUDIO]=m,p.AUDIO=m),y&&(s[p.SUBTITLES]=y,p.SUBTITLES=y);const v=Pb(f.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),S=new Ra({attrs:p,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:v,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let T=1;T<f.audioGroups.length;T++)S.addGroupId("audio",`${f.audioGroups[T]}_clone_${o}`);if(f.subtitleGroups)for(let T=1;T<f.subtitleGroups.length;T++)S.addGroupId("text",`${f.subtitleGroups[T]}_clone_${o}`);return S});t.push(...c),vx(this.audioTracks,n,d,o),vx(this.subtitleTracks,s,d,o)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+f)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,u=o.errorRetry||o.timeoutRetry||{},d={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},c={onSuccess:(f,p,m,y)=>{this.log(`Loaded steering manifest: "${s}"`);const v=f.data;if(v?.VERSION!==1){this.log(`Steering VERSION ${v.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=v.TTL;const{"RELOAD-URI":S,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":A}=v;if(S)try{this.uri=new self.URL(S,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||m.url),T&&this.clonePathways(T);const L={steeringManifest:v,url:s.toString()};this.hls.trigger(I.STEERING_MANIFEST_LOADED,L),A&&this.updatePathwayPriority(A)},onError:(f,p,m,y)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${p.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let v=this.timeToLoad*1e3;if(f.code===429){const S=this.loader;if(typeof S?.getResponseHeader=="function"){const T=S.getResponseHeader("Retry-After");T&&(v=parseFloat(T)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,v)},onTimeout:(f,p,m)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,d,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const s=(n=this.hls)==null?void 0:n.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function vx(r,e,t,n){r&&Object.keys(e).forEach(s=>{const i=r.filter(o=>o.groupId===s).map(o=>{const u=rt({},o);return u.details=void 0,u.attrs=new St(u.attrs),u.url=u.attrs.URI=Pb(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[s],u.attrs["PATHWAY-ID"]=n,u});r.push(...i)})}function Pb(r,e,t,n){const{HOST:s,PARAMS:i,[t]:o}=n;let u;e&&(u=o?.[e],u&&(r=u));const d=new self.URL(r);return s&&!u&&(d.host=s),i&&Object.keys(i).sort().forEach(c=>{c&&d.searchParams.set(c,i[c])}),d.href}class so extends Wn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=so.CDMCleanupPromise?[so.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:s}=t,i=`"${t.type}" event: init data type: "${n}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=la(this.config));const u=o.map(Pf).filter(d=>!!d);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(o=>{const u=bu(o);if(n!=="sinf"||u!==bt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${u}`);return}let d;try{const y=$t(new Uint8Array(s)),v=Op(JSON.parse(y).sinf),S=AS(v);if(!S)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");d=new Uint8Array(S.subarray(8,24))}catch(y){this.warn(`${i} Failed to parse sinf: ${y}`);return}const c=dn(d),{keyIdToKeySessionPromise:f,mediaKeySessions:p}=this;let m=f[c];for(let y=0;y<p.length;y++){const v=p[y],S=v.decryptdata;if(!S.keyId)continue;const T=dn(S.keyId);if(Wu(d,S.keyId)||S.uri.replace(/-/g,"").indexOf(c)!==-1){if(m=f[T],!m)continue;if(S.pssh)break;delete f[T],S.pssh=new Uint8Array(s),S.keyId=d,m=f[c]=m.then(()=>this.generateRequestWithPreferredKeySession(v,n,s,"encrypted-event-key-match")),m.catch(A=>this.handleError(A));break}}m||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(I.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(I.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(I.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(I.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(I.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(I.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,s=t?.[e];if(s)return s.licenseUrl;if(e===bt.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t?.[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(o,u,d)=>!!o&&d.indexOf(o)===u,s=t.map(o=>o.audioCodec).filter(n),i=t.map(o=>o.videoCodec).filter(n);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,u)=>{const d=c=>{const f=c.shift();this.getMediaKeysPromise(f,s,i).then(p=>o({keySystem:f,mediaKeys:p})).catch(p=>{c.length?d(c):p instanceof Pn?u(p):u(new Pn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};d(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${n}`;return $S===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return n(e,t)}getMediaKeysPromise(e,t,n){var s;const i=qO(e,t,n,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],u=(s=o)==null?void 0:s.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${lt(i)}`),u=this.requestMediaKeySystemAccess(e,i);const d=o=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),u.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const p=d.mediaKeys=c.createMediaKeys().then(m=>(this.log(`Media-keys created for "${e}"`),d.hasMediaKeys=!0,f.then(y=>y?this.setMediaKeysServerCertificate(m,e,y):m)));return p.catch(m=>{this.error(`Failed to create media-keys for "${e}"}: ${m}`)}),p})}return u.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${dn(e.keyId||[])} keyUri: ${e.uri}`);const s=n.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),s=cu(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(n,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${dn(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Pf(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=Pf(s);i?t(i):n(new Error(`Unable to find format for key-system "${s}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=la(this.config),n=e.map(bu).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const s=gF(e,t[n]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,n=cu(t),s=this.bannedKeyIds[n];if(s||this.getKeyStatus(t)==="internal-error"){const u=xx(s||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const i=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[n];if(!o){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:d,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(d,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:d,mediaKeys:c,decryptdata:t}))))).then(d=>{const c="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(d,c,f,"playlist-key")});return u.catch(d=>this.handleError(d,e.frag)),this.keyIdToKeySessionPromise[n]=u,u}return o.catch(u=>{if(u instanceof Pn){const d=et({},u.data);this.getKeyStatus(t)==="internal-error"&&(d.decryptdata=t);const c=new Pn(d,u.message);this.handleError(c,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Pn){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${dn(n.keyId||[])})`:""}`),this.hls.trigger(I.ERROR,e.data)}else this.error(e.message),this.hls.trigger(I.ERROR,{type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=cu(e),n=this.keyIdToKeySessionPromise[t];if(!n){const s=bu(e.keyFormat),i=s?[s]:la(this.config);return this.attemptKeySystemAccess(i)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=la(this.config)),e.length===0)throw new Pn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${lt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(n).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>n.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,n,s){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const v=o.call(this.hls,t,n,e);if(!v)throw new Error("Invalid response from configured generateRequest filter");t=v.initDataType,n=v.initData?v.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(v){if(this.warn(v.message),this.hls&&this.hls.config.debug)throw v}if(n===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const u=cu(e.decryptdata),d=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${u} URI: ${d} (init data type: ${t} length: ${n.byteLength})`);const c=new Mp,f=e._onmessage=v=>{const S=e.mediaKeysSession;if(!S){c.emit("error",new Error("invalid state"));return}const{messageType:T,message:A}=v;this.log(`"${T}" message event for session "${S.sessionId}" message size: ${A.byteLength}`),T==="license-request"||T==="license-renewal"?this.renewLicense(e,A).catch(L=>{c.eventNames().length?c.emit("error",L):this.handleError(L)}):T==="license-release"?e.keySystem===bt.FAIRPLAY&&this.updateKeySession(e,Dh("acknowledged")).then(()=>this.removeSession(e)).catch(L=>this.handleError(L)):this.warn(`unhandled media key message type "${T}"`)},p=(v,S)=>{S.keyStatus=v;let T;v.startsWith("usable")?c.emit("resolved"):v==="internal-error"||v==="output-restricted"||v==="output-downscaled"?T=xx(v,S.decryptdata):v==="expired"?T=new Error(`key expired (keyId: ${u})`):v==="released"?T=new Error("key released"):v==="status-pending"||this.warn(`unhandled key status change "${v}" (keyId: ${u})`),T&&(c.eventNames().length?c.emit("error",T):this.handleError(T))},m=e._onkeystatuseschange=v=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const T=this.getKeyStatuses(e);if(!Object.keys(T).some(C=>T[C]!=="status-pending"))return;if(T[u]==="expired"){this.log(`Expired key ${lt(T)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let L=T[u];if(L)p(L,e);else{var w;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(w=e.keyStatusTimeouts)[u]||(w[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const P=this.getKeyStatus(e.decryptdata);if(P&&P!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${P} from other session.`),p(P,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),L="internal-error",p(L,e)},1e3)),this.log(`No status for keyId ${u} (${lt(T)}).`)}};fn(e.mediaKeysSession,"message",f),fn(e.mediaKeysSession,"keystatuseschange",m);const y=new Promise((v,S)=>{c.on("error",S),c.on("resolved",v)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${d}`)}).catch(v=>{throw new Pn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_SESSION,error:v,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${v}`)}).then(()=>y).catch(v=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw v}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,s)=>{if(typeof s=="string"&&typeof n=="object"){const u=s;s=n,n=u}const i="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);e.keySystem===bt.PLAYREADY&&i.length===16&&US(i);const o=dn(i);n==="internal-error"&&(this.bannedKeyIds[o]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,s=new n(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,u)=>{const d={responseType:"arraybuffer",url:i},c=t.certLoadPolicy.default,f={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,y,v,S)=>{o(m.data)},onError:(m,y,v,S)=>{u(new Pn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:et({url:d.url,data:void 0},m)},`"${e}" certificate request failed (${i}). Status: ${m.code} (${m.text})`))},onTimeout:(m,y,v)=>{u(new Pn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:d.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(m,y,v)=>{u(new Error("aborted"))}};s.load(d,f,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((s,i)=>{e.setServerCertificate(n).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),s(e)}).catch(o=>{i(new Pn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(s=>{throw new Pn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(n,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let f;for(let p=0,m=i.length;p<m;p++){var o,u;f=i[p];const y=(o=f.querySelector("name"))==null?void 0:o.textContent,v=(u=f.querySelector("value"))==null?void 0:u.textContent;y&&v&&e.setRequestHeader(y,v)}}const d=s.querySelector("Challenge"),c=d?.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Dh(atob(c))}setupLicenseXHR(e,t,n,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,n,s)}).catch(o=>{if(!n.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,n,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let d=u.response;this.log(`License received ${d instanceof ArrayBuffer?d.byteLength:d}`);const c=this.config.licenseResponseCallback;if(c)try{d=c.call(this.hls,u,o,e)}catch(f){this.error(f)}s(d)}else{const d=n.errorRetry,c=d?d.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||u.status>=400&&u.status<500)i(new Pn({type:we.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:o,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${o}). Status: ${u.status} (${u.statusText})`));else{const f=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,o,e,t).then(({xhr:d,licenseChallenge:c})=>{e.keySystem==bt.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(d,c)),d.send(c)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,fn(n,"encrypted",this.onMediaEncrypted),fn(n,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(bn(e,"encrypted",this.onMediaEncrypted),bn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,si.clearKeyUriToKeyIdMap();const s=n.length;so.CDMCleanupPromise=Promise.all(n.map(i=>this.removeSession(i)).concat((t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(i=>{this.log(`Could not clear media keys: ${i}`),this.hls&&this.hls.trigger(I.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${i}`)})}))||Promise.resolve())).catch(i=>{this.log(`Could not close sessions and clear media keys: ${i}`),this.hls&&this.hls.trigger(I.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${i}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${dn(s?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(c=>self.clearTimeout(o[c]));const{drmSystemOptions:u}=this.config;return(QO(u)?new Promise((c,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(f)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(I.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(I.ERROR,{type:we.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}so.CDMCleanupPromise=void 0;function cu(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return dn(r.keyId)}function gF(r,e){if(r.keyId&&e.mediaKeysSession.keyStatuses.has(r.keyId))return e.mediaKeysSession.keyStatuses.get(r.keyId);if(r.matches(e.decryptdata))return e.keyStatus}class Pn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function xx(r,e){const t=r==="output-restricted",n=t?z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:z.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Pn({type:we.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${r}"`)}class yF{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(I.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(I.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,o=n-this.lastDroppedFrames,u=t-this.lastDecodedFrames,d=1e3*o/i,c=this.hls;if(c.trigger(I.FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:n}),d>0&&o>c.config.fpsDroppedMonitoringThreshold*u){let f=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=f)&&(f=f-1,c.trigger(I.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:c.currentLevel}),c.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function _b(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function kb(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){tt.debug(`[texttrack-utils]: ${n}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,r.addCue(s)}catch(s){tt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(r.mode=t)}function Ji(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let n=r.cues.length;n--;)e&&r.cues[n].removeEventListener("enter",e),r.removeCue(r.cues[n]);t==="disabled"&&(r.mode=t)}function Vh(r,e,t,n){const s=r.mode;if(s==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const i=xF(r.cues,e,t);for(let o=0;o<i.length;o++)(!n||n(i[o]))&&r.removeCue(i[o])}s==="disabled"&&(r.mode=s)}function vF(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let n=0,s=t,i;for(;n<=s;)if(i=Math.floor((s+n)/2),e<r[i].startTime)s=i-1;else if(e>r[i].startTime&&n<t)n=i+1;else return i;return r[n].startTime-e<e-r[s].startTime?n:s}function xF(r,e,t){const n=[],s=vF(r,e);if(s>-1)for(let i=s,o=r.length;i<o;i++){const u=r[i];if(u.startTime>=e&&u.endTime<=t)n.push(u);else if(u.startTime>t)return n}return n}function wu(r){const e=[];for(let t=0;t<r.length;t++){const n=r[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(r[t])}return e}class EF extends Gp{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=wu(this.media.textTracks);for(let i=0;i<n.length;i++)if(n[i].mode==="hidden")t=n[i];else if(n[i].mode==="showing"){t=n[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;wu(n.textTracks).forEach(o=>{Ji(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:s,details:i}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${n} and group:${s} not found in active group ${o?.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Subtitle track ${n} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!n||s?.length!==n?.length||n!=null&&n.some(o=>s?.indexOf(o)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!n||n.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,p)=>{f.id=p});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const u=this.hls.config.subtitlePreference;if(!i&&u){this.selectDefaultTrack=!1;const f=gr(u,o);if(f>-1)i=o[f];else{const p=gr(u,this.tracks);i=this.tracks[p]}}let d=this.findTrackId(i);d===-1&&i&&(d=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${n?.join(",")}" group-id`),this.hls.trigger(I.SUBTITLE_TRACKS_UPDATED,c),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(n&&!i.default||!n&&!e)&&(!e||ri(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(ka(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(ka(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(Bh(s,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ye.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&ri(e,n))return n;const s=gr(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(n)return null;{const i=gr(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,u=o?.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(I.SUBTITLE_TRACK_LOADING,{url:i,id:n,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=wu(e.textTracks),n=this.currentTrack;let s;if(n&&(s=t.filter(i=>Bh(n,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!ve(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(I.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===n&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:u="",name:d,type:c,url:f}=s;this.hls.trigger(I.SUBTITLE_TRACK_SWITCH,{id:o,groupId:u,name:d,type:c,url:f});const p=this.switchParams(s.url,n?.details,s.details);this.loadPlaylist(p)}}function TF(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function ya(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const io=.025;let Qu=(function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r})({});function SF(r,e,t){return`${r.identifier}-${t+1}-${ya(e)}`}class bF{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Uf(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=Uf(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=ve(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Uf(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<io))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Qu.Range:Qu.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return AF(this)}}function Uf(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<io)?e.start:e.start+e.duration}function Db(r,e,t){const n=new self.URL(r,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function jf(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function AF(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function Vi(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class LF{constructor(e,t,n,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(I.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=n,this.assetItem=s;const o=()=>{this.hasDetails=!0};i.once(I.LEVEL_LOADED,o),i.once(I.AUDIO_TRACK_LOADED,o),i.once(I.SUBTITLE_TRACK_LOADED,o),i.on(I.MEDIA_ATTACHING,(u,{media:d})=>{this.removeMediaListeners(),this.mediaAttached=d,this.interstitial.playoutLimit&&(d.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(I.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,i.trigger(I.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=Db(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=Ue.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ue.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,n){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,n){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Vi(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Ex=.033;class IF extends Wn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(i=s[n])!=null&&i.event;){var i;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let s=0;s<n.length;s++){let i=n[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let s=e;s<=t&&n[s];s++){const i=n[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var n;if(((n=t[s].event)==null?void 0:n.identifier)===e)return s}return-1}findAssetIndex(e,t){const n=e.assetList,s=n.length;if(s>1)for(let i=0;i<s;i++){const o=n[i];if(!o.error){const u=o.timelineStart;if(t===u||t>u&&(t<u+(o.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,s=n[n.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:s}=n,i=this.events,o=this.parseDateRanges(s,{url:n.url},t),u=Object.keys(s),d=i?i.filter(c=>!u.includes(c.identifier)):[];o.length&&o.sort((c,f)=>{const p=c.cue.pre,m=c.cue.post,y=f.cue.pre,v=f.cue.post;if(p&&!y)return-1;if(y&&!p||m&&!v)return 1;if(v&&!m)return-1;if(!p&&!y&&!m&&!v){const S=c.startTime,T=f.startTime;if(S!==T)return S-T}return c.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=o,d.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,d)}updateSchedule(e,t=[],n=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(s,e);(n||t.length||i?.length!==o.length||o.some((d,c)=>Math.abs(d.playout.start-i[c].playout.start)>.005||Math.abs(d.playout.end-i[c].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,n){const s=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const u=i[o],d=e[u];if(d.isInterstitial){let c=this.eventMap[u];c?c.setDateRange(d):(c=new bF(d,t),this.eventMap[u]=c,n===!1&&(c.appendInPlace=n)),s.push(c)}}return s}parseSchedule(e,t){const n=[],s=t.main.details,i=s.live?1/0:s.edge;let o=0;if(e=e.filter(d=>!d.error&&!(d.cue.once&&d.hasPlayed)),e.length){this.resolveOffsets(e,t);let d=0,c=0;if(e.forEach((f,p)=>{const m=f.cue.pre,y=f.cue.post,v=e[p-1]||null,S=f.appendInPlace,T=y?i:f.startOffset,A=f.duration,L=f.timelineOccupancy===Qu.Range?A:0,w=f.resumptionOffset,C=v?.startTime===T,P=T+f.cumulativeDuration;let B=S?P+A:T+w;if(m||!y&&T<=0){const N=c;c+=L,f.timelineStart=P;const F=o;o+=A,n.push({event:f,start:P,end:B,playout:{start:F,end:o},integrated:{start:N,end:c}})}else if(T<=i){if(!C){const O=T-d;if(O>Ex){const V=d,H=c;c+=O;const te=o;o+=O;const X={previousEvent:e[p-1]||null,nextEvent:f,start:V,end:V+O,playout:{start:te,end:o},integrated:{start:H,end:c}};n.push(X)}else O>0&&v&&(v.cumulativeDuration+=O,n[n.length-1].end=T)}y&&(B=P),f.timelineStart=P;const N=c;c+=L;const F=o;o+=A,n.push({event:f,start:P,end:B,playout:{start:F,end:o},integrated:{start:N,end:c}})}else return;const D=f.resumeTime;y||D>i?d=i:d=D}),d<i){var u;const f=d,p=c,m=i-d;c+=m;const y=o;o+=m,n.push({previousEvent:((u=n[n.length-1])==null?void 0:u.event)||null,nextEvent:null,start:d,end:f+m,playout:{start:y,end:o},integrated:{start:p,end:c}})}this.setDurations(i,o,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,s=n.live?1/0:n.edge;let i=0,o=-1;e.forEach((u,d)=>{const c=u.cue.pre,f=u.cue.post,p=c?0:f?s:u.startTime;this.updateAssetDurations(u),o===p?u.cumulativeDuration=i:(i=0,o=p),!f&&u.snapOptions.in&&(u.resumeAnchor=ai(null,n.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&d+1<e.length&&e[d+1].startTime-e[d].resumeTime<Ex&&(e[d+1].appendInPlace=!1,e[d+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const y=ve(u.resumeOffset)?u.resumeOffset:u.duration;i+=y})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(n-s)>io?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(o=>{const u=t[o].details,d=u.edge;if(n>=d)return this.log(`"${e.identifier}" resumption ${n} past ${o} playlist end ${d}`),!1;const c=ai(null,u.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${o} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const f=o==="audio"?.175:0;return Math.abs(c.start-n)<io+f||Math.abs(c.end-n)<io+f?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,s=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const u=e.assetList[o],d=t+n;u.startOffset=n,u.timelineStart=d,s||(s=u.duration===null),i||(i=!!u.error);const c=u.error?0:u.duration||0;n+=c}s&&!i?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function nr(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class wF{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let s;try{s=Db(n,this.hls.sessionId,e.baseUrl)}catch(m){const y=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,m,n);this.hls.trigger(I.ERROR,y);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,u=new o(i),d={responseType:"json",url:s.href},c=i.interstitialAssetListLoadPolicy.default,f={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,y,v,S)=>{const T=m.data,A=T?.ASSETS;if(!Array.isArray(A)){const L=this.assignAssetListError(e,z.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),v.url,y,S);this.hls.trigger(I.ERROR,L);return}e.assetListResponse=T,this.hls.trigger(I.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:S})},onError:(m,y,v,S)=>{const T=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${m.code} ${m.text} (${y.url})`),y.url,S,v);this.hls.trigger(I.ERROR,T)},onTimeout:(m,y,v)=>{const S=this.assignAssetListError(e,z.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${y.url})`),y.url,m,v);this.hls.trigger(I.ERROR,S)}};return u.load(d,f,p),this.hls.trigger(I.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,n,s,i,o){return e.error=n,{type:we.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:n,networkDetails:o,stats:i}}}function Tx(r){r?.play().catch(()=>{})}function du(r,e){return`[${r}] Advancing timeline position to ${e}`}class RF extends Wn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const s=n-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=n,this.bufferedPos=n;const u=this.playingItem;if(!u){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(n,n-s)&&this.updateSchedule(!0),this.checkBuffer(),o&&n<u.start||n>=u.end){var d;const y=this.findItemIndex(u);let v=this.schedule.findItemIndexAtTime(n);if(v===-1&&(v=y+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${n} (resolving from ${y} to ${v})`)),!this.isInterstitial(u)&&(d=this.media)!=null&&d.paused&&(this.shouldPlay=!1),!o&&v>y){const S=this.schedule.findJumpRestrictedIndex(y+1,v);if(S>y){this.setSchedulePosition(S);return}}this.setSchedulePosition(v);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(u)){const y=u.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,y))}return}const f=c.timelineStart,p=c.duration||0;if(o&&n<f||n>=f+p){var m;(m=u.event)!=null&&m.appendInPlace&&(this.clearInterstitial(u.event,u),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,c)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(n>=s.end){this.timelinePos=s.end;const u=this.findItemIndex(s);this.setSchedulePosition(u+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);n>=o&&this.setScheduleToAssetAtTime(n,i)},this.onScheduleUpdate=(n,s)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,u=i.events||[],d=i.items||[],c=i.durations,f=n.map(S=>S.identifier),p=!!(u.length||f.length);(p||s)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${d.map(S=>nr(S))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let m=null,y=null;o&&(m=this.updateItem(o,this.timelinePos),this.itemsMatch(o,m)?this.playingItem=m:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const v=this.bufferingItem;if(v&&(y=this.updateItem(v,this.bufferedPos),this.itemsMatch(v,y)?this.bufferingItem=y:v.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(v.event,null))),n.forEach(S=>{S.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),this.playerQueue.forEach(S=>{if(S.interstitial.appendInPlace){const T=S.assetItem.timelineStart,A=S.timelineOffset-T;if(A)try{S.timelineOffset=T}catch(L){Math.abs(A)>io&&this.warn(`${L} ("${S.assetId}" ${S.timelineOffset}->${T})`)}}}),p||s){if(this.hls.trigger(I.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:d.slice(0),durations:c,removedIds:f}),this.isInterstitial(o)&&f.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(m,o),v&&y!==m&&this.trimInPlace(y,v),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new wF(e),this.schedule=new IF(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(I.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(I.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(I.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(I.MEDIA_ENDED,this.onMediaEnded,this),e.on(I.ERROR,this.onError,this),e.on(I.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(I.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(I.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(I.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(I.MEDIA_ENDED,this.onMediaEnded,this),e.off(I.ERROR,this.onError,this),e.off(I.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){bn(e,"play",this.onPlay),bn(e,"pause",this.onPause),bn(e,"seeking",this.onSeeking),bn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;fn(n,"seeking",this.onSeeking),fn(n,"timeupdate",this.onTimeupdate),fn(n,"play",this.onPlay),fn(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(n);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(this.media=null,!n&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=p=>p&&e.getAssetPlayer(p.identifier),s=(p,m,y,v,S)=>{if(p){let T=p[m].start;const A=p.event;if(A){if(m==="playout"||A.timelineOccupancy!==Qu.Point){const L=n(y);L?.interstitial===A&&(T+=L.assetItem.startOffset+L[S])}}else{const L=v==="bufferedPos"?o():e[v];T+=L-p.start}return T}return 0},i=(p,m)=>{var y;if(p!==0&&m!=="primary"&&(y=e.schedule)!=null&&y.length){var v;const S=e.schedule.findItemIndexAtTime(p),T=(v=e.schedule.items)==null?void 0:v[S];if(T){const A=T[m].start-T.start;return p+A}}return p},o=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?u("primary"):Math.max(p,0)},u=p=>{var m,y;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:((y=e.schedule)==null?void 0:y.durations[p])||0},d=(p,m)=>{var y,v;const S=e.effectivePlayingItem;if(S!=null&&(y=S.event)!=null&&y.restrictions.skip||!e.schedule)return;e.log(`seek to ${p} "${m}"`);const T=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(p,m),L=(v=e.schedule.items)==null?void 0:v[A],w=e.getBufferingPlayer(),C=w?.interstitial,P=C?.appendInPlace,B=T&&e.itemsMatch(T,L);if(T&&(P||B)){const D=n(e.playingAsset),N=D?.media||e.primaryMedia;if(N){const F=m==="primary"?N.currentTime:s(T,m,e.playingAsset,"timelinePos","currentTime"),O=p-F,V=(P?F:N.currentTime)+O;if(V>=0&&(!D||P||V<=D.duration)){N.currentTime=V;return}}}if(L){let D=p;if(m!=="primary"){const F=L[m].start,O=p-F;D=L.start+O}const N=!e.isInterstitial(L);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(N||L.event.appendInPlace)){const F=e.media||(P?w?.media:null);F&&(F.currentTime=D)}else if(T){const F=e.findItemIndex(T);if(A>F){const V=e.schedule.findJumpRestrictedIndex(F+1,A);if(V>F){e.setSchedulePosition(V);return}}let O=0;if(N)e.timelinePos=D,e.checkBuffer();else{const V=L.event.assetList,H=p-(L[m]||L).start;for(let te=V.length;te--;){const X=V[te];if(X.duration&&H>=X.startOffset&&H<X.startOffset+X.duration){O=te;break}}}e.setSchedulePosition(A,O)}}},c=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const m=t();return e.isInterstitial(m)?m:null},f={get bufferedEnd(){const p=t(),m=e.bufferingItem;if(m&&m===p){var y;return s(m,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-m.playout.start||((y=e.bufferingAsset)==null?void 0:y.startOffset)||0}return 0},get currentTime(){const p=c(),m=e.effectivePlayingItem;return m&&m===p?s(m,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-m.playout.start:0},set currentTime(p){const m=c(),y=e.effectivePlayingItem;y&&y===m&&d(p+y.playout.start,"playout")},get duration(){const p=c();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const m=(p=c())==null?void 0:p.event.assetList;return m?m.map(y=>e.getAssetPlayer(y.identifier)):[]},get playingIndex(){var p;const m=(p=c())==null?void 0:p.event;return m&&e.effectivePlayingAsset?m.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var p;return((p=e.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=e.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return c()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return o()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){d(p,"primary")},get duration(){return u("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){d(p,"integrated")},get duration(){return u("integrated")},get seekableStart(){var p;return i(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,m=p?.event;if(m&&!m.restrictions.skip){const y=e.findItemIndex(p);if(m.appendInPlace){const v=p.playout.start+p.event.duration;d(v+.001,"playout")}else e.advanceAfterAssetEnded(m,y,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!ve(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,s=e.media;if(n&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${lt(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var n,s;if(e.media===t)return;let i=null;const o=this.hls,u=e!==o,d=u&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let f;if(o.media)d&&(i=o.transferMedia(),this.detachedData=i),f="Primary";else if(c){const v=this.getBufferingPlayer();v?(i=v.transferMedia(),f=`${v}`):f="detached MediaSource"}else f="detached media";if(!i){if(c)i=this.detachedData,this.log(`using detachedData: MediaSource ${lt(i)}`);else if(!this.detachedData||o.media===t){const v=this.playerQueue;v.length>1&&v.forEach(S=>{if(u&&S.interstitial.appendInPlace!==d){const T=S.interstitial;this.clearInterstitial(S.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",m=p&&i?i:t;this.log(`${p?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${f} (media.currentTime: ${t.currentTime})`);const y=this.schedule;if(m===i&&y){const v=u&&e.assetId===y.assetIdAtEnd;m.overrides={duration:y.duration,endOfStream:!u||v,cueRemoval:!u}}e.attachMedia(m)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,s=this.effectivePlayingItem;if(n===-1){const i=this.hls.startPosition;if(this.log(du("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,u=e.findItemIndexAtTime(o);this.setSchedulePosition(u)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const n=e.event,s=n.findAssetIndex(t),i=jf(n,s);if(!n.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const u=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,n){const s=jf(e,n);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,u=i.length;if(o>=u){this.setSchedulePosition(-1);return}const d=e.resumeTime;this.timelinePos<d&&(this.log(du("advanceAfterAssetEnded",d)),this.timelinePos=d,e.appendInPlace&&this.advanceInPlace(d),this.checkBuffer(this.bufferedPos<d)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const s=t.parentIdentifier,i=n.getEvent(s);if(i){const o=n.findEventIndex(s),u=n.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,u-1)}}setSchedulePosition(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&nr(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(o)){const f=o.event,p=this.playingAsset,m=p?.identifier,y=m?this.getAssetPlayer(m):null;if(y&&m&&(!this.eventItemsMatch(o,i)||t!==void 0&&m!==f.assetList[t].identifier)){var d;const v=f.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${v+1}/${f.assetList.length} ${Vi(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(I.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:v,event:f,schedule:s.slice(0),scheduleIndex:e,player:y}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),v);return}this.retreiveMediaSource(m,i),y.media&&!((d=this.detachedData)!=null&&d.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${nr(o)}`),f.hasPlayed=!0,this.hls.trigger(I.INTERSTITIAL_ENDED,{event:f,schedule:s.slice(0),scheduleIndex:e}),f.cue.once)){var c;this.updateSchedule();const v=(c=this.schedule)==null?void 0:c.items;if(i&&v){const S=this.findItemIndex(i);this.advanceSchedule(S,v,t,o,u)}return}}this.advanceSchedule(e,s,t,o,u)}advanceSchedule(e,t,n,s,i){const o=this.schedule;if(!o)return;const u=t[e]||null,d=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(f=>{const p=f.interstitial,m=o.findEventIndex(p.identifier);(m<e||m>e+1)&&this.clearInterstitial(p,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const f=u.event;if(n===void 0){n=o.findAssetIndex(f,this.timelinePos);const v=jf(f,n-1);if(f.isAssetPastPlayoutLimit(v)||f.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(f,e,n);return}n=v}const p=this.waitingItem;this.assetsBuffered(u,d)||this.setBufferingItem(u);let m=this.preloadAssets(f,n);if(this.eventItemsMatch(u,p||s)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${nr(u)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(I.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!d){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const y=f.assetList[n];if(!y){this.advanceAfterAssetEnded(f,e,n||0);return}if(m||(m=this.getAssetPlayer(y.identifier)),m===null||m.destroyed){const v=f.assetList.length;this.warn(`asset ${n+1}/${v} player destroyed ${f}`),m=this.createAssetPlayer(f,y,n),m.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(m,n,t,e,d),this.shouldPlay&&Tx(m.media)}else u?(this.resumePrimary(u,e,s),this.shouldPlay&&Tx(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${nr(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(du("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!n)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${nr(e)}`),this.hls.trigger(I.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(n<s.fragmentStart||n>s.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ue.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(du("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((n=s.mainForwardBufferInfo)==null?void 0:n.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(I.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(I.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const s=et(et({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=et(et({},this.altSelection),{},{audio:n});return}const i=et(et({},s),{},{audio:n});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=et(et({},this.altSelection),{},{subtitles:n});return}const i=et(et({},s),{},{subtitles:n});this.mediaSelection=i}onAudioTrackSwitching(e,t){const n=Pv(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=Pv(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var n;const o=this.schedule.findEventIndex(i.identifier),u=(n=this.schedule.items)==null?void 0:n[o];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const n=e.end+.25,s=Ue.bufferInfo(this.primaryMedia,n,0);(s.end>n||(s.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${nr(e)} (was ${nr(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const s=Ue.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,n,e)}updateBufferedPos(e,t,n){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,u=this.findItemIndex(o);let d=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const f=this.findItemIndex(i),p=Math.min(f+1,t.length-1),m=t[p];if((d===-1&&i&&e>=i.end||(c=m.event)!=null&&c.appendInPlace&&e+.01>=m.start)&&(d=p),this.isInterstitial(i)){const y=i.event;if(p-u>1&&y.appendInPlace===!1||y.assetList.length===0&&y.assetListLoader)return}if(this.bufferedPos=e,d>f&&d>u)this.bufferedToItem(m);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&m.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(m)&&this.preloadAssets(m.event,0)}}else n&&o&&!this.itemsMatch(o,i)&&(d===u?this.bufferedToItem(o):d===u+1&&this.bufferedToItem(t[d]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:s,events:i}=n;if(!s||!i)return t;const o=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const d=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${nr(e)}`+(t?` (${d.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const c=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,p)=>{const m=this.getAssetPlayer(f.identifier);m&&(p===c&&m.loadSource(),m.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(I.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,s=n.assetList.length===0&&!n.assetListLoader,i=n.cue.once;if(s||!i){const o=this.preloadAssets(n,t);if(o!=null&&o.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(o,u)}}}preloadAssets(e,t){const n=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,o=e.cue.once;if(i){const d=e.timelineStart;if(e.appendInPlace){var u;const m=this.playingItem;!this.isInterstitial(m)&&(m==null||(u=m.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(d+.25)}let c,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const m=f-d;m>0&&(c=Math.round(m*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:s} ${e}${c?` live-start: ${f} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,d,e.duration,n);const p=this.assetListLoader.loadAssetList(e,c);p&&(e.assetListLoader=p)}else if(!o&&s){for(let c=t;c<s;c++){const f=e.assetList[c],p=this.getAssetPlayerQueueIndex(f.identifier);(p===-1||this.playerQueue[p].destroyed)&&!f.error&&this.createAssetPlayer(e,f,c)}const d=e.assetList[t];if(d){const c=this.getAssetPlayer(d.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,s,i,o){const u={parentIdentifier:e.identifier,identifier:SF(e,o,t),duration:i,startOffset:n,timelineStart:s,uri:o};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,n){const s=this.hls,i=s.userConfig;let o=i.videoPreference;const u=s.loadLevelObj||s.levels[s.currentLevel];(o||u)&&(o=rt({},o),u.videoCodec&&(o.videoCodec=u.videoCodec),u.videoRange&&(o.allowedVideoRanges=[u.videoRange]));const d=s.audioTracks[s.audioTrack],c=s.subtitleTracks[s.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const C=this.timelinePos-t.timelineStart;if(C>1){const P=t.duration;P&&C<P&&(f=C)}}const p=t.identifier,m=et(et({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:d||i.audioPreference,subtitlePreference:c||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(m.timelineOffset=t.timelineStart));const y=m.cmcd;y!=null&&y.sessionId&&y.contentId&&(m.cmcd=rt({},y,{contentId:ya(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const v=new LF(this.HlsPlayerClass,m,e,t);this.playerQueue.push(v),e.assetList[n]=t;let S=!0;const T=C=>{if(C.live){var P;const N=new Error(`Interstitials MUST be VOD assets ${e}`),F={fatal:!0,type:we.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:N},O=((P=this.schedule)==null?void 0:P.findEventIndex(e.identifier))||-1;this.handleAssetItemError(F,e,O,n,N.message);return}const B=C.edge-C.fragmentStart,D=t.duration;(S||D===null||B>D)&&(S=!1,this.log(`Interstitial asset "${p}" duration change ${D} > ${B}`),t.duration=B,this.updateSchedule())};v.on(I.LEVEL_UPDATED,(C,{details:P})=>T(P)),v.on(I.LEVEL_PTS_UPDATED,(C,{details:P})=>T(P)),v.on(I.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const A=(C,P)=>{const B=this.getAssetPlayer(p);if(B&&P.tracks){B.off(I.BUFFER_CODECS,A),B.tracks=P.tracks;const D=this.primaryMedia;this.bufferingAsset===B.assetItem&&D&&!B.media&&this.bufferAssetPlayer(B,D)}};v.on(I.BUFFER_CODECS,A);const L=()=>{var C;const P=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${P}`),!P||!this.schedule)return;const B=this.schedule.findEventIndex(e.identifier),D=(C=this.schedule.items)==null?void 0:C[B];this.isInterstitial(D)&&this.advanceAssetBuffering(D,t)};v.on(I.BUFFERED_TO_END,L);const w=C=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const B=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,B,C)};return v.once(I.MEDIA_ENDED,w(n)),v.once(I.PLAYOUT_LIMIT_REACHED,w(1/0)),v.on(I.ERROR,(C,P)=>{if(!this.schedule)return;const B=this.getAssetPlayer(p);if(P.details===z.BUFFER_STALLED_ERROR){if(B!=null&&B.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(P,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${P.error} ${e}`)}),v.on(I.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const P=new Error(`Asset player destroyed unexpectedly ${p}`),B={fatal:!0,type:we.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:P};this.handleAssetItemError(B,e,this.schedule.findEventIndex(e.identifier),n,P.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Vi(t)}`),this.hls.trigger(I.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:v}),v}clearInterstitial(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const s=this.playerQueue[n];this.log(`clear ${s} toSegment: ${t&&nr(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(n,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,s,i){const{interstitial:o,assetItem:u,assetId:d}=e,c=o.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!f||f.identifier!==d)&&(f&&(this.clearAssetPlayer(f.identifier,n[s]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${Vi(u)}`),this.hls.trigger(I.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:o,schedule:n.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var n,s;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,u=this.schedule.findEventIndex(i.identifier),d=(n=this.schedule.items)==null?void 0:n[u];if(!d)return;e.loadSource(),this.setBufferingItem(d),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const f=i.appendInPlace;if(f&&c?.interstitial.appendInPlace===!1)return;const p=c?.tracks||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(f&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(p&&!mS(p,e.tracks)){const m=new Error(`Asset ${Vi(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),y={fatal:!0,type:we.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:m},v=i.findAssetIndex(o);this.handleAssetItemError(y,i,u,v,m.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const s=n.currentTime,i=t.findAssetIndex(e,s),o=e.assetList[i];if(o){const u=this.getAssetPlayer(o.identifier);if(u){const d=u.currentTime||s-o.timelineStart,c=u.duration-d;if(this.warn(`Stalled at ${d} of ${d+c} in ${u} ${e} (media.currentTime: ${s})`),d&&(c/n.playbackRate<.5||u.bufferedInPlaceToEnd(n))&&u.hls){const f=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,s,i){if(e.details===z.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Vi(o)} ${e.error}`),!this.schedule)return;const u=o?.identifier||"",d=this.getAssetPlayerQueueIndex(u),c=this.playerQueue[d]||null,f=this.schedule.items,p=rt({},e,{fatal:!1,errorAction:no(!0),asset:o,assetListIndex:s,event:t,schedule:f,scheduleIndex:n,player:c});if(this.hls.trigger(I.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const m=this.playingAsset,y=this.bufferingAsset,v=new Error(i);if(o&&(this.clearAssetPlayer(u,null),o.error=v),!t.assetList.some(S=>!S.error))t.error=v;else for(let S=s;S<t.assetList.length;S++)this.resetAssetPlayer(t.assetList[S].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):m&&m.identifier===u?this.advanceAfterAssetEnded(t,n,s):y&&y.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,y)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${nr(n)} error: ${e.error}`);let s=this.timelinePos;s===-1&&(s=this.hls.startPosition);const i=this.updateItem(n,s);if(this.itemsMatch(n,i)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const o=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(e,t){var n,s;const i=t.event,o=i.identifier,u=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(o)))return;const d=i.timelineStart,c=i.duration;let f=0;u.forEach((S,T)=>{const A=parseFloat(S.DURATION);this.createAsset(i,T,f,d+f,A,S.URI),f+=A}),i.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${c}) ${i}`);const p=this.waitingItem,m=p?.event.identifier===o;this.updateSchedule();const y=(s=this.bufferingItem)==null?void 0:s.event;if(m){var v;const S=this.schedule.findEventIndex(o),T=(v=this.schedule.items)==null?void 0:v[S];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==S){i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(T)}this.setSchedulePosition(S)}else if(y?.identifier===o){const S=i.assetList[0];if(S){const T=this.getAssetPlayer(S.identifier);if(y.appendInPlace){const A=this.primaryMedia;T&&A&&this.bufferAssetPlayer(T,A)}else T&&T.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case z.ASSET_LIST_PARSING_ERROR:case z.ASSET_LIST_LOAD_ERROR:case z.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case z.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Sx=500;class CF extends Np{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",Te.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=se.IDLE,this.setInterval(Sx),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:s}=t;if(this.fragContextChanged(n)||(Ft(n)&&(this.fragPrevious=n),this.state=se.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const u=n.start;for(let c=0;c<i.length;c++)if(u>=i[c].start&&u<=i[c].end){o=i[c];break}const d=n.start+n.duration;o?o.end=d:(o={start:u,end:d},i.push(o)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:s}=t;if(n===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let u=0;u<o.length;){if(o[u].end<=i){o.shift();continue}else if(o[u].start<i)o[u].start=i;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(n,i,Te.SUBTITLE)}}onError(e,t){const n=t.frag;n?.type===Te.SUBTITLE&&(t.details===z.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==se.STOPPED&&(this.state=se.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&vb(this.levels,t)){this.levels=t.map(n=>new Ra(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const s=new Ra(n);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Te.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==se.STOPPED&&this.setInterval(Sx)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:s,levels:i}=this,{details:o,id:u}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const d=i[u];if(u>=i.length||!d)return;this.log(`Subtitle track ${u} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(n=d.details)!=null&&n.live){if(o.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const m=p.fragments[0];if(!d.details)o.hasProgramDateTime&&p.hasProgramDateTime?(qu(o,p),c=o.fragmentStart):m&&(c=m.start,Nh(o,c));else{var f;c=this.alignPlaylists(o,d.details,(f=this.levelLastLoaded)==null?void 0:f.details),c===0&&m&&(c=m.start,Nh(o,c))}p&&!this.startFragRequested&&this.setStartPosition(p,c)}d.details=o,this.levelLastLoaded=d,u===s&&(this.hls.trigger(I.SUBTITLE_TRACK_UPDATED,{details:o,id:u,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===se.IDLE&&(ai(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&s!=null&&s.key&&s.iv&&ro(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer,Dp(s.method)).catch(u=>{throw i.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const d=performance.now();i.trigger(I.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:o,tdecrypt:d}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=se.IDLE})}}doTick(){if(!this.media){this.state=se.IDLE;return}if(this.state===se.IDLE){const{currentTrackId:e,levels:t}=this,n=t?.[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:s}=this,i=this.getLoadPosition(),o=Ue.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:u,len:d}=o,c=n.details,f=this.hls.maxBufferLength+c.levelTargetDuration;if(d>f)return;const p=c.fragments,m=p.length,y=c.edge;let v=null;const S=this.fragPrevious;if(u<y){const L=s.maxFragLookUpTolerance,w=u>y-L?0:L;v=ai(S,p,Math.max(p[0].start,u),w),!v&&S&&S.start<p[0].start&&(v=p[0])}else v=p[m-1];if(v=this.filterReplacedPrimary(v,n.details),!v)return;const T=v.sn-c.startSN,A=p[T-1];if(A&&A.cc===v.cc&&this.fragmentTracker.getState(A)===Vt.NOT_LOADED&&(v=A),this.fragmentTracker.getState(v)===Vt.NOT_LOADED){const L=this.mapToInitFragWhenRequired(v);L&&this.loadFragment(L,n,u)}}}loadFragment(e,t,n){Ft(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new PF(this.tracksBuffered[this.currentTrackId]||[])}}class PF{constructor(e){this.buffered=void 0;const t=(n,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const _F={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ob=r=>String.fromCharCode(_F[r]||r),rr=15,Fr=100,kF={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},DF={17:2,18:4,21:6,22:8,23:10,19:13,20:15},OF={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},NF={25:2,26:4,29:6,30:8,31:10,27:13,28:15},MF=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class FF{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;tt.log(`${this.time} [${e}] ${n}`)}}}const Ws=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class Nb{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const s=t[n];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class BF{constructor(){this.uchar=" ",this.penState=new Nb}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class UF{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Nb,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Fr;t++)this.chars.push(new BF);this.logger=e}equals(e){for(let t=0;t<Fr;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Fr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Fr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Fr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Fr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Ob(e);if(this.pos>=Fr){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Fr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Fr;n++){const s=this.chars[n].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class $f{constructor(e){this.rows=[],this.currRow=rr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<rr;t++)this.rows.push(new UF(e));this.logger=e}reset(){for(let e=0;e<rr;e++)this.rows[e].clear();this.currRow=rr-1}equals(e){let t=!0;for(let n=0;n<rr;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<rr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<rr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+lt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<rr;u++)this.rows[u].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const u=o.rows[i].cueStartTime,d=this.logger.time;if(u!==null&&d!==null&&u<d)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[i+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);n.setCursor(e.indent),e.color=n.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+lt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",s=-1;for(let i=0;i<rr;i++){const o=this.rows[i].getTextString();o&&(s=i+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class bx{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new $f(n),this.nonDisplayedMemory=new $f(n),this.lastOutputScreen=new $f(n),this.currRollUpRow=this.displayedMemory.rows[rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[n]}this.logger.log(2,"MIDROW: "+lt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Ax{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=$F(),this.logger=void 0;const s=this.logger=new FF;this.channels=[null,new bx(e,t,s),new bx(e+1,n,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const s=t[n]&127,i=t[n+1]&127;let o=!1,u=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+Ws([t[n],t[n+1]])+"] -> ("+Ws([s,i])+")");const d=this.cmdHistory;if(s>=16&&s<=31){if(jF(s,i,d)){fu(null,null,d),this.logger.log(3,()=>"Repeated command ("+Ws([s,i])+") is dropped");continue}fu(s,i,this.cmdHistory),o=this.parseCmd(s,i),o||(o=this.parseMidrow(s,i)),o||(o=this.parsePAC(s,i)),o||(o=this.parseBackgroundAttributes(s,i))}else fu(null,null,d);if(!o&&(u=this.parseChars(s,i),u)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ws([s,i])+" orig: "+Ws([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(n||s))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[n];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ws([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?n=o===1?kF[e]:OF[e]:n=o===1?DF[e]:NF[e];const u=this.channels[o];return u?(u.setPAC(this.interpretPAC(n,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let n;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,s.underline=(n&1)===1,n<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((n-16)/2)*4,s}parseChars(e,t){let n,s=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+Ob(o)+"' in channel "+n),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Ws(s).join(",")),s}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(n||s))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=MF[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}fu(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function fu(r,e,t){t.a=r,t.b=e}function jF(r,e,t){return t.a===r&&t.b===e}function $F(){return{a:null,b:null}}var Wp=(function(){if(Yu!=null&&Yu.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,d){if(typeof d!="string"||!Array.isArray(u))return!1;const c=d.toLowerCase();return~u.indexOf(c)?c:!1}function n(u){return t(r,u)}function s(u){return t(e,u)}function i(u,...d){let c=1;for(;c<arguments.length;c++){const f=arguments[c];for(const p in f)u[p]=f[p]}return u}function o(u,d,c){const f=this,p={enumerable:!0};f.hasBeenReset=!1;let m="",y=!1,v=u,S=d,T=c,A=null,L="",w=!0,C="auto",P="start",B=50,D="middle",N=50,F="middle";Object.defineProperty(f,"id",i({},p,{get:function(){return m},set:function(O){m=""+O}})),Object.defineProperty(f,"pauseOnExit",i({},p,{get:function(){return y},set:function(O){y=!!O}})),Object.defineProperty(f,"startTime",i({},p,{get:function(){return v},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");v=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",i({},p,{get:function(){return S},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");S=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",i({},p,{get:function(){return T},set:function(O){T=""+O,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",i({},p,{get:function(){return A},set:function(O){A=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",i({},p,{get:function(){return L},set:function(O){const V=n(O);if(V===!1)throw new SyntaxError("An invalid or illegal string was specified.");L=V,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",i({},p,{get:function(){return w},set:function(O){w=!!O,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",i({},p,{get:function(){return C},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");C=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",i({},p,{get:function(){return P},set:function(O){const V=s(O);if(!V)throw new SyntaxError("An invalid or illegal string was specified.");P=V,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",i({},p,{get:function(){return B},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");B=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",i({},p,{get:function(){return D},set:function(O){const V=s(O);if(!V)throw new SyntaxError("An invalid or illegal string was specified.");D=V,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",i({},p,{get:function(){return N},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");N=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",i({},p,{get:function(){return F},set:function(O){const V=s(O);if(!V)throw new SyntaxError("An invalid or illegal string was specified.");F=V,this.hasBeenReset=!0}})),f.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class VF{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Mb(r){function e(n,s,i,o){return(n|0)*3600+(s|0)*60+(i|0)+parseFloat(o||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class GF{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let s=0;s<n.length;++s)if(t===n[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function Fb(r,e,t,n){const s=n?r.split(n):[r];for(const i in s){if(typeof s[i]!="string")continue;const o=s[i].split(t);if(o.length!==2)continue;const u=o[0],d=o[1];e(u,d)}}const Gh=new Wp(0,0,""),hu=Gh.align==="middle"?"middle":"center";function HF(r,e,t){const n=r;function s(){const u=Mb(r);if(u===null)throw new Error("Malformed timestamp: "+n);return r=r.replace(/^[^\sa-zA-Z-]+/,""),u}function i(u,d){const c=new GF;Fb(u,function(m,y){let v;switch(m){case"region":for(let S=t.length-1;S>=0;S--)if(t[S].id===y){c.set(m,t[S].region);break}break;case"vertical":c.alt(m,y,["rl","lr"]);break;case"line":v=y.split(","),c.integer(m,v[0]),c.percent(m,v[0])&&c.set("snapToLines",!1),c.alt(m,v[0],["auto"]),v.length===2&&c.alt("lineAlign",v[1],["start",hu,"end"]);break;case"position":v=y.split(","),c.percent(m,v[0]),v.length===2&&c.alt("positionAlign",v[1],["start",hu,"end","line-left","line-right","auto"]);break;case"size":c.percent(m,y);break;case"align":c.alt(m,y,["start",hu,"end","left","right"]);break}},/:/,/\s/),d.region=c.get("region",null),d.vertical=c.get("vertical","");let f=c.get("line","auto");f==="auto"&&Gh.line===-1&&(f=-1),d.line=f,d.lineAlign=c.get("lineAlign","start"),d.snapToLines=c.get("snapToLines",!0),d.size=c.get("size",100),d.align=c.get("align",hu);let p=c.get("position","auto");p==="auto"&&Gh.position===50&&(p=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=p}function o(){r=r.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);r=r.slice(3),o(),e.endTime=s(),o(),i(r,e)}function Bb(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class KF{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new VF,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let i=t.buffer,o=0;for(i=Bb(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const u=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),u}function s(i){Fb(i,function(o,u){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=n();const u=i.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=n(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new Wp(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{HF(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=i.indexOf("-->")!==-1;if(!i||u&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const zF=/\r\n|\n\r|\n|\r/g,Vf=function(e,t,n=0){return e.slice(n,n+t.length)===t},WF=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ve(t)||!ve(n)||!ve(s)||!ve(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*s,t+=3600*1e3*i,t};function Yp(r,e,t){return ya(r.toString())+ya(e.toString())+ya(t)}const YF=function(e,t,n){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=n};function qF(r,e,t,n,s,i,o){const u=new KF,d=Nn(new Uint8Array(r)).trim().replace(zF,`
`).split(`
`),c=[],f=e?tM(e.baseTime,e.timescale):0;let p="00:00.000",m=0,y=0,v,S=!0;u.oncue=function(T){const A=t[n];let L=t.ccOffset;const w=(m-f)/9e4;if(A!=null&&A.new&&(y!==void 0?L=t.ccOffset=A.start:YF(t,n,w)),w){if(!e){v=new Error("Missing initPTS for VTT MPEGTS");return}L=w-t.presentationOffset}const C=T.endTime-T.startTime,P=kn((T.startTime+L-y)*9e4,s*9e4)/9e4;T.startTime=Math.max(P,0),T.endTime=Math.max(P+C,0);const B=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(B)),T.id||(T.id=Yp(T.startTime,T.endTime,B)),T.endTime>0&&c.push(T)},u.onparsingerror=function(T){v=T},u.onflush=function(){if(v){o(v);return}i(c)},d.forEach(T=>{if(S)if(Vf(T,"X-TIMESTAMP-MAP=")){S=!1,T.slice(16).split(",").forEach(A=>{Vf(A,"LOCAL:")?p=A.slice(6):Vf(A,"MPEGTS:")&&(m=parseInt(A.slice(7)))});try{y=WF(p)/1e3}catch(A){v=A}return}else T===""&&(S=!1);u.parse(T+`
`)}),u.flush()}const Gf="stpp.ttml.im1t",Ub=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,jb=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,XF={left:"start",center:"center",right:"end",start:"start",end:"end"};function Lx(r,e,t,n){const s=Ge(new Uint8Array(r),["mdat"]);if(s.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(u=>Nn(u)),o=eM(e.baseTime,1,e.timescale);try{i.forEach(u=>t(QF(u,o)))}catch(u){n(u)}}function QF(r,e){const s=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((p,m)=>(p[m]=s.getAttribute(`ttp:${m}`)||i[m],p),{}),u=s.getAttribute("xml:space")!=="preserve",d=Ix(Hf(s,"styling","style")),c=Ix(Hf(s,"layout","region")),f=Hf(s,"body","[begin]");return[].map.call(f,p=>{const m=$b(p,u);if(!m||!p.hasAttribute("begin"))return null;const y=zf(p.getAttribute("begin"),o),v=zf(p.getAttribute("dur"),o);let S=zf(p.getAttribute("end"),o);if(y===null)throw wx(p);if(S===null){if(v===null)throw wx(p);S=y+v}const T=new Wp(y-e,S-e,m);T.id=Yp(T.startTime,T.endTime,T.text);const A=c[p.getAttribute("region")],L=d[p.getAttribute("style")],w=ZF(A,L,d),{textAlign:C}=w;if(C){const P=XF[C];P&&(T.lineAlign=P),T.align=C}return rt(T,w),T}).filter(p=>p!==null)}function Hf(r,e,t){const n=r.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function Ix(r){return r.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function $b(r,e){return[].slice.call(r.childNodes).reduce((t,n,s)=>{var i;return n.nodeName==="br"&&s?t+`
`:(i=n.childNodes)!=null&&i.length?$b(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function ZF(r,e,t){const n="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),i.reduce((u,d)=>{const c=Kf(e,n,d)||Kf(r,n,d)||Kf(s,n,d);return c&&(u[d]=c),u},{})}function Kf(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function wx(r){return new Error(`Could not parse ttml timestamp ${r}`)}function zf(r,e){if(!r)return null;let t=Mb(r);return t===null&&(Ub.test(r)?t=JF(r,e):jb.test(r)&&(t=e2(r,e))),t}function JF(r,e){const t=Ub.exec(r),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function e2(r,e){const t=jb.exec(r),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class pu{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class t2{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Cx(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this),e.on(I.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(I.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(I.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this),e.off(I.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(I.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(I.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new pu(this,"textTrack1"),t=new pu(this,"textTrack2"),n=new pu(this,"textTrack3"),s=new pu(this,"textTrack4");this.cea608Parser1=new Ax(1,e,t),this.cea608Parser2=new Ax(3,n,s)}addCues(e,t,n,s,i){let o=!1;for(let u=i.length;u--;){const d=i[u],c=n2(d[0],d[1],t,n);if(c>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],n),o=!0,c/(n-t)>.5))return}if(o||i.push([t,n]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,n,s)}else{const u=this.Cues.newCue(null,t,n,s);this.hls.trigger(I.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:i,trackId:o}){const{unparsedVttFrags:u}=this;n===Te.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:o}),u.length&&(this.unparsedVttFrags=[],u.forEach(d=>{this.initPTS[d.frag.cc]?this.onFragLoaded(I.FRAG_LOADED,d):this.hls.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let s=0;s<n.textTracks.length;s++){const i=n.textTracks[s];if(Rx(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:s}=this,{label:i,languageCode:o}=t[e],u=this.getExistingTrack(i,o);if(u)n[e]=u,Ji(n[e]),_b(n[e],s);else{const d=this.createTextTrack("captions",i,o);d&&(d[e]=!0,n[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,s={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(I.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,n){const s=this.media;if(s)return s.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{Ji(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Cx(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)Ji(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],s=n.some(i=>i.textCodec===Gf);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(vb(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const o=this.media,u=o?wu(o.textTracks):null;if(this.tracks.forEach((d,c)=>{let f;if(u){let p=null;for(let m=0;m<u.length;m++)if(u[m]&&Rx(u[m],d)){p=u[m],u[m]=null;break}p&&(f=p)}if(f)Ji(f);else{const p=Vb(d);f=this.createTextTrack(p,d.name,d.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),u!=null&&u.length){const d=u.filter(c=>c!==null).map(c=>c.label);d.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${d.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(I.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!s)return;const i=`textTrack${s[1]}`,o=this.captionsProperties[i];o&&(o.label=n.name,n.lang&&(o.languageCode=n.lang),o.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Te.MAIN){var n,s;const{cea608Parser1:i,cea608Parser2:o,lastSn:u}=this,{cc:d,sn:c}=t.frag,f=(n=(s=t.part)==null?void 0:s.index)!=null?n:-1;i&&o&&(c!==u+1||c===u&&f!==this.lastPartIndex+1||d!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=d,this.lastSn=c,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:n,payload:s}=t;if(n.type===Te.SUBTITLE)if(s.byteLength){const i=n.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const u=this.tracks[n.level],d=this.vttCCs;d[n.cc]||(d[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),u&&u.textCodec===Gf?this._parseIMSC1(n,s):this._parseVTTs(t)}}else this.hls.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Lx(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),n.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{n.logger.log(`Failed to parse IMSC1: ${s}`),n.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:n,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,u=i.length-1;if(!i[n.cc]&&u===-1){o.push(e);return}const d=this.hls,c=(t=n.initSegment)!=null&&t.data?Kn(n.initSegment.data,new Uint8Array(s)).buffer:s;qF(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,f=>{this._appendCues(f,n.level),d.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},f=>{const p=f.message==="Missing initPTS for VTT MPEGTS";p?o.push(e):this._fallbackToIMSC1(n,s),d.logger.log(`Failed to parse VTT cue: ${f}`),!(p&&u>n.cc)&&d.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:f})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Lx(t,this.initPTS[e.cc],()=>{n.textCodec=Gf,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>kb(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;n.trigger(I.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===Te.SUBTITLE&&this.onFragLoaded(I.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:s}=t;if(!(n.type===Te.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let i=0;i<s.length;i++){const o=s[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(o);this.cea608Parser1.addData(s[i].pts,u[0]),this.cea608Parser2.addData(s[i].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(!(!o||o.currentTime<n)){if(!i||i==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(d=>Vh(u[d],t,n))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(d=>Vh(u[d],t,s))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let s=2;for(let i=0;i<n;i++){const o=e[s++],u=127&e[s++],d=127&e[s++];if(u===0&&d===0)continue;if((4&o)!==0){const f=3&o;(f===0||f===1)&&(t[f].push(u),t[f].push(d))}}return t}}function Vb(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function Rx(r,e){return!!r&&r.kind===Vb(e)&&Bh(e,r)}function n2(r,e,t,n){return Math.min(e,n)-Math.max(r,t)}function Cx(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const r2=/\s/,s2={newCue(r,e,t,n){const s=[];let i,o,u,d,c;const f=self.VTTCue||self.TextTrackCue;for(let m=0;m<n.rows.length;m++)if(i=n.rows[m],u=!0,d=0,c="",!i.isEmpty()){var p;for(let S=0;S<i.chars.length;S++)r2.test(i.chars[S].uchar)&&u?d++:(c+=i.chars[S].uchar,u=!1);i.cueStartTime=e,e===t&&(t+=1e-4),d>=16?d--:d++;const y=Bb(c.trim()),v=Yp(e,t,y);r!=null&&(p=r.cues)!=null&&p.getCueById(v)||(o=new f(e,t,y),o.id=v,o.line=m+1,o.align="left",o.position=10+Math.min(80,Math.floor(d*8/32)*10),s.push(o))}return r&&s.length&&(s.sort((m,y)=>m.line==="auto"||y.line==="auto"?0:m.line>8&&y.line>8?y.line-m.line:m.line-y.line),s.forEach(m=>kb(r,m))),s}};function i2(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const o2=/(\d+)-(\d+)\/(\d+)/;class Px{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||c2,this.controller=new self.AbortController,this.stats=new Ip}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=a2(e,this.controller.signal),o=e.responseType==="arraybuffer",u=o?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=d&&ve(d)?d:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(_a(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var m;this.response=this.loader=p;const y=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},c-(y-s.loading.start)),!p.ok){const{status:S,statusText:T}=p;throw new d2(T||"fetch, bad network response",S,p)}s.loading.first=y,s.total=u2(p.headers)||s.total;const v=(m=this.callbacks)==null?void 0:m.onProgress;return v&&ve(t.highWaterMark)?this.loadProgressively(p,s,e,t.highWaterMark,v):o?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var m,y;const v=this.response;if(!v)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const S=p[u];S&&(s.loaded=s.total=S);const T={url:v.url,data:p,code:v.status},A=(m=this.callbacks)==null?void 0:m.onProgress;A&&!ve(t.highWaterMark)&&A(s,e,p,v),(y=this.callbacks)==null||y.onSuccess(T,s,e,v)}).catch(p=>{var m;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const y=p&&p.code||0,v=p?p.message:null;(m=this.callbacks)==null||m.onError({code:y,text:v},e,p?p.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,s=0,i){const o=new ZS,u=e.body.getReader(),d=()=>u.read().then(c=>{if(c.done)return o.dataLength&&i(t,n,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=c.value,p=f.length;return t.loaded+=p,p<s||o.dataLength?(o.push(f),o.dataLength>=s&&i(t,n,o.flush().buffer,e)):i(t,n,f.buffer,e),d()}).catch(()=>Promise.reject());return d()}}function a2(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(rt({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function l2(r){const e=o2.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function u2(r){const e=r.get("Content-Range");if(e){const n=l2(e);if(ve(n))return n}const t=r.get("Content-Length");if(t)return parseInt(t)}function c2(r,e){return new self.Request(r.url,e)}class d2 extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const f2=/^age:\s*[\d.]+\s*$/im;class Gb{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Ip,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return i(n,t.url)}).catch(o=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),i(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(o=>{var u;(u=this.callbacks)==null||u.onError({code:n.status,text:o.message},t,n,s)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=n.loadPolicy;if(s)for(const u in s)e.setRequestHeader(u,s[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=i&&ve(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!n.aborted&&s>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,f=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const v=f??t.response;if(v!=null){var o,u;n.loading.end=Math.max(self.performance.now(),n.loading.first);const S=t.responseType==="arraybuffer"?v.byteLength:v.length;n.loaded=n.total=S,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const T=(o=this.callbacks)==null?void 0:o.onProgress;T&&T(n,e,v,t);const A={url:t.responseURL,data:v,code:c};(u=this.callbacks)==null||u.onSuccess(A,n,e,t);return}}const p=i.loadPolicy.errorRetry,m=n.retry,y={url:e.url,data:void 0,code:c};if(zu(p,m,!1,y))this.retry(p);else{var d;tt.error(`${c} while loading ${e.url}`),(d=this.callbacks)==null||d.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(zu(e,t,!0))this.retry(e);else{var n;tt.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=Pp(e,n.retry),n.retry++,tt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&f2.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const h2={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},p2=et(et({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Gb,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:IO,bufferController:gM,capLevelController:Hp,errorController:_O,fpsController:yF,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:$S,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:h2},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},m2()),{},{subtitleStreamController:CF,subtitleTrackController:EF,timelineController:t2,audioStreamController:fM,audioTrackController:hM,emeController:so,cmcdController:hF,contentSteeringController:mF,interstitialsController:RF});function m2(){return{cueHandler:s2,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function g2(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=Hh(r),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const u=`${o==="level"?"playlist":o}LoadPolicy`,d=e[u]===void 0,c=[];i.forEach(f=>{const p=`${o}Loading${f}`,m=e[p];if(m!==void 0&&d){c.push(p);const y=n[u].default;switch(e[u]={default:y},f){case"TimeOut":y.maxLoadTimeMs=m,y.maxTimeToFirstByteMs=m;break;case"MaxRetry":y.errorRetry.maxNumRetry=m,y.timeoutRetry.maxNumRetry=m;break;case"RetryDelay":y.errorRetry.retryDelayMs=m,y.timeoutRetry.retryDelayMs=m;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=m,y.timeoutRetry.maxRetryDelayMs=m;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${u}": ${lt(e[u])}`)}),et(et({},n),e)}function Hh(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(Hh):Object.keys(r).reduce((e,t)=>(e[t]=Hh(r[t]),e),{}):r}function y2(r,e){const t=r.loader;t!==Px&&t!==Gb?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):i2()&&(r.loader=Px,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Ru=2,v2=.1,x2=.05,E2=100;class T2 extends MS{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(E2),this.mediaSource=t.mediaSource;const n=this.media=t.media;fn(n,"playing",this.onMediaPlaying),fn(n,"waiting",this.onMediaWaiting),fn(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(bn(n,"playing",this.onMediaPlaying),bn(n,"waiting",this.onMediaWaiting),bn(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,s;const i=(n=this.hls)==null?void 0:n.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:u}=o,d=this.seeking&&!u,c=!this.seeking&&u,f=o.paused&&!u||o.ended||o.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||d){d&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!1}));return}if(!Ue.getBuffered(o).length){this.nudgeRetry=0;return}const p=Ue.bufferInfo(o,e,0),m=p.nextStart||0,y=this.fragmentTracker;if(u&&y&&this.hls){const B=_x(this.hls.inFlightFragments,e),D=p.len>Ru,N=!m||B||m-e>Ru&&!y.getPartialFragment(e);if(D||N)return;this.moved=!1}const v=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(p.len>0)&&!m)return;const D=Math.max(m,p.start||0)-e,F=!!(v!=null&&v.live)?v.targetduration*2:Ru,O=mu(e,y);if(D>0&&(D<=F||O)){o.paused||this._trySkipBufferHole(O);return}}const S=i.detectStallWithCurrentTimeMs,T=self.performance.now(),A=this.waiting;let L=this.stalled;if(L===null)if(A>0&&T-A<S)L=this.stalled=A;else{this.stalled=T;return}const w=T-L;if(!u&&(w>=S||A)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&!(v!=null&&v.live)&&Math.abs(e-(v?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const P=Ue.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(P,w,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(I.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&s&&s.length>1&&e>s.end(0)){const i=Ue.bufferedInfo(Ue.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=Ue.timeRangesToArray(s),u=Ue.bufferedInfo(o,t,0).bufferedIndex;if(u>-1&&u<o.length-1){const d=Ue.bufferedInfo(o,e,0).bufferedIndex,c=o[u].end,f=o[u+1].start;if((d===-1||d>u)&&f-c<1&&e-c<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${f} buffered index: ${d}`);this.warn(p.message),this.media.currentTime+=1e-6;let m=mu(e,this.fragmentTracker);m&&"fragment"in m?m=m.fragment:m||(m=void 0);const y=Ue.bufferInfo(this.media,e,0);this.hls.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:m,buffer:y.len,bufferInfo:y})}}}}}_tryFixBufferStall(e,t,n){var s,i;const{fragmentTracker:o,media:u}=this,d=(s=this.hls)==null?void 0:s.config;if(!u||!o||!d)return;const c=(i=this.hls)==null?void 0:i.latestLevelDetails,f=mu(n,o);if((f||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const p=e.buffered,m=this.adjacentTraversal(e,n);(p&&p.length>1&&e.len>d.maxBufferHole||e.nextStart&&(e.nextStart-n<d.maxBufferHole||m))&&(t>d.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,s=e.nextStart;if(n&&s){const i=n.getFragAtPos(t,Te.MAIN),o=n.getFragAtPos(s,Te.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:s,stalled:i}=this;if(!s&&i!==null&&n&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${lt(e)})`);this.warn(o.message),t.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!n||!i)return 0;const o=s.currentTime,u=Ue.bufferInfo(s,o,0),d=o<u.start?u.start:u.nextStart;if(d&&this.hls){const f=u.len<=i.maxBufferHole,p=u.len>0&&u.len<1&&s.readyState<3,m=d-o;if(m>0&&(f||p)){if(m>i.maxBufferHole){let v=!1;if(o===0){const S=n.getAppendedFrag(0,Te.MAIN);S&&d<S.end&&(v=!0)}if(!v&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||_x(this.hls.inFlightFragments,d))return 0;let T=!1,A=e.end;for(;A<d;){const L=mu(A,n);if(L)A+=L.duration;else{T=!0;break}}if(T)return 0}}const y=Math.max(d+x2,o+v2);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${y}`),this.moved=!0,s.currentTime=y,!(e!=null&&e.gap)){const v=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${y}`),S={type:we.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?S.part=e:S.frag=e),this.hls.trigger(I.ERROR,S)}return y}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:s}=this,i=t?.config;if(!n||!i)return 0;const o=n.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const u=o+(s+1)*i.nudgeOffset,d=new Error(`Nudging 'currentTime' from ${o} to ${u}`);this.warn(d.message),n.currentTime=u,t.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function _x(r,e){const t=kx(r.main);if(t&&t.start<=e)return t;const n=kx(r.audio);return n&&n.start<=e?n:null}function kx(r){if(!r)return null;switch(r.state){case se.IDLE:case se.STOPPED:case se.ENDED:case se.ERROR:return null}return r.frag}function mu(r,e){return e.getAppendedFrag(r,Te.MAIN)||e.getPartialFragment(r)}const S2=.25;function Kh(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Wf(r,e,t,n,s){let i=new r(e,t,"");try{i.value=n,s&&(i.type=s)}catch{i=new r(e,t,lt(s?et({type:s},n):n))}return i}const gu=(()=>{const r=Kh();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class b2{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(I.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Ji(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return _b(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:s}=this.hls.config;if(!n&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Kh();if(o)for(let u=0;u<i.length;u++){const d=i[u].type;if(d===Dn.emsg&&!n||!s)continue;const c=ib(i[u].data),f=i[u].pts;let p=f+i[u].duration;p>gu&&(p=gu),p-f<=0&&(p=f+S2);for(let y=0;y<c.length;y++){const v=c[y];if(!ob(v)){this.updateId3CueEnds(f,d);const S=Wf(o,f,p,v,d);S&&this.id3Track.addCue(S)}}}}updateId3CueEnds(e,t){var n;const s=(n=this.id3Track)==null?void 0:n.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===gu&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:d}}=o;if(i&&(u||d)){let c;s==="audio"?c=f=>f.type===Dn.audioId3&&d:s==="video"?c=f=>f.type===Dn.emsg&&u:c=f=>f.type===Dn.audioId3&&d||f.type===Dn.emsg&&u,Vh(i,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const u=Kh();if(n&&s&&!o){const{fragmentStart:S,fragmentEnd:T}=e;let A=this.assetCue;A?(A.startTime=S,A.endTime=T):u&&(A=this.assetCue=Wf(u,S,T,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),A&&(A.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(A),A.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:d}=this,{dateRanges:c}=e,f=Object.keys(c);let p=this.dateRangeCuesAppended;if(d&&t){var m;if((m=d.cues)!=null&&m.length){const S=Object.keys(p).filter(T=>!f.includes(T));for(let T=S.length;T--;){var y;const A=S[T],L=(y=p[A])==null?void 0:y.cues;delete p[A],L&&Object.keys(L).forEach(w=>{const C=L[w];if(C){C.removeEventListener("enter",this.onEventCueEnter);try{d.removeCue(C)}catch{}}})}}else p=this.dateRangeCuesAppended={}}const v=e.fragments[e.fragments.length-1];if(!(f.length===0||!ve(v?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let S=0;S<f.length;S++){const T=f[S],A=c[T],L=A.startTime,w=p[T],C=w?.cues||{};let P=w?.durationKnown||!1,B=gu;const{duration:D,endDate:N}=A;if(N&&D!==null)B=L+D,P=!0;else if(A.endOnNext&&!P){const O=f.reduce((V,H)=>{if(H!==A.id){const te=c[H];if(te.class===A.class&&te.startDate>A.startDate&&(!V||A.startDate<V.startDate))return te}return V},null);O&&(B=O.startTime,P=!0)}const F=Object.keys(A.attr);for(let O=0;O<F.length;O++){const V=F[O];if(!HO(V))continue;const H=C[V];if(H)P&&!(w!=null&&w.durationKnown)?H.endTime=B:Math.abs(H.startTime-L)>.01&&(H.startTime=L,H.endTime=B);else if(u){let te=A.attr[V];KO(V)&&(te=gS(te));const ae=Wf(u,L,B,{key:V,data:te},Dn.dateRange);ae&&(ae.id=T,this.id3Track.addCue(ae),C[V]=ae,o&&(V==="X-ASSET-LIST"||V==="X-ASSET-URL")&&ae.addEventListener("enter",this.onEventCueEnter))}}p[T]={cues:C,dateRange:A,durationKnown:P}}}}}class A2{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!n.live)return;const u=this.targetLatency;if(u===null)return;const d=s-u,c=Math.min(this.maxLatency,u+n.targetduration);if(d<c&&d>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,o)),m=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20,y=Math.min(p,Math.max(1,m));this.changeMediaPlaybackRate(t,y)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:u}=this.config,d=this.hls.userConfig;let c=u&&n||t;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||c===0)&&(c=i!==void 0?i:o*s);const f=s;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const s=n.edge,i=e-t-this.edgeStalled,o=s-n.totalduration,u=s-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(o,i),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===z.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,s;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class L2 extends Gp{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,s=[],i={},o={};let u=!1,d=!1,c=!1;t.levels.forEach(f=>{const p=f.attrs;let{audioCodec:m,videoCodec:y}=f;m&&(f.audioCodec=m=Vu(m,n)||void 0),y&&(y=f.videoCodec=aO(y));const{width:v,height:S,unknownCodecs:T}=f,A=T?.length||0;if(u||(u=!!(v&&S)),d||(d=!!y),c||(c=!!m),A||m&&!this.isAudioSupported(m)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:L,"FRAME-RATE":w,"HDCP-LEVEL":C,"PATHWAY-ID":P,RESOLUTION:B,"VIDEO-RANGE":D}=p,F=`${`${P||"."}-`}${f.bitrate}-${B}-${w}-${L}-${D}-${C}`;if(i[F])if(i[F].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const O=o[F]+=1;f.attrs["PATHWAY-ID"]=new Array(O+1).join(".");const V=this.createLevel(f);i[F]=V,s.push(V)}else i[F].addGroupId("audio",p.AUDIO),i[F].addGroupId("text",p.SUBTITLES);else{const O=this.createLevel(f);i[F]=O,o[F]=1,s.push(O)}}),this.filterAndSortMediaOptions(s,t,u,d,c)}createLevel(e){const t=new Ra(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(s.message),t.supportedResult=RS(s,[])}return t}isAudioSupported(e){return Ia(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ia(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,s,i){var o;let u=[],d=[],c=e;const f=((o=t.stats)==null?void 0:o.parsing)||{};if((n||s)&&i&&(c=c.filter(({videoCodec:L,videoRange:w,width:C,height:P})=>(!!L||!!(C&&P))&&yO(w))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let L="no level with compatible codecs found in manifest",w=L;t.levels.length&&(w=`one or more CODECS in variant not supported: ${lt(t.levels.map(P=>P.attrs.CODECS).filter((P,B,D)=>D.indexOf(P)===B))}`,this.warn(w),L+=` (${w})`);const C=new Error(L);this.hls.trigger(I.ERROR,{type:we.MEDIA_ERROR,details:z.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:C,reason:w})}}),f.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(L=>!L.audioCodec||this.isAudioSupported(L.audioCodec)),Dx(u)),t.subtitles&&(d=t.subtitles,Dx(d));const p=c.slice(0);c.sort((L,w)=>{if(L.attrs["HDCP-LEVEL"]!==w.attrs["HDCP-LEVEL"])return(L.attrs["HDCP-LEVEL"]||"")>(w.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&L.height!==w.height)return L.height-w.height;if(L.frameRate!==w.frameRate)return L.frameRate-w.frameRate;if(L.videoRange!==w.videoRange)return Gu.indexOf(L.videoRange)-Gu.indexOf(w.videoRange);if(L.videoCodec!==w.videoCodec){const C=Av(L.videoCodec),P=Av(w.videoCodec);if(C!==P)return P-C}if(L.uri===w.uri&&L.codecSet!==w.codecSet){const C=$u(L.codecSet),P=$u(w.codecSet);if(C!==P)return P-C}return L.averageBitrate!==w.averageBitrate?L.averageBitrate-w.averageBitrate:0});let m=p[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==p.length)){for(let L=0;L<p.length;L++)if(p[L].pathwayId===c[0].pathwayId){m=p[L];break}}this._levels=c;for(let L=0;L<c.length;L++)if(c[L]===m){var y;this._firstLevel=L;const w=m.bitrate,C=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${w}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){const P=Math.min(w,this.hls.config.abrEwmaDefaultEstimateMax);P>C&&C===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=P)}break}const v=i&&!s,S=this.hls.config,T=!!(S.audioStreamController&&S.audioTrackController),A={levels:c,audioTracks:u,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:T&&!v&&u.some(L=>!!L.url)};f.end=performance.now(),this.hls.trigger(I.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(I.ERROR,{type:we.OTHER_ERROR,details:z.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:f,reason:f.message}),p)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],u=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,n===e&&s&&i===u)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${u?" with Pathway "+u:""} from level ${n}${i?" with Pathway "+i:""}`);const d={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(I.LEVEL_SWITCHING,d);const c=o.details;if(!c||c.live){const f=this.switchParams(o.uri,s?.details,c);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===Ye.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Te.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(i=>!!n[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var n;const{level:s,details:i}=t,o=t.levelInfo;if(!o){var u;this.warn(`Invalid level index ${s}`),(u=t.deliveryDirectives)!=null&&u.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let d=o.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(s,t,d)}else(n=t.deliveryDirectives)!=null&&n.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,u=o?.age;this.log(`Loading level index ${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${n}`),this.hls.trigger(I.LEVEL_LOADING,{url:n,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(u=>u.level=-1)),!1));qS(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=n.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(I.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(I.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function Dx(r){const e={};r.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function Hb(){return self.SourceBuffer||self.WebKitSourceBuffer}function Kb(){if(!ws())return!1;const e=Hb();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function I2(){if(!Kb())return!1;const r=ws();return typeof r?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(wa(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(wa(e,"audio"))))}function w2(){var r;const e=Hb();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const R2=100;class C2 extends Np{constructor(e,t,n){super(e,t,n,"stream-controller",Te.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!ve(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(s,i,Te.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:s}=this;if(this.stopLoad(),this.setInterval(R2),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=se.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=se.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case se.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e?.[t],s=n?.details;if(s&&(!s.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(s))break;this.state=se.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=se.IDLE;break}break}case se.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===se.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[i]))return;const o=n[i],u=this.getMainFwdBufferInfo();if(u===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(u,d)){const S={};this.altAudio===2&&(S.type="video"),this.hls.trigger(I.BUFFER_EOS,S),this.state=se.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const c=o.details;if(!c||this.state===se.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=se.WAITING_LEVEL,this.startFragRequested=!1;return}const f=u.len,p=this.getMaxBufferLength(o.maxBitrate);if(f>=p)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const m=this.backtrackFragment?this.backtrackFragment.start:u.end;let y=this.getNextFragment(m,c);if(this.couldBacktrack&&!this.fragPrevious&&y&&Ft(y)&&this.fragmentTracker.getState(y)!==Vt.OK){var v;const T=((v=this.backtrackFragment)!=null?v:y).sn-c.startSN,A=c.fragments[T-1];A&&y.cc===A.cc&&(y=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,m)){if(!y.gap){const T=this.audioOnly&&!this.altAudio?at.AUDIO:at.VIDEO,A=(T===at.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,T,Te.MAIN)}y=this.getNextFragmentLoopLoading(y,c,u,Te.MAIN,p)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,o,m))}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);s===Vt.NOT_LOADED||s===Vt.PARTIAL?Ft(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Te.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<i.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,d=e[u],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*d.maxBitrate/(1e3*c)+1:n=0}else n=0;const o=this.getBufferedFrag(t.currentTime+n);if(o){const u=this.followingBufferedFrag(o);if(u){this.abortCurrentFrag();const d=u.maxStartPTS?u.maxStartPTS:u.start,c=u.duration,f=Math.max(o.end,d+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case se.KEY_LOADING:case se.FRAG_LOADING:case se.FRAG_LOADING_WAITING_RETRY:case se.PARSING:case se.PARSED:this.state=se.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;fn(n,"playing",this.onMediaPlaying),fn(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(bn(n,"playing",this.onMediaPlaying),bn(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,s=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(n=n||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&s&&!w2(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==se.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=se.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:s,startFragRequested:i}=this,o=t.level,u=t.details,d=u.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${d}`);const c=t.levelInfo,f=this.fragCurrent;f&&(this.state===se.FRAG_LOADING||this.state===se.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let p=0;if(u.live||(n=c.details)!=null&&n.live){var m;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;p=this.alignPlaylists(u,c.details,(m=this.levelLastLoaded)==null?void 0:m.details)}if(c.details=u,this.levelLastLoaded=c,i||this.setStartPosition(u,p),this.hls.trigger(I.LEVEL_UPDATED,{details:u,level:o}),this.state===se.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=se.IDLE}i&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,u=e.edge,d=i>=o-t.maxFragLookUpTolerance&&i<=u;if(s!==null&&n.duration>s&&(i<s||!d)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!d&&n.readyState<4||i<u-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),n.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const p=Ue.bufferInfo(n,s,0);if(!((c=p.buffered)!=null&&c.length)){n.currentTime=s;return}if(p.start<=i){n.currentTime=s;return}const{nextStart:y}=Ue.bufferedInfo(p.buffered,i,0);y&&(n.currentTime=y)}else n.currentTime=s}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=o[n.level];if(!u){this.warn(`Level ${n.level} not found on progress`);return}const d=u.details;if(!d){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=u.videoCodec,f=d.PTSKnown||!d.live,p=(t=n.initSegment)==null?void 0:t.data,m=this._getAudioCodec(u),y=this.transmuxer=this.transmuxer||new yb(this.hls,Te.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=s?s.index:-1,S=v!==-1,T=new kp(n.level,n.sn,n.stats.chunkCount,i.byteLength,v,S),A=this.initPTS[n.cc];y.push(i,p,m,c,n,s,d.totalduration,f,T,A)}onAudioTrackSwitching(e,t){const n=this.hls,s=this.altAudio===2;if(Hu(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.fragmentTracker.removeAllFragments(),n.once(I.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(I.AUDIO_TRACK_SWITCHED,t)}),n.trigger(I.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(I.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=Hu(t.url,this.hls);if(n){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let s,i,o=!1;for(const u in n){const d=n[u];if(d.id==="main"){if(i=u,s=d,u==="video"){const c=n[u];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:s}=t,i=n.type===Te.MAIN;if(i){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===se.PARSED&&(this.state=se.IDLE);return}const u=s?s.stats:n.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),Ft(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,s)}const o=this.media;o&&(!this._hasEnoughToStart&&Ue.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=se.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Te.MAIN,t);break;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===se.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===Ye.LEVEL&&(this.state=se.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=se.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==at.AUDIO||!this.altAudio){const n=(t===at.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,Te.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&n&&(n+=s);const i=this.getLevelDetails(),o=Ue.getBuffered(e),u=o.length?o.start(0):0,d=u-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<c||this.loadingParts&&d<2*(i?.partTarget||0)))&&(this.log(`adjusting start position by ${d} to match buffer start`),n+=d,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${u}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:s}=this,i=n?.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=se.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(I.FRAG_LOADED,n),i.bitrateTest=!1}).catch(n=>{this.state===se.STOPPED||this.state===se.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:s,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:u,part:d,level:c}=o,{video:f,text:p,id3:m,initSegment:y}=s,{details:v}=c,S=this.altAudio?void 0:s.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=se.PARSING,y){const T=y.tracks;if(T){const C=u.initSegment||u;if(this.unhandledEncryptionError(y,u))return;this._bufferInitSegment(c,T,C,i),n.trigger(I.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:t,tracks:T})}const A=y.initPTS,L=y.timescale,w=this.initPTS[u.cc];if(ve(A)&&(!w||w.baseTime!==A||w.timescale!==L)){const C=y.trackId;this.initPTS[u.cc]={baseTime:A,timescale:L,trackId:C},n.trigger(I.INIT_PTS_FOUND,{frag:u,id:t,initPTS:A,timescale:L,trackId:C})}}if(f&&v){S&&f.type==="audiovideo"&&this.logMuxedErr(u);const T=v.fragments[u.sn-1-v.startSN],A=u.sn===v.startSN,L=!T||u.cc>T.cc;if(s.independent!==!1){const{startPTS:w,endPTS:C,startDTS:P,endDTS:B}=f;if(d)d.elementaryStreams[f.type]={startPTS:w,endPTS:C,startDTS:P,endDTS:B};else if(f.firstKeyFrame&&f.independent&&i.id===1&&!L&&(this.couldBacktrack=!0),f.dropped&&f.independent){const D=this.getMainFwdBufferInfo(),N=(D?D.end:this.getLoadPosition())+this.config.maxBufferHole,F=f.firstKeyFramePTS?f.firstKeyFramePTS:w;if(!A&&N<F-this.config.maxBufferHole&&!L){this.backtrack(u);return}else L&&(u.gap=!0);u.setElementaryStreamInfo(f.type,u.start,C,u.start,B,!0)}else A&&w-(v.appliedTimelineOffset||0)>Ru&&(u.gap=!0);u.setElementaryStreamInfo(f.type,w,C,P,B),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(f,u,d,i,A||L)}else if(A||L)u.gap=!0;else{this.backtrack(u);return}}if(S){const{startPTS:T,endPTS:A,startDTS:L,endDTS:w}=S;d&&(d.elementaryStreams[at.AUDIO]={startPTS:T,endPTS:A,startDTS:L,endDTS:w}),u.setElementaryStreamInfo(at.AUDIO,T,A,L,w),this.bufferFragmentData(S,u,d,i)}if(v&&m!=null&&m.samples.length){const T={id:t,frag:u,details:v,samples:m.samples};n.trigger(I.FRAG_PARSING_METADATA,T)}if(v&&p){const T={id:t,frag:u,details:v,samples:p.samples};n.trigger(I.FRAG_PARSING_USERDATA,T)}}logMuxedErr(e){this.warn(`${Ft(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,s){if(this.state!==se.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:i,video:o,audiovideo:u}=t;if(i){const c=e.audioCodec;let f=Tu(i.codec,c);f==="mp4a"&&(f="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const m=i.metadata;m&&"channelCount"in m&&(m.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),c&&c!==f&&this.log(`Swapping manifest audio codec "${c}" for "${f}"`),i.levelCodec=f,i.id=Te.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${f||""}/${c||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=Te.MAIN;const c=o.codec;if(c?.length===4)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const d=Object.keys(t);if(d.length){if(this.hls.trigger(I.BUFFER_CODECS,t),!this.hls)return;d.forEach(c=>{const p=t[c].initSegment;p!=null&&p.byteLength&&this.hls.trigger(I.BUFFER_APPENDING,{type:c,data:p,frag:n,part:null,chunkMeta:s,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Te.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e?.[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=se.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(Ue.isBuffered(e,n)?t=this.getAppendedFrag(n):Ue.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(I.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(I.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ve(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ve(t)){const n=this.getLevelDetails(),s=this.currentFrag||(n?ai(null,n.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const o=i+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class P2 extends Wn{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[n].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=z.KEY_LOAD_ERROR,n,s,i){return new Br({type:we.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:n,networkDetails:s})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const o=t[s];if(e.cc<=o.cc&&(!Ft(e)||!Ft(o)||e.sn<o.sn)||!n&&s==i-1)return this.emeController.selectKeySystemFormat(o).then(u=>{if(!this.emeController)return;o.setKeyFormat(u);const d=bu(u);if(d)return this.emeController.getKeySystemAccess([d])})}if(this.config.requireKeySystemAccessOnStart){const s=la(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,c))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const u=Yf(i);let d=this.keyIdToKeyInfo[u];if((n=d)!=null&&n.decryptdata.key)return i.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if(this.emeController&&(s=d)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(d.decryptdata)){case"usable":case"usable-in-future":return d.keyLoadPromise.then(f=>{const{keyInfo:p}=f;return i.key=p.decryptdata.key,{frag:e,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${i.keyId?" keyId: "+dn(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),d=this.keyIdToKeyInfo[u]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const o=qD(t.initSegment.data);if(o.length){const u=o[0];u.some(d=>d!==0)&&(this.log(`Using keyId found in init segment ${dn(u)}`),e.decryptdata.keyId=u,si.setKeyIdForUri(e.decryptdata.uri,u))}}const i=this.emeController.loadKey(n);return(e.keyLoadPromise=i.then(o=>(e.mediaKeySessionContext=o,n))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,s=n.loader,i=new s(n);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,u)=>{const d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,f={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,y,v,S)=>{const{frag:T,keyInfo:A}=v,L=Yf(A.decryptdata);if(!T.decryptdata||A!==this.keyIdToKeyInfo[L])return u(this.createKeyLoadError(T,z.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));A.decryptdata.key=T.decryptdata.key=new Uint8Array(m.data),T.keyLoader=null,A.loader=null,o({frag:T,keyInfo:A})},onError:(m,y,v,S)=>{this.resetLoader(y),u(this.createKeyLoadError(t,z.KEY_LOAD_ERROR,new Error(`HTTP Error ${m.code} loading key ${m.text}`),v,et({url:d.url,data:void 0},m)))},onTimeout:(m,y,v)=>{this.resetLoader(y),u(this.createKeyLoadError(t,z.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:(m,y,v)=>{this.resetLoader(y),u(this.createKeyLoadError(t,z.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};i.load(d,f,p)})}resetLoader(e){const{frag:t,keyInfo:n,url:s}=e,i=n.loader;t.keyLoader===i&&(t.keyLoader=null,n.loader=null);const o=Yf(n.decryptdata)||s;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function Yf(r){if(r.keyFormat!==Zt.FAIRPLAY){const e=r.keyId;if(e)return dn(e)}return r.uri}function Ox(r){const{type:e}=r;switch(e){case Ye.AUDIO_TRACK:return Te.AUDIO;case Ye.SUBTITLE_TRACK:return Te.SUBTITLE;default:return Te.MAIN}}function qf(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class _2{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(I.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(I.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,s=t.loader,i=n||s,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ye.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:s,pathwayId:i,url:o,deliveryDirectives:u,levelInfo:d}=t;this.load({id:n,level:s,pathwayId:i,responseType:"text",type:Ye.LEVEL,url:o,deliveryDirectives:u,levelOrTrack:d})}onAudioTrackLoading(e,t){const{id:n,groupId:s,url:i,deliveryDirectives:o,track:u}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:Ye.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:n,groupId:s,url:i,deliveryDirectives:o,track:u}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:Ye.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:u})}onLevelsUpdated(e,t){const n=this.loaders[Ye.LEVEL];if(n){const s=n.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(n.abort(),delete this.loaders[Ye.LEVEL])}}load(e){var t;const n=this.hls.config;let s=this.getInternalLoader(e);if(s){const c=this.hls.logger,f=s.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===Ye.MANIFEST?i=n.manifestLoadPolicy.default:i=rt({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),ve((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===Ye.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===Ye.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===Ye.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const f=c.partTarget,p=c.targetduration;if(f&&p){const m=Math.max(f*3,p*.8)*1e3;i=rt({},i,{maxTimeToFirstByteMs:Math.min(m,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(m,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},u={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},d={onSuccess:(c,f,p,m)=>{const y=this.getInternalLoader(p);this.resetInternalLoader(p.type);const v=c.data;f.parsing.start=performance.now(),yr.isMediaPlaylist(v)||p.type!==Ye.MANIFEST?this.handleTrackOrLevelPlaylist(c,f,p,m||null,y):this.handleMasterPlaylist(c,f,p,m)},onError:(c,f,p,m)=>{this.handleNetworkError(f,p,!1,c,m)},onTimeout:(c,f,p)=>{this.handleNetworkError(f,p,!0,void 0,c)}};s.load(e,u,d)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,s){const i=this.hls,o=e.data,u=qf(e,n),d=yr.parseMasterPlaylist(o,u);if(d.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,d.playlistParsingError,s,t);return}const{contentSteering:c,levels:f,sessionData:p,sessionKeys:m,startTimeOffset:y,variableList:v}=d;this.variableList=v,f.forEach(L=>{const{unknownCodecs:w}=L;if(w){const{preferManagedMediaSource:C}=this.hls.config;let{audioCodec:P,videoCodec:B}=L;for(let D=w.length;D--;){const N=w[D];Ia(N,"audio",C)?(L.audioCodec=P=P?`${P},${N}`:N,uo.audio[P.substring(0,4)]=2,w.splice(D,1)):Ia(N,"video",C)&&(L.videoCodec=B=B?`${B},${N}`:N,uo.video[B.substring(0,4)]=2,w.splice(D,1))}}});const{AUDIO:S=[],SUBTITLES:T,"CLOSED-CAPTIONS":A}=yr.parseMasterPlaylistMedia(o,u,d);S.length&&!S.some(w=>!w.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new St({}),bitrate:0,url:""})),i.trigger(I.MANIFEST_LOADED,{levels:f,audioTracks:S,subtitles:T,captions:A,contentSteering:c,url:u,stats:t,networkDetails:s,sessionData:p,sessionKeys:m,startTimeOffset:y,variableList:v})}handleTrackOrLevelPlaylist(e,t,n,s,i){const o=this.hls,{id:u,level:d,type:c}=n,f=qf(e,n),p=ve(d)?d:ve(u)?u:0,m=Ox(n),y=yr.parseLevelPlaylist(e.data,f,p,m,0,this.variableList);if(c===Ye.MANIFEST){const v={attrs:new St({}),bitrate:0,details:y,name:"",url:f};y.requestScheduled=t.loading.start+zS(y,0),o.trigger(I.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:f,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=y,this.handlePlaylistLoaded(y,e,t,n,s,i)}handleManifestParsingError(e,t,n,s,i){this.hls.trigger(I.ERROR,{type:we.NETWORK_ERROR,details:z.MANIFEST_PARSING_ERROR,fatal:t.type===Ye.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,n=!1,s,i){let o=`A network ${n?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Ye.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Ye.AUDIO_TRACK||e.type===Ye.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let d=z.UNKNOWN,c=!1;const f=this.getInternalLoader(e);switch(e.type){case Ye.MANIFEST:d=n?z.MANIFEST_LOAD_TIMEOUT:z.MANIFEST_LOAD_ERROR,c=!0;break;case Ye.LEVEL:d=n?z.LEVEL_LOAD_TIMEOUT:z.LEVEL_LOAD_ERROR,c=!1;break;case Ye.AUDIO_TRACK:d=n?z.AUDIO_TRACK_LOAD_TIMEOUT:z.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case Ye.SUBTITLE_TRACK:d=n?z.SUBTITLE_TRACK_LOAD_TIMEOUT:z.SUBTITLE_LOAD_ERROR,c=!1;break}f&&this.resetInternalLoader(e.type);const p={type:we.NETWORK_ERROR,details:d,fatal:c,url:e.url,loader:f,context:e,error:u,networkDetails:t,stats:i};if(s){const m=t?.url||e.url;p.response=et({url:m,data:void 0},s)}this.hls.trigger(I.ERROR,p)}handlePlaylistLoaded(e,t,n,s,i,o){const u=this.hls,{type:d,level:c,levelOrTrack:f,id:p,groupId:m,deliveryDirectives:y}=s,v=qf(t,s),S=Ox(s);let T=typeof s.level=="number"&&S===Te.MAIN?c:void 0;const A=e.playlistParsingError;if(A){if(this.hls.logger.warn(`${A} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(I.ERROR,{type:we.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:A,reason:A.message,response:t,context:s,level:T,parent:S,networkDetails:i,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const L=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(I.ERROR,{type:we.NETWORK_ERROR,details:z.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:L,reason:L.message,response:t,context:s,level:T,parent:S,networkDetails:i,stats:n});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case Ye.MANIFEST:case Ye.LEVEL:if(T){if(!f)T=0;else if(f!==u.levels[T]){const L=u.levels.indexOf(f);L>-1&&(T=L)}}u.trigger(I.LEVEL_LOADED,{details:e,levelInfo:f||u.levels[0],level:T||0,id:p||0,stats:n,networkDetails:i,deliveryDirectives:y,withoutMultiVariant:d===Ye.MANIFEST});break;case Ye.AUDIO_TRACK:u.trigger(I.AUDIO_TRACK_LOADED,{details:e,track:f,id:p||0,groupId:m||"",stats:n,networkDetails:i,deliveryDirectives:y});break;case Ye.SUBTITLE_TRACK:u.trigger(I.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:p||0,groupId:m||"",stats:n,networkDetails:i,deliveryDirectives:y});break}}}class mr{static get version(){return Ca}static isMSESupported(){return Kb()}static isSupported(){return I2()}static getMediaSource(){return ws()}static get Events(){return I}static get MetadataSchema(){return Dn}static get ErrorTypes(){return we}static get ErrorDetails(){return z}static get DefaultConfig(){return mr.defaultConfig?mr.defaultConfig:p2}static set DefaultConfig(e){mr.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Mp,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=FD(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=g2(mr.DefaultConfig,e,t);this.userConfig=e,n.progressive&&y2(n,t);const{abrController:s,bufferController:i,capLevelController:o,errorController:u,fpsController:d}=n,c=new u(this),f=this.abrController=new s(this),p=new kO(this),m=n.interstitialsController,y=m?this.interstitialsController=new m(this,mr):null,v=this.bufferController=new i(this,p),S=this.capLevelController=new o(this),T=new d(this),A=new _2(this),L=n.contentSteeringController,w=L?new L(this):null,C=this.levelController=new L2(this,w),P=new b2(this),B=new P2(this.config,this.logger),D=this.streamController=new C2(this,p,B),N=this.gapController=new T2(this,p);S.setStreamController(D),T.setStreamController(D);const F=[A,C,D];y&&F.splice(1,0,y),w&&F.splice(1,0,w),this.networkControllers=F;const O=[f,v,N,S,T,P,p];this.audioTrackController=this.createController(n.audioTrackController,F);const V=n.audioStreamController;V&&F.push(this.audioStreamController=new V(this,p,B)),this.subtitleTrackController=this.createController(n.subtitleTrackController,F);const H=n.subtitleStreamController;H&&F.push(this.subtititleStreamController=new H(this,p,B)),this.createController(n.timelineController,O),B.emeController=this.emeController=this.createController(n.emeController,O),this.cmcdController=this.createController(n.cmcdController,O),this.latencyController=this.createController(A2,O),this.coreComponents=O,F.push(c);const te=c.onErrorOut;typeof te=="function"&&this.on(I.ERROR,te,c),this.on(I.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,s){this._emitter.off(e,t,n,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const s=e===I.ERROR;this.trigger(I.ERROR,{type:we.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:s,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(I.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(I.ERROR,{type:we.OTHER_ERROR,details:z.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,s=t?e:{media:n};this._media=n,this.trigger(I.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(I.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(I.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,s=this._url=Lp.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&n&&(n!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(I.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Te.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Te.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Te.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=TF()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){gO(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let s=0;s<n;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,n)for(let i=s;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=n)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=_S(t);return CS(e,n,navigator.mediaCapabilities)}}mr.defaultConfig=void 0;const k2=({sellers:r,products:e,onAddToCart:t})=>{const{id:n}=qh(),[s]=Yx(),i=zn(),o=_.useRef(null),u=r.find(v=>v.id===parseInt(n)),d=e.find(v=>v.name===u?.featuredProduct.name),c=s.get("type"),f=s.get("src");if(_.useEffect(()=>{if(c==="mux"&&f&&o.current){const v=o.current;if(mr.isSupported()){const S=new mr;S.loadSource(f),S.attachMedia(v),S.on(mr.Events.MANIFEST_PARSED,()=>{v.play().catch(T=>console.error("Playback failed",T))})}else v.canPlayType("application/vnd.apple.mpegurl")&&(v.src=f,v.addEventListener("loadedmetadata",()=>{v.play().catch(S=>console.error("Playback failed",S))}))}},[c,f]),!u||!d)return x.jsx(an,{children:x.jsxs("div",{className:"text-center py-20",children:[x.jsx("h1",{className:"text-2xl font-bold",children:"Live no encontrado"}),x.jsx(nt,{onClick:()=>i("/"),className:"mt-4 bg-primary text-primary-foreground hover:bg-primary/90",children:"Volver al inicio"})]})});const p=()=>{As({title:"Compra iniciada",description:"🚧 El proceso de compra estará disponible próximamente. 🚀"})},m=()=>{t(d),As({title:"Producto agregado",description:`${d.name} se agregó al carrito`})},y=()=>c==="iframe"?x.jsx("iframe",{className:"w-full h-full",src:f,title:`Live de ${u.name}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):x.jsx("video",{ref:o,className:"w-full h-full object-contain",controls:!0,playsInline:!0});return x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsxs("title",{children:["LIVE: ",u.name," - SimpleMarket360"]}),x.jsx("meta",{name:"description",content:`Viendo el live de ${u.name} en SimpleMarket360. Producto destacado: ${d.name}.`})]}),x.jsx("div",{className:"min-h-screen bg-white",children:x.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[x.jsxs("button",{onClick:()=>i(-1),className:"flex items-center gap-2 text-gray-600 hover:text-primary mb-6","aria-label":"Volver",children:[x.jsx(po,{className:"w-5 h-5"}),"Volver"]}),x.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-primary sr-only",children:["Live de ",u.name]}),x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[x.jsx("div",{className:"lg:col-span-2 bg-black rounded-lg overflow-hidden aspect-video",children:y()}),x.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[x.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[x.jsx("img",{className:"w-16 h-16 rounded-full object-cover",src:u.avatar,alt:`Avatar de ${u.name}`}),x.jsxs("div",{children:[x.jsx("h2",{className:"text-xl font-semibold text-primary",children:u.name}),x.jsx("p",{className:"text-sm text-gray-500",children:u.handle})]})]}),x.jsx("div",{className:"mb-6",children:x.jsx("span",{className:"inline-block bg-accent/20 text-accent text-xs px-2 py-1 rounded",children:u.category})}),x.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[x.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Producto destacado"}),x.jsxs("div",{className:"flex items-start gap-4",children:[x.jsx("img",{src:d.image,alt:d.name,className:"w-24 h-24 object-cover rounded-lg"}),x.jsxs("div",{children:[x.jsx("p",{className:"font-semibold text-primary",children:d.name}),x.jsxs("p",{className:"text-2xl font-bold text-primary mt-2",children:["USD ",d.price]})]})]}),x.jsxs("div",{className:"flex flex-col gap-3 mt-6",children:[x.jsx(nt,{size:"lg",className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",onClick:p,children:"Comprar ahora"}),x.jsx(nt,{size:"lg",variant:"outline",className:"w-full border-primary text-primary hover:bg-gray-50",onClick:m,children:"Agregar al carrito"})]})]})]})]})]})})]})},D2=({categorizedData:r,onAddToCart:e})=>{const{categories:t}=r;return x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsx("title",{children:"Categorías de Productos - SimpleMarket360"}),x.jsx("meta",{name:"description",content:"Explora todos nuestros productos organizados por categorías."})]}),x.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[x.jsxs("header",{className:"py-8 text-center",children:[x.jsx("h1",{className:"text-4xl font-extrabold tracking-tight text-foreground sm:text-5xl",children:"Categorías de Productos"}),x.jsxs("p",{className:"mt-4 text-xl text-muted-foreground",children:["Encuentra exactamente lo que buscas en nuestras ",t.length," categorías."]}),x.jsx("hr",{className:"mt-6 w-48 mx-auto"})]}),t&&t.length>0?t.map(n=>n.items.length>0&&x.jsxs("section",{id:n.slug,className:"py-12",children:[x.jsxs("div",{className:"flex justify-between items-baseline mb-6",children:[x.jsx("h2",{className:"text-3xl font-bold text-foreground",children:n.name}),x.jsxs(ct,{to:`/categories#${n.slug}`,className:"text-sm font-medium text-primary hover:text-primary/90",children:["Ver todos (",n.count,")"]})]}),x.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:n.items.map(s=>x.jsx(cc,{product:s,onAddToCart:e},s.id))})]},n.slug)):x.jsx("div",{className:"text-center py-16",children:x.jsx("p",{className:"text-muted-foreground",children:"Cargando categorías y productos..."})})]})]})},O2=()=>x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsx("title",{children:"Ofertas Especiales - SimpleMarket360"}),x.jsx("meta",{name:"description",content:"Encuentra las mejores ofertas y descuentos en una amplia variedad de productos."})]}),x.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[x.jsxs("div",{className:"text-center",children:[x.jsx("h1",{className:"text-4xl font-extrabold tracking-tight text-foreground sm:text-5xl",children:"Ofertas Especiales"}),x.jsx("p",{className:"mt-4 text-xl text-muted-foreground",children:"¡Grandes descuentos en tus productos favoritos por tiempo limitado!"}),x.jsx("hr",{className:"mt-6 w-48 mx-auto"})]}),x.jsx("div",{className:"mt-12 text-center",children:x.jsx("p",{className:"text-muted-foreground",children:"No hay ofertas especiales en este momento. ¡Vuelve pronto!"})})]})]}),N2=({sellers:r})=>{const e=zn();return x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsx("title",{children:"Vendedores - SimpleMarket360"}),x.jsx("meta",{name:"description",content:"Descubre a todos los vendedores de nuestra comunidad en SimpleMarket360."})]}),x.jsx("div",{className:"min-h-screen bg-background py-8",children:x.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[x.jsx("h1",{className:"text-3xl font-bold text-foreground mb-8 text-center",children:"Nuestros Vendedores"}),x.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6",children:r.map(t=>x.jsxs("div",{onClick:()=>e(`/seller/${t.id}`),className:"bg-card border-border rounded-lg p-4 flex flex-col items-center text-center hover:shadow-md hover:-translate-y-1 transition-all duration-300 cursor-pointer group",children:[x.jsx("img",{src:t.avatar,alt:`Avatar de ${t.name}`,className:"w-24 h-24 rounded-full object-cover mb-4"}),x.jsx("h2",{className:"text-lg font-semibold text-foreground group-hover:text-primary transition-colors",children:t.name}),x.jsx("p",{className:"text-sm text-muted-foreground",children:t.handle}),x.jsx("span",{className:"mt-2 text-xs bg-accent/20 text-accent px-2 py-1 rounded-full",children:t.category})]},t.id))})]})})]})},M2=()=>{const r=e=>{e.preventDefault(),As({title:"Mensaje Enviado",description:"Gracias por contactarnos. Te responderemos pronto."}),e.target.reset()};return x.jsxs(an,{children:[x.jsxs(hn,{children:[x.jsx("title",{children:"Contacto - SimpleMarket360"}),x.jsx("meta",{name:"description",content:"Ponte en contacto con el equipo de SimpleMarket360."})]}),x.jsx("div",{className:"min-h-screen bg-white py-8",children:x.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[x.jsxs("div",{className:"text-center mb-12",children:[x.jsx("h1",{className:"text-3xl font-bold text-primary mb-4",children:"Ponte en Contacto"}),x.jsx("p",{className:"text-gray-600",children:"¿Tienes alguna pregunta? Estamos aquí para ayudarte."})]}),x.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8",children:x.jsxs("form",{onSubmit:r,className:"space-y-6",children:[x.jsxs("div",{children:[x.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre"}),x.jsx("input",{type:"text",id:"name",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),x.jsx("input",{type:"email",id:"email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"Mensaje"}),x.jsx("textarea",{id:"message",rows:"4",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"})]}),x.jsx(nt,{type:"submit",className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",size:"lg",children:"Enviar Mensaje"})]})})]})})]})},F2=()=>x.jsxs(an,{children:[x.jsx(hn,{children:x.jsx("title",{children:"Página no encontrada - SimpleMarket360"})}),x.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 text-center",children:x.jsxs("div",{className:"py-16",children:[x.jsx("h1",{className:"text-6xl font-extrabold text-primary tracking-tight sm:text-8xl",children:"404"}),x.jsx("h2",{className:"text-3xl font-bold text-foreground mt-4",children:"Página no encontrada"}),x.jsx("p",{className:"mt-4 text-lg text-muted-foreground",children:"Lo sentimos, la página que buscas no existe o ha sido movida."}),x.jsx(nt,{asChild:!0,className:"mt-8",children:x.jsx(ct,{to:"/",children:"Volver a la página de inicio"})})]})})]}),B2=({slotKey:r,slotData:e})=>{const[t,n]=_.useState(!1);_.useEffect(()=>{sessionStorage.getItem("stickyAdShown")||n(!0)},[]);const s=()=>{n(!1),sessionStorage.setItem("stickyAdShown","true")};return!t||!e?null:x.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 md:hidden bg-white/80 backdrop-blur-sm p-2 shadow-[0_-4px_10px_rgba(0,0,0,0.1)]",children:x.jsxs("div",{className:"relative",children:[x.jsx(Ap,{slotKey:r,slotData:e}),x.jsx("button",{onClick:s,className:"absolute top-0 right-0 -mt-1 -mr-1 bg-gray-800 text-white rounded-full p-0.5","aria-label":"Cerrar anuncio",children:x.jsx(vp,{className:"w-4 h-4"})})]})})},eo=[{name:"Electrónica & computación",slug:"electronica-computacion"},{name:"Moda & calzado",slug:"moda-calzado"},{name:"Hogar & cocina",slug:"hogar-cocina"},{name:"Belleza & cuidado personal",slug:"belleza-cuidado-personal"},{name:"Deportes & aire libre",slug:"deportes-aire-libre"},{name:"Juguetes, bebés & niños",slug:"juguetes-bebes-ninos"},{name:"Automotriz & motos",slug:"automotriz-motos"},{name:"Construcción & servicios",slug:"construccion-servicios"},{name:"Jardinería & exterior",slug:"jardineria-exterior"},{name:"Herramientas & máquinas",slug:"herramientas-maquinas"}],U2={"electronica-computacion":["smartphone","telefono","iphone","android","tablet","notebook","laptop","pc","aio","monitor","impresora","scanner","ssd","hdd","router","wi fi","wifi","teclado","mouse","auricular","parlante","consola","gaming","cargador","cable","usb"],"moda-calzado":["remera","camisa","jean","pantalon","abrigo","vestido","pollera","zapatilla","bota","sandalia","cartera","mochila","cinturon","gorra"],"hogar-cocina":["licuadora","cafetera","microondas","horno","aspiradora","organizador","estante","almohada","sabana","lampara","vela","vajilla","decoracion","deco"],"belleza-cuidado-personal":["maquillaje","base","labial","serum","crema","shampoo","acondicionador","fragancia","perfume","secador","planchita","barbero","afeitadora"],"deportes-aire-libre":["pesas","mancuerna","bici","bicicleta","casco","carpa","bolsa de dormir","snorkel","balon","pelota","raqueta","running","trekking","banda elastica"],"juguetes-bebes-ninos":["juguete","didactico","lego","bloque","muneco","peluche","patinete","patin","cochecito","butaca","biberon","panal","juego de mesa","rompecabezas"],"automotriz-motos":["auto","automotor","moto","repuesto","filtro","bujia","pastilla de freno","amortiguador","llanta","neumatico","aceite","multimedia","estereo"],"construccion-servicios":["cemento","arena","yeso","placa","durlock","pintura","esmalte","cable","disyuntor","cano","llave inglesa","servicio de albanil","servicio de electricista","servicio de plomero","servicio de pintor","montaje","ferreteria"],"jardineria-exterior":["planta","maceta","sustrato","semilla","manguera","riego","aspersor","parrilla","bbq","reposera","pergola","piscina","inflable","huerta"],"herramientas-maquinas":["taladro","amoladora","atornillador","caladora","soldadora","compresor","neumatica","multimetro","nivel laser","banco de trabajo","sierra","lijadora"]},j2=r=>(r||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");function $2(r){const e=[];if(e.push(r.name||""),r.description&&e.push(r.description),r.brand&&e.push(r.brand),r.attributes)for(const[t,n]of Object.entries(r.attributes))e.push(String(t),String(n));return j2(e.join(" "))}function V2(r,e){const t=U2[e]||[];if(!t.length)return 0;let n=0;for(const s of t){const i=s.replace(/\s+/g," ").trim();i&&r.includes(i)&&n++}return n/Math.min(t.length,20)}function G2(r){const e=$2(r);let t=null;for(const{slug:s}of eo){const i=V2(e,s);i>0&&(!t||i>t.score)&&(t={slug:s,score:i})}if(!t)return["cable","usb","hdmi","bluetooth","adaptador","cargador","fuente"].some(o=>e.includes(o))?{name:"Electrónica & computación",slug:"electronica-computacion",relevanceScore:.1}:null;const n=eo.find(s=>s.slug===t.slug);return{name:n.name,slug:n.slug,relevanceScore:+t.score.toFixed(4)}}function H2(r,e){if(r.relevanceScore!==e.relevanceScore)return e.relevanceScore-r.relevanceScore;const t=r.soldCount??0,n=e.soldCount??0;if(t!==n)return n-t;const s=r.rating??0,i=e.rating??0;if(s!==i)return i-s;const o=r.price??Number.POSITIVE_INFINITY,u=e.price??Number.POSITIVE_INFINITY;return o!==u?o-u:0}function K2(r){const e={};for(const o of eo)e[o.slug]={name:o.name,slug:o.slug,count:0,items:[]};const t=[],n={};eo.forEach(o=>n[o.slug]=0);for(const o of r){const u=G2(o);if(!u){t.push({id:o.id,reason:"no_match"});continue}const d={id:o.id,title:o.name,price:o.price,rating:o.rating,soldCount:o.sold_count,category:u.name,categorySlug:u.slug,relevanceScore:u.relevanceScore,image:o.image};e[u.slug].items.push(d),n[u.slug]+=1}for(const o of eo){const u=e[o.slug];u.items.sort(H2),u.count=u.items.length}const s=eo.map(o=>e[o.slug]),i={all:r.length,byCategory:n};return{categories:s,uncategorized:t,totals:i}}const z2=({user:r,children:e})=>r?e:x.jsx(UI,{to:"/user",replace:!0});function W2(){const r=Cs(),[e,t]=_.useState([]),[n,s]=_.useState([]),[i,o]=_.useState(()=>{const O=localStorage.getItem("users");return O?JSON.parse(O):[]}),[u,d]=_.useState(()=>{const O=localStorage.getItem("currentUser");return O?JSON.parse(O):null}),[c,f]=_.useState(()=>{const O=localStorage.getItem("cartItems");return O?JSON.parse(O):[]}),{theme:p,toggleTheme:m}=ET(),{getSlot:y}=dS();_.useEffect(()=>{const O=async()=>{try{const te=await(await fetch("/livehopp_sellers_30_enhanced.json")).json();s(te)}catch(H){console.error("Failed to fetch sellers:",H)}},V=localStorage.getItem("products");V?t(JSON.parse(V)):(async()=>{try{const X=await(await fetch("/livehopp_products_24.json")).json();t(X),localStorage.setItem("products",JSON.stringify(X))}catch(te){console.error("Failed to fetch products:",te)}})(),O()},[]),_.useEffect(()=>{localStorage.setItem("cartItems",JSON.stringify(c))},[c]),_.useEffect(()=>{localStorage.setItem("users",JSON.stringify(i))},[i]),_.useEffect(()=>{u?localStorage.setItem("currentUser",JSON.stringify(u)):localStorage.removeItem("currentUser")},[u]);const v=O=>{if(i.some(te=>te.email===O.email))return{success:!1,message:"El email ya está registrado."};const H={...O,id:Date.now()};return o(te=>[...te,H]),d(H),{success:!0,message:"¡Registro exitoso!"}},S=O=>{const V=i.find(H=>H.email===O.email&&H.password===O.password);return V?(d(V),{success:!0,message:"¡Inicio de sesión exitoso!"}):{success:!1,message:"Credenciales incorrectas."}},T=()=>{d(null)},A=O=>{const H=[{...O,id:e.length+1,seller:{id:u.id,name:u.name}},...e];t(H),localStorage.setItem("products",JSON.stringify(H))},L=O=>{f(V=>V.find(te=>te.id===O.id)?V.map(te=>te.id===O.id?{...te,quantity:te.quantity+1}:te):[...V,{...O,quantity:1}])},w=O=>{f(V=>V.filter(H=>H.id!==O))},C=(O,V)=>{V<=0?w(O):f(H=>H.map(te=>te.id===O?{...te,quantity:V}:te))},P=()=>{f([])},B=_.useMemo(()=>K2(e),[e]),D=c.reduce((O,V)=>O+V.quantity,0),N=y("ad-prefooter"),F=y("ad-sticky-footer");return x.jsxs("div",{className:`min-h-screen flex flex-col ${p}`,children:[x.jsx(DP,{cartCount:D,toggleTheme:m,theme:p,user:u,onLogout:T}),x.jsx("main",{className:"pt-20 flex-grow",children:x.jsx(ba,{mode:"wait",children:x.jsxs($I,{location:r,children:[x.jsx(Tn,{path:"/",element:x.jsx(eD,{categorizedData:B,sellers:n,onAddToCart:L})}),x.jsx(Tn,{path:"/product/:id",element:x.jsx(tD,{products:e,onAddToCart:L})}),x.jsx(Tn,{path:"/seller/:id",element:x.jsx(nD,{products:e,sellers:n,onAddToCart:L})}),x.jsx(Tn,{path:"/cart",element:x.jsx(z2,{user:u,children:x.jsx(rD,{items:c,onUpdateQuantity:C,onRemove:w,onCheckoutSuccess:P})})}),x.jsx(Tn,{path:"/user",element:x.jsx(fD,{user:u,onLogin:S,onRegister:v,onAddNewProduct:A,userProducts:e.filter(O=>O.seller.id===(u?u.id:null))})}),x.jsx(Tn,{path:"/blog",element:x.jsx(pD,{})}),x.jsx(Tn,{path:"/legal",element:x.jsx(RD,{})}),x.jsx(Tn,{path:"/live/:id",element:x.jsx(k2,{sellers:n,products:e,onAddToCart:L})}),x.jsx(Tn,{path:"/categories",element:x.jsx(D2,{categorizedData:B,onAddToCart:L})}),x.jsx(Tn,{path:"/offers",element:x.jsx(O2,{products:e,onAddToCart:L})}),x.jsx(Tn,{path:"/sellers",element:x.jsx(N2,{sellers:n})}),x.jsx(Tn,{path:"/contact",element:x.jsx(M2,{})}),x.jsx(Tn,{path:"*",element:x.jsx(F2,{})})]},r.pathname)})}),N&&x.jsx("div",{className:"max-w-7xl mx-auto px-4 w-full my-8",children:x.jsx(Ap,{slotKey:"ad-prefooter",slotData:N})}),x.jsx(OP,{}),F&&x.jsx(B2,{slotKey:"ad-sticky-footer",slotData:F}),x.jsx(lk,{})]})}function Y2(){return x.jsx(XI,{children:x.jsx(W2,{})})}const q2=XL.createRoot(document.getElementById("root"));q2.render(x.jsx(Y2,{}));const qp=document.createElement("script");qp.async=!0;qp.src="https://www.googletagmanager.com/gtag/js?id=G-XXXX";document.head.appendChild(qp);const zb=document.createElement("script");zb.innerHTML=`
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXX');
`;document.head.appendChild(zb);
